<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Microsoft Japan Windows Technology Support Blog</title>
  
  <subtitle>日本マイクロソフト Windows Support チームによる、サポート情報 Blog です。</subtitle>
  <link href="https://jpwinsup.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpwinsup.github.io/blog/"/>
  <updated>2025-10-03T00:49:07.708Z</updated>
  <id>https://jpwinsup.github.io/blog/</id>
  
  <author>
    <name>Microsoft Japan Windows Technology Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows 10 ESU に関するよくあるお問い合わせ</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/29/Activation/Windows10-ESU-QA/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/29/Activation/Windows10-ESU-QA/</id>
    <published>2025-09-29T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.708Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事はマイクロソフト社員によって公開されております。</p><p>みなさま、こんにちは。Windows サポート チームです。<br>Windows 10 のサポートは、2025 年 10 月 14 日に終了します。サポート終了後は、基本的にセキュリティ更新および技術サポートが提供されなくなりますが、ESU を適用することで、最大 3 年間セキュリティ更新を受けることができます。<br>本記事では、オンプレミス環境における Windows 10 ESU の認証に関するよくあるお問い合わせをご紹介いたします。</p><ul><li>本内容はすべて本記事記載時点の情報に基づいたものとなりますのでご留意ください。</li></ul><p>初めに、ESU 適用する必要なケースと必要でないケースについて、以下の表をご覧ください。</p><table><thead><tr><th>環境構成</th><th>ESU 適用要否</th><th>ESU キー入手要否</th><th>ESU キー提供形態</th></tr></thead><tbody><tr><td>Windows 365 <br> Azure Virtual Desktop <br> Azure 仮想マシン <br> Azure Dedicated Host <br> Azure VMware Solution <br> Azure 上の Nutanix Cloud Clusters <br> Azure Local (Azure Local は Azure Stack HCI の新名称) <br> Azure Stack Hub <br> Azure Stack Edge</td><td>不要</td><td>不要</td><td>N/A</td></tr><tr><td>オンプレ Windows 10</td><td>必要</td><td>必要</td><td>5×5 MAK キー</td></tr><tr><td>Intune で管理された Windows 10</td><td>必要</td><td>必要</td><td>5×5 MAK キー( 配布方法は <a href="#Intune-%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%80%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%AD%E3%83%BC%E3%82%92%E9%85%8D%E5%B8%83%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">「Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？」</a> を参照)</td></tr></tbody></table><p>上記のオンプレ Windows 10 環境を利用する場合、5x5 MAK キーによる適用が必要となるため、MAK キーによる適用に関連する Q&amp;A を以下に記載します。</p><h1 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h1><h2 id="セクション1-ESU-の導入とライセンス認証方法"><a href="#セクション1-ESU-の導入とライセンス認証方法" class="headerlink" title="セクション1: ESU の導入とライセンス認証方法"></a>セクション1: ESU の導入とライセンス認証方法</h2><p>-<a href="#MAK-%E3%82%AD%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B-Windows-10-ESU-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%81%84%E3%81%A7%E3%81%99%E3%81%8C%E3%80%81%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？</a></p><p>-<a href="#KMS-%E7%92%B0%E5%A2%83%E3%81%A7%E9%81%8B%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8C%E3%80%81ESU-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E4%BD%95%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">KMS 環境で運用していますが、ESU を適用するには何が必要ですか</a></p><p>-<a href="#Windows-10-ESU-%E3%82%92%E4%B8%80%E6%8B%AC%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">Windows 10 ESU を一括適用することができますか？</a></p><p>-<a href="#Sysprep-%E5%AE%9F%E8%A1%8C%E5%BE%8C%E3%81%AE%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E5%86%8D%E8%AA%8D%E8%A8%BC%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">Sysprep 実行後のライセンス再認証は必要ですか？</a></p><p>-<a href="#%E9%81%A9%E7%94%A8%E6%B8%88%E3%81%BF%E3%81%AE-ESU-%E3%82%92%E5%A4%B1%E5%8A%B9%E3%81%95%E3%81%9B%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E5%87%BA%E6%9D%A5%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">適用済みの ESU を失効させることが出来ますか？</a></p><p>-<a href="#VAMT-%E3%81%A7-Windows-10-ESU-%E3%82%AD%E3%83%BC%E3%82%92%E5%B1%95%E9%96%8B%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">VAMT で Windows 10 ESU キーを展開できますか？</a></p><p>-<a href="#Intune-%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%80%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%AD%E3%83%BC%E3%82%92%E9%85%8D%E5%B8%83%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">Intune で複数の端末に対して、ライセンスキーを配布可能ですか？</a></p><h2 id="セクション2-運用環境への影響・周辺設定"><a href="#セクション2-運用環境への影響・周辺設定" class="headerlink" title="セクション2: 運用環境への影響・周辺設定"></a>セクション2: 運用環境への影響・周辺設定</h2><p>-<a href="#WSUS-%E3%82%84-SCCM-%E3%81%AB%E4%BD%95%E3%81%8B%E6%89%8B%E3%82%92%E5%8A%A0%E3%81%88%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">WSUS や SCCM に何か手を加える必要がありますか？</a></p><p>-<a href="#ESU-%E3%81%AE%E9%81%A9%E7%94%A8%E5%BE%8C%E3%80%81%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E9%85%8D%E4%BF%A1%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？</a></p><h2 id="セクション3-年次更新とエディション対応"><a href="#セクション3-年次更新とエディション対応" class="headerlink" title="セクション3: 年次更新とエディション対応"></a>セクション3: 年次更新とエディション対応</h2><p>-<a href="#ESU-%E7%94%A8%E3%81%AE-MAK-%E3%82%AD%E3%83%BC%E3%81%AF%E6%AF%8E%E5%B9%B4%E6%9B%B4%E6%96%B0%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU 用の MAK キーは毎年更新されますか？</a></p><p>-<a href="#ESU-%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%A8%E3%83%87%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE-Windows-10-%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU はどのエディションの Windows 10 に適用できますか？</a></p><p>-<a href="#ESU-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AE%E9%96%8B%E5%A7%8B%E6%97%A5%E3%81%AF%E3%81%84%E3%81%A4%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU サポートの開始日はいつですか？</a></p><h2 id="セクション4-認証要件・接続条件"><a href="#セクション4-認証要件・接続条件" class="headerlink" title="セクション4: 認証要件・接続条件"></a>セクション4: 認証要件・接続条件</h2><p>-<a href="#ESU-%E8%AA%8D%E8%A8%BC%E7%94%A8%E3%81%AE-URLxxx-%E3%81%AE%E3%81%BF%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%97%E3%81%A6%E3%82%82%E5%A4%A7%E4%B8%88%E5%A4%AB%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU 認証用の URL の一部だけブロックしても大丈夫ですか？</a></p><p>-<a href="#ESU-%E3%81%AE-MAK-%E3%82%AD%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E8%AA%8D%E8%A8%BC%E3%81%AB-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？</a></p><p>-<a href="#KMS-%E3%83%9B%E3%82%B9%E3%83%88%E3%81%A7-ESU-%E3%82%92%E8%AA%8D%E8%A8%BC%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">KMS ホストで ESU を認証可能ですか？</a></p><hr><h2 id="MAK-キーによる-Windows-10-ESU-を適用したいですが、どうすればよいですか？"><a href="#MAK-キーによる-Windows-10-ESU-を適用したいですが、どうすればよいですか？" class="headerlink" title="MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？"></a>MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？</h2><p>Windows 10 ESU 対応手順は、以下の公開情報にまとまっております。<br>下記に公開情報の手順を詳細に記載しておりますのでご参照ください。</p><p>Title:拡張セキュリティ更新プログラム (ESU) を有効にする<br>URL:<a href="https://learn.microsoft.com/en-us/windows/whats-new/enable-extended-security-updates">https://learn.microsoft.com/en-us/windows/whats-new/enable-extended-security-updates</a></p><p>■ 前提条件</p><ol><li><p>Windows 10 バージョン 22H2 (2024 年 11 月 12 日 KB5046613 以降) がインストールされていること。  </p></li><li><p>以下のエンドポイントに接続できること。<br>　<a href="https://go.microsoft.com/">https://go.microsoft.com/</a><br>　<a href="https://login.live.com/">https://login.live.com</a><br>　<a href="https://activation.sls.microsoft.com/">https://activation.sls.microsoft.com/</a><br>　<a href="http://crl.microsoft.com/">http://crl.microsoft.com/</a><br>　<a href="https://validation.sls.microsoft.com/">https://validation.sls.microsoft.com/</a><br>　<a href="https://activation-v2.sls.microsoft.com/">https://activation-v2.sls.microsoft.com/</a><br>　<a href="https://validation-v2.sls.microsoft.com/">https://validation-v2.sls.microsoft.com/</a><br>　<a href="https://displaycatalog.mp.microsoft.com/">https://displaycatalog.mp.microsoft.com/</a><br>　<a href="https://licensing.mp.microsoft.com/">https://licensing.mp.microsoft.com/</a><br>　<a href="https://purchase.mp.microsoft.com/">https://purchase.mp.microsoft.com/</a><br>　<a href="https://displaycatalog.md.mp.microsoft.com/">https://displaycatalog.md.mp.microsoft.com/</a><br>　<a href="https://licensing.md.mp.microsoft.com/">https://licensing.md.mp.microsoft.com/</a><br>　<a href="https://purchase.md.mp.microsoft.com/">https://purchase.md.mp.microsoft.com/</a>  </p></li><li><p>ESU プロダクトキーを入手していること。  </p></li></ol><p>　ESU のプロダクトキーの入手方法:<br>　(1) Microsoft 365 管理センターにアクセスします。<br>　<a href="https://admin.microsoft.com/Adminportal/Home#/homepage">https://admin.microsoft.com/Adminportal/Home#/homepage</a>  </p><p>　※ Microsoft 365 管理センターへのサインインについては以下の公開情報もご参照ください。<br>　　Title:Microsoft 365 管理センター (ボリューム ライセンス) にサインインします<br>　　URL:<a href="https://learn.microsoft.com/en-us/microsoft-365/commerce/licenses/vl-sign-in?view=o365-worldwide">https://learn.microsoft.com/en-us/microsoft-365/commerce/licenses/vl-sign-in?view=o365-worldwide</a><br>　<br>　(2) 管理センターで [課金] -&gt; [製品] ページに移動し、[ボリューム ライセンス] を選択します。<br>　(3) [契約] セクションで [契約の表示] を選択します。<br>　(4) [契約] ページで ESU ライセンスのライセンス認証 ID を探し、選択し [プロダクト キーの表示] を選択します。<br>　　※[プロダクト キーの詳細] ページには、契約の詳細とその契約のすべてのキーが表示されます。</p><p>■ ESU ライセンス認証手順 (インターネット経由):</p><ol><li><p>コマンド プロンプトを管理者として実行します。</p></li><li><p>以下のコマンドを実行して、ESU プロダクト キーをインストールします。<br> ESU プロダクトキーは Microsoft 365 管理センターで入手したプロダト キーです。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk ＜ESU プロダクト キー＞</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure><p> プロダクト キーのインストールに成功すると、プロダクト キーが正常にインストールされた旨のメッセージが表示されます。</p></li><li><p>次の表から今回 ESU ライセンス認証を実行する ESU Activation ID を確認します。<br>　<br>ESU Program    Activation ID<br>Win10 ESU Year1    f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2    1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3    83d49986-add3-41d7-ba33-87c7bfb5c0fb<br>※ Activation ID は、対象となるすべての Windows ESU エディションと、そのプログラムに登録されているすべてのデバイスで同じです。</p></li><li><p>以下のコマンドを実行して、ライセンス認証を行います。<br>　Activation ID は上記 Activation ID の一覧から確認したものに置き換えます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ato &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(例) 1 年目の認証を行う場合</span><br><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ato f520e45e-7413-4a34-a497-d2765967d094</span><br></pre></td></tr></table></figure><p>　ライセンス認証に成功すると、コマンドの実行結果に正常にライセンス認証された旨のメッセージが表示されます。</p></li></ol><ol start="5"><li>念のため、以下のコマンドを実行して、現在のライセンス認証の状態を確認します。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dlv</span><br></pre></td></tr></table></figure>　出力結果に対応する ESU プログラムの名前とその ESU の “ライセンスの状態” が “ライセンスされています” と表示されていれば問題ございません。<br>(英語表記の場合は “LICENSE STATUS” に “LICENSED”。)</li></ol><p>■ ESU ライセンス認証手順 (電話経由):</p><ol><li><p>コマンド プロンプトを管理者として実行します。</p></li><li><p>以下のコマンドを実行して、ESU プロダクト キーをインストールします。<br> ESU プロダクト キーは Microsoft 365 管理センターで入手したプロダクト キーです。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk ＜ESU プロダクト キー＞</span><br><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure><p> プロダクト キーのインストールに成功すると、プロダクト キーが正常にインストールされた旨のメッセージが表示されます。</p></li></ol><ol start="3"><li><p>次の表から今回 ESU ライセンス認証を実行する ESU Activation ID を確認します。<br>　<br>ESU Program    Activation ID<br>Win10 ESU Year1    f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2    1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3    83d49986-add3-41d7-ba33-87c7bfb5c0fb<br>※ Activation ID は、対象となるすべての Windows ESU エディションと、そのプログラムに登録されているすべてのデバイスで同じです。</p></li><li><p>以下のコマンドを実行し、インストール ID を確認します。<br>Activation ID は上記 Activation ID の一覧から確認したものに置き換えます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dti &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><p>※ この後の手順でインストール ID を使用します。<br>メモ帳などのテキスト エディターにコピーし、以下のように 6 桁毎もしくは 7 桁毎に区切っておいていただくことをお勧めいたします。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　  (例)    xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx</span><br></pre></td></tr></table></figure><ol start="5"><li><p>弊社のライセンス認証窓口 (0120-801-734) に電話をかけていただき、電話の音声ガイダンスに従って、手順 4 で確認したインストール ID を電話機で入力します。</p></li><li><p>電話の音声ガイダンスに従って操作し、応答のあった ESU 認証用の確認 ID を書き留めます。</p><p> ※ この後の手順で確認 ID (48 桁) を使用します。<br> 　 いったん、メモ帳などのテキスト エディターに入力しておいていただくことをお勧めいたします。<br>  　6 桁毎の区切り文字は不要です。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(例)      xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、指定した確認 ID を使用してライセンス認証を行います。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;atp ＜確認 ID＞ &lt;Activation ID&gt;</span><br><span class="line">※ ＜確認 ID＞ には、手順 c で取得した確認 ID を入力します。</span><br></pre></td></tr></table></figure><p>(例) 1 年目の認証を行う場合</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;atp xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx f520e45e-7413-4a34-a497-d2765967d094</span><br></pre></td></tr></table></figure><p>   上記コマンドが正しく実行されると、確認 ID が正常に登録された旨のメッセージが表示されます。</p><ol start="8"><li>念のため、以下のコマンドを実行して、現在のライセンス認証の状態を確認します。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dlv</span><br></pre></td></tr></table></figure>出力結果に対応する ESU プログラムの名前とその ESU の “ライセンスの状態” が “ライセンスされています” と表示されていれば問題ございません。<br>(英語表記の場合は “LICENSE STATUS” に “LICENSED”。)</li></ol><hr><h2 id="WSUS-や-SCCM-に何か手を加える必要がありますか？"><a href="#WSUS-や-SCCM-に何か手を加える必要がありますか？" class="headerlink" title="WSUS や SCCM に何か手を加える必要がありますか？"></a>WSUS や SCCM に何か手を加える必要がありますか？</h2><p>ESU の更新プログラムはすべて従来の更新プログラムと同様なチャンネルで配信しております。<br>そのため、通常通り WSUS、Windows Update および Microsoft カタログ サイトから取得可能となり、<br>これまでに WSUS サーバーに参照して、WSUS から更新プログラムを取得しているクライアントに関しては、<br>ESU 開始後にも WSUS サーバーから取得できるようになります。<br>(通常通り個々の更新プログラムに対して WSUS 側での承認作業が必要となります。)</p><p>WSUS に関しては追加作業や設定変更はございませんが、<br>WSUS から取得した ESU の更新プログラムを各端末に適用可能にするには、<br>各クライアント端末にて、ESU 専用の MAK キーのインストールおよび認証作業を実施していただく必要がございます。<br>この ESU 専用の MAK キーのインストールおよび認証作業を実施しても、<br>WSUS 関連の設定や既存の OS のライセンス認証に影響を与えることは一切ありません。</p><hr><h2 id="ESU-用の-MAK-キーは毎年更新されますか？"><a href="#ESU-用の-MAK-キーは毎年更新されますか？" class="headerlink" title="ESU 用の MAK キーは毎年更新されますか？"></a>ESU 用の MAK キーは毎年更新されますか？</h2><p>はい、ESU は年間の契約となり、お客様の契約内容によって認証可能なデバイス数なども異なるため、毎年異なる MAK キーが発行されます。そのため、契約ごとに発行された MAK キーのインストールおよびライセンス認証は必ず必要となります。</p><hr><h2 id="KMS-環境で運用していますが、ESU-を適用するには何が必要ですか？"><a href="#KMS-環境で運用していますが、ESU-を適用するには何が必要ですか？" class="headerlink" title="KMS 環境で運用していますが、ESU を適用するには何が必要ですか？"></a>KMS 環境で運用していますが、ESU を適用するには何が必要ですか？</h2><p>ESU 有効化のために MAK 認証は既存の OS のライセンス認証を置き換えるものではなく、既存の OS ライセンス認証をこのまま維持したうえで、追加で ESU 有効化用の MAK キーをインストールし、認証していただく形となります。</p><p>既存の環境に対して、 ESU 専用の MAK のインストールおよび (電話もしくはインターネットによる) MAK キーのライセンス認証を行っていただくことで、ESU のセキュリティ更新の適用が可能となります。(ESU 専用の MAK キーのインストールおよび認証作業を実施しない限り、ESU のセキュリティ更新を入手しても OS に適用することはできません。)</p><p>また、今回のシナリオにおいて、上記作業はすべてエンドユーザー側にて各 OS に対して実施していただく必要があり、KCPS IaaS の基盤側における変更や操作は一切必要ございません。(このまま KCPS IaaS 上の KMS サーバーに参照するような設定で運用していただいて問題ございません)</p><hr><h2 id="ESU-認証用の-URLxxx-のみブロックしても大丈夫ですか？"><a href="#ESU-認証用の-URLxxx-のみブロックしても大丈夫ですか？" class="headerlink" title="ESU 認証用の URLｘｘｘ のみブロックしても大丈夫ですか？"></a>ESU 認証用の URLｘｘｘ のみブロックしても大丈夫ですか？</h2><p>以下の公開情報に記載されている URL は ESU 認証を行うための前提条件となっております。<br>そのため、原則すべて許可していただく必要がございます。</p><p>タイトル：前提条件<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/whats-new/enable-extended-security-updates#prerequisites">https://learn.microsoft.com/ja-jp/windows/whats-new/enable-extended-security-updates#prerequisites</a>  </p><blockquote><p>ESU for Windows 10を有効にするには、次の前提条件を満たす必要があります。<br>Windows 10、バージョン 22H2 とKB5046613、またはそれ以降の更新プログラムがインストールされている<br>デバイスの管理特権<br>クライアントのアクティブ化のエンドポイント:<br><a href="https://go.microsoft.com/">https://go.microsoft.com/</a><br><a href="https://login.live.com/">https://login.live.com</a><br><a href="https://activation.sls.microsoft.com/">https://activation.sls.microsoft.com/</a><br><a href="http://crl.microsoft.com/">http://crl.microsoft.com/</a><br><a href="https://validation.sls.microsoft.com/">https://validation.sls.microsoft.com/</a><br><a href="https://activation-v2.sls.microsoft.com/">https://activation-v2.sls.microsoft.com/</a><br><a href="https://validation-v2.sls.microsoft.com/">https://validation-v2.sls.microsoft.com/</a><br><a href="https://displaycatalog.mp.microsoft.com/">https://displaycatalog.mp.microsoft.com/</a><br><a href="https://licensing.mp.microsoft.com/">https://licensing.mp.microsoft.com/</a><br><a href="https://purchase.mp.microsoft.com/">https://purchase.mp.microsoft.com/</a><br><a href="https://displaycatalog.md.mp.microsoft.com/">https://displaycatalog.md.mp.microsoft.com/</a><br><a href="https://licensing.md.mp.microsoft.com/">https://licensing.md.mp.microsoft.com/</a><br><a href="https://purchase.md.mp.microsoft.com/">https://purchase.md.mp.microsoft.com/</a>  </p></blockquote><h2 id="Windows-10-ESU-を一括適用することができますか？"><a href="#Windows-10-ESU-を一括適用することができますか？" class="headerlink" title="Windows 10 ESU を一括適用することができますか？"></a>Windows 10 ESU を一括適用することができますか？</h2><p>インターネット接続できる環境であれば、「ESU ライセンス認証手順 (インターネット経由)」に記載されているコマンドを何等かの方法でクライアント端末で実行させれば、ESU を認証することが可能です。</p><p>インターネット接続なし、かつ複数台で電話認証が現実的に実施できない場合には、VAMT というツールが用意されており、クライアント OS の代わりに、本ツールでライセンス認証を実施することが可能です。<br>なお、VAMT については、無料で提供されているものであるため、技術サポートはベスト エフォートでの対応となり、製品側の不具合がある場合は修正を受け付けできないこと、ご了承ください。  </p><p>また、ご利用にあたり、VAMTの構築が必要になりますので、必要に応じて下記の公開情報をご参考ください。<br>タイトル：ボリューム ライセンス認証管理ツール (VAMT) テクニカル リファレンス<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/volume-activation-management-tool">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/volume-activation-management-tool</a></p><hr><h2 id="Sysprep-実行後のライセンス再認証は必要ですか？"><a href="#Sysprep-実行後のライセンス再認証は必要ですか？" class="headerlink" title="Sysprep 実行後のライセンス再認証は必要ですか？"></a>Sysprep 実行後のライセンス再認証は必要ですか？</h2><p>はい。Sysprep 実行後は端末の固有情報が初期化されるため、ESU ライセンスの再認証が必要になります。再認証には同じキーを使用できますが、認証回数が減る点に注意が必要です 。  </p><hr><h2 id="適用済みの-ESU-を失効させることが出来ますか？"><a href="#適用済みの-ESU-を失効させることが出来ますか？" class="headerlink" title="適用済みの ESU を失効させることが出来ますか？"></a>適用済みの ESU を失効させることが出来ますか？</h2><p>以下のコマンドを実行することで、該当端末で ESU キーをアンインストールすることが可能です。<br>ただし、アンインストールしても、ESU キーの残数が +1 に戻ることがありませんので、ご留意ください。  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slmgr.vbs &#x2F;upk &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><p>■ご参考: 各 Activation ID<br>Win10 ESU Year1: f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2: 1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3: 83d49986-add3-41d7-ba33-87c7bfb5c0fb  </p><hr><h2 id="ESU-はどのエディションの-Windows-10-に適用できますか？"><a href="#ESU-はどのエディションの-Windows-10-に適用できますか？" class="headerlink" title="ESU はどのエディションの Windows 10 に適用できますか？"></a>ESU はどのエディションの Windows 10 に適用できますか？</h2><p>Windows 10 の ESU 対象エディションには、Home, Education、Pro,Pro for Workstations, Pro Education および  Enterprise が含まれます。  </p><hr><h2 id="ESU-の-MAK-キーを使った認証に-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-は必要ですか？"><a href="#ESU-の-MAK-キーを使った認証に-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-は必要ですか？" class="headerlink" title="ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？"></a>ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？</h2><p>いいえ、通常の 5x5 MAK Microsoft Entra joined 参加 や Microsoft Entra hybrid joined 参加 は不要です。Microsoft Entra joined / Microsoft Entra hybrid joined が必要なのは、クラウドベースの ESU サブスクリプション方式に限られます 。</p><hr><h2 id="ESU-の適用後、セキュリティ更新プログラムはどのように配信されますか？"><a href="#ESU-の適用後、セキュリティ更新プログラムはどのように配信されますか？" class="headerlink" title="ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？"></a>ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？</h2><p>ESU 適用後は、Windows Update、WSUS、Intune などの既存の配信チャネルを通じてセキュリティ更新プログラムが配信されます。</p><hr><h2 id="VAMT-で-Windows-10-ESU-キーを展開できますか？"><a href="#VAMT-で-Windows-10-ESU-キーを展開できますか？" class="headerlink" title="VAMT で Windows 10 ESU キーを展開できますか？"></a>VAMT で Windows 10 ESU キーを展開できますか？</h2><p>VAMT を構築済みで、かつ以下の前提条件を満たした場合、VAMT で Windows 10 ESU キーを展開できます。</p><p>■ 前提条件1<br>クライアント側で、本記事 A1 で記載した Windows 10 ESU 公開情報にある前提条件を満たした。</p><p>■ 前提条件2<br>各クライアント端末側で以下の設定を行っている。</p><p>＜事前設定 1＞<br>各クライアント端末において、Windows ファイアウォールより設定する場合は、以下の操作を行います。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1) [コントロール パネル] - [Windows ファイアウォール] を開きます。</span><br><span class="line"> </span><br><span class="line">2) [Windows ファイアウォールを介したアプリまたは機能を許可] をクリックします。</span><br><span class="line"> </span><br><span class="line">3) 表示された一覧がグレー アウトしている場合は、[設定の変更] ボタンをクリックします。</span><br><span class="line"> </span><br><span class="line">4) [Windows Management Instrumentation (WMI)] のチェックをオンにします。</span><br><span class="line"> </span><br><span class="line">5) [OK] ボタンをクリックします。</span><br></pre></td></tr></table></figure><br> 警告 既定では、Windows ファイアウォールの例外は、ローカルサブネットで送信されたトラフィックにのみ適用されます。<br> 複数のサブネットに適用する例外を展開するには、以下で説明するように、セキュリティが強化された Windows ファイアウォールの<br>例外設定を変更する必要があります。 </p><p>＜コマンドで実行する場合＞<br>以下の内容をバッチ実行する。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall set rule group&#x3D;&quot;windows management instrumentation (wmi)&quot; new enable&#x3D;yes</span><br></pre></td></tr></table></figure><ul><li>参考情報<br><a href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista">https://docs.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista</a><br>※上記の設定は、Sysprep 後も保持されます。</li></ul><p>＜事前設定 2＞<br>ワークグループ環境の場合、各クライアント端末において、以下のレジストリの設定も行っていただく必要がございます。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー : HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</span><br><span class="line">種類 : REG_DWORD</span><br><span class="line">名前 : LocalAccountTokenFilterPolicy</span><br><span class="line">データ : 1</span><br></pre></td></tr></table></figure><br>※上記のレジストリ設定は、Sysprep 後も保持されます。</p><ul><li>参考情報<br>クライアント端末での設定につきましては、以下の公開情報にも掲載しておりますので、あわせてご参照ください。</li></ul><p>※ 複数のサブネットにわたる VAMT アクセスを許可する場合の設定などについても掲載しております。</p><p>Configure client computers<br><a href="https://learn.microsoft.com/en-us/windows/deployment/volume-activation/configure-client-computers-vamt">https://learn.microsoft.com/en-us/windows/deployment/volume-activation/configure-client-computers-vamt</a><br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/configure-client-computers-vamt">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/configure-client-computers-vamt</a> (機械翻訳)  </p><p>■ VAMT を使った Windows 10 ESU キーの展開手順</p><p>1.下記サイトより VAMT-ESU 構成ファイルをダウンロードします。</p><p>タイトル: VAMT- ESU Configuration March 2025<br>アドレス:  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=106364">https://www.microsoft.com/en-us/download/details.aspx?id=106364</a>  </p><ol start="2"><li><p>ダウンロードした構成ファイル (pkconfig_win10_esu.xrm-ms) を以下のパスに配置します。<br>  C:\Program Files (x86)\Windows Kits\10\Assessment and Deployment Kit\VAMT3\pkconfig</p></li><li><p>VAMT を起動し、左ペインにある [Product Keys] を選択し右クリックメニューから [Add Product Keys] を押下します。</p></li><li><p>表示されたウインドウに入手した ESU キーを入力し [Add Key(s)] 押下で追加します。<br><img src="./step4.png"></p></li></ol><ol start="5"><li>次に左ペインにある [Products] &gt; [Windows] を選択し、右クリックメニューから [Discover products…] を押下します。<br><img src="./step5.png"></li></ol><ol start="6"><li>表示されたウインドウにてプルダウンメニューから ESU キーのインストールを行うクライアントの検索方法を選択し、検索句を入力後、 [Search] を押下して検索を行います。</li></ol><p>例1) ドメインに参加しているコンピューターを検索する場合<br>(ドメイン名: testDomain.com / コンピューター名: 対象のコンピューターが例えば “WIN10” から始まる場合 “WIN10*” で検索対象をフィルターすることが出来ます。)<br><img src="./step6.png"></p><p>例2) 個々のコンピューター名や IP アドレスで検索する場合<br>(画像では “WIN10PC” という名称のコンピューターを追加したい場合の入力例)<br> <img src="./step6-2.png"></p><p>利用可能な検索方法などにつきましては下記弊社公開情報もご参照ください。</p><ul><li>参考情報<br>タイトル: コンピューターの追加と削除<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/add-remove-computers-vamt">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/add-remove-computers-vamt</a>  </li></ul><ol start="7"><li>検索に成功した場合、以下のようなダイアログが表示されます。<br><img src="./step7.png"></li></ol><ol start="8"><li>コンピューターが追加されましたら、クライアントの情報を収集するために追加されたコンピューターを選択し、右クリックメニューから [Update license status] &gt; [Current credential] もしくは [Alternate credential…] を押下します。<br><img src="./step8.png"></li></ol><p>※ [Current credential] と [Alternate credential…] について</p><ul><li><p>VAMT を使用している端末にログオンしているユーザーが、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーである場合は、[Current credential] をクリックします。</p></li><li><p>VAMT を使用している端末にログオンしているユーザーが、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーではない場合は、[Alternate credential] をクリックすると、ユーザー名とパスワードの入力画面が表示されますので、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p></li></ul><p>(ユーザー名 / パスワードの入力画面サンプル)<br><img src="./step8-2.png"></p><ol start="9"><li>以下の画像のように情報収集が完了しましたら [Close] を押下し、ウインドウを閉じます。<br><img src="./step9.png"></li></ol><ol start="10"><li>ESU キーをインストールしたい端末を選択し、右クリックメニューから [Install product key…] を押下します。 (CtrlキーまたはShiftキーを用いて一度に複数選択も可能です。)<br><img src="./step10.png"></li></ol><ol start="11"><li>表示されたウインドウにてインストールを行う ESU キーを選択し、 [Install Key] を押下します。<br><img src="./step11.png"></li></ol><p>※「8.」 にて [Alternate credential…] を選択した場合は本画面においても左下の [Use Alternate Credentials] にチェックを入れ、 [Install Key] 押下後に表示されるユーザー名とパスワードの入力画面にて、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p><ol start="12"><li>以下の画像のようにキーのインストールが完了しましたら [Close] を押下し、ウインドウを閉じます。<br><img src="./step12.png"></li></ol><ol start="13"><li>キーのインストールが完了しましたら、次に認証を行います。認証するクライアントと ESU キーの組み合わせを選択し、右クリックメニューから [Activate] &gt; [Online activate] もしくは [Proxy activate…] を押下します。<br><img src="./step13.png"></li></ol><p>※ [Online activate] と [Proxy activate…] について</p><ul><li><p>該当のクライアントが直接インターネットに接続可能な場合は [Online activate] より [Current credential] もしくは [Alternate credential…] を押下し認証します。</p></li><li><p>該当のクライアントがインターネットに接続できない場合は代わりに VAMT にて代理 (Proxy) で認証を行うために [Proxy activate…] を押下します。</p></li></ul><ol start="14"><li>([Proxy activate…] を押下した場合のみ) 表示されたウインドウにて [Acquire confirmation ID, apply to selected machine(s) and activate] のラジオボタンを選択し、 [OK] を押下します。<br><img src="./step14.png"></li></ol><p>※「8.」 にて [Alternate credential…] を選択した場合は本画面においても [Use Alternate Credentials when applying confirmation ID] にチェックを入れ、 [OK] 押下後に表示されるユーザー名とパスワードの入力画面にて、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p><ol start="15"><li>[Online activate] の場合はウインドウが 1 回、 [Proxy activate…] の場合は 2 回ウインドウが表示されますので、それぞれ処理が完了しましたら [Close] を押下します。</li></ol><p>[Online activate] の場合)<br><img src="./step15.png"></p><p> [Proxy activate…] の場合)<br>●1 回目 (Confirmation ID の 取得)<br><img src="./step15-2.png"></p><p>●2 回目 (取得した Confirmation ID のクライアントへの適用)<br><img src="./step15-3.png"></p><p>※ [Automatically close when done] にチェックを入れることでウインドウを自動で閉じることも可能です。</p><ol start="16"><li>認証が完了し、インストールした ESU キーについて [License Status] 列が “Licensed” となっていることを確認します。<br><img src="./step16.png"></li></ol><p>これにて ESU の適用が完了となります。</p><hr><p>▼参考<br>手順完了後の端末の状態 (slmgr /dlv の結果)<br>端末側でも ESU Year1 のキーが “ライセンスされています” になっていることが確認できる。<br><img src="./step16-2.png"></p><hr><h2 id="Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？"><a href="#Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？" class="headerlink" title="Intune で複数の端末に対して、ライセンスキーを配布可能ですか？"></a>Intune で複数の端末に対して、ライセンスキーを配布可能ですか？</h2><p>はい、Intune Win32 アプリもしくは PowerShell スクリプトの修復にて ESU ライセンスキーを配布することが可能です。<br>具体的なやり方については、以下の情報をご参考ください。</p><ul><li>Enabling Extended Security Updates (ESU) for Windows 10 with Intune<br><a href="https://techcommunity.microsoft.com/blog/coreinfrastructureandsecurityblog/enabling-extended-security-updates-esu-for-windows-10-with-intune/4420182">https://techcommunity.microsoft.com/blog/coreinfrastructureandsecurityblog/enabling-extended-security-updates-esu-for-windows-10-with-intune/4420182</a></li></ul><hr><h2 id="KMS-ホストで-ESU-を認証可能ですか？"><a href="#KMS-ホストで-ESU-を認証可能ですか？" class="headerlink" title="KMS ホストで ESU を認証可能ですか？"></a>KMS ホストで ESU を認証可能ですか？</h2><p>ESU は MAK キーによる認証方式となっているため、KMS ホストでは認証できません。</p><hr><h2 id="ESU-サポートの開始日はいつですか？"><a href="#ESU-サポートの開始日はいつですか？" class="headerlink" title="ESU サポートの開始日はいつですか？"></a>ESU サポートの開始日はいつですか？</h2><p>ESU サポートの開始日は 2025 年 10 月 14 日です。（Windows 10 のサポート終了日と同じ日です。）<br><a href="https://learn.microsoft.com/en-us/lifecycle/faq/extended-security-updates#esu-availability-and-end-dates">https://learn.microsoft.com/en-us/lifecycle/faq/extended-security-updates#esu-availability-and-end-dates</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Windows サポート チームです。&lt;br&gt;Windows 10 のサポートは、2025 年 10 月 14 日に終了します。サポート終了後は、基本的にセキュリティ更新および技術</summary>
      
    
    
    
    <category term="Activation" scheme="https://jpwinsup.github.io/blog/categories/Activation/"/>
    
    <category term="ESU" scheme="https://jpwinsup.github.io/blog/categories/Activation/ESU/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 11 へアップグレードしましょう！</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/29/Setup/FU/FU_Win10EOS/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/29/Setup/FU/FU_Win10EOS/</id>
    <published>2025-09-29T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.964Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Windows Commercial Support Device and Deployment チームの堀之内です。  </p><p>この記事では<br>・Windows 11 へのアップグレードをスムーズに進めるための準備<br>・よくあるトラブルと、解決方法の紹介<br>についてご紹介いたします。  </p><p>まずは、今この記事を公開する理由から説明させていただきます。</p><h2 id="アップグレードが必要になる背景"><a href="#アップグレードが必要になる背景" class="headerlink" title="アップグレードが必要になる背景"></a>アップグレードが必要になる背景</h2><p>皆様に長くご利用いただいている Windows 10 ですが、実は発売されたのが 2015 年 7 月 29 日でした。<br>つまり、発売からほぼ 10 年経過したことになりますが、10 年目となる今年 (2025 年) の 10 月 14 日をもちまして、いよいよWindows 10 のサポートが終了いたします。  </p><p><a href="https://support.microsoft.com/ja-jp/windows/2ca8b313-1946-43d3-b55c-2b95b107f281">https://support.microsoft.com/ja-jp/windows/2ca8b313-1946-43d3-b55c-2b95b107f281</a>  </p><p>OS がサポート終了日を迎えると、その OS に対するセキュリティ更新や技術サポートは提供されなくなります。<br>つまり、サポートが切れた OS を利用を続ける = 重大なセキュリティリスクを抱えたままになる、ということになります。<br>安全な環境を維持するためにも、現時点で Windows 10 をご利用になられている方は、Windows 11 への移行を是非ご検討ください。  </p><p>本記事は、ご利用中の Windows 10 を Windows 11 にアップグレードしようとした時に発生しがちなトラブルに対する対処方法を、サポートの観点から対処しやすい順にまとめました。<br>また、全て実施した上でも解決できない場合、弊社有償サポートをご契約いただいているお客様は、文末の情報と合わせてお問い合わせをいただく事で、切り分けや情報取得に時間をかけることなく、迅速にサポートの提供が可能となります。  </p><h1 id="Windows-11-アップグレード：お試しいただきたい手順まとめ"><a href="#Windows-11-アップグレード：お試しいただきたい手順まとめ" class="headerlink" title="Windows 11 アップグレード：お試しいただきたい手順まとめ"></a>Windows 11 アップグレード：お試しいただきたい手順まとめ</h1><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><p>-<a href="#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB%EF%BC%88%E6%BA%96%E5%82%99%E3%81%AE%E3%81%8A%E9%A1%98%E3%81%84%EF%BC%89">0- はじめに (準備のお願い)</a><br>-<a href="#1-%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E8%A6%81%E4%BB%B6%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF">1-アップグレード要件のチェック</a><br>-<a href="#2-%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%80%81%E6%9C%80%E5%88%9D%E3%81%AB%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%9F%E3%81%84%E7%AE%87%E6%89%80">2-アップグレードが失敗したとき、最初確認したい箇所</a><br>-<a href="#3-%E9%A0%85%E7%95%AA-2-%E3%81%AB%E6%9B%B8%E3%81%8B%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E6%89%8B%E9%A0%86%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%97%E3%81%A6%E3%82%82%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E5%A0%B4%E5%90%88">3-項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合</a><br>    - <a href="#EFI-%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%A9%BA%E3%81%8D%E4%B8%8D%E8%B6%B3%E3%82%92%E8%A7%A3%E6%B6%88">efi パーティションの空き不足を解消</a><br>    - <a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E9%87%8D%E8%A4%87%E3%82%92%E8%A7%A3%E6%B6%88">ユーザープロファイルの重複を解消</a><br>    - <a href="#%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%BB%E3%82%A8%E3%83%87%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%B8%80%E8%87%B4%E3%81%95%E3%81%9B%E3%82%8B">メディアの言語エディションを一致させる</a><br>-<a href="#4-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%94%E8%B3%AA%E5%95%8F%EF%BC%88%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E6%99%82%EF%BC%89">4-よくあるご質問アップグレード時</a><br>  -<a href="#Windows-old-%E3%82%92%E4%BD%9C%E3%82%89%E3%81%AA%E3%81%84%E6%96%B9%E6%B3%95">windows.old-を作らない方法</a><br>  -<a href="#%E5%85%83%E3%81%AE-OS-%E3%81%AB%E6%88%BB%E3%81%99%E6%96%B9%E6%B3%95%EF%BC%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%EF%BC%89">元の OS に戻す方法（ロールバック）</a><br>  -<a href="#%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E5%AE%B9%E9%87%8F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99%E6%96%B9%E6%B3%95">ディスク容量を増やす方法</a><br>-<a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B">5-お問い合わせ</a></p><hr><blockquote><p>本セクションでは、Windows 11 へのアップグレードする前に[まずご確認いただきたい操作]をまとめています。<br>詳細な原因の説明は省き、実際に役立つ手順だけを簡単な補足とともにご紹介します。</p></blockquote><h2 id="0-はじめに（準備のお願い）"><a href="#0-はじめに（準備のお願い）" class="headerlink" title="0) はじめに（準備のお願い）"></a>0) はじめに（準備のお願い）</h2><p>アップグレードに失敗するシナリオのうち、いくつかは事前準備の段階で予防が可能です。<br>スムーズにアップグレードを進めるためにも、以下の準備をご実施ください。  </p><ul><li><p><strong>最新のメディアを使用する</strong><br>意図しない互換性の問題の発生を防ぐためにも、アップグレードに最新版のメディアをご利用いただくことを強くお勧めいたします。<br>アップグレードに ISO メディアをご利用の場合は、インターネットに接続可能な環境にて、セットアップ画面の [セットアップでの更新プログラムのダウンロード方法の変更] より [更新プログラム、ドライバー、オプション機能をダウンロードする (推奨)] にチェックのうえ、アップグレードをご実施ください。<br>WSUS や MECM をご利用の場合、毎月リリースされる最新の累積更新プログラムを含む機能更新プログラムのパッケージをご利用ください。</p></li><li><p><strong>バックアップを取る</strong><br>大切なデータを守るため、事前にバックアップをお願いします。  </p></li><li><p><strong>BitLocker を一時停止</strong><br>既定ではアップグレード中に BitLocker の保護の中断を自動的に行う動作ですが、環境固有の何等かの理由により、BitLocker が中断されないことあるため、BitLocker 暗号化を一時的に止めることで、アップグレード中のエラーを防ぎます。<br>[BitLocker の管理] をスタートメニューから開き、[オペレーティング システム ドライブ] の [保護の中断] を実施してください。<br>※[保護の中断] を実施しても、次回再起動時またはアップグレード完了時に自動的に再開するので、ご安心ください。  </p></li><li><p><strong>周辺機器を外す</strong><br>接続されているハードウェアによってアップデートが失敗する場合があります。<br>可能な限り不要なデバイスを一時的に外し、必要最小限（キーボード、マウス、LAN）の構成にしてください。  </p></li><li><p><strong>管理者権限の確認</strong><br>コマンド実行や設定変更に必要です。<br>以降でご紹介する手順にはいくつかコマンドの実行がありますが、いずれも基本的には管理者権限を必要とします。<br>アップグレード時には出来るだけ管理者権限を利用できる状態で臨んでください。  </p></li><li><p><strong>ディスク容量を増やす</strong><br>一般的なガイダンスとして最低で 6GB - 11GB の空き領域が必要となっていますが、10GB 以上が必要となるケースがほとんどです。<br>さらに言えば、一時的に利用される領域等も加味した、弊社サポートとしての推奨値としては 20GB - 30GB の空き領域を確保していただきたいです。<br>以下の公開情報を参考に、十分な空き領域の確保をご実施ください。</p><p>Title : Windows でドライブの空き領域を増やす<br>URL   : <a href="https://support.microsoft.com/ja-jp/windows/85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/85529ccb-c365-490d-b548-831022bc9b32</a></p></li></ul><hr><h2 id="1-アップグレード要件のチェック"><a href="#1-アップグレード要件のチェック" class="headerlink" title="1) アップグレード要件のチェック"></a>1) アップグレード要件のチェック</h2><p>Windows 11 をご利用いただくに際しては、いくつかの必須要件があります。<br>アップグレードの実施前に、利用中の環境が条件を満たしているかご確認ください。  </p><ul><li><p><strong>TPM 2.0 の確認</strong><br>ハードウェアで提供されるセキュリティ機能ですが、Windows 11 では本機能の搭載が必須です。<br><code>Win</code> + <code>R</code> → <code>tpm.msc</code> を入力し、**[仕様バージョン: 2.0]** と表示されているか確認してください。<br>また、ここでバージョンが指定されたものではない、あるいは表示されないなどがあれば、UEFI の設定で無効化されているだけの場合もあります。<br>TPM の利用可否も含め、本項目で不明点がある場合は PC の提供元へご相談ください。</p></li><li><p><strong>UEFI とセキュアブート</strong><br>起動方式が UEFI で、セキュアブートが有効になっているか確認します。<br><code>Win</code> + <code>R</code> → <code>msinfo32</code> を入力し、以下を確認してください：  </p><ul><li><strong>BIOS モード: UEFI</strong>  </li><li><strong>セキュアブートの状態: 有効</strong></li></ul></li><li><p><strong>ハードウェア要件</strong><br>CPU 1GHz/2コア以上（対応CPU）、RAM 4GB以上、ストレージ64GB以上、DirectX 12対応GPU/WDDM 2.0。</p></li></ul><p>など、主な項目と確認方法を挙げましたが、詳細については以下の公開情報に纏められていますので、合わせてご確認ください。</p><p>  Title : Windows 11 の仕様、機能、コンピューターの要件を確認する<br>  URL   : <a href="https://www.microsoft.com/ja-jp/windows/windows-11-specifications">https://www.microsoft.com/ja-jp/windows/windows-11-specifications</a>  </p><p>また、これらの要件を満たしているかどうかは、以下の [PC 正常性チェック] アプリで一括確認することもできます。<br>※ 本ツールは WSUS や MECM に管理されている端末では利用できません。</p><ul><li><p><strong>PC 正常性チェック</strong>  </p><p>Title : PC 正常性チェック アプリの使用方法<br>URL   : <a href="https://support.microsoft.com/ja-jp/windows/9c8abd9b-03ba-4e67-81ef-36f37caa7844">https://support.microsoft.com/ja-jp/windows/9c8abd9b-03ba-4e67-81ef-36f37caa7844</a>    </p></li></ul><hr><blockquote><p>ここまでが準備編になります。<br>これ以降は、実際にアップグレードに臨んだものの、エラーになってしまった場合などの対処方法になります。</p></blockquote><hr><h2 id="2-アップグレードが失敗したとき、最初に確認したい箇所"><a href="#2-アップグレードが失敗したとき、最初に確認したい箇所" class="headerlink" title="2) アップグレードが失敗したとき、最初に確認したい箇所"></a>2) アップグレードが失敗したとき、最初に確認したい箇所</h2><p>アップグレードが失敗した場合、多くのシナリオで以下の項目を解決する事により改善が確認されております。<br>また、これらの要因でアップグレードが失敗する場合、特定のエラーが返されるわけではないため、エラーの内容等から対処方法を一意に特定することが非常に困難な内容となります。<br>特に優先順位はありませんが、いずれも事例として非常に多いものとなりますので、可能な限り全て同時にお試しください。  </p><ol><li><p><strong>サードパーティ製セキュリティソフトを一時的に停止またはアンインストールする</strong><br>他社製のウイルス対策や暗号化ソフトが原因になることがあります。<br>また、これらのソフトウェアは多くの場合、ドライバーとして機能の一部をインストールしています。<br>その場合、ソフトウェア上から [停止] [無効] などを実行しても、実は稼働したまま、という事が多くあります。<br>停止後もアップグレードが失敗する場合は、併せて [アンインストール] をご検討ください。</p></li><li><p><strong>ドライバーを最新にする</strong><br>特にストレージやネットワーク関連は重要です。<br>Windows Update の [オプションの更新] や、各ベンダーから提供されているツールで更新してください。  </p></li><li><p><strong>BIOS/UEFI を更新</strong><br>古いファームウェアはアップグレードを妨げる場合があります。<br>BIOS/UEFI に関しては更新の方法も様々ですので、PC の提供元へ確認の上でご実施ください。  </p></li><li><p><strong>システム整合性の修復</strong><br>以下のコマンドでシステムを修復します。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Cleanup-Image /RestoreHealth</span><br><span class="line">sfc /scannow</span><br></pre></td></tr></table></figure><p>これにより、Windows コンポーネントに破損が生じている場合も、可能な範囲で修復が行われます。  </p></li></ol><hr><blockquote><p>ここから先は、ファイルの削除を含む手順が含まれますので、必ず重要なファイルはバックアップを取得してから臨んでください。</p></blockquote><hr><h2 id="3-項番-2-に書かれている手順を実施してもアップグレードに失敗してしまう場合"><a href="#3-項番-2-に書かれている手順を実施してもアップグレードに失敗してしまう場合" class="headerlink" title="3) 項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合"></a>3) 項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合</h2><h3 id="EFI-パーティションの空き不足を解消"><a href="#EFI-パーティションの空き不足を解消" class="headerlink" title="EFI パーティションの空き不足を解消"></a>EFI パーティションの空き不足を解消</h3><p>EFI パーティションに空きがないとアップグレードに失敗します。<br>このシナリオに合致すると、多くの場合 [システム予約パーティションを更新できませんでした] という旨のエラーでアップグレードが失敗します。<br>以下のコマンドで EFI パーティションのフォルダ構成が確認できますので、それ以外のフォルダが存在しないか確認してみてください。  </p><p>Microsoft や Boot 以外のフォルダが存在する場合、サードパーティー製のアプリケーションや端末の提供元などによって作成・利用されている可能性がございます。これらフォルダ・ファイルが削除可能であるか提供元にご確認ください。</p><p>例) EFI フォルダ以下に、Microsoft や Boot 以外のフォルダが存在する　等<br>    この場合、PC やアプリケーションの提供元によって作成されている可能性がありますので、提供元へ相談しましょう。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\&gt;<span class="title">mountvol</span> <span class="title">y</span>: /<span class="title">s</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\&gt;<span class="title">y</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Y</span>:\&gt;<span class="title">tree</span></span></span><br><span class="line"><span class="function">フォルダー パスの一覧</span></span><br><span class="line"><span class="function">ボリューム シリアル番号は 36<span class="title">D4</span>-<span class="title">C9BB</span> です</span></span><br><span class="line"><span class="function"><span class="title">Y</span>:.</span></span><br><span class="line"><span class="function">└─<span class="title">EFI</span></span></span><br><span class="line"><span class="function">    ├─<span class="title">Microsoft</span></span></span><br><span class="line"><span class="function">    │  ├─<span class="title">Boot</span></span></span><br><span class="line"><span class="function">    |  | ～ <span class="title">Boot</span> フォルダ以下には多くのファイル/フォルダがあるため、省略しています ～</span></span><br><span class="line"><span class="function">    │  └─<span class="title">Recovery</span></span></span><br><span class="line"><span class="function">    └─<span class="title">Boot</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Y</span>:\&gt;</span></span><br></pre></td></tr></table></figure><p>また、同エラーに関して公開情報もありますので、こちらも確認してみてください。  </p><p>Title : Windows 10のインストール中に “システム予約パーティションを更新できませんでした” というエラーが表示される<br>URL   : <a href="https://support.microsoft.com/ja-jp/topic/46865f3f-37bb-4c51-c69f-07271b6672ac">https://support.microsoft.com/ja-jp/topic/46865f3f-37bb-4c51-c69f-07271b6672ac</a>  </p><hr><h3 id="ユーザープロファイルの重複を解消"><a href="#ユーザープロファイルの重複を解消" class="headerlink" title="ユーザープロファイルの重複を解消"></a>ユーザープロファイルの重複を解消</h3><p>Windows は複数のユーザーを作成することができ、それらのユーザーを使いわけて利用者ごとにデスクトップやドキュメント類を分けて管理することができます。<br>通常、これらは C:\Users フォルダ以下にユーザー毎のフォルダが作成されて管理されますが、この管理情報に誤りがある場合、アップグレードを妨げる事があります。<br>例) UserA と UserB のいずれも、<strong>C:\Users¥UserA</strong> を利用する事になってしまっている。  </p><p>上の例はわかりやすく書きましたが、こんな極端なシナリオは生じませんのでご安心ください。<br>ただ、[昔一時的に作成したけど削除したユーザーが、今メインで利用しているユーザーと同じフォルダを利用する事になっている。]<br>こういうシナリオは発生する可能性があります。<br>通常の Windows 利用時には全く問題となりませんが、アップグレード時には <strong>現時点で存在している全ユーザー情報</strong>の移行が必要ですので、これが問題になります。</p><p>各ユーザーには、SID と呼ばれる一意の ID が割り振られており、この ID 毎にユーザーのフォルダを管理しています。<br>次のコマンドを実行すると、各 SID (ユーザーに対して一意に割り当てられた ID) に対して設定された、プロファイルのパスを示す ProfileImagePath 値を纏めて表示できます。 </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList&quot; /v ProfileImagePath /s</span><br></pre></td></tr></table></figure><p>ここで、ProfileImagePath の指すパスが重複している SID がいないか確認してみてください。<br>もし複数の SID でパスが重複している場合、アップグレードの失敗に繋がります。<br>この場合は、次の手順で [利用されていない] SID のレジストリを削除してください。  </p><p>手順</p><ol><li>上のコマンドを実行し、フォルダ名が重複しているユーザーの SID (S- で始まるもの) を全て控えます。  </li><li>そのフォルダを利用しているユーザーで OS にサインインします。  </li><li>コマンド プロンプトから [whoami /user] を実行し、現時点でユーザーに紐づいている SID を確認します。  </li><li>レジストリ エディタを起動し、以下のキーまで移動します。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</li><li>[手順 3. で確認したほうではない] SID を右クリックし、エクスポート (.reg 形式) します。</li><li>[手順 3. で確認したほうではない] SID を右クリックし、削除します。</li></ol><p>※普段、自分が利用しているユーザーのフォルダがわからない場合、コマンド プロンプトを起動した際に表示される C:\Users のパスを確認してみてください。</p><p>コマンドプロンプト表示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Windows [Version 10.0.26100.6508]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line">C:\Users\admin&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="メディアの言語・エディションを一致させる"><a href="#メディアの言語・エディションを一致させる" class="headerlink" title="メディアの言語・エディションを一致させる"></a>メディアの言語・エディションを一致させる</h3><p>以下のコマンドで、今使っている Windows 10 のエディションと言語を確認してください。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Get-CurrentEdition</span><br><span class="line">DISM /Online /Get-TargetEditions</span><br><span class="line">DISM /Online /Get-Intl</span><br></pre></td></tr></table></figure><p><strong>現在のエディション</strong> がインストールに利用しているメディアに含まれているか確認してみてください。<br>その後、ここで確認した <strong>既定のシステム UI 言語</strong> と一致するメディアを利用して、OS のアップグレードを実施しましょう。  </p><hr><h2 id="4-よくあるご質問（アップグレード時）"><a href="#4-よくあるご質問（アップグレード時）" class="headerlink" title="4) よくあるご質問（アップグレード時）"></a>4) よくあるご質問（アップグレード時）</h2><h3 id="Windows-old-を作らない方法"><a href="#Windows-old-を作らない方法" class="headerlink" title="Windows.old を作らない方法"></a>Windows.old を作らない方法</h3><p>クリーンインストールのみ対応可能です。インプレースでは必ず作成されます。<br>ただし、Windows 11 へのアップグレード直後に自動削除する設定がありますので、アップグレードする際に、setup.exe に対して下記の /Uninstall Disable というオプションを設定することで利用可能です。</p><hr><h4 id="アップグレード後にすぐ-Windows-old-を自動削除するオプション"><a href="#アップグレード後にすぐ-Windows-old-を自動削除するオプション" class="headerlink" title="アップグレード後にすぐ Windows.old を自動削除するオプション"></a>アップグレード後にすぐ Windows.old を自動削除するオプション</h4><p>タイトル：/Uninstall<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#uninstall">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#uninstall</a>  </p><blockquote><p>/Uninstall<br>ユーザーが前のオペレーティング システムに戻れるようにするためのコントロールを Windows に含めるかどうかを決定します。<br>構文<br>/Uninstall {Enable | Disable}</p></blockquote><hr><p>なお、Windows Update で機能更新プログラムを配信する場合、通常 Setup.exe コマンドではないため、<br>代わりに以下のサイトで紹介されている setupconfig.ini に該当する記載をすることで、機能更新の際に、<br>当該設定を読み取って、設定項目に従って動作することが可能です。（機能更新前に、あらかじめ所定の場所に<br>SetupConfig.ini を配置しておく必要がございます。）</p><p>タイトル：Windows Update の使用<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-automation-overview?view=windows-11#using-windows-update">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-automation-overview?view=windows-11#using-windows-update</a>  </p><blockquote><p>Windows Update によって更新プログラムが配布されると、Windows セットアップは setupconfig ファイルの既定の場所を検索します。<br>setupconfig ファイルを %systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\SetupConfig.ini に含めることができます。</p></blockquote><hr><h4 id="アップグレード後に手動で-Windows-old-を削除するオプション"><a href="#アップグレード後に手動で-Windows-old-を削除するオプション" class="headerlink" title="アップグレード後に手動で Windows.old を削除するオプション"></a>アップグレード後に手動で Windows.old を削除するオプション</h4><p>[設定 &gt; システム &gt; 記憶域 &gt; クリーンアップの推奨事項] で [以前の Windows のインストール] を削除してください。</p><hr><h4 id="Windows-old-をすぐに削除するコマンドについて"><a href="#Windows-old-をすぐに削除するコマンドについて" class="headerlink" title="Windows.old をすぐに削除するコマンドについて"></a>Windows.old をすぐに削除するコマンドについて</h4><p>管理者権限にて以下の 2 つのコマンドを実行することで、すぐに Windows.old を削除することが可能です。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 削除設定</span><br><span class="line">&gt; DISM &#x2F;Online &#x2F;Remove-OSUninstall</span><br><span class="line"> </span><br><span class="line">2. SetupCleanupTask タスクの実行</span><br><span class="line">&gt; schtasks &#x2F;Run &#x2F;TN &quot;\Microsoft\Windows\Setup\SetupCleanupTask&quot; &#x2F;I</span><br></pre></td></tr></table></figure><br>なお、”前の バージョンの Windows に戻せる猶予期間” 以上の日数が経過している場合は、上記の 2 のコマンドのみでも削除可能でございます。</p><hr><h3 id="元の-OS-に戻す方法（ロールバック）"><a href="#元の-OS-に戻す方法（ロールバック）" class="headerlink" title="元の OS に戻す方法（ロールバック）"></a>元の OS に戻す方法（ロールバック）</h3><p>既定では 10 日以内なら [設定 &gt; システム &gt; 回復 &gt; 前のバージョンの Windows に戻す] からアップグレード前の状態に戻せます。<br>コマンドで戻す事も可能です。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Initiate-OSUninstall</span><br></pre></td></tr></table></figure><hr><h3 id="アップグレードする際にディスク容量を増やす方法"><a href="#アップグレードする際にディスク容量を増やす方法" class="headerlink" title="アップグレードする際にディスク容量を増やす方法"></a>アップグレードする際にディスク容量を増やす方法</h3><p>Windows OS における、ドライブの空き容量を増やすための手法に関する技術情報は、以下の公開情報に記載されています。</p><p>[公開情報]<br>タイトル：Windows でドライブの空き領域を増やす<br>URL：<a href="https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32</a>  </p><p>また、OS アップグレードに際して、必要な空き容量確保のために有効と考えられる主な手法として以下があります。</p><p><strong>A. ドライブ全体を圧縮する</strong></p><p>システム領域のみではなく、C ドライブ全体を圧縮 (C ドライブ内のすべてのフォルダーと、ファイルに圧縮属性を付与) することでも、空き領域を確保することができます。</p><p>※本操作にはドライブの大きさなどに依存して数十分を要する場合がございます。ご採用される場合は事前にテスト環境などで圧縮/圧縮解除にかかるお時間を測定ください。</p><ol><li><p>ファイル エクスプローラーより左パネルから [PC] を選択して C ドライブを右クリップしてプロパティを選択します。</p></li><li><p>[このドライブを圧縮してディスク領域を空ける] にチェックを入れます。</p></li><li><p>[ドライブ C:\ のみに変更を適用する] または [変更をドライブ C:\、サブフォルダ及びファイルに適用する] のいずれかを選択し OK を押下します。</p></li></ol><hr><p><strong>B. 休止状態を無効化し hiberfil.sys を削除する</strong></p><p>休止状態を利用している場合は一時的に無効化しhiberfil.sys を削除します。</p><ol><li><p>コマンド プロンプトを “管理者として実行” にて起動します。</p></li><li><p>以下のコマンドを実行します。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /h off</span><br></pre></td></tr></table></figure></li><li><p>システムの再起動を実行します。</p></li><li><p>再度休止状態を利用する場合は以下のコマンド実行後に再起動します。</p></li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /h on</span><br></pre></td></tr></table></figure><hr><p><strong>C. ページング ファイル (pagefile.sys) を別ドライブに移動する</strong></p><p>Pagefile は大きなファイルのサイズとなりますため、可能であれば、別ドライブに移動します。</p><p>以下手順は C ドライブにある pagefile.sys を削除し D ドライブ等の別ドライブに pagefile.sys を移動する場合の手順です。</p><ol><li>ファイル名を指定して実行に “sysdm.cpl” と入力し OK をクリックします。</li><li>[システムのプロパティ] の [詳細設定] タブの [パフォーマンス] にある [設定(S)] をクリックします。</li><li>[詳細設定] タブの [仮想メモリ] の項目にある [変更(C)] ボタンをクリックします。</li><li>[すべてのドライブのページング ファイルのサイズを自動的に管理する(A)] オプションを外します。</li><li>[各ドライブのページング ファイルのサイズ] 欄よりC: を選択し、[ページング ファイルなし] のラジオボタンをクリックし、[設定]ボタンをクリックします。</li><li>[各ドライブのページング ファイルのサイズ] 欄の C: の項目が [なし] と表示されていることを確認します。</li><li>続けて[各ドライブのページング ファイルのサイズ] 欄の D: を選択します。</li><li>[カスタム サイズ] にチェックを入れて、特定のメモリ サイズ を指定するか、[システム管理サイズ] にチェックを入れて、[設定] をクリックします。  </li><li>[各ドライブのページング ファイルのサイズ] 欄の D: の項目が設定した表示に切り替わったことを確認します。</li><li>[OK] ボタンをクリックし画面を閉じます。</li><li>“変更結果はコンピューターを再起動しなければ有効になりません。” というポップアップが表示されますので、[OK] ボタンをクリックします。</li><li>端末を再起動し、設定を反映させます</li></ol><hr><p><strong>D. 外部ストレージの利用</strong></p><p>外部ストレージを挿入することで一時ファイルを別ドライブに移動することが可能です。</p><p>コマンドで実行する場合は /TempDriveオプションをご使用いただけます。</p><p>[参考情報]<br>タイトル: /TempDrive<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#tempdrive">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#tempdrive</a></p><hr><p><strong>E. 一時ファイルの削除</strong></p><p>端末で保持されている一時ファイルにつきましては、以下公開情報に記載のディスクのクリーンアップにて</p><p>削除が可能となる場合があり、データの削除および空き容量の確保に寄与できる事がございますので、</p><p>併せてご案内させていただきます。</p><p>[公開情報]<br>タイトル：ディスクのクリーンアップ<br>URL：<a href="https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32</a>  </p><hr><h2 id="お問い合わせ"><a href="#お問い合わせ" class="headerlink" title="お問い合わせ"></a>お問い合わせ</h2><p>ここまでの項目を全て試しても解決しない場合や、その他の問題に遭遇した場合など、有償の技術サポートが必要な場合は弊社までお問い合わせください。<br>お問い合わせ時には問題発生時のログが必要となりますが、Windows 10 -&gt; Windows 11 へのアップグレードが失敗する場合は、以下の資料で多くの情報が網羅できます。<br>お問い合わせをいただく際には、失敗直後に以下の情報を収集してください。  </p><p><strong>TSS の収集</strong><br>Title : 初期調査にご取得いただくログ情報<br>URL   : <a href="https://jpwinsup.github.io/mslog/deployment/general/initiallog-deployment/">https://jpwinsup.github.io/mslog/deployment/general/initiallog-deployment/</a>  </p><ol><li>上記ページの手順通りに資料取得を進めます。</li></ol><hr><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/09/30 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Windows Commercial Support Device and Deployment チームの堀之内です。  &lt;/p&gt;
&lt;p&gt;この記事では&lt;br&gt;・Windows 11 へのアップグレードをスムーズに進めるための準備&lt;br&gt;・よくあるトラブルと、解決</summary>
      
    
    
    
    <category term="Windows Update" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/"/>
    
    <category term="Feature Update (FU)" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/Feature-Update-FU/"/>
    
    
  </entry>
  
  <entry>
    <title>ドメイン コントローラーで ソース :Microsoft-Windows-Perflib, ID:1023 のイベントが記録される事象について</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/04/ActiveDirectory/PromotionAndDemotion/ntds-perflib/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/04/ActiveDirectory/PromotionAndDemotion/ntds-perflib/</id>
    <published>2025-09-04T00:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.737Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。<br>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>今回は Windows Server 2019 あるいは Windows Server 2022 のドメイン コントローラーのアプリケーション イベント ログに、以下のようなエラー イベントが記録されることがあるという事象についてご案内いたします。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: Application</span><br><span class="line">ソース: Microsoft-Windows-Perflib</span><br><span class="line">日付: YYYY&#x2F;MM&#x2F;DD hh:mm:ss</span><br><span class="line">イベント ID: 1023</span><br><span class="line">レベル: エラー</span><br><span class="line">説明:</span><br><span class="line">拡張可能カウンター DLL &quot;C:\Windows\system32\ntdsperf.dll&quot; を読み込めません (Win32 エラー コード 指定されたモジュールが見つかりません。)。</span><br></pre></td></tr></table></figure><p>上記エラー イベントはメッセージの通り、”C:\Windows\system32\ntdsperf.dll” というパフォーマンス カウンター ファイルが見つからなかった場合に記録されます。</p><p>Windows Server 2019 においては、以下の 2019 年 9 月 24 日の更新プログラムを適用する前の状態では、Active Directory Diagnostics のデータ コレクター セットを実行できないという問題が報告されており、その際に当該エラー イベントが記録されます。</p><p>参考情報 : <a href="https://support.microsoft.com/ja-jp/topic/2019-%E5%B9%B4-9-%E6%9C%88-24-%E6%97%A5-kb4516077-os-%E3%83%93%E3%83%AB%E3%83%89-17763-774-c5368b0c-82d0-e9cd-8283-a9ca11cc3298">2019 年 9 月 24 日 — KB4516077 (OS ビルド 17763.774)</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ドメイン コントローラーのパフォーマンス モニターから Active Directory Diagnostics データ コレクター セットを実行できない問題に対処します。 これにより、データ コレクター セット名が空に表示されます。 Active Directory Diagnostics データ コレクター セットを実行すると、&quot;システムで指定されたファイルが見つかりません&quot; というエラーが返されます。 イベント ID 1023 は、ソースを Perflib として記録し、次のメッセージを記録します。</span><br></pre></td></tr></table></figure><p>この問題に関しては、上記の 2019 年 9 月 24 日の更新プログラム以降で修正されており、また、Windows Server 2022 については既定でこの問題に対する修正が含まれている状態となっています。<br>しかしながら、2019 年 9 月 24 日の更新プログラム以降を適用した Windows Server 2019 および Windows Server 2022 においても、一部でこの ntdsperf.dll ファイルを参照する処理が残存しており、上記イベントが出力される場合があることが報告されています。<br>もし、当該エラー イベントの記録を完全に抑止したい場合には、上記の ntdsperf.dll ファイルの情報が設定されているレジストリを、以下のような手順でリネームすることにより、ntdsperf.dll ファイルの読み込みを発生させないようにしてください。</p><h3 id="レジストリ-キーのリネーム手順"><a href="#レジストリ-キーのリネーム手順" class="headerlink" title="レジストリ キーのリネーム手順"></a>レジストリ キーのリネーム手順</h3><ol><li>当該エラー イベントが記録されるドメイン コントローラーに管理者権限を持つユーザーでログオンします。</li><li>キーボードの Windows + R キーを押下して [ファイル名を指定して実行] を起動し、”regedit” と入力して [OK] ボタンを押下します。</li><li>[レジストリ エディター] が起動したら、左ペインからレジストリ キー “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Performance” を展開します。</li><li>レジストリ キー “Performance” を右クリックして [名前の変更] をクリックして、”Performance_” などにリネームします。<br>手順は以上になります。</li></ol><p>※ Windows Server 2019 および Windows Server 2022 の OS においては、このレジストリ キーのリネームを行っても OS の動作に影響はありません。<br>※ Windows Server 2025 においては、そもそも当該レジストリ キーが存在していないため、対処は不要になります。<br>※ 仮にレジストリ キーのリネームを実施せず、当該エラー イベントが記録されてしまったとしても、存在しない ntdsperf.dll ファイルを意図せず参照しようとしているのみで、OS の動作に影響はないためご安心ください。</p><p>本投稿が少しでも皆様のお役に立てば幸いです。<br>※ 本情報の内容 (リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;br&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;今回は Windows Server 2019 あるいは Windows Ser</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Promotion and Demotion" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Promotion-and-Demotion/"/>
    
    
  </entry>
  
  <entry>
    <title>デスクトップのアイコンに茶色い鞄のオーバーレイ アイコンが付与される</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/02/UserInterfaceAndApps/brown_bag_overlay_pm_desktop_icons/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/02/UserInterfaceAndApps/brown_bag_overlay_pm_desktop_icons/</id>
    <published>2025-09-02T06:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.246Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><hr><p>こんにちは、Windows サポートの丸山です。</p><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Windows 11 および Windows Server 2022 以降のサーバー OS において、デスクトップや、エクスプローラーのフォルダー ウィンドウに表示されるアイコンに、茶色い鞄のオーバーレイが付与されることがあります。</p><p><img src="overlay_icon.png" alt="茶色い鞄のオーバーレイが付与されているアイコンの例"></p><p>多くの場合、本事象はファイルにオフライン属性 (FILE_ATTRIBUTE_OFFLINE) が付与されていることにより発生する事象であり、Windows の想定動作です。</p><h2 id="FILE-ATTRIBUTE-OFFLINE-について"><a href="#FILE-ATTRIBUTE-OFFLINE-について" class="headerlink" title="FILE_ATTRIBUTE_OFFLINE について"></a>FILE_ATTRIBUTE_OFFLINE について</h2><p>FILE_ATTRIBUTE_OFFLINE の属性は、OneDrive や DropBox、iCloud Drive などのオンライン ストレージと同期しているフォルダーにおいて、ローカルに実体がなく、ファイルのデータがすぐに利用できない状態を示す属性です。</p><p>ファイル属性定数<br><a href="https://learn.microsoft.com/ja-jp/windows/win32/fileio/file-attribute-constants">https://learn.microsoft.com/ja-jp/windows/win32/fileio/file-attribute-constants</a></p><p>フォルダーがオンライン ストレージと同期されている場合、同期の状態を示すアイコンがオーバーレイされていることが多いのですが、オンライン ストレージとの同期が切れている場合などにおいて、オンライン ストレージの同期状態を示すアイコンの代わりに、茶色い鞄のオーバーレイが表示されていることがございます。</p><p>ファイルに FILE_ATTRIBUTE_OFFLINE の属性が付与されているかどうかにつきましては、ATTRIB コマンドの他、ファイルのプロパティからも確認可能です。</p><p><img src="attrib_command.png" alt="ATTRIB コマンドの実行例"></p><p><img src="file_properties.png" alt="ファイルのプロパティ画面"></p><p>なお、Windows 10 ver 1903 以前は、ファイルに FILE_ATTRIBUTE_OFFLINE の属性が付与されている場合においても、オーバーレイは表示されませんでした。</p><p>Windows 10, version 1909 から Windows 10, version 22H2 環境では、× 印のオーバーレイが表示されます。</p><p>Windows 11, version 21H2 以降、および Windows Server 2022 以降の環境では、茶色い鞄のオーバーレイが表示されます。</p><table><thead><tr><th>OS バージョン</th><th>オーバーレイアイコンの表示</th></tr></thead><tbody><tr><td>Windows 10 version 1903 以前</td><td>表示なし</td></tr><tr><td>Windows 10 version 1909 ～ 22H2</td><td>× 印のオーバーレイ</td></tr><tr><td>Windows 11 version 21H2 以降</td><td>茶色い鞄のオーバーレイ</td></tr><tr><td>Windows Server 2022 以降</td><td>茶色い鞄のオーバーレイ</td></tr></tbody></table><p>こちらの情報が、お役立ちできますと幸いです。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025/09/02: 本 Blog の公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;こんにちは、Windows サポートの丸山です。&lt;/p&gt;
&lt;h2 id=&quot;概要&quot;&gt;&lt;a href=&quot;#概要&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>CVE-2025-26647 への対応とその影響について</title>
    <link href="https://jpwinsup.github.io/blog/2025/08/27/ActiveDirectory/Authentication/CVE-2025-26647%20Protections%20for%20Kerberos%20Authentication/"/>
    <id>https://jpwinsup.github.io/blog/2025/08/27/ActiveDirectory/Authentication/CVE-2025-26647%20Protections%20for%20Kerberos%20Authentication/</id>
    <published>2025-08-27T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.723Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。<br>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>2025 年 4 月 8 日にリリースされた Windows 更新プログラムには、Kerberos 認証の脆弱性に対する保護 (CVE-2025-26647) が含まれています。</p><p>一部環境にて、証明書を利用した認証 (例えば、スマートカード ログオンや証明書認証を利用した無線 LAN 接続 など) において、特権昇格の影響を受ける可能性のある脆弱性が報告されました。<br>CVE-2025-26647 では、この脆弱性に対して対応を行っています。</p><p>本記事では、CVE-2025-26647 に関してご案内させていただきます。</p><p>** 本脆弱性に関する公開情報<br><a href="https://support.microsoft.com/ja-jp/topic/cve-2025-26647-kerberos-%E8%AA%8D%E8%A8%BC-%E3%81%AE%E4%BF%9D%E8%AD%B7-5f5d753b-4023-4dd3-b7b7-c8b104933d53"> CVE-2025-26647 (Kerberos 認証) の保護 </a><br><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-26647"> Windows Kerberos の特権の昇格の脆弱性 </a></p><hr><h2 id="CVE-2025-26647-の詳細や影響を受ける可能性がある環境について"><a href="#CVE-2025-26647-の詳細や影響を受ける可能性がある環境について" class="headerlink" title="CVE-2025-26647 の詳細や影響を受ける可能性がある環境について"></a>CVE-2025-26647 の詳細や影響を受ける可能性がある環境について</h2><hr><p>Active Directory にあるアカウントの altSecurityIdentities 属性に以下 5 つのうちいずれかの記述方式を持つ値を設定しているアカウントが、特権を持つアカウント (例えば、Administrators グループや Domain Admins グループに所属するようなアカウント) である場合に、特権昇格の可能性があることが報告されております。</p><p>&lt;影響を受ける可能性のある altSecurityIdentities 属性の記述方式&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X509IssuerSerialNumber</span><br><span class="line">X509SKI</span><br><span class="line">X509SHA1PublicKey</span><br><span class="line">X509IssuerSubject</span><br><span class="line">X509NsubjectOnly</span><br></pre></td></tr></table></figure><p>altSecurityIdentities 属性は、ユーザーアカウントに対して証明書などを明示的に紐づけ（マッピング）し、その証明書などのデータを用いてユーザー認証を行う際に参照される属性値となっています。</p><p>本属性の利用について代表的なものとして、2022 年 5 月に CVE-2022-34691, CVE-2022-26931 および CVE-2022-26923 の脆弱性対応にあたってセキュリティ強化 （KB5014754） となります。<br>この脆弱性対応の対処方法の一つに、証明書を利用して認証するアカウントの altSecurityIdentities 属性に、証明書情報とマッピングさせるための値を設定し、脆弱性対応を行うという方法があります。</p><p>** 参照情報<br><a href="https://jpwinsup.github.io/blog/2023/04/11/PublicKeyInfrastructure/CertificateManagement/certificate-based-authentication-changes-on-may-2022/"> 2022 年 5 月 10 日の更新プログラムに含まれるドメイン コントローラーでの証明書ベースの認証の変更と対応の流れについて [KB5014754] </a><br><a href="https://learn.microsoft.com/ja-jp/windows/win32/ad/security-properties#altsecurityidentities"> ユーザー セキュリティ属性 - Win32 apps </a></p><hr><h2 id="CVE-2025-26647-に対応する流れと手順"><a href="#CVE-2025-26647-に対応する流れと手順" class="headerlink" title="CVE-2025-26647 に対応する流れと手順"></a>CVE-2025-26647 に対応する流れと手順</h2><hr><p>2025 年 4 月の更新プログラムを適用することで、証明書を用いた認証時にその証明書のチェーンに含まれる発行元 CA の証明書が NTAuth ストア 内に含まれていることを確認するように変更されています。<br>そのため、NTAuth ストアに認証に利用される証明書の直上にある発行元 CA 証明書を追加し、AllowNtAuthPolicyBypass レジストリを 2 に設定する (もしくは2025 年 10 月 14 日以降の更新プログラムを適用する) ことで脆弱性対応が完了します。対象のレジストリの設定箇所等については後述いたします。</p><p>NTAuth ストアへの証明書の追加手順については、以下の弊社サポートチームによる技術ブログをご参考ください。<br><a href="https://jpwinsup.github.io/blog/2024/10/24/PublicKeyInfrastructure/CertificateManagement/NTauth/"> NTAuth ストアの証明書の登録方法について </a></p><p>また、証明書ベースの認証ができなくなるリスクを回避するため、以下のスケジュールに沿って段階的に対応を進めていく予定としております。</p><h3 id="1-2025-年-4-月-8-日-初期展開フェーズ-監査モード"><a href="#1-2025-年-4-月-8-日-初期展開フェーズ-監査モード" class="headerlink" title="1) 2025 年 4 月 8 日: 初期展開フェーズ (監査モード)"></a>1) 2025 年 4 月 8 日: 初期展開フェーズ (監査モード)</h3><p>2025 年 4 月 8 日の更新プログラムにより、証明書ベースの認証を受け付けた際に、その証明書が脆弱性の影響を受ける可能性があるかどうかを判断できるようになります。<br>本脆弱性の影響を受ける可能性がある証明書を用いた認証が行われた場合、以下のイベント ログ ID:45 がドメイン コントローラーの SYSTEM イベントログ内に記録されます。<br>この時点では、認証を拒否することはありません。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ログの名前:         System</span><br><span class="line">ソース:           Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID:       45</span><br><span class="line">タスクのカテゴリ:      なし</span><br><span class="line">レベル:           警告</span><br><span class="line">キーワード:         クラシック</span><br><span class="line">説明:</span><br><span class="line">キー配布センター (KDC) で、有効なクライアント証明書が検出されましたが、NTAuth ストア内のルート証明書にチェーンされていませんでした。NTAuth ストアにチェーンされていない証明書のサポートは非推奨です。詳細については、https:&#x2F;&#x2F;go.microsoft.com&#x2F;fwlink&#x2F;?linkid&#x3D;2300705 を参照してください。</span><br><span class="line"></span><br><span class="line">ユーザー: &lt;アカウント名&gt;</span><br><span class="line">証明書のサブジェクト: &lt;認証に使用された証明書のサブジェクト情報&gt;</span><br><span class="line">証明書の発行者: &lt;認証に使用された証明書の発行元 CA&gt;</span><br><span class="line">証明書のシリアル番号: &lt;認証に使用された証明書のシリアル番号&gt;</span><br><span class="line">証明書の拇印: &lt;認証に使用された証明書の拇印&gt;</span><br></pre></td></tr></table></figure><p>イベント ログ ID:45 に記載されている「&lt;認証に使用された証明書の発行元 CA&gt;」に記載されている CA の CA 証明書を、NTAuth ストアに追加することで対処を進めます。<br>すべてのイベント ログ ID:45 を解決し、AllowNtAuthPolicyBypass レジストリを 2 に設定して強制フェーズとすることで脆弱性への対処が完了となります。<br>AllowNtAuthPolicyBypass レジストリ設定後に再起動は不要です。</p><h3 id="2-2025-年-7-月-8-日-既定で強制フェーズ"><a href="#2-2025-年-7-月-8-日-既定で強制フェーズ" class="headerlink" title="2) 2025 年 7 月 8 日: 既定で強制フェーズ"></a>2) 2025 年 7 月 8 日: 既定で強制フェーズ</h3><p>2025 年 7 月 8 日の更新プログラムを適用すると、脆弱性の影響を受ける証明書を用いた認証は既定で拒否されます。<br>認証が拒否された場合は、以下のイベント ログ ID:21 がドメイン コントローラーの SYSTEM イベントログ内に記録されます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ログの名前:         System</span><br><span class="line">ソース:           Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID:       21</span><br><span class="line">タスクのカテゴリ:      なし</span><br><span class="line">レベル:           警告</span><br><span class="line">キーワード:         クラシック</span><br><span class="line">説明:</span><br><span class="line">ユーザー &lt;アカウント名&gt; のクライアントの証明書が有効でなかったため、スマート カード ログオンに失敗しました。ユーザーに連絡し、スマート カード ログオンに使用しようとしていた証明書に関する情報を取得してください。チェーンの状態は 証明チェーンは正しく処理されましたが、証明機関の証明書の 1 つがポリシー プロバイダーによって信頼されていません。</span><br><span class="line">です。</span><br></pre></td></tr></table></figure><p>この時点では、AllowNtAuthPolicyBypass レジストリを明示的に 1 に設定することで、初期展開フェーズ (監査モード) に切り戻しをすることができます。<br>AllowNtAuthPolicyBypass レジストリ設定後に再起動は不要です。</p><h3 id="3-2025-年-10-月-14-日-強制モード"><a href="#3-2025-年-10-月-14-日-強制モード" class="headerlink" title="3) 2025 年 10 月 14 日: 強制モード"></a>3) 2025 年 10 月 14 日: 強制モード</h3><p>2025 年 10 月 14 日の更新プログラムを適用すると、脆弱性の影響を受ける証明書を用いた認証は拒否されます。<br>認証が拒否された場合は、イベント ログ ID:21 がドメイン コントローラーの SYSTEM イベントログ内に記録されます。<br>2025 年 10 月 14 日の更新プログラムを適用した後は、AllowNtAuthPolicyBypass レジストリの設定によるフェーズ変更はできなくなります。</p><h3 id="レジストリ-キー情報"><a href="#レジストリ-キー情報" class="headerlink" title="レジストリ キー情報"></a>レジストリ キー情報</h3><p>本脆弱性への対応に当たって追加された AllowNtAuthPolicyBypass について紹介します。<br>レジストリ キーは自動的には追加されません。動作を変更する必要がある場合は、レジストリ キーを手動で作成し、必要な値を設定する必要があります。<br>レジストリ キーが構成されていない場合の OS の動作は、展開のフェーズによって異なります。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">レジストリ キー: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Kdc</span><br><span class="line">値: AllowNtAuthPolicyBypass</span><br><span class="line">データ型: REG_DWORD</span><br><span class="line">値のデータ:</span><br><span class="line">0 (本脆弱性対策にかかる修正を無効にします)</span><br><span class="line">1 (NTAuth のチェックを実行し、失敗した場合、警告イベント ID:45 を出力します。 認証要求は許可されます (2025 年 4 月 8 日リリース以降の既定の動作))。</span><br><span class="line">2 (NTAuth チェックの実行し、失敗した場合、認証要求が拒否され、警告イベント ID:21 を出力します (2025 年 7 月 8 日リリース以降の既定の動作) )</span><br></pre></td></tr></table></figure><p>AllowNtAuthPolicyBypass レジストリ設定は、2025 年 4 月以降にリリースされた更新プログラムをインストールしたドメインコントローラーにて設定する必要があります。</p><hr><h2 id="既知の不具合について（2-点）"><a href="#既知の不具合について（2-点）" class="headerlink" title="既知の不具合について（2 点）"></a>既知の不具合について（2 点）</h2><hr><h3 id="1-2025-年-4-月-8-日の更新プログラムに含まれている不具合"><a href="#1-2025-年-4-月-8-日の更新プログラムに含まれている不具合" class="headerlink" title="1.2025 年 4 月 8 日の更新プログラムに含まれている不具合"></a>1.2025 年 4 月 8 日の更新プログラムに含まれている不具合</h3><p>※該当問題による実影響はなく、既に 2025 年 6 月 10 日の更新プログラムで改善されています。</p><p>2025 年 4 月リリースの月例更新プログラムには既知の問題が確認されております。<br>ただし、手動でレジストリ AllowNtAuthPolicyBypass = 2 と設定しない限り現状では影響はありません。</p><p>なお、本問題については、 2025 年 6 月リリースの更新プログラムにおいて既に修正がされておりますので、<br>2025 年 4 月リリースの更新プログラム適用を実施いただく際には、6 月の更新プログラム適用をご検討いただけますようお願いいたします。</p><p>以下、問題の詳細や対応についてご案内となります。</p><p>■ 問題の内容について</p><p>自己署名証明書が利用されるシナリオ（以下は例）が問題となる可能性がございます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Windows Hello for Business (WHfB) のキー信頼構成における WHfB のユーザー認証</span><br><span class="line">- Credential Guard が有効または TPM が使用できるドメイン参加端末による公開キー認証</span><br><span class="line">- その他、msds-KeyCredentialLink 属性に依存するような</span><br><span class="line">　サードパーティーのシングルサインオンやスマートカード、ID 管理システム</span><br></pre></td></tr></table></figure><p>これらのシナリオに合致する場合、以下のような事象が発生します。</p><p>・AllowNtAuthPolicyBypass が設定されていない、もしくは 1 に設定されている場合。（既定）<br>上記のシナリオに合致する認証にて、Kerberos-Key-Distribution-Center のイベント ID 45 のイベントログがドメイン コントローラー (DC) のシステムイベントログに記録されます。認証への影響はありません。</p><p>・AllowNtAuthPolicyBypass が 2 に設定されている場合。<br>上記シナリオに合致する認証にて、Kerberos-Key-Distribution-Center のイベント ID 21 のイベントログが DC のシステムイベントログに記録され、認証が拒否されます。</p><p>■ この問題への対応策</p><p>イベント ID 45 の記録が以下のようになっていることを確認します。</p><ol><li><p>WHfB ユーザー ログオンの場合、証明書のサブジェクトと発行者の両方が、以下のような形式と一致します。<br>　 <code>&lt;SID&gt;/&lt;UID&gt;/login.windows.net/&lt;テナント ID&gt;/&lt;ユーザー UPN&gt;</code></p></li><li><p>ドメイン参加端末による公開キー認証の場合、ユーザーがコンピューター アカウント (末尾の $ 文字で終わる) となっています。<br>　　証明書のサブジェクトと発行者は同じコンピューター名となっていて、証明書のシリアル番号は 01 となっています。</p></li></ol><p>イベント ID 45 の記録が上記に合致している場合、その ID 45 は無視していただいても問題ございません。</p><p>また、本問題については既に 2025 年 6 月 10 日リリースの更新プログラムにおいて既に修正がされています。更新プログラム適用をご検討いただけますようお願いいたします。</p><h3 id="2-2025-年-7-月-8-日の更新プログラムに含まれている不具合"><a href="#2-2025-年-7-月-8-日の更新プログラムに含まれている不具合" class="headerlink" title="2.2025 年 7 月 8 日の更新プログラムに含まれている不具合"></a>2.2025 年 7 月 8 日の更新プログラムに含まれている不具合</h3><p>※本問題は、上記の 「2025 年 4 月 8 日の更新プログラムに含まれている不具合」とは別の不具合であり、実際の影響はなく、現在、弊社内にて修正に向けて対応を進めています。</p><p>以下、問題の詳細や対応についてご案内となります。</p><p>■ 問題の内容について</p><p>2025 年 7 月 8 日の更新プログラムを適用した環境、またはレジストリで強制モードが設定された状態において、Windows Hello for Business 環境などで自己署名証明書を用いた認証が行われた場合、認証自体は成功するものの、ID:21 イベントが意図せず記録される事象が確認されています。<br>※この場合、実際の影響はなく、あくまで意図されていない ID:21 イベントが記録するのみです。<br>※自己署名証明書を用いた認証の例は、上記の 「2025 年 4 月 8 日の更新プログラムに含まれている不具合」 の説明にてご紹介しています。</p><p>■ この問題への対応策</p><p>ご利用環境にて記録される ID:21 イベントがこの不具合によるものか、あるいは強制モードによって拒否された認証に伴う想定された動作かを判断する必要があります。<br>ただし、現時点では不具合による ID:21 かどうかを明確に判別する方法がないため、まず以下の 2 点をご確認いただけますと幸いです。</p><p>・ID:21 イベントが記録された際、Windows Hello for Business によるログオンの失敗等、自己署名証明書を利用した認証の失敗報告が増えていないかを確認します。<br>（問題報告が増えているといったことがなければ、この ID:21 イベントの不具合による記録の可能性が高いと考えられます）</p><p>・7 月の更新プログラムを適用する前の ID:45 イベントの記録状態を確認します。こちらは、7 月の更新プログラムを適用前の状態により確認方法が異なります。</p><p>-6 月の更新プログラムを適用済みの状態で ID:45 が記録されていない状況であれば、ID:21 イベントによる実影響がないとお考えいただけます。<br>-4 月 または 5 月の更新プログラムを適用していて 6 月の更新プログラム適用を未実施の場合は、上記の 「2025 年 4 月 8 日の更新プログラムに含まれている不具合」による影響をクリアするために、まず 6 月の更新プログラム適用いただくことをおすすめします。</p><p>本不具合はイベントが記録するだけで実害ありませんが、今後の更新プログラムで修正される予定です。<br>修正までの間は、AllowNtAuthPolicyBypass レジストリを 1 に設定し監査モードへ切り戻し、運用を継続いただくこともご検討いただければと存じます。<br>（AllowNtAuthPolicyBypass レジストリ設定後に再起動は不要です）</p><hr><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><hr><p>2025/08/28 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;br&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;2025 年 4 月 8 日にリリースされた Windows 更新プログラムには</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Authentication" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Authentication/"/>
    
    
  </entry>
  
  <entry>
    <title>マルチセッションOS にて正しいパスワードを入力しているにも関わらず画面ロック解除が出来ない</title>
    <link href="https://jpwinsup.github.io/blog/2025/08/26/ActiveDirectory/Authentication/multi-sessionOSLogonIssue/"/>
    <id>https://jpwinsup.github.io/blog/2025/08/26/ActiveDirectory/Authentication/multi-sessionOSLogonIssue/</id>
    <published>2025-08-26T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.727Z</updated>
    
    <content type="html"><![CDATA[<p>※ 本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows Commercial Support Directory Services サポートチームです。<br></p><p>2025 年 8 月現在、表題の事象が報告されており、現在弊社内で調査を進めている状況でございますが、情報共有を目的として本事象についてご案内させていただきます。<br>なお、今後の調査状況によって本記事の内容が変更される可能性がございますため、予めご了承ください。</p><h2 id="マルチセッション-OS-にて正しいパスワードを入力しているにも関わらず画面ロック解除が出来ない事象について"><a href="#マルチセッション-OS-にて正しいパスワードを入力しているにも関わらず画面ロック解除が出来ない事象について" class="headerlink" title="マルチセッション OS にて正しいパスワードを入力しているにも関わらず画面ロック解除が出来ない事象について"></a>マルチセッション OS にて正しいパスワードを入力しているにも関わらず画面ロック解除が出来ない事象について</h2><hr><p>Azure Virtual Desktop 等で利用可能な Windows 11 マルチセッション OS (※ 現状動作が確認できているのは 23H2 及び 24H2 となります) でのみ発生する事象となりますが、複数のユーザーが同時にログオン / ロック解除した場合、タイミングの問題によりロック解除が失敗する場合がございます。</p><p>具体的には以下のようなシナリオで本事象が発生する可能性があります。</p><ol><li>ユーザー A がマシン X (マルチセッション OS) にログオンします。</li><li>ユーザー A が画面ロックを行います。</li><li>ユーザー A がロック解除を行うと同時に、別のユーザー B がマシン X にログオンします。</li><li>ユーザー B が画面ロックを行います。</li><li>ユーザー B がロック解除を行うが、正しいパスワードを入力しているにも関わらず、ロック解除が出来ません。</li></ol><p>本事象が発生するのは、上記 3 のステップにて、ログオンとロック解除が同時 (※) に行われた場合のみとなりますが、現在のマルチセッション OS 固有のセッション管理 (セッションごとの資格情報の管理) の仕組み上、本事象が発生する可能性がございます。<br>※ 環境に依存しますが、セッション管理の動作は瞬間的に行われるため、タイミングは非常にシビアとなります。</p><p>なお、事象が発生しますとユーザー自身では画面ロック解除が出来ないため、管理者ユーザーによるセッション サインオフ等の対処が必要となります。</p><p>もし、本件と類似の事象がお客様環境で発生しておりましたら、是非弊社サポートまでお問い合わせをいただければ幸いでございます。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/8/27 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※ 本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services サポートチームです。&lt;br&gt;&lt;/p&gt;
&lt;p&gt;2025 年 8 月現在、表題の事象が報告されており</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Authentication" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Authentication/"/>
    
    
  </entry>
  
  <entry>
    <title>ホスト名と IP アドレスを引き継ぐドメイン コントローラーの移行手順</title>
    <link href="https://jpwinsup.github.io/blog/2025/08/05/ActiveDirectory/PromotionAndDemotion/migrate-DCs-with-OldIPandHostName/"/>
    <id>https://jpwinsup.github.io/blog/2025/08/05/ActiveDirectory/PromotionAndDemotion/migrate-DCs-with-OldIPandHostName/</id>
    <published>2025-08-05T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.737Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。<br>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>本記事で IP アドレスとホスト名を引き継ぐ形でドメイン コントローラー（DC）を移行する際の、一般的な作業の流れについてご紹介します。</p><p>なお、後述の　&lt;補足 1&gt; で記載しておりますが、DC 昇格後にホスト名と IP アドレスを変更する場合、作業が煩雑であり障害を引き起こす可能性が高いため、今回ご案内するホスト名および IP アドレスを引き継ぐ形でリプレースされる実績が多くございます。</p><h1 id="既存-DC-の一部のみが移行対象となる場合"><a href="#既存-DC-の一部のみが移行対象となる場合" class="headerlink" title="既存 DC の一部のみが移行対象となる場合"></a>既存 DC の一部のみが移行対象となる場合</h1><p>FSMO の役割を保持する DC が移行対象となる場合は、事前に FSMO の役割を別の DC に転送する必要があります。<br>作業完了後、必要に応じて FSMO の役割を正しい DC に転送ください。</p><p>&lt;一般的な作業の流れ&gt;  </p><ol><li>事前準備として、DC 全台の正常性確認を実施します。<br>（DC の正常性を確認する手順は下記の &lt;補足 2&gt; をご確認ください）</li><li>対象 DC を通常降格し、ドメインから離脱させます。</li><li>必要に応じて降格した DC の Metadata Cleanup 手順を実施し、降格した DC の情報を AD データベースから削除します。<br>（Metadata Cleanup は下記の &lt;補足 2&gt; をご確認ください）</li><li>新サーバーをドメインに参加させて、降格した DC と同じ IP アドレス・ホスト名を新サーバーに設定して再起動します。</li><li>稼働中の DC 全台で、”repadmin /syncall /AeP” を実行し、新たなホスト名及び IP アドレス情報をすべての DC に複製します。</li><li>新サーバーを DC に昇格させます。</li></ol><h1 id="既存-DC-全台が移行対象となる場合"><a href="#既存-DC-全台が移行対象となる場合" class="headerlink" title="既存 DC 全台が移行対象となる場合"></a>既存 DC 全台が移行対象となる場合</h1><p> &lt;一般的な作業の流れ&gt;  </p><ol><li>事前準備として、DC 全台の正常性確認を実施します。<br>（DC の正常性を確認する手順は下記の &lt;補足 2&gt; をご確認ください）</li><li>FSMO の役割を持たない DC 1 台を通常降格し、ドメインから離脱させます。</li><li>必要に応じて降格した DC の Metadata Cleanup 手順を実施し、降格した DC の情報を AD データベースから削除します。<br>（Metadata Cleanup は下記の &lt;補足 2&gt; をご確認ください）</li><li>新サーバーをドメインに参加させて、降格した DC と同じ IP アドレス・ホスト名を新サーバーに設定して再起動します。</li><li>稼働中の DC 全台で、”repadmin /syncall /AeP” を実行し、新たなホスト名及び IP アドレス情報をすべての DC に複製します。</li><li>新サーバーを DC に昇格させます、</li><li>FSMO の役割を新たに昇格した DC に転送します。</li><li>残りの DC も手順 2~6 の手順で移行します。</li><li>必要に応じて FSMO の役割を設定されたい DC に転送します。</li></ol><h2 id="補足-1：稼働中の-DC-に対する-IP-アドレス・ホスト名の変更に関する注意事項"><a href="#補足-1：稼働中の-DC-に対する-IP-アドレス・ホスト名の変更に関する注意事項" class="headerlink" title="補足 1：稼働中の DC に対する IP アドレス・ホスト名の変更に関する注意事項"></a>補足 1：稼働中の DC に対する IP アドレス・ホスト名の変更に関する注意事項</h2><p>DC が稼働中の状態でホスト名や IP アドレスを直接変更することは、技術的には可能ですが、高いリスクを伴うため推奨されません。これは、DC の設計上、想定されていない操作です。</p><p>実際に、稼働中の DC に対してホスト名を変更した結果、旧ホスト名の情報が AD データベースに残留し、複製エラーや Netlogon サービスの起動失敗といった問題が発生した事例が報告されています。<br>また、IP アドレスの変更においても、旧アドレスを参照しているクライアントからのアクセス失敗などの影響が確認されています。</p><p>そのため、DC に昇格する前の段階で、あらかじめホスト名および IP アドレスを設定しておくことを推奨します。<br>※つまり、DC のホスト名や IP アドレスの変更は、昇格前または降格後の DC として稼働していない状態 で実施することが、最も安全かつ確実です。</p><h2 id="補足-2：作業の流れに関する補足情報"><a href="#補足-2：作業の流れに関する補足情報" class="headerlink" title="補足 2：作業の流れに関する補足情報"></a>補足 2：作業の流れに関する補足情報</h2><p>Metadata Cleanup の手順、FSMO の役割を持っている DC の確認方法や転送方法、通常降格でエラーが発生する場合は、以下の記事も併せてご参照いただきますようお願いいたします。<br><a href="https://jpwinsup.github.io/blog/2023/04/02/ActiveDirectory/PromotionAndDemotion/Demotion/">ドメイン コントローラーの降格方法</a></p><p>DC の正常性確認は以下の記事をご参照ください。<br><a href="https://jpwinsup.github.io/blog/2023/03/30/ActiveDirectory/PromotionAndDemotion/domain-controller-health-check/">ドメインコントローラ（DC）の正常性の確認方法について</a></p><p>もし Windows Server 2012/2012 R2 から移行する場合や、移行先と移行元のサーバー OS バージョンの違いが生じる場合、事前準備として以下の記事をご一読いただければ幸いです。<br><a href="https://jpwinsup.github.io/blog/2023/04/27/ActiveDirectory/PromotionAndDemotion/2012-migration-summary/">Windows Server 2012 、 2012 R2 からの移行、アップグレードにあたって考慮事項等まとめ</a></p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/08/28 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;br&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;本記事で IP アドレスとホスト名を引き継ぐ形でドメイン コントローラー（DC）</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Authentication" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Authentication/"/>
    
    
  </entry>
  
  <entry>
    <title>メディア プレーヤー にて CD の取り込みを実施中、 オーディオ CD を再生すると正しく再生されない問題について</title>
    <link href="https://jpwinsup.github.io/blog/2025/08/03/UserInterfaceAndApps/MicrosoftStore/IssueWithMediaPlayerDuringCDRipping/"/>
    <id>https://jpwinsup.github.io/blog/2025/08/03/UserInterfaceAndApps/MicrosoftStore/IssueWithMediaPlayerDuringCDRipping/</id>
    <published>2025-08-03T05:11:20.000Z</published>
    <updated>2025-10-03T00:49:08.170Z</updated>
    
    <content type="html"><![CDATA[<p>※ 本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。日本マイクロソフトサポートです。</p><p>本公開情報では メディア プレーヤー において、CD の取り込みを実施しているタイミングにてオーディオ CD を再生すると<br>正しく再生されない事象についてお伝えさせていただきます。</p><h2 id="適用対象"><a href="#適用対象" class="headerlink" title="適用対象"></a>適用対象</h2><p>全てのバージョンの メディア プレーヤー<br>※ Windows Media Player Legacy (Windows メディア プレーヤー従来版) では発生いたしません。</p><h2 id="事象の説明"><a href="#事象の説明" class="headerlink" title="事象の説明"></a>事象の説明</h2><p>メディア プレーヤー にて CD の取り込みを実施しているタイミングにて、オーディオ CD を再生するとオーディオが<br>正しく再生されない事象が発生する場合がございます。<br>一例として、再生中のオーディオの音が途切れる事象や、一部分の再生が繰り返される事象、機械音が再生される事象が報告<br>されております。<br>なお、影響範囲はオーディオ CD の再生となりますため、CD の取り込み自体は問題なく行われます。</p><h2 id="要因"><a href="#要因" class="headerlink" title="要因"></a>要因</h2><p>本動作は、メディア プレーヤー の動作に起因して発生いたします。<br>メディア プレーヤーでは、オーディオ CD の再生の際に、先読みをしてデータを一部バッファすることで、途切れることない<br>オーディオ再生を実現しております。<br>しかしながら、メディア プレーヤー の仕様により、CD の取り込み時には、上記バッファ処理が想定通り行われないことで、<br>オーディオ再生が正しく実施されない場合がございます。</p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>CD の取り込みの完了をお待ちいただきまして、オーディオ CD を再生いただけますと幸いです。<br>また、CD の取り込みとオーディオ CD の再生を並行して行う必要がございます場合には、Windows Media Player Legacy<br>(Windows メディア プレーヤー従来版) にて音楽読み込みを実施ください。</p><h2 id="弊社での対応状況"><a href="#弊社での対応状況" class="headerlink" title="弊社での対応状況"></a>弊社での対応状況</h2><p>マイクロソフトでは、この問題について把握しており、現在修正に向けて取り組んでいます。<br>情報の更新があり次第、本ブログを更新いたします。</p><p>本投稿が少しでも皆様のお役に立てば幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025/08/15 : 本 Blog の公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※ 本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。日本マイクロソフトサポートです。&lt;/p&gt;
&lt;p&gt;本公開情報では メディア プレーヤー において、CD の取り込みを実施しているタイミングにてオーディオ CD を再生すると&lt;br&gt;正しく再生</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>ワークグループ クラスターのサポート ポリシー変更に関して</title>
    <link href="https://jpwinsup.github.io/blog/2025/07/22/FailoverClustering/ConfigurationAndManagement/Changed-WorkGroupCluster-SupportPolicy/"/>
    <id>https://jpwinsup.github.io/blog/2025/07/22/FailoverClustering/ConfigurationAndManagement/Changed-WorkGroupCluster-SupportPolicy/</id>
    <published>2025-07-22T13:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.745Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>いつも弊社製品をご利用いただきまして誠にありがとうございます。日本マイクロソフトの Windows サポートチームです。</p><p>2024 年 7 月時点にて更新された ワークグループ クラスターに関するサポート ポリシーの内容をお伝えさせていただきます。</p><h2 id="変更内容"><a href="#変更内容" class="headerlink" title="[変更内容]"></a>[変更内容]</h2><p>2024 年 7 月時点にて下記のようにサポートポリシーが更新されております。</p><table><thead><tr><th>ワークロード</th><th>サポート状況</th><th>備考</th></tr></thead><tbody><tr><td>Hyper-V VM</td><td>サポートされています</td><td>Windows Server 2025 以降でサポート</td></tr><tr><td>SQL Server の可用性グループ</td><td>サポートされています</td><td>Windows Server 2016 から 2025 までサポート</td></tr><tr><td>ファイル サーバー</td><td>サポートされていません</td><td></td></tr><tr><td>SQL Server FCI</td><td>サポートされていません</td><td></td></tr></tbody></table><p>参照 : <a href="https://learn.microsoft.com/ja-jp/windows-server/failover-clustering/create-workgroup-cluster?tabs=desktop#cluster-workloads">クラスター ワークロード</a></p><p>弊社にて現在公開されております海外ブログなどの情報では、Windows Server 2016 のワークグループ クラスターにおいて一部の Hyper-V 機能が利用可能である旨の記載がございますが、今回のワークグループ クラスタ―に対するサポート ポリシーの更新に伴い、Hyper-V 機能がサポートされるワークグループ クラスタ―の OS バージョンは、Windows Server 2025 以降となりましたので、恐れ入りますが何卒よろしくお願い申し上げます。</p><p>また上記サポート ポリシーの更新に伴い、もし Windows Server 2025 以前の OS にて仮想マシン ワークロード (Hyper-V 機能) をご利用のワークグループ クラスタ―環境がございましたら、誠にお手数ではございますが、サポート対象バージョンである Windows Server 2025 へアップグレードの上、ご利用いただく事をご検討いただけますと幸いでございます。</p><br><p>本投稿が少しでも皆様のお役に立てば幸いです。</p><p>※ 本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;いつも弊社製品をご利用いただきまして誠にありがとうございます。日本マイクロソフトの Windows サポートチームです。&lt;/p&gt;
&lt;p&gt;2024 年 7 月時点にて更新された ワークグループ クラスターに</summary>
      
    
    
    
    <category term="Failover Clustering" scheme="https://jpwinsup.github.io/blog/categories/Failover-Clustering/"/>
    
    <category term="Configuration and Management" scheme="https://jpwinsup.github.io/blog/categories/Failover-Clustering/Configuration-and-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>Azure Virtual Desktop のホスト プール リダイレクトの既定値が変更されます</title>
    <link href="https://jpwinsup.github.io/blog/2025/07/15/RemoteDesktopService/AVD/AVD-host-pool-redirection-defaults-changing/"/>
    <id>https://jpwinsup.github.io/blog/2025/07/15/RemoteDesktopService/AVD/AVD-host-pool-redirection-defaults-changing/</id>
    <published>2025-07-15T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.908Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。<br>こんにちは。Windows プラットフォーム サポートの亀井です。</p><p>このブログでは、Azure Virtual Desktop（AVD）のホスト プールにおけるリダイレクト機能の既定値が変更されることについて、<br>公式ブログの内容を翻訳します。</p><p>翻訳元：<br><a href="https://techcommunity.microsoft.com/blog/azurevirtualdesktopblog/host-pool-redirection-defaults-changing-in-azure-virtual-desktop/4408071">Host pool redirection defaults changing in Azure Virtual Desktop - Azure Virtual Desktop Blog</a></p><hr><h2 id="Azure-Virtual-Desktop-のホスト-プール-リダイレクトの既定値が変更されます"><a href="#Azure-Virtual-Desktop-のホスト-プール-リダイレクトの既定値が変更されます" class="headerlink" title="Azure Virtual Desktop のホスト プール リダイレクトの既定値が変更されます"></a>Azure Virtual Desktop のホスト プール リダイレクトの既定値が変更されます</h2><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>2025 年 4 月 29 日より、Microsoft Secure Future Initiative (SFI) の一環として、AVD の新規ホスト プールでは、<br>以下のリダイレクト機能が既定で無効化されます。</p><ul><li>クリップボード リダイレクト</li><li>プリンター リダイレクト</li><li>USB リダイレクト</li><li>ドライブ リダイレクト</li></ul><p>この変更により、データの持ち出しやマルウェアの侵入リスクが低減され、より安全な環境が標準で提供されます。</p><p>IT 管理者は、必要に応じて次の方法でリダイレクトを有効化できます。</p><ul><li>Azure ポータルのホスト プール Remote Desktop Protocol (RDP) プロパティ</li><li>Microsoft Intune</li><li>グループ ポリシー</li></ul><hr><h3 id="変更のタイムライン"><a href="#変更のタイムライン" class="headerlink" title="変更のタイムライン"></a>変更のタイムライン</h3><p>このリダイレクト既定値の変更は近日中に適用されます。<br>IT 管理者向けに、Azure ポータルの「ホスト プールの作成」画面に通知バナーが表示され、<br>新しい既定値と、ホスト プール作成後に RDP プロパティを変更して上書きする方法のドキュメント リンクが案内されます。</p><p>※既存のホスト プールには自動的な変更は加えられませんが、不要なリダイレクトは無効化することでセキュリティ強化を推奨します。<br>設定変更方法は <a href="https://learn.microsoft.com/ja-jp/azure/virtual-desktop/rdp-properties#device-redirection">RDP プロパティのデバイス リダイレクト セクションのドキュメント</a>をご参照ください。</p><hr><h3 id="既定値の上書き方法"><a href="#既定値の上書き方法" class="headerlink" title="既定値の上書き方法"></a>既定値の上書き方法</h3><p>IT 管理者は、Azureポータルのホストプール RDP プロパティのデバイス リダイレクト項目から、必要なリダイレクトを有効化できます。</p><img src="/blog/2025/07/15/RemoteDesktopService/AVD/AVD-host-pool-redirection-defaults-changing/img1.png" class=""><p>RDP プロパティの設定方法や、Microsoft Intune、グループ ポリシーを使った方法については、<br>各リダイレクト設定のドキュメントをご参照ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-desktop/redirection-configure-clipboard?tabs=intune&pivots=azure-virtual-desktop#configure-clipboard-redirection-using-host-pool-rdp-properties">クリップ ボード リダイレクト</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-desktop/redirection-configure-printers?tabs=intune&pivots=azure-virtual-desktop#configure-printer-redirection-using-host-pool-rdp-properties">プリンター リダイレクト</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-desktop/redirection-configure-usb?tabs=intune&pivots=azure-virtual-desktop#host-pool-configuration">USB リダイレクト</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/virtual-desktop/redirection-configure-drives-storage?tabs=intune&pivots=azure-virtual-desktop#configure-drive-redirection-using-host-pool-rdp-properties">ドライブ リダイレクト</a></li></ul><p>※ Azure ポータルの RDP プロパティ設定は、Microsoft Intune やグループ ポリシーの設定よりも優先されます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;br&gt;こんにちは。Windows プラットフォーム サポートの亀井です。&lt;/p&gt;
&lt;p&gt;このブログでは、Azure Virtual Desktop（AVD）のホスト プールにおけるリダイレクト機能の既定値が変更されるこ</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Azure Virtual Desktop (AVD)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Azure-Virtual-Desktop-AVD/"/>
    
    
  </entry>
  
  <entry>
    <title>コピー直後のはじめのキー入力が確定されてしまう問題について</title>
    <link href="https://jpwinsup.github.io/blog/2025/07/15/UserInterfaceAndApps/LanguageSupport_IME/first_key_finalized_after_copy/"/>
    <id>https://jpwinsup.github.io/blog/2025/07/15/UserInterfaceAndApps/LanguageSupport_IME/first_key_finalized_after_copy/</id>
    <published>2025-07-15T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.164Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><p>こんにちは、Windows サポート チームの近藤です。<br>本日は表題の問題についての情報をご紹介いたします。</p><h2 id="適用対象の-OS"><a href="#適用対象の-OS" class="headerlink" title="適用対象の OS"></a>適用対象の OS</h2><ul><li>Windows 11 version 22H2 / 23H2</li><li>Windows 11 version 24H2 / LTSC 2024</li></ul><p>※ Windows 11 version 22H2 / 23H2 は 2025 年 1 月 29 日以降の更新プログラムを適用している環境のみで発生します。</p><h2 id="事象の概要"><a href="#事象の概要" class="headerlink" title="事象の概要"></a>事象の概要</h2><p>以前のバージョンの Microsoft IME や他社の日本語入力ソフトウェアを利用している場合に、コピー操作後のはじめのキー入力が、意図せず確定される問題が発生する場合があります。<br>この動作は、タッチ キーボードを一度開いて閉じることで対処が可能ですが、再サインインにより再発する場合があります。</p><h2 id="要因"><a href="#要因" class="headerlink" title="要因"></a>要因</h2><p>これはタッチ キーボードの動作に関連して発生する問題です。<br>この問題は上記の Windows OS の問題と判断されており開発部門において対応を検討中です。</p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><h4 id="タッチ-キーボードを頻繁に利用する環境での対処"><a href="#タッチ-キーボードを頻繁に利用する環境での対処" class="headerlink" title="タッチ キーボードを頻繁に利用する環境での対処"></a>タッチ キーボードを頻繁に利用する環境での対処</h4><p>サインイン後にタッチ キーボードを一度開き、閉じてください。<br>なおこの対応は、サインインの都度 実施いただく必要があります。</p><h4 id="タッチ-キーボードをほとんど利用しない環境での対処"><a href="#タッチ-キーボードをほとんど利用しない環境での対処" class="headerlink" title="タッチ キーボードをほとんど利用しない環境での対処"></a>タッチ キーボードをほとんど利用しない環境での対処</h4><p>再現ユーザーで以下の 2 つのコマンドを実行後、再サインインすることで対処が可能です。</p><blockquote><p>reg delete HKCU\Software\Microsoft\InputMethod\Settings\Common /v TouchKeyboardHasEverShown /f<br>reg delete HKCU\Software\Microsoft\InputMethod\Settings\Common /v InputPanelPageLastOpenTime /f</p></blockquote><h4 id="その他の対処策"><a href="#その他の対処策" class="headerlink" title="その他の対処策"></a>その他の対処策</h4><p>新しい Microsoft IME を利用いただくことでも回避可能です。<br><br></p><p>本情報がお客様の問題解決の一助となりましたら幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><hr><p>更新履歴<br>2025/07/15 本 Blog の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポート チームの近藤です。&lt;br&gt;本日は表題の問題についての情報をご紹介いたします。&lt;/p&gt;
&lt;h2 id=&quot;適用対象の</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Language Support" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Language-Support/"/>
    
    
  </entry>
  
  <entry>
    <title>RemoteApp 利用時の IME に関する事象と対処策について</title>
    <link href="https://jpwinsup.github.io/blog/2025/07/14/RemoteDesktopService/RemoteAppIMEIssues/"/>
    <id>https://jpwinsup.github.io/blog/2025/07/14/RemoteDesktopService/RemoteAppIMEIssues/</id>
    <published>2025-07-14T02:35:48.000Z</published>
    <updated>2025-10-03T00:49:07.957Z</updated>
    
    <content type="html"><![CDATA[<p>本記事では、RemoteApp 利用時の IME に関する問題が発生した際に<br>有用である可能性がある回避策についてご案内いたします。</p><hr><h2 id="事象-1-IME-の同期に関する事象について"><a href="#事象-1-IME-の同期に関する事象について" class="headerlink" title="事象 1 IME の同期に関する事象について"></a>事象 1 IME の同期に関する事象について</h2><p>RemoteApp において接続先の IME が使用されます。<br>既定では接続元の IME に同期される Seamless Language Bar と呼ばれる機能が動作しています。<br>このため、既定の設定のまま使用された場合、エンドユーザーは接続先の IME を使用していることを意識せずに、接続先の IME を利用することができます。</p><p>しかしながら、IME の設定の同期が何らかの問題でうまくいかない場合があります (*)。<br>この時、接続先の IME ツールバーを表示させて使用することで回避できることがありますので、以下に設定方法をご案内いたします。</p><h3 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h3><p>接続先の IME ツールバーを表示、使用するには、RDP ファイルに以下の RDP プロパティを追加する必要があります。</p><p>DisableSeamlessLanguagebar:i:1</p><p>この設定は AVD (Azure Virtual Desktop) の RemoteApp につきましては<br>Azure Portal - Azure Virtual Desktop - ホスト プール - 任意のホスト プール - RDP プロパティ から追加することが可能です。</p><p>しかしながら、オンプレミスなどで使用される Remote Desktop Service において<br>RDP プロパティに追加するための Set-RDSessionCollectionConfiguration コマンドレットが現時点では対応しておりません。<br>このため、RDWeb や WebFeed では “DisableSeamlessLanguagebar:i:1” を追加するこの対応はできかねます。</p><p>オンプレミスなどで使用される Remote Desktop Service において IME の問題が発生している場合、<br>大変恐縮ですが、現状では上記設定を追加した RDP ファイルをグループポリシーなどで配布していただき、エンドユーザー様にご利用いただくことをご検討ください。<br>Set-RDSessionCollectionConfiguration の実装に変化がありましたらこちらの記事を更新させていただきます。</p><h4 id="IME-の同期-に関する問題の例。"><a href="#IME-の同期-に関する問題の例。" class="headerlink" title="(*) IME の同期 に関する問題の例。"></a>(*) IME の同期 に関する問題の例。</h4><ul><li><p>接続元のタスク トレイ アイコン上で右クリックによる入力切替不可。<br>接続元のタスク トレイ アイコン上で IME を右クリックして 「ひらがな」 「全角カタカナ」 「全角英数字」 「半角カタカナ」 「半角英数字/直接入力」 を選択しても変更が反映されない問題が報告されております。<br>なお、この環境下でも、タスク トレイ アイコン上で IME を左クリックし半角/全角を変更した場合や、キーボードによる IME の変更 (半角/全角キー、無変換キー) の場合は問題なく設定を変更することが可能であることを確認しておりますので、 “DisableSeamlessLanguagebar:i:1” の回避策のほかに運用上の回避もご検討ください。</p></li><li><p>参考情報<br><a href="https://learn.microsoft.com/ja-jp/powershell/module/remotedesktop/set-rdsessioncollectionconfiguration">https://learn.microsoft.com/ja-jp/powershell/module/remotedesktop/set-rdsessioncollectionconfiguration</a></p></li></ul><hr><h2 id="事象-2-日本語の文字変換が正しく行われず、その後-RemoteApp-がフリーズする事象"><a href="#事象-2-日本語の文字変換が正しく行われず、その後-RemoteApp-がフリーズする事象" class="headerlink" title="事象 2 日本語の文字変換が正しく行われず、その後 RemoteApp がフリーズする事象"></a>事象 2 日本語の文字変換が正しく行われず、その後 RemoteApp がフリーズする事象</h2><p>RemoteApp を Windows Server 2025 より展開しているシナリオで、アプリケーション利用時に日本語を含む文字を入力・変換すると、<br>その文字に含まれるアルファベットが残存し変換が正しく完了せず、RemoteApp がフリーズする事象が報告されております。</p><p>例：へんしゅう -&gt; nsへんしゅう</p><h3 id="回避策-1"><a href="#回避策-1" class="headerlink" title="回避策"></a>回避策</h3><p>本事象については現在調査中でございます。<br>以下の対処策で事象の回避ができることを確認しております。こちらで対処可能かご検討いただけますと幸いでございます</p><ol><li>接続元端末にて、[スタート ] を選択し、[設定] &gt; [時刻と言語] &gt; [言語と地域] を選択します。</li><li>[言語 - 日本語] の右側にある [・・・] を押下し、[言語のオプション] を選択します。</li><li>[キーボード - Microsoft IME] &gt; [キーボード オプション] - [Microsoft IME] - [全般] - [互換性] を選択します。</li><li>[以前のバージョンの Microsoft IME を使う] をオンにします。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事では、RemoteApp 利用時の IME に関する問題が発生した際に&lt;br&gt;有用である可能性がある回避策についてご案内いたします。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;事象-1-IME-の同期に関する事象について&quot;&gt;&lt;a href=&quot;#事象-1-IME-の同期に関する</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Remote Desktop Service (RDS)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Remote-Desktop-Service-RDS/"/>
    
    
  </entry>
  
  <entry>
    <title>プリント サーバーの IP アドレスが指定されたポイント アンド プリント環境について</title>
    <link href="https://jpwinsup.github.io/blog/2025/07/02/UserInterfaceAndApps/Printing/PointAndPrint_IPAddress/"/>
    <id>https://jpwinsup.github.io/blog/2025/07/02/UserInterfaceAndApps/Printing/PointAndPrint_IPAddress/</id>
    <published>2025-07-02T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.172Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><p>こんにちは、Windows サポート チームの竹内です。<br>クライアント PC を Windows 11 とする、プリント サーバーの IP アドレスが指定されたポイント アンド プリントの環境において、共有プリンターの追加 および 共有プリンターからの印刷に時間がかかるとのご報告をいただいております。<br>本ブログでは、確認している事象および対応策についてお知らせいたします。</p><h2 id="IP-アドレス指定について"><a href="#IP-アドレス指定について" class="headerlink" title="IP アドレス指定について"></a>IP アドレス指定について</h2><p>まず、ポイント アンド プリントを行う場合、以下のグループポリシーで信頼するプリントサーバーを IP アドレスではなく FQDN (完全修飾名) で登録する必要があります。</p><p>ご報告の事象には、このグループポリシーで指定した FQDN を使用して、ポイント アンド プリントを行うのが効果的です。</p><p>また、ホスト名であれば FQDN への変換は比較的 迅速に行えるためホスト名を使用しても遅延は発生しません。</p><p>・ ポイント アンド プリントの実装-許可されたサーバー<br><img src="PointAndPrint_IPAddress_01.png" alt="Package Point and Print - Approved servers"></p><ul><li><a href="https://support.microsoft.com/ja-jp/topic/cve-2021-34481-873642bf-2634-49c5-a23b-6d8e9a302872">KB5005652—新しいポイントアンドプリントの既定のドライバーのインストールの動作を管理する (CVE-2021-34481)</a> </li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>クライアント PC を Windows 11 とする、プリント サーバーの IP アドレスが指定されたポイント アンド プリントの環境において、共有プリンターの追加や印刷に時間がかかる事象が発生しています。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Windows 11 では、ポイント アンド プリントの通信（クライアント - サーバー通信）に、既定で RPC over TCP が使用されています。</p><p>また、RPC over TCP おいてプリントサーバーに対して、FQDN にて問い合わせが行われることがあります。</p><p>\ServerName\ShareName の形式の ServerName に、もし、IP アドレスが指定されていた場合、FQDN の問い合わせが IP アドレスで行われることとなります。</p><p>この FQDN の問い合わせには失敗し、その後のフォールバック処理が行われるため、結果として通信に時間を要してしまいます。</p><h2 id="対応策"><a href="#対応策" class="headerlink" title="対応策"></a>対応策</h2><p>プリントサーバーには、FQDN もしくはホスト名を使用して、ポイント アンド プリントの環境を構成してください。</p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><p>Windows 11 では、下記のポリシー設定にて RPC over Named Pipe (SMB) を有効にしていただくことが可能ですが、セキュリティの観点から推奨はしていません。</p><p><a href="https://learn.microsoft.com/ja-jp/troubleshoot/windows-client/printing/windows-11-rpc-connection-updates-for-print">Windows 11 での印刷用の RPC 接続更新プログラム</a> の “名前付きパイプでの RPC の使用” の項目で説明されている条件に沿っているかをご確認頂き、必要に応じてご利用ください。</p><p>本投稿が少しでも皆様のお役に立てば幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><p>更新履歴<br>2025/07/03 本 Blog の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポート チームの竹内です。&lt;br&gt;クライアント PC を Windows 11 とする、プリント サーバーの IP アド</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Printing (印刷)" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Printing-%E5%8D%B0%E5%88%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Azure VM の日本語化</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/30/UserInterfaceAndApps/LanguageSupport_IME/japanese_localization_of_azure_vm/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/30/UserInterfaceAndApps/LanguageSupport_IME/japanese_localization_of_azure_vm/</id>
    <published>2025-06-30T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.164Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><p>本記事では Azure VM の日本語化を行う際のベストプラクティスとして、Install-Language コマンドを使用した日本語化の手順と注意事項をご紹介します。</p><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Windows 10 Version 20H2 以降では言語パックの追加に Install-Language コマンドを利用可能となっています。本記事ではこのコマンドを利用した日本語化の一連の流れをご紹介します。<br>なお Install-Language コマンドについては以下の記事も併せてご覧ください。</p><p><a href="https://jpwinsup.github.io/blog/2023/03/06/UserInterfaceAndApps/LanguageSupport_IME/InstallLanguage/">言語パックの管理に便利な PowerShell コマンドレットのご紹介</a></p><h2 id="対象-OS-バージョン"><a href="#対象-OS-バージョン" class="headerlink" title="対象 OS バージョン"></a>対象 OS バージョン</h2><p>本記事で対象とする OS バージョンは Install-Language コマンドを利用可能な OS バージョンとなり以下のとおりです。<br>Windows 10 については前提として 2022 年 8 月 26 日のプレビュー リリース更新プログラム以降の適用が必要です。</p><ul><li>Windows 10 Version 22H2</li><li>Windows 11 Version 22H2 / 23H2</li><li>Windows 11 Version 24H2</li><li>Windows Server 2025</li></ul><h2 id="日本語化の流れ"><a href="#日本語化の流れ" class="headerlink" title="日本語化の流れ"></a>日本語化の流れ</h2><ol><li><p><strong>Azure VM をデプロイします。</strong></p><p> 後述の補足のとおり、組織のポリシー設定やセキュリティ製品、ネットワーク構成などに由来して日本語化に必要なリソースの取得に失敗する場合がありますので、そのような構成を行う前の、デプロイ直後のタイミングで、以下の流れにて日本語化を行います。</p></li><li><p><strong>言語パックなどのリソースをインストールします。</strong></p><p> Windows PowerShell (powershell.exe) を [管理者として実行] にて開きコマンドを実行します。</p><blockquote><p>Install-Language ja-jp</p></blockquote><p> コマンドの実行には時間を要しますので、プロンプトが戻ってくるまで待機し、以下のような表示となることを確認します。</p> <img src="install-language.png" width="600"></li><li><p><strong>ユーザーの優先する言語のリストへ日本語を追加します。</strong></p><p> Settings アプリ &gt; Time and language &gt; Language (&amp; region) &gt; Add a language から、日本語を追加します。<br> 選択肢はすべて既定値で問題ありません。<br> また追加後に、日本語 (Japanese) をリストの一番上へ移動します。</p> <img src="add-ja-jp.png" width="400"> <br> <details> <summary> コマンドの場合 </summary> コマンドの場合は管理者の PowerShell で以下のコマンドを実行します。<br> このコマンドを実行した場合にはユーザーの表示言語も変更されるため、次の手順はスキップ可能です。<br> <blockquote>Set-WinUserLanguageList ja,en-US -force</blockquote> </details></li><li><p><strong>ユーザーの表示言語を変更します。</strong></p><p> Settings アプリ &gt; Time and language &gt; Language (&amp; region) &gt; Windows display language にて、日本語を選択します。<br> この時点でサインアウトする必要はありません。</p> <img src="set-display-language.png" width="400"></li><li><p><strong>ハードウェア キーボード レイアウトを変更します。</strong></p><p> Settings アプリ &gt; Time and language &gt; Language (&amp; region) を開きます。<br> つぎに Japanese 右側の […] から Language options を開くか、または Japanese の [Options] ボタンを押します。<br> (Hardware) Keyboard layout &gt; [Change layout] &gt; “Japanese keyboard (106/109 key)” を選択し [OK] にて設定します。<br> この時点で再起動する必要はありません。</p> <img src="hardware-keyboard-layout.png" width="400"></li><li><p><strong>地域設定を変更します。</strong></p><p> Settings アプリ &gt; Time and language &gt; (Language &amp;) region &gt; Country or region にて、”Japan” を選択します。</p> <img src="country-region.png" width="400"> <br> <details> <summary> コマンドの場合 </summary> コマンドの場合は管理者の PowerShell で以下のコマンドを実行します。<br> <blockquote>Set-WinHomeLocation -GeoId 0x7A</blockquote> </details></li><li><p><strong>タイムゾーン設定を変更します。</strong></p><p> Settings アプリ &gt; Time and language &gt; Date &amp; time &gt; Time zone にて、”(UTC+09:00) Osaka, Sapporo, Tokyo” を選択します。</p> <img src="time-zone.png" width="400"> <br> <details> <summary> コマンドの場合 </summary> コマンドの場合は管理者の PowerShell で以下のコマンドを実行します。<br> <blockquote>Set-TimeZone -Id "Tokyo Standard Time"</blockquote> </details></li><li><p><strong>システム アカウントと新しいユーザー アカウントに設定をコピーします。</strong></p><p> Settings アプリ &gt; Time and language &gt; Language (&amp; region) &gt; Administrative language settings を開きます。<br> Administrative タブ &gt; [Copy settings] を開きます。<br> “Welcome screen and system accounts” と “New user accounts” にチェックを入れて [OK] にて設定します。<br> この時点で再起動する必要はありません。</p> <img src="copy-settings.png" width="350"> <br> <details> <summary> コマンドの場合 </summary> コマンドの場合は管理者の PowerShell で以下のコマンドを実行します。<br> <blockquote>Copy-UserInternationalSettingsToSystem -WelcomeScreen $True -NewUser $True</blockquote> </details></li><li><p><strong>システム ロケールを変更します。</strong></p><p> Settings アプリ &gt; Time and language &gt; Language (&amp; region) &gt; Administrative language settings を開きます。<br> Administrative タブ &gt; [Change system locale] を開き、”Japanese (Japan)” を設定します。<br> <em>※ “Beta: Use Unicode UTF-8 for worldwide language support” にはチェックを入れないでください。</em></p> <img src="system-locale.png" width="350"> <br> <details> <summary> コマンドの場合 </summary> コマンドの場合は管理者の PowerShell で以下のコマンドを実行します。<br> <blockquote>Set-WinSystemLocale -SystemLocale ja-JP</blockquote> </details></li><li><p><strong>Windows OS を再起動します。</strong></p></li><li><p><strong>Windows Update を行います。</strong></p> <img src="windows-update.png" width="350"></li><li><p><strong>アプリを更新します。</strong></p><p> Microsoft Store アプリを開き、ダウンロードから [更新プログラムの確認] を行い、アプリをすべて更新します。</p> <img src="microsoft-store.png" width="500"></li></ol><p>手順は以上です。</p><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><ul><li><p>組織のポリシー設定やセキュリティ製品などの影響で、言語リソースのインストールが失敗する場合がありますので、本手順は Azure VM のデプロイ直後に行ってください。</p></li><li><p>ファイア ウォール製品や機能のご使用など、通信に関する制限が発生する可能性がある状況下では、同様に言語リソースのインストールが失敗する場合があります。失敗する場合にはインターネットへ直接接続可能なネットワーク構成にて再度お試しください。</p></li><li><p>Microsoft Store アプリの手順実施時、Microsoft Store アプリのバージョンが古く、アプリを開いた際にエラーが表示される場合があります。その場合にはログオン ユーザーとして Windows PowerShell (powershell.exe) を開き、以下のコマンド実行をお試しください。このコマンドではバックグラウンドでの Microsoft Store アプリ更新を行いますので、コマンド実行後に時間経過により状況が改善する場合があります。</p><blockquote><p>[Windows.ApplicationModel.Store.Preview.InstallControl.AppInstallManager,InstallService.dll,ContentType=WindowsRuntime]<br>(new-object Windows.ApplicationModel.Store.Preview.InstallControl.AppInstallManager).SearchForUpdatesAsync(“9WZDNCRFJBMP”, “0010”)</p></blockquote></li><li><p>ハードウェア キーボード レイアウトの変更については設定可能なコマンドのご用意がなく、手順に記載のとおり GUI での設定が必要です。</p></li></ul><p>いかがでしたでしょうか。本記事の情報が少しでも皆様のお役に立てば幸いです。</p><p>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><hr><p>更新履歴<br>2025/06/30 本 Blog の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;本記事では Azure VM の日本語化を行う際のベストプラクティスとして、Install-Language コマンドを使用した日本語化の手順と注意事</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Language Support" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Language-Support/"/>
    
    
  </entry>
  
  <entry>
    <title>ノード シャットダウン時にクラスター サービスが意図せず停止する事象について</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/25/FailoverClustering/ANodeShutdownCausesQuorumLoss/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/25/FailoverClustering/ANodeShutdownCausesQuorumLoss/</id>
    <published>2025-06-25T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.738Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事は、マイクロソフト社員によって公開されております。  </p></blockquote><p>こんにちは、Windows サポートチームの三浦です。<br>本日はノード シャットダウン時にクラスター サービスが意図せず停止する事象について紹介させていただきます。<br><br></p><h2 id="事象概要"><a href="#事象概要" class="headerlink" title="事象概要"></a>事象概要<a id="事象概要"></a></h2><p>Windows Server 2025、かつ、2 ノード構成の WSFC 環境において、クラスター コア リソースを所有しているノードのシャットダウンを行うと Lost Quorum によりクラスター サービスが意図せず停止する事象が発生する場合がございます。</p><p>本問題は現在調査中の問題であり、今後修正をリリース予定でございます。修正のリリースが確認でき次第、本ページでもアナウンスをさせていただく予定でございますが、修正がリリースされるまでは、後述の回避策の手順でノードのシャットダウンを行い、事象の発生を回避いただきますようお願いいたします。</p><p>なお、本問題はノードのシャットダウン時にのみ発生する可能性があり、ブルースクリーン / 電源断などの予期せぬノード ダウンやネットワーク障害によるハートビート断などのシナリオでの事象の発生例は確認できておりません。<br><br></p><h2 id="発生環境"><a href="#発生環境" class="headerlink" title="発生環境"></a>発生環境<a id="発生環境"></a></h2><p>Windows Server 2025、かつ、2 ノード構成の WSFC 環境において、クラスター コア リソースを所有しているノードのシャットダウンを行うと発生する可能性がございます。<br><br></p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策<a id="回避策"></a></h2><p>事前に作業対象のクラスター ノードを一時停止し、リソースのドレインを行ってからクラスター ノードのシャットダウンを行うことで本問題の発生を回避することが可能でございます。<br>具体的な作業手順は<a href="https://learn.microsoft.com/ja-jp/previous-versions/azure/azure-local/manage/maintain-servers">本公開情報</a>に記載がございますので、ご確認いただきますようお願いいたします。</p><p>なお、本問題の発生条件を満たす環境に限らず、WSFC 環境でノードのシャットダウンを行う場合には、事前にノードの一時停止とドレインをご実施いただくことを推奨しております。そのため、本問題の発生有無にかかわらず、メンテナンス時には上記公開情報の手順に従ってノードのシャットダウンをご実施いただくことをご検討ください。<br><br></p><p>いかがでしたでしょうか。本投稿が少しでも皆様のお役に立てば幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポートチームの三浦です。&lt;br&gt;本日はノード シャットダウン時にクラスター サービスが意図せず停止する事象について</summary>
      
    
    
    
    <category term="Failover Clustering" scheme="https://jpwinsup.github.io/blog/categories/Failover-Clustering/"/>
    
    <category term="Configuration and Management" scheme="https://jpwinsup.github.io/blog/categories/Failover-Clustering/Configuration-and-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>UWP アプリが起動できない事象への初動対処について</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/19/UserInterfaceAndApps/InitialStepsOfAppxIssues/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/19/UserInterfaceAndApps/InitialStepsOfAppxIssues/</id>
    <published>2025-06-19T08:00:10.000Z</published>
    <updated>2025-10-03T00:49:08.163Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Windows サポートチームです。<br>今回は、UWP アプリが起動できない問題が発生した際にお試しいただける対処方法についてご紹介させていただきます。</p><h2 id="■-対象-OS"><a href="#■-対象-OS" class="headerlink" title="■ 対象 OS"></a>■ 対象 OS</h2><p>Windows 10 以降 / Windows Server 2016 以降</p><h2 id="■-UWP-アプリとは"><a href="#■-UWP-アプリとは" class="headerlink" title="■ UWP アプリとは"></a>■ UWP アプリとは</h2><p>UWP アプリとは Windows で動作するアプリの種類の一つを指しており、例として、スタートメニューや検索ボックス、Microsoft フォトアプリや付箋アプリ等が UWP アプリとして標準で搭載されています。<br>Windows には既定で様々な UWP アプリのパッケージがプロビジョニングパッケージとして組み込まれており、ユーザーの初回ログオン時 (プロファイルの作成時) には、プロビジョニングパッケージからそれぞれの UWP アプリのインストールが実行されます。  </p><p>また、Windows に標準搭載されている UWP アプリについても大きく 2 種類に分類でき、OS の機能の一部として動作する<strong>システムアプリ</strong>と、OS の機能とは独立して動作する<strong>プロビジョニング済みアプリ</strong>にわけられます。</p><h3 id="▼-システムアプリの例"><a href="#▼-システムアプリの例" class="headerlink" title="▼ システムアプリの例"></a>▼ システムアプリの例</h3><ul><li>スタートメニュー</li><li>検索ボックス</li><li>設定アプリ etc</li></ul><h3 id="▼-プロビジョニング済みアプリの例"><a href="#▼-プロビジョニング済みアプリの例" class="headerlink" title="▼ プロビジョニング済みアプリの例"></a>▼ プロビジョニング済みアプリの例</h3><ul><li>Microsoft フォト</li><li>付箋</li><li>電卓 etc</li></ul><p>今回は、<strong>システムアプリ</strong>、および<strong>プロビジョニング済みアプリ</strong>のそれぞれをプロビジョニングパッケージから再登録 (再インストール) する方法をご紹介させていただきますので、UWP アプリの動作に関して意図しない動作が発生している場合には、本ブログでご紹介する対処方法がお役にたてば幸いです。</p><h2 id="■-システムアプリの再登録手順"><a href="#■-システムアプリの再登録手順" class="headerlink" title="■ システムアプリの再登録手順"></a>■ システムアプリの再登録手順</h2><p>以下の手順を実行することで全システムアプリが再登録されます。<br>なお、以下の手順を実施いただいた場合にも、もともと正常に動作しているシステムアプリの動作への影響はございません。</p><ol><li>事象が発生しているユーザーでログオンします。</li><li>ログオンユーザー自身の権限で PowerShell を起動します。</li><li>以下の PowerShell スクリプトを実行し、全システムアプリの再登録を実行します。</li><li>PowerShell プロンプトが入力可能な状態となりましたら処理が完了していますため、事象の解消可否をご確認ください。<br>なお、もしも事象に解消が見られない場合や、PowerShell の実行がエラーになりましたら、対象の環境の内部動作から調査を行わせていただきたく存じます。<br>そのため、<a href="#%E2%96%A0%E4%B8%8A%E8%A8%98%E3%81%AE%E5%AF%BE%E5%87%A6%E3%81%8C%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">■上記の対処が有効にならなかった場合の対応について</a>に案内させていただいている情報採取をご実施いただき、弊社サポート窓口までご相談をいただけますと幸いでございます。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ChildItem HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\InboxApplications | % &#123;Add-AppxPackage -Path ($_.GetValue(&quot;Path&quot;)) -Register -DisableDevelopmentMode -ForceApplicationShutdown&#125;</span><br></pre></td></tr></table></figure><h2 id="■-プロビジョニング済みアプリの再登録手順"><a href="#■-プロビジョニング済みアプリの再登録手順" class="headerlink" title="■ プロビジョニング済みアプリの再登録手順"></a>■ プロビジョニング済みアプリの再登録手順</h2><p>以下の手順を実行することで全プロビジョニング済みアプリが再登録されます。<br>なお、以下の手順を実施いただいた場合にも、もともと正常に動作しているプロビジョニング済みアプリの動作への影響はございません。</p><ol><li>事象が発生しているユーザーでログオンします。</li><li>ログオンユーザー自身の権限で PowerShell を起動します。</li><li>以下の PowerShell スクリプトを実行し、全プロビジョニング済みアプリの再登録を実行します。</li><li>PowerShell プロンプトが入力可能な状態となりましたら処理が完了していますため、事象の解消可否をご確認ください。<br>なお、もしも事象に解消が見られない場合や、PowerShell の実行がエラーになりましたら、対象の環境の内部動作から調査を行わせていただきたく存じます。<br>そのため、<a href="#%E2%96%A0%E4%B8%8A%E8%A8%98%E3%81%AE%E5%AF%BE%E5%87%A6%E3%81%8C%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">■上記の対処が有効にならなかった場合の対応について</a>に案内させていただいている情報採取をご実施いただき、弊社サポート窓口までご相談をいただけますと幸いでございます。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$frameworks &#x3D; @&#123;&#125;</span><br><span class="line">$applications &#x3D; @&#123;&#125;</span><br><span class="line">foreach( $application in Get-ChildItem HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Applications )</span><br><span class="line">&#123;</span><br><span class="line">  foreach( $framework in Get-ChildItem $application.PSPath )</span><br><span class="line">  &#123;</span><br><span class="line">    $frameworks[([Environment]::ExpandEnvironmentVariables($framework.GetValue(&quot;Path&quot;)))] &#x3D; 0</span><br><span class="line">  &#125;</span><br><span class="line">  $applications[([Environment]::ExpandEnvironmentVariables($application.GetValue(&quot;Path&quot;)))] &#x3D; 0</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">foreach( $framework in $frameworks.Keys )</span><br><span class="line">&#123;</span><br><span class="line">  Add-AppxPackage -Path ($framework) -Register -DisableDevelopmentMode -ForceApplicationShutdown</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">foreach( $application in $applications.Keys )</span><br><span class="line">&#123;</span><br><span class="line">  Add-AppxPackage -Path ($application) -Register -DisableDevelopmentMode -ForceApplicationShutdown</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="■上記の対処が有効にならなかった場合の対応について"><a href="#■上記の対処が有効にならなかった場合の対応について" class="headerlink" title="■上記の対処が有効にならなかった場合の対応について"></a>■上記の対処が有効にならなかった場合の対応について</h2><p>弊社の有償サポートサービスにて、調査のご依頼を承ることが可能でございます。<br>その際には、調査を円滑に進めるため、以下の項目のご確認と、事象の詳細を把握するための関連資料をご提供いただけますと幸いです。</p><h3 id="ご確認いただく内容"><a href="#ご確認いただく内容" class="headerlink" title="ご確認いただく内容"></a>ご確認いただく内容</h3><ol><li>問題はいつから発生していますか。</li><li>問題が発生しているのは、特定のアプリケーションのみでしょうか。</li><li>問題が発生している端末は、物理環境でしょうか、それとも仮想環境でしょうか。<ul><li>仮想環境の場合は、仮想化基盤ソフトウェア（例：Hyper-V 等）についても教えてください。</li></ul></li><li>全体で何台の端末があり、問題が発生している端末は何台でしょうか。</li><li>問題は以下のどのユーザーで発生しますか。また発生しないユーザーはいますか。<ul><li>ローカルの管理者ユーザー</li><li>ローカルの一般ユーザー</li><li>ドメインの管理者ユーザー</li><li>ドメインの一般ユーザー</li></ul></li><li>問題が発生している環境のユーザープロファイルの種類を教えてください。<br> 例：ローカルプロファイル、移動ユーザープロファイル、フォルダリダイレクト、FSlogix等</li><li>問題発生時にエラーメッセージは表示されていますか。<ul><li>表示されている場合は、該当画面のキャプチャをご提供ください。</li></ul></li></ol><h3 id="採取していただく資料"><a href="#採取していただく資料" class="headerlink" title="採取していただく資料"></a>採取していただく資料</h3><p>以下の URL に記載された内容の手順で資料の採取をご実施ください。(併せて、発生している事象を確認するため、<br>資料を採取しつつ以下のWebサイト記載の方法で画面を録画し、ご提供いただけますと幸いです）</p><p>UWP アプリが正常に起動しない事象の調査<br><a href="https://jpwinsup.github.io/mslog/shell-and-uwp/apps/uwpnotistarted/">https://jpwinsup.github.io/mslog/shell-and-uwp/apps/uwpnotistarted/</a></p><p>画面を録画する<br><a href="https://jpwinsup.github.io/mslog/other/tips-and-tricks/screenrecording/">https://jpwinsup.github.io/mslog/other/tips-and-tricks/screenrecording/</a></p><p>本記事が皆様のお役にたちましたら幸いです。 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Windows サポートチームです。&lt;br&gt;今回は、UWP アプリが起動できない問題が発生した際にお試しいただける対処方法についてご紹介させていただきます。&lt;/p&gt;
&lt;h2 id=&quot;■-対象-OS&quot;&gt;&lt;a href=&quot;#■-対象-OS&quot; class=&quot;heade</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>STS (Secure Time Seeding) 機能に関する推奨事項について</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/18/ActiveDirectory/WindowsTimeService/sts-recommendations/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/18/ActiveDirectory/WindowsTimeService/sts-recommendations/</id>
    <published>2025-06-18T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.738Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。  </p><p>こんにちは。Windows Commercial Support Directory Services チームです。  </p><p>今回は、STS (Secure Time Seeding) 機能に関する推奨事項についてご紹介いたします。<br>なお、本記事は、以下の弊社公開情報を基に、日本語で概要をおまとめしたものでございます。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><p><a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/active-directory/sts-recommendations-for-windows-server">Secure Time Seeding recommendations for Windows Server</a></p><h1 id="STS-Secure-Time-Seeding-機能について"><a href="#STS-Secure-Time-Seeding-機能について" class="headerlink" title="STS (Secure Time Seeding) 機能について"></a>STS (Secure Time Seeding) 機能について</h1><p>STS (Secure Time Seeding) 機能は、Windows OS における時刻同期メカニズムの 1 つであり、<br>コンピューターの外向きの SSL/TLS 接続から取得される時刻メタデータを使用して、その情報を基にシステム時刻の大きな誤差を検出および修正する機能です。<br>STS 機能の主な目的は、ハードウェアの不具合やその他の要因によって発生する大きな時刻ずれが原因で、SSL/TLS が正常に機能しなくなるような場合にシステム時刻を修正することです。</p><p>機能としては、Windows Server 2016, Windows Server 2019, Windows Server 2022 の全てのエディション、<br>Windows 11 を含む Windows 10 バージョン 1511 以降にリリースされたすべてのクライアント OS , Windows IOT リリース、および その他すべての Windows OS SKU で既定で有効化されております。<br>一方で、後述の STS によって時刻ずれが発生する問題のフィードバックに基づき、Windows Server 2025 では既定でSTS が無効化されております。</p><h1 id="STS-によって時刻ずれが発生する問題について"><a href="#STS-によって時刻ずれが発生する問題について" class="headerlink" title="STS によって時刻ずれが発生する問題について"></a>STS によって時刻ずれが発生する問題について</h1><p>Windows Server OS の導入環境において、STS が原因と考えられる時刻ずれに関する複数のインシデント報告がお客様から寄せられており、それらの問題には以下の共通点があることが確認できています。</p><p>・Windows Server OS のさまざまなリリース／バージョンを実行している一部の環境で発生する<br>・STS 機能が導入された期間と比較すると事象発生率は低い<br>・影響を受けたマシンでは STS が有効化されている<br>・W32time サービスがシステム時刻をランダムな誤った値に設定し、ずれは数日から数週間、場合によっては数年におよぶ<br>・STS による問題は多くの場合、意図的に再現することができない</p><p>記載のとおり、STS における時刻ずれについては意図的に再現させることが困難でございますが、<br>原因としては、コンピューターが外部の SSL/TLS 接続先から受け取った時刻メタデータに異常があり、そのデータが STS に渡されたことが考えられます。<br>なお、STS が有効な環境で必ず時刻ずれが発生してしまうというわけではなく、<br>弊社サポートとしても、現時点でお客様から、STS による時刻ずれが発生したというお問い合わせを大量にお寄せいただいているわけではございません。</p><h1 id="Windows-Server-OS-での-STS-の無効化について"><a href="#Windows-Server-OS-での-STS-の無効化について" class="headerlink" title="Windows Server OS での STS の無効化について"></a>Windows Server OS での STS の無効化について</h1><p>STS により、不用意に時刻ずれが発生することを抑制することを目的とし、<br>STS が有効であるコンピューターでは、STS 機能の無効化を検討いただくことを推奨しております。<br>具体的な手順については以下にお纏めいたしましたので、ご活用いただけますと幸いでございます。</p><h2 id="レジストリで設定する方法"><a href="#レジストリで設定する方法" class="headerlink" title="レジストリで設定する方法"></a>レジストリで設定する方法</h2><p>※ レジストリを直接設定される場合、予めバックアップを取得の上、操作には十分お気を付けください。  </p><ol><li><p>対象サーバーに管理者権限を持つユーザーでログオンします。  </p></li><li><p>レジストリエディターより、以下のレジストリを設定します。  </p></li></ol><p>キー: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time\Config<br>名前: UtilizeSslTimeData<br>種類: REG_DWORD<br>値: 0 (無効)  </p><ol start="3"><li>対象のサーバーを再起動します。</li></ol><h2 id="グループ-ポリシーで設定する方法"><a href="#グループ-ポリシーで設定する方法" class="headerlink" title="グループ ポリシーで設定する方法"></a>グループ ポリシーで設定する方法</h2><ol><li>ドメインのグループ  ポリシーもしくは、ローカルのグループ ポリシーにて、以下のポリシーを設定します。  </li></ol><p>ポリシー パス：[コンピューターの構成] &gt; [管理用テンプレート] &gt; [システム] &gt; [Windows タイム サービス]<br>ポリシー： グローバル構成設定<br>設定値：有効<br>オプション：UtilizeSslTimeData = 0</p><p>※ UtilizeSslTimeData 以外のその他の値については、ご利用環境の構成に従って変更をお願いいたします。  </p><ol start="2"><li>対象のコンピューターにポリシーが適用されましたら、OS を再起動します。</li></ol><h1 id="よくお寄せいただくご質問"><a href="#よくお寄せいただくご質問" class="headerlink" title="よくお寄せいただくご質問"></a>よくお寄せいただくご質問</h1><h2 id="Windows-Server-OS-以外の-OS-でも-STS-による時刻ずれが発生することはありますか？"><a href="#Windows-Server-OS-以外の-OS-でも-STS-による時刻ずれが発生することはありますか？" class="headerlink" title="Windows Server OS 以外の OS でも STS による時刻ずれが発生することはありますか？"></a>Windows Server OS 以外の OS でも STS による時刻ずれが発生することはありますか？</h2><p>はい。Windows Server 以外の OS SKU（たとえば、Windows 10 バージョン 1511 以降のリリース、Windows 10 クライアント SKU、Windows 10 IoT、Windows 11 クライアント SKU、Windows 11 IoT など）を実行しているマシンでも、STS に関連する時刻の問題が発生する可能性がわずかながら存在します。<br>こうした問題の発生を防ぐには、影響を受けるマシンで STS 機能を無効にすることが唯一の対策となります。</p><h2 id="過去に発生した時刻ずれが-STS-によって発生したものか判断することはできますか？"><a href="#過去に発生した時刻ずれが-STS-によって発生したものか判断することはできますか？" class="headerlink" title="過去に発生した時刻ずれが STS によって発生したものか判断することはできますか？"></a>過去に発生した時刻ずれが STS によって発生したものか判断することはできますか？</h2><p>STS による時刻ずれが発生したことは、イベント ログなどの OS が既定で残すログでは確認することができません。<br>確認するためには、時刻ずれが発生した際の Windows タイム サービスのデバッグ ログを採取する必要がございます。<br>そのため、デバッグ ログを常時採取し続けている環境以外では、過去に遡って STS による時刻ずれが発生したことを判断することはかないません。</p><h1 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h1><p>2025/6/18 : 本ブログの公開<br>2025/7/16 : グループ ポリシーで設定する方法における補足事項を追記</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services チームです。  &lt;/p&gt;
&lt;p&gt;今回は、STS (Secure Time Seeding) 機能</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Windows Time Service" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Windows-Time-Service/"/>
    
    
  </entry>
  
  <entry>
    <title>UWP アプリのインストールに失敗する事象への初動対処について</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/18/UserInterfaceAndApps/FailedToInstallUWPApps/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/18/UserInterfaceAndApps/FailedToInstallUWPApps/</id>
    <published>2025-06-18T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.157Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Windows サポートチームです。<br>今回は、UWP アプリのインストールに失敗する問題が発生した際にお試しいただける対処方法についてご紹介させていただきます。</p><h2 id="■-対象-OS"><a href="#■-対象-OS" class="headerlink" title="■ 対象 OS"></a>■ 対象 OS</h2><p>Windows 10 以降 / Windows Server 2016 以降</p><h2 id="■-UWP-アプリとは"><a href="#■-UWP-アプリとは" class="headerlink" title="■ UWP アプリとは"></a>■ UWP アプリとは</h2><p>UWP アプリとは Windows で動作するアプリの種類の一つを指しており、例として、Microsoft フォトアプリや付箋アプリ等が UWP アプリとして OS に標準で搭載されています。また、Microsoft Store などから UWP アプリを追加でインストールすることも可能です。</p><h3 id="▼-OS-に標準で搭載されているアプリの例"><a href="#▼-OS-に標準で搭載されているアプリの例" class="headerlink" title="▼ OS に標準で搭載されているアプリの例"></a>▼ OS に標準で搭載されているアプリの例</h3><ul><li>Microsoft フォト</li><li>付箋</li><li>電卓 etc</li></ul><h3 id="▼-Microsoft-Store-から追加でインストールするアプリの例"><a href="#▼-Microsoft-Store-から追加でインストールするアプリの例" class="headerlink" title="▼ Microsoft Store から追加でインストールするアプリの例"></a>▼ Microsoft Store から追加でインストールするアプリの例</h3><ul><li>Microsoft Whiteboard</li><li>ポータル サイト (Company Portal) etc</li></ul><p>今回は、上記の UWP のインストール (再インストール) に失敗する事象が発生した場合の対処方法をご案内いたしますので、ご参考としていただけますと幸いです。</p><hr><h2 id="■-インストールの方法"><a href="#■-インストールの方法" class="headerlink" title="■ インストールの方法"></a>■ インストールの方法</h2><p>UWP アプリのインストール方法として、主に以下の方法が挙げられます。<br>特定のインストール方法に失敗する場合、状況に応じて他のインストール方法についてもご検討ください。</p><ul><li><p>インターネット経由でのインストール<br>– Microsoft Store からインストール<br>– winget install コマンドでのインストール<br>– Intune からアプリをインストール</p></li><li><p>オフラインでのインストール<br>– オフライン パッケージ からインストール</p></li></ul><p>参考 - winget を用いた Microsoft Store アプリのオフライン ダウンロードについて<br><a href="https://jpwinsup.github.io/blog/2024/06/10/UserInterfaceAndApps/winget-store-download/">https://jpwinsup.github.io/blog/2024/06/10/UserInterfaceAndApps/winget-store-download/</a></p><hr><h2 id="■-インストールに失敗するときにご確認いただきたいこと"><a href="#■-インストールに失敗するときにご確認いただきたいこと" class="headerlink" title="■ インストールに失敗するときにご確認いただきたいこと"></a>■ インストールに失敗するときにご確認いただきたいこと</h2><p>UWP アプリのインストールに失敗する事象が発生する場合には、まず以下の点についてご確認ください。</p><p>[1] 必要なサービスが無効化されていないか<br>[2] 必要なエンド ポイントへのアクセスが制限されていないか (インターネット経由のインストールの場合)<br>[3] インストールを実行するユーザーのコンテキストは問題ないか<br>[4] 依存するパッケージはインストールされているか</p><h2 id="1-必要なサービスが無効化されていないか"><a href="#1-必要なサービスが無効化されていないか" class="headerlink" title="[1] 必要なサービスが無効化されていないか"></a>[1] 必要なサービスが無効化されていないか</h2><p>UWP アプリのインストール、実行にあたり必要なサービスがございます。<br>以下のサービスが無効化されている場合には、有効化することで改善が見られるかご確認ください。</p><ul><li>AppX Deployment Service (AppXSVC)</li><li>Microsoft Store インストール サービス (InstallService)</li><li>Microsoft Account Sign-in Assistant (wlidsvc)</li><li>機能アクセス マネージャー サービス (camsvc)</li><li>App Readiness (AppReadiness)</li></ul><h2 id="2-必要なエンド-ポイントへのアクセスが制限されていないか-インターネット経由のインストールの場合"><a href="#2-必要なエンド-ポイントへのアクセスが制限されていないか-インターネット経由のインストールの場合" class="headerlink" title="[2] 必要なエンド ポイントへのアクセスが制限されていないか (インターネット経由のインストールの場合)"></a>[2] 必要なエンド ポイントへのアクセスが制限されていないか (インターネット経由のインストールの場合)</h2><p>Microsoft Store や winget、Intune でのインストールなど、インターネット経由でのアプリのインストールに必要なエンド ポイントがございますので、こちらへのアクセスが制限されていないかご確認ください。</p><p>具体的に対象となるエンド ポイントにつきましては、以下の公開情報にございます Microsoft Store、Windows Update の項目に記載の URL への制限有無をご確認ください。</p><p>Windows 11 Enterprise の接続エンドポイントの管理<br><a href="https://learn.microsoft.com/ja-jp/windows/privacy/manage-windows-11-endpoints">https://learn.microsoft.com/ja-jp/windows/privacy/manage-windows-11-endpoints</a></p><p>Windows 10 Enterprise バージョン 21H2 の接続エンドポイントを管理する<br><a href="https://learn.microsoft.com/ja-jp/windows/privacy/manage-windows-21h2-endpoints">https://learn.microsoft.com/ja-jp/windows/privacy/manage-windows-21h2-endpoints</a></p><h2 id="3-インストールを実行するユーザーのコンテキストは問題ないか"><a href="#3-インストールを実行するユーザーのコンテキストは問題ないか" class="headerlink" title="[3] インストールを実行するユーザーのコンテキストは問題ないか"></a>[3] インストールを実行するユーザーのコンテキストは問題ないか</h2><p>UWP アプリはユーザーごとにインストール状態が管理されており、UWP アプリのインストールを実行したユーザーに対してのみ、該当の UWP アプリがインストールされる動きとなります。そのため、基本的には UWP アプリのインストールの際は、インストールさせたいユーザーのコンテキストでインストールの実行をご実施ください。</p><p>良くお問い合わせいただく例として、以下のようなシナリオにご注意ください。</p><ul><li><p>管理者アカウントでインストールを実行する<br>→ 実行した管理者アカウントでのみ、アプリがインストールされます。</p></li><li><p>管理者権限に昇格してインストールを実行する<br>→ 管理者アカウントに昇格すると、昇格したアカウントに対してアプリがインストールされます</p></li></ul><h2 id="4-依存するパッケージはインストールされているか"><a href="#4-依存するパッケージはインストールされているか" class="headerlink" title="[4] 依存するパッケージはインストールされているか"></a>[4] 依存するパッケージはインストールされているか</h2><p>UWP アプリには、依存するフレームワーク パッケージが存在する場合がございます。依存するフレームワーク パッケージがインストールされていない場合、アプリのインストールはエラーとなります。</p><p>オフライン パッケージを利用してインストールを実施する場合には、依存するフレームワーク パッケージを先にインストールするか、アプリのインストールの際に依存パッケージを指定するようにしてください。</p><p>&lt;コマンドで依存するフレームワーク パッケージを指定してインストールを実行する方法&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Add-AppxPackage -Path &lt;パッケージ（.AppxBundle 形式）のファイルパス&gt; &#96;</span><br><span class="line">    -DependencyPath @( &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt;, &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt;, &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt; &#96;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">* -DependencyPath にはカンマ区切りで必要なフレームワークをすべて指定します。</span><br></pre></td></tr></table></figure><p>&lt;実行例&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Add-AppxPackage -Path &quot;C:\temp\Microsoft.WindowsCalculator_2020.2103.8.0_neutral_~_8wekyb3d8bbwe.</span><br><span class="line">AppxBundle&quot; &#96;</span><br><span class="line">    -DependencyPath @(&#96;</span><br><span class="line">       &quot;C:\temp\Microsoft.UI.Xaml.2.4_2.42007.9001.0_x64__8wekyb3d8bbwe.Appx&quot;, &#96;</span><br><span class="line">       &quot;C:\temp\Microsoft.VCLibs.140.00_14.0.30704.0_x64__8wekyb3d8bbwe.Appx&quot; &#96;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><p>なお、Microsoft Store、Intune、winget install でアプリをインストールする場合には自動的に必要なフレームワーク パッケージを入手しインストールするため、基本的には依存するパッケージついては特に気にする必要はございません。</p><hr><h2 id="■上記の対処で事象が解消しなかった場合の対応について"><a href="#■上記の対処で事象が解消しなかった場合の対応について" class="headerlink" title="■上記の対処で事象が解消しなかった場合の対応について"></a>■上記の対処で事象が解消しなかった場合の対応について</h2><p>以下のヒアリング事項と資料採取手順について可能な範囲で情報を収集いただき、弊社サポート窓口までお問い合わせをいただけますと幸いでございます。</p><h3 id="▼-ヒアリング事項"><a href="#▼-ヒアリング事項" class="headerlink" title="▼ ヒアリング事項"></a>▼ ヒアリング事項</h3><ul><li>問題はいつから発生しておりますでしょうか。</li><li>特定のアプリのみで問題が発生しておりますでしょうか。</li><li>特定の端末のみで問題が発生しておりますでしょうか。</li><li>問題が発生する端末において、異なるユーザーでも同様の事象が発生しますでしょうか。</li><li>具体的なエラーメッセージなどは表示されておりますでしょうか。<br>　(もし表示されておりましたら、メッセージの画面キャプチャをご提供ください)</li></ul><h3 id="▼-資料採取手順"><a href="#▼-資料採取手順" class="headerlink" title="▼ 資料採取手順"></a>▼ 資料採取手順</h3><p>OS に既定でインストールされている UWP アプリのインストールに失敗する場合は、以下の URL の手順を参考に資料をご採取ください。</p><p>▽ UWPアプリが正常にインストールされていない事象の調査<br><a href="https://jpwinsup.github.io/mslog/shell-and-uwp/apps/uwpnotinstalled/">https://jpwinsup.github.io/mslog/shell-and-uwp/apps/uwpnotinstalled/</a></p><p>その他のシナリオで UWP アプリのインストールに失敗する場合は以下の URL の手順にて資料をご採取ください。</p><p>▽ Microsoft Store からアプリをインストールできない事象の調査<br><a href="https://jpwinsup.github.io/mslog/shell-and-uwp/apps/app-from-msstore/">https://jpwinsup.github.io/mslog/shell-and-uwp/apps/app-from-msstore/</a></p><p>本記事が皆様のお役にたちましたら幸いです。 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Windows サポートチームです。&lt;br&gt;今回は、UWP アプリのインストールに失敗する問題が発生した際にお試しいただける対処方法についてご紹介させていただきます。&lt;/p&gt;
&lt;h2 id=&quot;■-対象-OS&quot;&gt;&lt;a href=&quot;#■-対象-OS&quot; class=&quot;</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>Microsoft Store Web インストーラーをブロックする方法</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/10/UserInterfaceAndApps/block-store-web-installer/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/10/UserInterfaceAndApps/block-store-web-installer/</id>
    <published>2025-06-10T03:00:00.000Z</published>
    <updated>2025-10-03T00:49:08.243Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><hr><p>こんにちは、Windows サポートの丸山です。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Microsoft Store Web インストーラーは、開発者の Web サイトの apps.microsoft.com や Microsoft Store バッジ などの Web サイトからアプリをダウンロードしてインストールするのに役立つ、Store アプリケーション用のスタンドアロン インストーラーです。</p><p>Microsoft Store Web インストーラーを使用して Web 上でアプリを配布する方法<br><a href="https://learn.microsoft.com/ja-jp/windows/apps/distribute-through-store/how-to-use-store-web-installer-for-distribution">https://learn.microsoft.com/ja-jp/windows/apps/distribute-through-store/how-to-use-store-web-installer-for-distribution</a></p><p><img src="1.png" alt="Microsoft Store Web インストーラーの例"></p><p>Microsoft Store Web インストーラーを用いることで、ユーザーは、Windows 標準搭載の Microsoft Store が利用出来ない場合にも、アプリのダウンロード、インストールが可能となります。</p><p>いっぽう、組織の管理者が Microsoft Store Web インストーラーの実行をブロックしたい場合には、AppLocker を用いた制御が可能でございます。</p><p>本記事では、AppLocker を用いた Microsoft Store Web インストーラーの実行をブロックする手順をご紹介します。</p><h2 id="AppLocker-による制御手順（ローカル-セキュリティ-ポリシー-ツール使用）"><a href="#AppLocker-による制御手順（ローカル-セキュリティ-ポリシー-ツール使用）" class="headerlink" title="AppLocker による制御手順（ローカル セキュリティ ポリシー ツール使用）"></a>AppLocker による制御手順（ローカル セキュリティ ポリシー ツール使用）</h2><p>※ AppLocker のが動作するためには、[Application Identity] サービスが動作している必要がございます。手順を実施いただく前に、[Application Identity] サービスが [実行中] であることをご確認ください。</p><ol><li><p>スタートメニューを開き、[すべてのプログラム] の一覧から、[Windows ツール] をクリックして開きます。<br><img src="2.png" alt="Windows ツール"></p></li><li><p>[ローカル セキュリティ ポリシー] をダブルクリックして起動します。<br><img src="3.png" alt="ローカル セキュリティ ポリシー"></p></li><li><p>[アプリケーション制御ポリシー]、[AppLocker]、[実行可能ファイルの規則] の順にツリーを展開します。<br><img src="4.png" alt="実行可能ファイルの規則"></p></li><li><p>[実行可能ファイルの規則] を右クリックし、[新しい規則の作成] をクリックします。<br><img src="5.png" alt="新しい規則の作成"></p></li><li><p>[開始する前に] 画面が表示されたら、内容を確認し [次へ] をクリックします。<br><img src="6.png" alt="開始する前に"></p></li><li><p>[アクセス許可] の画面で [拒否] を選択し、[次へ] をクリックします。<br>※ユーザーまたはグループは [Everyone] のままで問題ありません。<br><img src="7.png" alt="アクセス許可"></p></li><li><p>[条件] の画面では [発行元] にチェックを入れて、[次へ] をクリックします。<br><img src="8.png" alt="条件"></p></li><li><p>[発行元] 画面で [参照] ボタンをクリックし、事前にダウンロードしておいた Microsoft Store Web インストーラーを選択します。<br><img src="9.png" alt="事前にダウンロードしておいた Microsoft Store Web インストーラーを選択"></p></li><li><p>ファイルを選択すると、[発行元] や [製品名] が表示されますので、[製品名] として [STORE INSTALLER] が表示されていることを確認します。<br><img src="10.png" alt="STORE INSTALLER が表示されていることを確認"></p></li><li><p>条件を選択するスライドバーを [製品名] に合わせて、[作成] をクリックします。<br>※この設定により、Microsoft Store Web インストーラーの実行を拒否しつつ、他の実行ファイルは実行可能とすることができます。<br><img src="11.png" alt="&quot;製品名&quot; に合わせて &quot;作成&quot; をクリック"></p></li><li><p>既定の規則が存在しない場合、[既定の規則] を作成するかどうかのダイアログが表示されますので [はい] をクリックします。<br>既定の規則と「STORE INSTALLER」の実行を拒否する規則が追加されていることを確認してください。<br><img src="12.png" alt="既定の規則を作成するかどうかの確認"><br><img src="13.png" alt="できあがった規則の一覧"></p></li><li><p>パッケージアプリの規則が未設定の場合、[パッケージアプリの規則] を右クリックし、[既定の規則を作成] を実行します。<br>※すでに既定の規則が存在する場合はこの手順は不要です。<br><img src="14.png" alt="&quot;既定の規則&quot; の作成"><br><img src="15.png" alt="&quot;既定の規則&quot; が作成された状態"></p></li></ol><p>上記手順を実施後、Microsoft Store Web インストーラーを実行すると、実行がブロックされることをご確認ください。<br><img src="16.png" alt="Microsoft Store Web インストーラーがブロックされている様子"></p><p>こちらの情報が、お役立ちできますと幸いです。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025/06/10: 本 Blog の公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;こんにちは、Windows サポートの丸山です。&lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;&gt;&lt;a href=&quot;#はじめに&quot; class=&quot;head</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>エンタープライズ ルート CA の移行手順について</title>
    <link href="https://jpwinsup.github.io/blog/2025/06/08/PublicKeyInfrastructure/CertificateAuthority/certificate-authorites-migrate-for-root-enterprise/"/>
    <id>https://jpwinsup.github.io/blog/2025/06/08/PublicKeyInfrastructure/CertificateAuthority/certificate-authorites-migrate-for-root-enterprise/</id>
    <published>2025-06-08T15:00:00.000Z</published>
    <updated>2025-10-03T00:49:07.856Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。<br>こんにちは。Windows Commercial Support Directory Services チームです。<br>今回は、エンタープライズ ルート CA の移行手順をご紹介いたします。</p><p>はじめに移行時の注意事項について記載しております。長くなりまして恐縮ですが、<br>移行に当たりこれらの注意事項の認識が無いことで問題に発展したお問い合わせを受けることが多く、ご一読いただけますと幸いでございます。</p><p>手順については「2. 移行手順について 」に記載しておりますので、手順について参照したい場合は読み飛ばしていただいて問題ございません。</p><hr><h2 id="1-移行時の注意事項について"><a href="#1-移行時の注意事項について" class="headerlink" title="1. 移行時の注意事項について"></a>1. 移行時の注意事項について</h2><hr><h3 id="①CA-の切り戻しについて"><a href="#①CA-の切り戻しについて" class="headerlink" title="①CA の切り戻しについて"></a>①CA の切り戻しについて</h3><p>CA の移行はおおまかに </p><ol><li>旧 CA で現在の CA 情報をバックアップ</li><li>旧 CA のアンインストール</li><li>取得したバックアップを基に新 CA でリストア</li></ol><p>の順でご実施いただく形となりますが、よくあるご質問といたしまして、切り戻しの工数削減のためといった理由で<strong>「旧 CA をインストールしたまま（稼働したまま）移行することは可能か」</strong>というお問い合わせをいただくことがございます。</p><p>結論といたしまして、<strong>新旧の並行稼働は基本的に不可</strong>であることにご留意くださいますようお願いいたします。<br>特にエンタープライズ CA の場合、Active Directory と連携しておりますので、フォレスト内に同一 CA が稼働することで予期せぬ動作を引き起こす可能性がございます。<br>また、切り戻し手順実施の際にも予期せぬ問題に繋がる可能性がございます。</p><p>そのため、移行の場合には新 CA へ構成を復元する前に、旧 CA を削除いただくことが手順として必要となることを念頭に置いていただければと存じます。<br>移行時の問題発生に備えるという意味では、CA のバックアップを確実に取得いただくこと。移行にあたり無用な問題を避けるためには、<strong>旧 CA をアンインストールし、新 CA をインストールする、という流れを守っていただくことが肝要</strong>となります。</p><p>なお、切り戻し手順は以下のページにおまとめしておりますので、必要に応じてご参照いただけますと幸いです。</p><p><a href="https://jpwinsup.github.io/blog/2025/06/08/PublicKeyInfrastructure/CertificateAuthority/certificate-authorites-migrate-for-root-enterprise-rollback/">エンタープライズ ルート CA の切り戻し手順について</a></p><h3 id="②旧-CA-の-CDP-について"><a href="#②旧-CA-の-CDP-について" class="headerlink" title="②旧 CA の CDP について"></a>②旧 CA の CDP について</h3><p>CA 移行にあたり、<strong>ホスト名を変更する場合は CRL 配布ポイント (CDP) の設定に注意が必要</strong>です。</p><p>エンタープライズ CA をご利用の環境において、既定では最新の CRL や CA 証明書は、Active Directory の構成パーティション上（LDAP パス）にCRL 配布ポイント (CDP) を持っており、自動的に公開されております。<br>このうち CDP について、具体的な既定のパスは以下のような設定となっております。</p><blockquote><p>ldap:///CN=&lt;CATruncatedName&gt;&lt;CRLNameSuffix&gt;,CN=&lt;ServerShortName&gt;,CN=CDP,CN=Public Key Services,CN=Services,&lt;ConfigurationContainer&gt;&lt;CDPObjectClass&gt;</p></blockquote><p>&lt;&gt; で囲まれた名前が変数となり、CA から発行された証明書には、変数に値が入った形で CDP の項目に記載されます。<br>例えば、CA 名が fabrikam-Root-CA、CA のホスト名が fabrikam-CA、fabrikam.com がドメイン名という場合、発行される証明書の CDP には以下のようなパスが記載されます。</p><blockquote><p>ldap:///CN=fabrikam-Root-CA,CN=fabrikam-CA,CN=CDP,CN=Public Key Services,CN=Services,CN=Configuration,DC=fabrikam,DC=com?certificateRevocationList?base?objectClass=cRLDistributionPoint</p></blockquote><p>ここで、上記パスのうち、&lt;ServerShortName&gt; は CA サーバーの NetBIOS 名 (ホスト名) に置き換わります。<br>つまり移行に伴いホスト名が変更となる場合、この LDAP パス中のホスト名を指す &lt;ServerShortName&gt; 変数に<strong>新 CA のホスト名が利用される</strong>ため、<strong>CDP パス (CRL 公開先) が変わってしまう</strong>ことになります。</p><p>一方、<strong>移行前に発行済みの証明書</strong>に記載されている CDP のパスは<strong>旧 CA のホスト名のまま</strong>となります。<br>つまり、もし上記パスが変化することを考慮せず移行を行った場合、移行前に発行した証明書の参照先となる CDP の CRL が更新されなくなります。<br>そのため、移行前に発行した証明書の参照先となる CDP の CRL の有効期限が切れてしまい、移行前に発行した証明書の失効確認が行えず、旧 CA から発行された証明書を利用した機能に影響を及ぼす可能性がございます。</p><p>以下にホスト名を変更した場合、CDP のパスがどのように変化するのか例を記載します。<br>例えば、fabrikam.com というドメインで、移行前のホスト名が fabrikam-CA の場合、<br><code>CN=&lt;ServerShortName&gt;,CN=CDP,CN=Public Key Services,CN=Services,&lt;ConfigurationContainer&gt;</code> の部分は実際には以下のようなパスになります。</p><blockquote><p>CN=fabrikam-CA,CN=CDP,CN=Public Key Services,CN=Services,CN=Configuration,DC=fabrikam,DC=com</p></blockquote><p>一方で、移行後は fabrikam-CA<strong>2</strong> というホスト名のサーバーとなる場合、パスは以下となります。</p><blockquote><p>CN=fabrikam-CA2,CN=CDP,CN=Public Key Services,CN=Services,CN=Configuration,DC=fabrikam,DC=com</p></blockquote><p>実際の CDP（構成パーティション上の CDP 配下）は以下の画像の通りです。<br>移行前は CN=fabrikam-CA というコンテナの中に CRL が公開されますが、移行後は CN=fabrikam-CA2 というコンテナの配下に CRL が公開されていることが確認できます。</p><p>//移行前の CDP パーティション</p><img src="/blog/2025/06/08/PublicKeyInfrastructure/CertificateAuthority/certificate-authorites-migrate-for-root-enterprise/cdpbefore.png" class=""><p>//移行後の CDP パーティション</p><img src="/blog/2025/06/08/PublicKeyInfrastructure/CertificateAuthority/certificate-authorites-migrate-for-root-enterprise/cdpafter.png" class=""><p>つまり、既定値のまま移行を行うと CN=fabrikam-CA2 というコンテナ配下の CRL が更新されていくことになり、CN=fabrikam-CA というコンテナの CRL は更新がされていきません。<br>このようにホスト名が変更になる場合、移行前と移行後で CDP が変わってしまうため、旧証明書の失効確認を旧 CDP (例でいう fabrikam-CA ) を明示的に追加していただく対応が必要となることにご留意いただければ幸いでございます。</p><p>後述の手順では上記を考慮し、「(11) 新 CA で、旧 CRL 配布ポイント (CDP) に対して、最新の CRL を公開し続ける設定を実施する」での設定をご実施いただくことで、失効確認を旧 CDP の LDAP パスに対して参照し続けることができ、旧証明書 (旧ホスト名で発行した証明書) を利用した機能に影響を与えず移行することを可能としております。</p><hr><h2 id="2-移行手順について"><a href="#2-移行手順について" class="headerlink" title="2. 移行手順について"></a>2. 移行手順について</h2><hr><h3 id="移行手順の概要"><a href="#移行手順の概要" class="headerlink" title="移行手順の概要"></a>移行手順の概要</h3><p>CA の移行手順については、ご利用の CA の種類などによって変わってまいります。<br>ここでは一例として表題の通り、お問い合わせでもよくいただきます「エンタープライズ ルート CA」を既定値で運用されており、 証明機関のみの役割を持つ場合についての手順をご紹介いたします。<br>※例えば下位 CA であったり、証明機関 Web 登録の機能も持つという場合には追加で手順必要となるなど、内容が異なってまいりますのでご留意ください。</p><p>概要は以下の通りです。移行前と移行後でホスト名が変更になる場合、省略可能な手順がありますので、詳細は各手順をご確認いただけますと幸いです。</p><p>(1) 旧 CA で、CA データベース、CA 証明書と秘密キー、構成情報、CDP/AIA の設定を保存する<br>(2) 旧 CA で、証明書テンプレートをバックアップする<br>(3) 旧 CA で、CRL の有効期限を延長し、公開する<br>(4) 旧 CA で、証明書サービスをアンインストールする<br>(5) 新 CA で、既定の証明書テンプレートをロードしないように、CA 構成ファイル (CAPolicy.inf) を作成する<br>(6) 新 CA で、証明書サービスをインストールする<br>(7) 新 CA で、CA 証明書 (秘密キー) 及び CA データベースを復元する<br>(8) 新 CA で、バックアップした CA の構成情報を編集する<br>(9) 新 CA で、CA 構成情報を復元する<br>(10) 新 CA で、証明書テンプレートをリストアする<br>(11) 新 CA で、旧 CRL 配布ポイント (CDP) に対して、最新の CRL を公開し続ける設定をする<br>(12) DC 上で、新 CA のコンピューター アカウントが、旧 CDP/AIA (LDAP 箇所) に情報を公開するための、アクセス許可を設定する<br>(13) 新 CA で、CRL を公開できることを確認する<br>(14) 実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）で、旧証明書が継続利用できるかどうかを検証する</p><h3 id="移行手順の詳細"><a href="#移行手順の詳細" class="headerlink" title="移行手順の詳細"></a>移行手順の詳細</h3><h4 id="1-旧-CA-で、CA-データベース、CA-証明書と秘密キー、構成情報、CDP-AIA-の設定を保存する"><a href="#1-旧-CA-で、CA-データベース、CA-証明書と秘密キー、構成情報、CDP-AIA-の設定を保存する" class="headerlink" title="(1) 旧 CA で、CA データベース、CA 証明書と秘密キー、構成情報、CDP/AIA の設定を保存する"></a>(1) 旧 CA で、CA データベース、CA 証明書と秘密キー、構成情報、CDP/AIA の設定を保存する</h4><ol><li>移行に際して必要となる 旧 CA の “CA データベース” のバックアップを採取する<br>1-1. 旧 CA に管理者ユーザーでログオンします。<br>1-2. [スタート] - [管理ツール] - [証明機関] をクリックします。<br>1-3. [&lt;CA 名&gt;] を右クリックし [すべてのタスク] から [CA のバックアップ] を選択します。<br>1-4. “証明機関のバックアップ ウィザードの開始” が表示されましたら、[次へ] をクリックします。<br>1-5. [バックアップを作成する項目] の選択で、[秘密キーとCA証明書]、[証明書データベースおよび証明書データベースのログ] にチェックを入れます。<br>1-6. [バックアップを作成する場所] を任意の場所 (例：C:\Ca_Backup) に設定し、[次へ] をクリックします。<br>1-7. パスワードを設定する画面で、パスワードを設定し、[次へ] をクリックします。パスワードは、CA 復元の際に必要となるため控えておいて下さい。<br>1-8. [完了] ボタンをクリックし、上記 1-6. で指定した場所に、下記のファイルが保存されていることを確認します。</li></ol><blockquote><p>=========================<br>C:\Ca_Backup\CA_NAME.p12<br>C:\Ca_Backup\Database\certbkxp.dat<br>C:\Ca_Backup\Database\edb#####.log<br>C:\Ca_Backup\Database\CA_NAME.edb<br>=========================</p></blockquote><ol start="2"><li><p>旧 CA の構成情報（レジストリ）をバックアップする<br>2-1. 旧 CA に管理者ユーザーでログオンします。<br>2-2. [スタート] - [ファイル名を指定して実行] から、regedit.exe　と入力し、[Enter] キーを押します。<br>2-3. 下記のレジストリを右クリックし、[エクスポート] をクリックします。</p><blockquote><p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\CertSvc\Configuration</p></blockquote><p>2-4. 上記 1-6. と同じフォルダ配下に、任意のファイル名 (例：certsrv.reg) を指定し、保存します。拡張子は .reg ファイルとして保存します。<br>2-5. レジストリ エディタを閉じます。</p></li></ol><ol start="3"><li>CA 移行完了後の検証に利用するため、直近で発行された証明書をエクスポートする<br>3-1. 旧 CA に管理者ユーザーでログオンします。<br>3-2. [スタート] - [管理ツール] - [証明機関] をクリックします。<br>3-3. [発行した証明書] から、任意の証明書（なるべく直近で発行された証明書）をダブルクリックします。<br>3-4. [詳細] タブにて、[ファイルにコピー] ボタンをクリックします。<br>3-5. 証明書のエクスポートウィザードが表示されたら、[次へ] をクリックします。<br>3-6. ここで、[証明書と一緒に秘密キーをエクスポートしますか？] と表示された場合には、[いいえ、秘密キーをエクスポートしません] をクリックして、[次へ] をクリックします。<br>(※ この画面は、エクスポートする証明書によっては、表示されない場合があります。表示されない場合には、次の 3-7. の手順にお進みください。)<br>3-7. エクスポートファイル形式として、[DER encoded binary X.509 (.CER)] を選択します。<br>3-8. 上記 1-6. と同じフォルダ配下の、任意のファイル名 (例：C:\Ca_Backup\old-example.cer) を指定して、[次へ] をクリックします。<br>3-9. [完了] ボタンをクリックします。<br>3-10. [詳細] タブの画面に戻ったら、[OK] をクリックして閉じます。</li><li>上記 1,2 で採取したバックアップファイルを、新 CA の任意の場所にコピーしておきます。</li></ol><h4 id="2-旧-CA-で、証明書テンプレートをバックアップする"><a href="#2-旧-CA-で、証明書テンプレートをバックアップする" class="headerlink" title="(2) 旧 CA で、証明書テンプレートをバックアップする"></a>(2) 旧 CA で、証明書テンプレートをバックアップする</h4><p>証明書テンプレートの実体は、Active Directory データベース、つまり、ドメイン コントローラー上に保存されています。<br>そのため、CA を移行した場合でも、証明書テンプレートの実体は、Active Directory データベースに残っており、削除されることはありません。<br>しかしながら、どの証明書テンプレートを使用した証明書を発行できるかという、CA ごとに保持されている設定については、<br>CA を移行したタイミングで削除されてしまいますので、新 CA に手動で再設定する必要があります。<br>なお、旧 CA で、どの証明書テンプレートを使用しているかは、以下の手順で保存できます。</p><ol><li>旧 CA に管理者ユーザーでログオンします。</li><li>[スタート] - [管理ツール] - [証明機関] をクリックします。</li><li>画面左にて、[&lt;CA 名&gt;] - [証明書テンプレート] をクリックします。</li><li>[証明書テンプレート] を [右クリック] - [一覧のエクスポート] をクリックします。</li><li>バックアップフォルダに、任意のファイル名を入力し、保存します。(※ ここで保存したファイルは、(10) の手順で使用します。)</li></ol><h4 id="3-旧-CA-で、CRL-の有効期限を延長し、公開する"><a href="#3-旧-CA-で、CRL-の有効期限を延長し、公開する" class="headerlink" title="(3) 旧 CA で、CRL の有効期限を延長し、公開する"></a>(3) 旧 CA で、CRL の有効期限を延長し、公開する</h4><p>CA の移行中に、既存の CRL の有効期限が切れてしまわないように、以下の手順で予め CRL の有効期限を延長し、公開していただくことをお勧めいたします。</p><ol><li>旧 CA に管理者ユーザーでログオンします。</li><li>[スタート] - [管理ツール] - [証明機関 (ローカル)] をクリックします。</li><li>[&lt;CA 名&gt;] - [失効した証明書] を右クリックし、[プロパティ] をクリックします。</li><li>[CRL 公開のパラメーター] タブにて、以下の設定を行い、[OK] をクリックします。（※ 以下は、CRL の有効期限を 14 日に設定する設定例です）</li></ol><blockquote><p>[CRL 公開期間] : 1 週 -&gt; 2 週 に変更<br>[Delta CRL を公開する] - [公開期間] : 1 日 -&gt; 2 週 に変更</p></blockquote><ol start="5"><li>[&lt;CA 名&gt;] - [失効した証明書] を右クリックし、[すべてのタスク] - [公開] をクリックします。</li><li>[新しい CRL] が選択されていることを確認し、[OK] をクリックします。<br>※上記 6. を実施後、エラーが発生していない限りは、特にダイアログは表示されません。<br>そのため、以下の手順で実際に新しい CRL が公開されているかご確認ください。</li><li>[&lt;CA 名&gt;] - [失効した証明書] を右クリックし、[プロパティ] をクリックします。</li><li>[CRL の表示] タブにて、[CRL の表示] ボタンをクリックします。</li><li>[全般] タブにて、[次の更新予定] が上記 4. で指定した期間になっていることを確認します。</li><li>[OK] ボタンをクリックし、プロパティ ダイアログを閉じます。</li></ol><h4 id="4-旧-CA-で、証明書サービスをアンインストールする"><a href="#4-旧-CA-で、証明書サービスをアンインストールする" class="headerlink" title="(4) 旧 CA で、証明書サービスをアンインストールする"></a>(4) 旧 CA で、証明書サービスをアンインストールする</h4><ol><li>旧 CA に管理者ユーザーでログオンします。</li><li>[サーバー マネージャ] を開き、画面右上から [管理] をクリックします。</li><li>[役割と機能の削除] をクリックします。</li><li>[開始する前に] の画面が表示される場合には、[次へ] ボタンをクリックします。</li><li>[サーバーの役割の削除] 画面で、[Active Directory 証明書 サービス] のチェックボックスを OFF にして、[次へ] ボタンをクリックします。</li><li>[削除] ボタンをクリックし、ウィザードを進めます。</li><li>削除が完了したら、[閉じる] ボタンをクリックします。</li><li>再起動が求められましたら、[はい] ボタンをクリックし OS を再起動します。</li></ol><h4 id="5-新-CA-で、既定の証明書テンプレートをロードしないように、CA-構成ファイル-CAPolicy-inf-を作成する"><a href="#5-新-CA-で、既定の証明書テンプレートをロードしないように、CA-構成ファイル-CAPolicy-inf-を作成する" class="headerlink" title="(5) 新 CA で、既定の証明書テンプレートをロードしないように、CA 構成ファイル (CAPolicy.inf) を作成する"></a>(5) 新 CA で、既定の証明書テンプレートをロードしないように、CA 構成ファイル (CAPolicy.inf) を作成する</h4><p>証明書サービスをインストールしますと、既定の証明書テンプレート（複数）が利用されるように、CA が構成されます。<br>その結果、管理者が適切な証明書テンプレートを利用するよう、CA の構成変更を行うまでの間に、意図しない証明書が発行されてしまう可能性があります。<br>この問題に対応するためには、<br>証明書サービスがインストールされた時に、既定の証明書テンプレートが利用されないように、構成ファイル (CAPolicy.inf) を作成してから、証明書サービスをインストールします。</p><ol><li>新 CA で、エクスプローラを開きます。</li><li>画面上部に表示されたメニューの中から、[表示] をクリックします。</li><li>画面上部に表示されたリボンの中から、[ファイル名拡張子] のチェックボックスを ON にします。</li><li>“C:\Windows\CAPolicy.inf” ファイルを作成します。<br>4-1. C:\Windows フォルダを開きます。<br>4-2. 表示された画面を右クリックし、[新規作成] - [テキスト ドキュメント] をクリックします。<br>4-3. ファイル名として、CAPolicy.inf と入力し、[Enter] キーを押します。<br>4-4. 拡張子を変更することを警告する画面が表示されますが、[はい] をクリックします。</li><li>上記 4. で作成した CAPolicy.inf をダブルクリックし、下記内容（2 行）を追記し、上書き保存します。</li></ol><blockquote><p>============================<br>[Certsrv_Server]<br>LoadDefaultTemplates = 0<br>============================</p></blockquote><h4 id="6-新-CA-で、証明書サービスをインストールする"><a href="#6-新-CA-で、証明書サービスをインストールする" class="headerlink" title="(6) 新 CA で、証明書サービスをインストールする"></a>(6) 新 CA で、証明書サービスをインストールする</h4><p>※証明書サービスをインストールすると、CA サーバーのホスト名の変更や、ドメイン参加や離脱ができなくなります。<br>そのため、当手順を実施する前に、必要に応じて CA サーバーのホスト名の変更、ドメイン参加や離脱の作業を実施してください。</p><p>＜証明機関のインストール＞</p><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>[サーバー マネージャ] を開き、画面上部より [管理] - [役割と機能の追加] をクリックします。</li><li>[開始する前に] 画面が表示された場合には、[次へ] をクリックします。</li><li>[インストールの種類の選択] にて [役割ベースまたは機能ベースのインストール] を選択し、[次へ] をクリックします。</li><li>[対象サーバーの選択] にて、[サーバー プールからサーバーを選択] を選択し、[サーバー プール] に表示されているホストを選択し、[次へ] をクリックします。</li><li>[サーバーの役割の選択] にて [Active Directory 証明書サービス] を選択し、[次へ] をクリックします。<br>※ チェックを入れた際に [Active Directory 証明書サービスに必要な機能を追加しますか] のダイアログが表示された場合、[管理ツールを含める] をチェックし [機能の追加] をクリックします。</li><li>[機能の選択] にて既定のまま [次へ] をクリックします。</li><li>[Active Directory 証明書サービス] にて [次へ] をクリックします。</li><li>[役割サービスの選択] では [証明機関] を選択し [次へ] をクリックします。</li><li>以後、既定のまま [次へ] をクリックし、ウィザードを最後まで進めます。</li><li>ウィザードの最後に表示される、[インストールオプションの確認] にて [インストール] をクリックします。</li></ol><p>＜証明機関の構成＞</p><ol><li>[サーバー マネージャ] を開き画面上部の [通知] アイコンをクリックし、[対象サーバーに Active Directory 証明書サービスを構成する] をクリックします。</li><li>[資格情報] にて、インストールを行う管理者アカウントを指定し、[次へ] をクリックします。</li><li>[役割サービス] にて [証明機関] を選択し [次へ] をクリックします。</li><li>[セットアップの種類] にて 旧 CA に合わせて [エンタープライズ] を指定し、[次へ] をクリックします。</li><li>[CA の種類] にて 旧 CA に合わせて [ルート CA] を指定し、[次へ] をクリックします。</li><li>[秘密キー] にて、[既存の秘密キーを使用する] および [証明書を選択し、関連付けられている秘密キーを使用する] を選択し、[次へ] をクリックします。</li><li>[既存の証明書] にて [インポート] をクリックします。(1) の手順で バックアップした &lt;CA 名&gt;.p12 ファイルを選択してパスワードを入力し、[OK] をクリックします。</li><li>表示された証明書を選択して、[次へ] をクリックします。</li><li>[CA データベース] にて、証明書データベース、および証明書データベース ログの場所を指定して、[次へ] をクリックします。(※ (8) の手順で 旧 CA の構成情報をインポートしますため、ここでは既定の設定のまま進めて問題ありません)</li><li>最後に、[構成] ボタンをクリックします。</li><li>構成が終了しましたら [閉じる] ボタンをクリックします。</li></ol><h4 id="7-新-CA-で、CA-証明書-秘密キー-及び-CA-データベースを復元する"><a href="#7-新-CA-で、CA-証明書-秘密キー-及び-CA-データベースを復元する" class="headerlink" title="(7) 新 CA で、CA 証明書 (秘密キー) 及び CA データベースを復元する"></a>(7) 新 CA で、CA 証明書 (秘密キー) 及び CA データベースを復元する</h4><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>スタート画面から、[Windows 管理ツール] - [証明機関] を開きます。</li><li>[&lt;CA 名&gt;] を右クリックし、[すべてのタスク] から [CA の復元] を選択します。<br>※証明書サービスを停止する旨の確認メッセージが表示された場合は、[OK] をクリックして、証明書サービスを停止します。</li><li>[証明機関の復元ウィザードの開始] 画面にて、[次へ] ボタンをクリックします。</li><li>[復元する項目] にて、[秘密キーと CA 証明書]、及び、[証明書データベースおよび証明書データベースのログ] のチェックボックスを ON にします。</li><li>[この場所から復元する] の項目にて [参照] ボタンをクリックし、先の手順 (1)-1-6 で保存したバックアップフォルダ (例：C:\Ca_Backup) を指定して、[次へ] をクリックします。</li><li>[パスワード] の項目にて、先の手順 (1)-1-7 で指定したパスワードを入力して、[次へ] をクリックします。</li><li>[証明機関の復元ウィザードの完了] 画面にて、[完了] ボタンをクリックします。</li><li>証明書サービスを開始するかどうかを確認するダイアログが表示されましたら、[いいえ] をクリックします。</li></ol><h4 id="8-新-CA-で、バックアップした-CA-の構成情報を編集する"><a href="#8-新-CA-で、バックアップした-CA-の構成情報を編集する" class="headerlink" title="(8) 新 CA で、バックアップした CA の構成情報を編集する"></a>(8) 新 CA で、バックアップした CA の構成情報を編集する</h4><p><strong>※ホスト名を変更しない場合、この手順は省略可能です。</strong><br>旧 CA と新 CA の構成情報の整合性を取るために、事前にエクスポートしたレジストリ情報を編集します。</p><ol><li>事前に採取した構成情報のバックアップ (レジストリ ファイル) を右クリックし、[編集] をクリックします。<br>(※ 編集を行う “前” のレジストリ ファイルは、移行に失敗した場合の切り戻しに使用するため、削除せずに残しておいてください。)</li><li>以下のエントリにある値を、&lt;新 CA の FQDN 名&gt; に変更し、ファイルを上書き保存します。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAServerName</span><br></pre></td></tr></table></figure></li></ol><h4 id="9-新-CA-で、CA-構成情報を復元する"><a href="#9-新-CA-で、CA-構成情報を復元する" class="headerlink" title="(9) 新 CA で、CA 構成情報を復元する"></a>(9) 新 CA で、CA 構成情報を復元する</h4><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>事前に採取した構成情報のバックアップ (レジストリ ファイル) をダブル クリックし、構成情報をインポートします。<br>(※ レジストリの変更を警告するダイアログが表示されますが、[はい] をクリックして続行してください。)</li><li>スタート画面から、[Windows 管理ツール] - [証明機関] を開きます。</li><li>[証明機関 (ローカル)] - [&lt;CA 名&gt;] を右クリックし、[すべてのタスク] - [サービスの開始] をクリックし、証明書サービスを開始します。<br>(※ 既に開始している場合には、一度 [サービスの停止] をクリックしてから、[サービスの開始] をクリックしてください。)</li></ol><h4 id="10-新-CA-で、証明書テンプレートをリストアする"><a href="#10-新-CA-で、証明書テンプレートをリストアする" class="headerlink" title="(10) 新 CA で、証明書テンプレートをリストアする"></a>(10) 新 CA で、証明書テンプレートをリストアする</h4><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>スタート画面から、[Windows 管理ツール] - [証明機関] を開きます。</li><li>画面左にて、[&lt;CA 名&gt;] - [証明書テンプレート] を右クリックし、[新規作成] - [発行する証明書テンプレート] をクリックします。</li><li>(2) の手順でエクスポートしたテンプレートと、同じテンプレートを選択し、[OK] をクリックします。</li></ol><h4 id="11-新-CA-で、旧-CRL-配布ポイント-CDP-に対して、最新の-CRL-を公開し続ける設定を実施する"><a href="#11-新-CA-で、旧-CRL-配布ポイント-CDP-に対して、最新の-CRL-を公開し続ける設定を実施する" class="headerlink" title="(11) 新 CA で、旧 CRL 配布ポイント (CDP) に対して、最新の CRL を公開し続ける設定を実施する"></a>(11) 新 CA で、旧 CRL 配布ポイント (CDP) に対して、最新の CRL を公開し続ける設定を実施する</h4><p><strong>※ホスト名を変更しない場合、この手順は省略可能です。</strong><br>Base CRL ファイルは、既定で 7 日で有効期限が切れるため、常に最新の CRL をクライアントからアクセスできる場所に、公開し続ける必要があります。<br>そのため、以下の手順では、旧証明書に記載されている 旧 CRL 配布ポイント (CDP) に対して、最新の CRL を公開し続けるように、新 CA の設定を行います。</p><p>// CDP (LDAP 箇所)</p><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>[スタート] - [管理ツール] - [証明機関] をクリックします。</li><li>[&lt;CA 名&gt;] を右クリックし、プロパティをクリックします。</li><li>[拡張機能] タブをクリックします。</li><li>プルダウンメニューから [CRL 配布ポイント (CDP)] をクリックします</li><li>追加をクリックし 下記を入力します。変数はそのままで、&lt;旧 CA の NetBIOS 名&gt; の部分には、移行前の CA のホスト名を入力して下さい。</li></ol><blockquote><p>ldap:///CN=&lt;CATruncatedName&gt;&lt;CRLNameSuffix&gt;,CN=&lt;旧 CA の NetBIOS 名&gt;,CN=CDP,CN=Public Key Services,CN=Services,&lt;ConfigurationContainer&gt;&lt;CDPObjectClass&gt; </p></blockquote><p>例）例えば、移行前のホスト名が fabrikam-CA の場合、以下のようになります。</p><blockquote><p>ldap:///CN=&lt;CATruncatedName&gt;&lt;CRLNameSuffix&gt;,CN=fabrikam-CA,CN=CDP,CN=Public Key Services,CN=Services,&lt;ConfigurationContainer&gt;&lt;CDPObjectClass&gt; </p></blockquote><ol start="7"><li><p>下記のチェック ボックスを ON にします。<br>･ [この場所にCRLを公開する]<br>･ [Delta CRLをこの場所に公開する]<br>･ [CRL に含め、クライアントはこれを使って、Delta CRL の場所を検索する]</p></li><li><p>[OK] をクリックします。 </p></li><li><p>証明書サービスの再起動を求められるので、証明書サービスを再起動します。</p></li></ol><h4 id="12-DC-上で、新-CA-のコンピューター-アカウントが、旧-CDP-AIA-LDAP-箇所-に情報を公開するための、アクセス許可を設定する"><a href="#12-DC-上で、新-CA-のコンピューター-アカウントが、旧-CDP-AIA-LDAP-箇所-に情報を公開するための、アクセス許可を設定する" class="headerlink" title="(12) DC 上で、新 CA のコンピューター アカウントが、旧 CDP/AIA (LDAP 箇所) に情報を公開するための、アクセス許可を設定する"></a>(12) DC 上で、新 CA のコンピューター アカウントが、旧 CDP/AIA (LDAP 箇所) に情報を公開するための、アクセス許可を設定する</h4><p><strong>※ホスト名を変更しない場合、この手順は省略可能です。</strong><br>エンタープライズ CA の場合、最新の CRL や CA 証明書は、Active Directory 上（LDAP パス）に、自動的に公開されます。<br>その公開先である、Active Directory 上のコンテナには、CA のコンピューター アカウントに対して、フルコントロールアクセス権が付与されています。<br>そのため、旧 CDP や AIA に対して、新 CA のコンピューター アカウントが情報を公開し続けられるよう、Active Directory 上のアクセス許可を設定します。</p><ol><li>ドメイン コントローラーに、Enterprise Admins グループのメンバーでログオンします。</li><li>[スタート] - [ファイル名を指定して実行] の順にクリックし、「dssite.msc」と入力して、[Enter] キーを押します。</li><li>画面左の最上位ノード（”Active Directory サイトとサービス”）をクリックして、ハイライトさせます。</li><li>[表示] メニューの [サービス ノードの表示] をクリックします。</li><li>コンソール ツリーで、[Services] - [Public Key Services] を展開し、[AIA] をクリックします。</li><li>画面右の詳細ウィンドウで、&lt;CA 名&gt; を右クリックし、[プロパティ] をクリックします。</li><li>[セキュリティ] タブをクリックし、[追加] をクリックします。</li><li>[オブジェクトの種類] をクリックし、[コンピューター] をクリックして、[OK] をクリックします。</li><li>新 CA のホスト名を入力し、[OK] をクリックします。</li><li>[許可] 列で、[フル コントロール] をクリックします。</li><li>旧 CA のホスト名をクリックし、[削除] をクリックします。</li><li>[適用],[OK] の順にクリックします。</li><li>コンソール ツリーで、[CDP] を展開し、旧 CA のホスト名をクリックして、ハイライトさせます。</li><li>画面右の詳細ウィンドウで、[cRLDistributionPoint] 項目を右クリックし、[プロパティ] をクリックします。</li><li>[セキュリティ] タブをクリックし、[追加] をクリックします。</li><li>[オブジェクトの種類] をクリックし、[コンピューター] をクリックして、[OK] をクリックします。</li><li>新 CA のホスト名を入力し、[OK] をクリックします。</li><li>[許可] 列で、[フル コントロール] をクリックし、[適用] をクリックします。</li><li>旧 CA のホスト名をクリックし、[削除] をクリックします。</li><li>[適用],[OK] の順にクリックします。</li></ol><h4 id="13-新-CA-で、CRL-を公開できることを確認する"><a href="#13-新-CA-で、CRL-を公開できることを確認する" class="headerlink" title="(13) 新 CA で、CRL を公開できることを確認する"></a>(13) 新 CA で、CRL を公開できることを確認する</h4><p>正しく CA の復元や設定ができていることを確認するために、下記手順にて、実際に CRL を公開できることを確認します。</p><ol><li>新 CA に管理者ユーザーでログオンします。</li><li>[サーバーマネージャー] を開き、[ツール] - [証明機関] をクリックします。</li><li>[CA] - [失効した証明書] を右クリックし、[プロパティ] をクリックします。</li><li>[CRL 公開のパラメーター] タブの下記項目が、(3) の手順で “延長する前” の設定に、戻っていることを確認し、[OK] をクリックします。<br>（※ バックアップから設定をリストアしたことにより、延長した有効期限の設定が元に戻っておりますが、この後 CRL を公開するまでは、有効期限が延長された CRL が利用され続けます。）</li></ol><blockquote><p>[CRL 公開期間] : 1 週 (既定値)<br>[Delta CRL を公開する] - [公開期間] : 1 日 (既定値)</p></blockquote><ol start="5"><li>[CA] - [失効した証明書] を右クリックし、[すべてのタスク] - [公開] をクリックします。</li><li>[新しい CRL] が選択されていることを確認し、[OK] をクリックします。</li></ol><p>※ 上記 6. を実施後、エラーが発生していない限りは、特にダイアログは表示されません。<br>※ そのため、以下の手順で実際に新しい CRL が公開されているかご確認ください。</p><ol start="7"><li>[CA] - [失効した証明書] を右クリックし、[プロパティ] をクリックします。</li><li>[CRL の表示] タブにて、[CRL の表示] ボタンをクリックします。</li><li>[全般] タブにて、[次の更新予定] が上記 4. で確認した期間になっていることを確認し、[OK] をクリックします。</li></ol><h4 id="14-実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）で、旧証明書が継続利用できるかどうかを検証する"><a href="#14-実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）で、旧証明書が継続利用できるかどうかを検証する" class="headerlink" title="(14) 実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）で、旧証明書が継続利用できるかどうかを検証する"></a>(14) 実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）で、旧証明書が継続利用できるかどうかを検証する</h4><p>旧証明書が、CA 移行後も正常に利用できるかどうかを、検証します。<br>検証を目的とする属性（CDP や AIA）は、全証明書に共通して含まれているため、検証のために使用する証明書は、どの証明書であっても問題ありません。<br>従いまして、今回は、旧 CA のバックアップを取得したときにエクスポートしておいた証明書を利用して、検証を行う手順をご案内いたします。<br>また、以下の検証は、実際に証明書を利用している環境（ドメイン環境、ワークグループ環境）ごとに、実施してください。</p><ol><li>実際に証明書を利用しているコンピューターに、任意のユーザーでログオンします。</li><li>旧 CA のバックアップを取得したときにエクスポートした旧証明書を、当該コンピューターにコピーします。</li><li>以下のコマンドを実行します。</li></ol><blockquote><p>certutil -v -urlfetch -verify &lt;旧証明書のパス&gt;<br>例：certutil -v -urlfetch -verify C:\old-example.cer</p></blockquote><ol start="4"><li>証明書のチェーンごとに記録される、下記 4 つの項目の URL をご確認ください。<br>･ 証明書 AIA<br>･ 証明書 CDP<br>･ Base CRL CDP<br>･ 証明書 OCSP</li></ol><p>// 正常性の確認方法<br>各項目に URL が 1 つ以上存在する場合、1 つでも [OK] または [確認済み] の文字が存在すれば、その証明書は利用可能であると判断できます。<br>この際、 [失敗] の文字が混在していても問題ございません。<br>また、各項目に URL が 1 つも存在しない場合、[URL なし] と表記されますが、この場合も問題ございません。<br><br/></p><hr><h2 id="3-補足情報"><a href="#3-補足情報" class="headerlink" title="3. 補足情報"></a>3. 補足情報</h2><hr><p>以下の公開情報内で、CA の移行に関する情報をご案内しております。よろしければご参照ください。</p><p><a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-cs/migrate-certification-authority?tabs=server-manager">Migrate the Certification Authority</a></p><p><a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee126140(v=ws.10)?redirectedfrom=MSDN">AD CS Migration: Migrating the Certification Authority</a></p><p>CDP のパスの変数についての記載は以下の公開情報にございます。Configure the CA を参照ください。<br><a href="https://learn.microsoft.com/ja-jp/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831574(v=ws.11)">Certification Authority Guidance</a></p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/06/09 : 本ブログの公開<br>2025/08/20 : 以下の更新を行いました。<br>　　　　　　　- 全体的な記載フォーマットを修正<br>　　　　　　　- LDAPパスの記載を修正<br>　　　　　　　- 「2. 移行手順について」手順 (13) の内容を修正<br>　　　　　　　-  切り戻し手順のリンクを修正<br>　　　　　　　-  カテゴリの変更と、それに伴い URL が変更となりました。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;br&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;br&gt;今回は、エンタープライズ ルート CA の移行手順をご紹介いたします。&lt;/p&gt;
&lt;p&gt;は</summary>
      
    
    
    
    <category term="Public Key Infrastructure" scheme="https://jpwinsup.github.io/blog/categories/Public-Key-Infrastructure/"/>
    
    <category term="Certificate Authority" scheme="https://jpwinsup.github.io/blog/categories/Public-Key-Infrastructure/Certificate-Authority/"/>
    
    
  </entry>
  
</feed>
