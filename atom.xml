<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Microsoft Japan Windows Technology Support Blog</title>
  
  <subtitle>日本マイクロソフト Windows Support チームによる、サポート情報 Blog です。</subtitle>
  <link href="https://jpwinsup.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpwinsup.github.io/blog/"/>
  <updated>2026-02-19T02:53:58.330Z</updated>
  <id>https://jpwinsup.github.io/blog/</id>
  
  <author>
    <name>Microsoft Japan Windows Technology Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>「ユーザー アカウント制御：ビルトイン Administrator アカウントのための管理者承認モード」ポリシーが有効になる動作ついて</title>
    <link href="https://jpwinsup.github.io/blog/2026/02/16/ActiveDirectory/GroupPolicy/UacPolicyIsEnabled/"/>
    <id>https://jpwinsup.github.io/blog/2026/02/16/ActiveDirectory/GroupPolicy/UacPolicyIsEnabled/</id>
    <published>2026-02-16T03:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.330Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>今回は、Windows OS のアップグレード (FU) 時に、ユーザー アカウント制御（UAC）に関連するポリシーの設定値が変更される動作について説明します。<br><br></p><h2 id="動作について"><a href="#動作について" class="headerlink" title="動作について"></a>動作について</h2><hr><p>Windows OS をアップグレード (FU) する際に、<strong>ローカルの Administrators グループのメンバーがビルトインの Administrator のみである</strong> 場合、以下のローカル セキュリティ ポリシー <strong>「ユーザー アカウント制御: ビルトイン Administrator アカウントのための管理者承認モード」</strong> が自動的に <strong>有効</strong> となります。<br>アップグレード前に、本ポリシーを明示的に無効に設定していた場合も、条件を満たしていれば自動的に有効となります。</p><blockquote><p>セキュリティの設定 - ローカル ポリシー - セキュリティ オプション<br> ⇒ ユーザー アカウント制御: ビルトイン Administrator アカウントのための管理者承認モード</p></blockquote><p><img src="Policyname.png"></p><p>なお、ローカルの Administartors グループのメンバーにビルトインの Administartor ではないアカウントが存在する場合はこの動作は発生しません。</p><p>この動作は、以下の公開情報においても説明されています。</p><p><a href="https://learn.microsoft.com/ja-jp/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/user-account-control-admin-approval-mode-for-the-built-in-administrator-account">User Account Control: Admin Approval Mode for the Built-in Administrator account</a><br><img src="note1.png"><br><br></p><h2 id="ポリシーの効果について"><a href="#ポリシーの効果について" class="headerlink" title="ポリシーの効果について"></a>ポリシーの効果について</h2><hr><p>「ユーザー アカウント制御: ビルトイン Administrator アカウントのための管理者承認モード」を有効/無効に設定した際の挙動についてご説明します。</p><h3 id="有効"><a href="#有効" class="headerlink" title="有効"></a>有効</h3><p>ビルトイン Administrator でも管理者承認モードでログオンし、昇格が必要な操作ごとに同意を求めるプロンプトが表示されます。<br>仕組みとしては、ログオン時に標準トークンと管理者トークンの 2 つが作られ、通常起動のアプリは標準トークンで動作します。<br>管理者権限が必要となった場合は利用者の同意を得た後に昇格し、管理者トークンを使い動作します。</p><h3 id="無効"><a href="#無効" class="headerlink" title="無効"></a>無効</h3><p>ビルトイン Administrator による操作では、既定で常にフル管理者権限（フルトークン）でアプリが動作します。<br>昇格プロンプト無しで管理操作が通りやすい一方、万が一攻撃者が仕込んだ悪意のあるコードが存在する場合も高権限で動きやすい状態です。<br>なお、ポリシーが未定義の場合、この無効の動作となります。</p><p>UAC の仕組みについては、以下の公開情報をご参考としていただければと存じます。<br><a href="https://learn.microsoft.com/ja-jp/windows/security/application-security/application-control/user-account-control/how-it-works">ユーザー アカウント制御のしくみ</a></p><br><h2 id="影響について"><a href="#影響について" class="headerlink" title="影響について"></a>影響について</h2><hr><p>前項のとおり未定義の場合は無効の動作となりますので、今回ご案内している動作によりポリシーが有効となった場合、OS のアップグレード後、挙動に変化が生じる可能性があります。<br>具体的には以下のような影響が想定されます。</p><ul><li>ビルトイン Administrator での作業において、昇格を求めるプロンプトの表示が増える</li><li>ビルトイン Administrator であれば常に管理者権限でアプリを実行できることを前提としたアプリケーションが動作している場合、非昇格での起動により処理が失敗する</li></ul><p>前述の公開情報においても <a href="https://learn.microsoft.com/ja-jp/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/user-account-control-admin-approval-mode-for-the-built-in-administrator-account">Best practices</a> として記載のとおり、ビルトイン Administrator を常用することは推奨しておらず、利用される場合は本ポリシーを有効としていただくようにご案内しております。<br>本ブログでご紹介した動作は、このようなセキュリティ面での推奨事項を背景とした動作となっておりますので、OS アップグレードの際には本動作をご認識いただいた上、作業をご計画いただけますようお願いいたします。</p><p>なお、本ポリシーを無効の動作とされたい場合は、上記のとおり非推奨ではございますが、お客様にて十分ご検討いただいた上、ポリシーの設定を未定義もしくは無効に変更いただけますようお願いいたします。</p><br><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2026/02/19 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;今回は、Windows OS のアップグレード (FU) 時に、ユーザー</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Group Policy" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Group-Policy/"/>
    
    
  </entry>
  
  <entry>
    <title>印刷キューアプリのプレビュー機能について</title>
    <link href="https://jpwinsup.github.io/blog/2026/02/15/UserInterfaceAndApps/Printing/printer-queue-app-preview/"/>
    <id>https://jpwinsup.github.io/blog/2026/02/15/UserInterfaceAndApps/Printing/printer-queue-app-preview/</id>
    <published>2026-02-15T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.855Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><p>こんにちは、Windows サポート チームの竹内です。</p><p>印刷に関して、よくお問い合わせをいただく内容や、皆様にご認識いただきたい情報について<br>本ブログにてご案内をさせていただきます。</p><p>今回のブログにてお届けする内容としては、設定アプリ経由にて起動した “印刷キュー” アプリのプレビュー機能について取り上げます。</p><p>それでは、以下についてご確認をいただければ幸いです。</p><p><a href="#english">English follows</a></p><h2 id="印刷ジョブをプレビューする機能について"><a href="#印刷ジョブをプレビューする機能について" class="headerlink" title="印刷ジョブをプレビューする機能について"></a>印刷ジョブをプレビューする機能について</h2><p>新しい形式の印刷キューアプリは、従来のコントロールパネルから表示する印刷キューのウィンドウと異なり残存する印刷ジョブをプレビューする機能があります。</p><p>しかし、この印刷ジョブをプレビューする機能は、全ての印刷ジョブに対して有効ではなく、プレビューできる印刷ジョブとプレビューできない印刷ジョブがあります。</p><h2 id="プレビューできる印刷ジョブについて"><a href="#プレビューできる印刷ジョブについて" class="headerlink" title="プレビューできる印刷ジョブについて"></a>プレビューできる印刷ジョブについて</h2><p>Universal Print や Mopria に対応した Microsoft IPP Class Driver を利用する印刷キュー、 Microsoft Print To PDF では、プレビューを行える印刷ジョブを生成することが多くあります。</p><p>対して、従来の v3 プリンタードライバーを利用する印刷キューでは、プレビューを行える印刷ジョブを生成することは、ほとんどありません。</p><p><img src="printer-queue-app-preview_ja.png" alt="PREVIEW"></p><p>印刷ジョブのプレビューができなかったとしても実際の印刷は行われますが、印刷ジョブのプレビューを確認したい場合は、Microsoft IPP Class Driver を利用する印刷キューから Universal Print や Mopria といったモダンなプリンターに印刷することをお勧めします。</p><h2 id=""><a href="#" class="headerlink" title=""></a><a name="english"></a></h2><h2 id="About-the-Print-Job-Preview-Feature"><a href="#About-the-Print-Job-Preview-Feature" class="headerlink" title="About the Print Job Preview Feature"></a>About the Print Job Preview Feature</h2><p>Unlike the legacy print queue window accessed from the Control Panel, the new version of the print queue app includes a feature that allows you to preview remaining print jobs.  </p><p>However, this print job preview feature is not available for all print jobs. Some print jobs can be previewed, while others cannot.</p><h2 id="Print-Jobs-That-Can-Be-Previewed"><a href="#Print-Jobs-That-Can-Be-Previewed" class="headerlink" title="Print Jobs That Can Be Previewed"></a>Print Jobs That Can Be Previewed</h2><p>Print queues that use the Microsoft IPP Class Driver and support Universal Print or Mopria, as well as Microsoft Print to PDF, often generate print jobs that can be previewed.<br>In contrast, print queues that use legacy v3 printer drivers rarely generate print jobs that can be previewed.</p><p><img src="printer-queue-app-preview_en.png" alt="PREVIEW"></p><p>Even if a print job cannot be previewed, the actual printing will still be performed. However, if you want to check the print job preview, we recommend printing to modern printers such as those supporting Universal Print or Mopria via a print queue that uses the Microsoft IPP Class Driver.</p><p>本投稿が少しでも皆様のお役に立てば幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><p>更新履歴<br>2026/02/16 本 Blog の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポート チームの竹内です。&lt;/p&gt;
&lt;p&gt;印刷に関して、よくお問い合わせをいただく内容や、皆様にご認識いただきたい情報に</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Printing (印刷)" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Printing-%E5%8D%B0%E5%88%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>CVE‑2026‑20833 への対応とその影響について [KB5073381]</title>
    <link href="https://jpwinsup.github.io/blog/2026/02/02/ActiveDirectory/Authentication/kerberos-rc4-for-service-account-ticket-issuance-changes-related-to-cve-2026-20833/"/>
    <id>https://jpwinsup.github.io/blog/2026/02/02/ActiveDirectory/Authentication/kerberos-rc4-for-service-account-ticket-issuance-changes-related-to-cve-2026-20833/</id>
    <published>2026-02-02T09:39:17.000Z</published>
    <updated>2026-02-19T02:53:58.324Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>2026 年 1 月の Windows 更新プログラム以降、Kerberos 認証で利用されている RC4 などのレガシー暗号を段階的に無効化する変更が始まりました。</p><p>KB5073381: <a href="https://support.microsoft.com/ja-jp/topic/cve-2026-20833-%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88-%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E7%99%BA%E8%A1%8C%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B-rc4-%E3%81%AE-kerberos-kdc-%E4%BD%BF%E7%94%A8%E9%87%8F%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95-1ebcda33-720a-4da8-93c1-b0496e1910dc">CVE-2026-20833 に関連するサービス アカウント チケット発行の変更に対する RC4 の Kerberos KDC 使用量を管理する方法</a></p><p>これは、CVE‑2026‑20833 として報告された脆弱性への対処の一環であり、<br><strong>最終的に 2026 年 7 月までに必要な対応を完了しなければ、一部の認証がブロックされます。</strong></p><p>本記事では、KB5073381 の内容をもとに</p><ul><li>いつ・何が変わるのか（タイムライン）</li><li>いつまでに何をしておくべきか</li><li>対応しなかった場合にどのような影響が出るのか</li></ul><p>を、できるだけ分かりやすく整理してご紹介します。</p><hr><h2 id="CVE‑2026‑20833-について"><a href="#CVE‑2026‑20833-について" class="headerlink" title="CVE‑2026‑20833 について"></a>CVE‑2026‑20833 について</h2><p>2026 年 1 月 13 日以降にリリースされた Windows 更新プログラムには、Kerberos 認証プロトコルによる脆弱性への保護が含まれております。<br>RC4 などの脆弱またはレガシー暗号化の種類のサービス チケットを取得し、オフライン攻撃を実行してサービス アカウントのパスワードを回復できる可能性がある情報漏えいの脆弱性に対処します。</p><p>本脆弱性への対処のため、ドメイン コントローラー上の Kerberos Key Distribution Center (KDC) が、 <strong>既定で RC4 を使わないようにする</strong> 方向で変更が行われます。<br>レジストリへの設定を行う、もしくは 2026 年 7 月リリースの更新プログラム適用で対処が完了いたしますが、認証への影響を考慮して、段階的に対処が進められるようにフェーズが分かれており、監査イベントの追加や、ガイドラインが公開されております。</p><p>対処方法について詳細を以下におまとめいたします。</p><hr><h2 id="3-つのフェーズ（タイムライン）"><a href="#3-つのフェーズ（タイムライン）" class="headerlink" title="3 つのフェーズ（タイムライン）"></a>3 つのフェーズ（タイムライン）</h2><p>本脆弱性への対応はフェーズが分かれており、以下のようなタイムラインとなっております。<br>ポイントとしては、2026 年 1 月 13 日 - 初期展開フェーズで記録されるようになる監査イベントログに対処できていない場合、<strong>2026 年 4 月 - 第 2 の展開フェーズにて RC4DefaultDisablementPhase の既定値が 2 となり、認証が拒否されるようになります。</strong><br>明示的に RC4DefaultDisablementPhase = 1 とすることで、2026 年 4 月以降も引き続き認証が拒否されることなく動作させることが可能ですが、最終的には、2026 年 7 月 までに、監査イベントログに記録されている内容に対処する必要がございます。</p><h3 id="2026-年-1-月-13-日-初期展開フェーズ"><a href="#2026-年-1-月-13-日-初期展開フェーズ" class="headerlink" title="2026 年 1 月 13 日 - 初期展開フェーズ"></a>2026 年 1 月 13 日 - 初期展開フェーズ</h3><p>このフェーズでは以下の変更が実施されます。</p><ul><li>監査イベントログの追加</li><li>今後のセキュリティ強化 (第 2 の展開フェーズ以降) によって影響の受ける可能性のあるクライアントの監査イベントログの出力</li><li>RC4DefaultDisablementPhase レジストリ設定を実装。明示的に設定しない限りレジストリは存在せず、存在しない場合は既定で RC4DefaultDisablementPhase = 1 相当で動作します。</li></ul><h3 id="2026-年-4-月-第-2-の展開フェーズ"><a href="#2026-年-4-月-第-2-の展開フェーズ" class="headerlink" title="2026 年 4 月 - 第 2 の展開フェーズ"></a>2026 年 4 月 - 第 2 の展開フェーズ</h3><p>このフェーズでは以下の変更が実施されます。</p><ul><li>DefaultDomainSupportedEncTypes の既定値が 0x18 (AES のみ) に変更となります。これにより、明示的な msds-SupportedEncryptionTypes 属性が定義されていないアカウントでは、Kerberos のサービスチケットの暗号化方式に AES-SHA1 を利用するようになります。</li><li>RC4DefaultDisablementPhase の既定値が変更となり、レジストリが明示的に存在しない場合は、既定でRC4DefaultDisablementPhase = 2 相当で動作します。(明示的に設定を行えば引き続き RC4DefaultDisablementPhase = 1 で動作させることが可能です)</li></ul><h3 id="2026-年-7-月-適用フェーズ"><a href="#2026-年-7-月-適用フェーズ" class="headerlink" title="2026 年 7 月 - 適用フェーズ"></a>2026 年 7 月 - 適用フェーズ</h3><p>このフェーズでは以下の変更が実施されます。</p><ul><li>RC4DefaultDisablementPhase の値にかかわらず、RC4DefaultDisablementPhase = 2 相当の動作に強制します。<br>※レジストリにて 明示的に値を設定した場合でも、動作に反映されません。</li></ul><h4 id="追加されたレジストリについて"><a href="#追加されたレジストリについて" class="headerlink" title="追加されたレジストリについて"></a>追加されたレジストリについて</h4><p>本脆弱性への対応で追加された RC4DefaultDisablementPhase レジストリの設定箇所等の情報は以下となります。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters</span><br><span class="line">キー：RC4DefaultDisablementPhase</span><br><span class="line">値の種類：REG_DWORD</span><br><span class="line">設定することのできる値のデータ：</span><br><span class="line">0 – 監査なし、変更なし </span><br><span class="line">1 - 警告イベントは、既定の RC4 使用状況でログに記録されます。 (初期展開フェーズの既定値) </span><br><span class="line">2 – Kerberos は、RC4 が既定で有効になっていないと仮定して開始されます。  (第 2 の展開フェーズの既定値) </span><br><span class="line">再起動の必要性：あり</span><br></pre></td></tr></table></figure><h2 id="2026-年-4-月までにやるべきこと"><a href="#2026-年-4-月までにやるべきこと" class="headerlink" title="2026 年 4 月までにやるべきこと"></a>2026 年 4 月までにやるべきこと</h2><p>初期展開フェーズで記録されるようになる監査イベントログをもとに、以下のうち、いずれかの対処を実施する必要があります。</p><ul><li>AES への対応を行う</li><li>RC4 を継続して利用する場合、認証先のサービス アカウントの msds-SupportedEncryptionTypes 属性に明示的に RC4 を含むような値を設定する。 </li></ul><p>もし何らかのご事情があり、 2026 年 4 月までに上記対応が間に合わなかったり、2026 年 4 月以降も監査を続ける場合、<br>2026 年 6 月 の更新プログラムまでは、明示的に RC4DefaultDisablementPhase = 1 とすることで引き続き初期展開フェーズでの動作が可能です。<br>ただし、2026 年 7 月には RC4DefaultDisablementPhase による動作の変更を受け付けなくなるため、最終的にはそれまでに上記のいずれかの対応が必要となります。</p><hr><h2 id="影響を受ける可能性がある環境"><a href="#影響を受ける可能性がある環境" class="headerlink" title="影響を受ける可能性がある環境"></a>影響を受ける可能性がある環境</h2><p>今回の脆弱性対応によって、DefaultDomainSupportedEncTypes を明示的に設定していない場合、サービス チケットの暗号方式が既定で AES-SHA1 に変更されます。<br>影響が発生する可能性が高いのは、Kerberos 認証の暗号方式で AES-SHA1 に対応していないサードパーティー製品や古い OS への認証、また、Windows OS 上で動作するサードパーティー製品となります。<br>「<strong>2026 年 4 月までにやるべきこと</strong>」に記載の内容が実施できていない場合、RC4DefaultDisablementPhase = 2 の動作になると、<strong>認証失敗といった事象が発生する可能性</strong>があります。</p><hr><h2 id="具体的な対応ステップ"><a href="#具体的な対応ステップ" class="headerlink" title="具体的な対応ステップ"></a>具体的な対応ステップ</h2><p>対処手順の具体的なステップについて、記載します。</p><h3 id="1-更新プログラムを適用する"><a href="#1-更新プログラムを適用する" class="headerlink" title="1. 更新プログラムを適用する"></a>1. 更新プログラムを適用する</h3><p>まずは、<strong>2026 年 1 月 13 日以降にリリースされた更新プログラムを、すべてのドメイン コントローラーに適用</strong>します。これにより、RC4DefaultDisablementPhase の仕組みと監査イベントが利用できるようになります。</p><h3 id="2-監査イベントを確認し、影響範囲を把握する"><a href="#2-監査イベントを確認し、影響範囲を把握する" class="headerlink" title="2. 監査イベントを確認し、影響範囲を把握する"></a>2. 監査イベントを確認し、影響範囲を把握する</h3><p>次に、ドメイン コントローラーの <strong>システム イベントログ</strong> から、以下のイベント ID を確認します。</p><ul><li><strong>警告</strong>：201 / 202 / 206 / 207<blockquote><p>※RC4DefaultDisablementPhase = 2 の動作では、これらの警告イベントはそれぞれ 203 / 204 / 208 / 209　のエラーイベントとなり、認証がブロックされるようになります。</p></blockquote></li></ul><p>それぞれの監査イベントログは、次の場合に記録されます。</p><ul><li><strong>ID 201 / 206 の場合</strong><br>認証元となったクライアント側が AES に対応していない、または AES が無効化されている。</li><li><strong>ID 202 / 207 の場合</strong><br>認証先となったサービス アカウント側で Kerberos 認証で使用可能な AES のキーが存在しない（RC4 のキーのみが存在する） 。</li></ul><h3 id="3-a-AES-への移行"><a href="#3-a-AES-への移行" class="headerlink" title="3-(a). AES への移行"></a>3-(a). AES への移行</h3><p>基本方針としては <strong>AES への移行</strong> を推奨します。記録されている監査イベントログに応じて、それぞれ以下のように対処をご検討ください。監査イベントログの記載内容については、後述の<a href="https://jpwinsup.github.io/blog/2026/02/02/ActiveDirectory/Authentication/kerberos-rc4-for-service-account-ticket-issuance-changes-related-to-cve-2026-20833/#%E8%A8%98%E9%8C%B2%E3%81%95%E3%82%8C%E3%82%8B%E7%9B%A3%E6%9F%BB%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%AD%E3%82%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">記録される監査イベントログについて</a>にサンプルを記載しておりますので、ご参考になれば幸いです。</p><h4 id="ID-201-206-の場合"><a href="#ID-201-206-の場合" class="headerlink" title="ID 201 / 206 の場合"></a><strong>ID 201 / 206 の場合</strong></h4><p>認証元となったクライアント側での対処が必要です。<br>イベントログに記載の「<strong>ネットワーク情報:</strong> 」に、要求元クライアントの IP アドレスが記録されるため、記載された IP アドレスのクライアントをご確認ください。</p><p>対処策について、現在サポートされている Windows OS では、既定で AES の暗号方式に対応しておりますので、通常記録されることは想定されません。<br>対象のクライアントがサードパーティー製品の場合には、恐れ入りますが対応方法について、対象製品のベンダー様にご確認ください。</p><p>もしサポートされている Windows OS で記録がされる場合、要求元のクライアント端末に以下のポリシー設定が行われている可能性があります。もし明示的に設定があり、その中に AES の設定が無い場合は AES も許可されるよう設定を更新ください。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">パス：[コンピュータの構成] - [ポリシー] - [Windows の設定] - [セキュリティの設定] - [ローカル ポリシー] - [セキュリティ オプション] </span><br><span class="line">ポリシー名：[ネットワーク セキュリティ: Kerberos で許可される暗号化の種類を構成する]</span><br></pre></td></tr></table></figure><p>以下が含まれるようにチェックを入れます。<br>　 AES128_HMAC_SHA1<br>　 AES256_HMAC_SHA1 </p><h4 id="ID-202-207-の場合"><a href="#ID-202-207-の場合" class="headerlink" title="ID 202 / 207 の場合"></a><strong>ID 202 / 207 の場合</strong></h4><p>認証先となったサービス アカウント側での対処が必要です。<br>イベントログ内の「<strong>サービス情報:</strong> 」に記載の認証先アカウントのパスワード更新することで、ドメイン コントローラーが自動的に AES に対応したキーを生成するため、認証先アカウントのパスワードリセットやパスワード変更を実施ください。</p><p>認証先となったサービス アカウントは、イベントログに記載の「サービス情報: 」に、認証先のアカウントの情報が記録されますので、記載されたアカウントの用途をご確認ください。</p><p>サービス アカウントのパスワード変更方法は、アカウントを使用している製品ごとに用意されていることがありますので、ご利用のアカウントがどのようなサービスで利用されているのかご確認の上、サービスごとに確認することをご検討ください。</p><p>もし、ドメイン コントローラー側でパスワードリセットを行った場合、サービス側が保持しているパスワードとドメインコントローラー上で保持しているパスワードが不一致となってしまうため、<br>リセット後のパスワードで、サービス アカウントの再設定が必要となります。こちらも設定方法について、ご利用のサービスごとにご確認ください。</p><p>対象のアカウントを利用しているサービスがサードパーティー製品の場合には、各ベンダー様にご確認ください。</p><h3 id="3-b-RC4-を継続利用する場合"><a href="#3-b-RC4-を継続利用する場合" class="headerlink" title="3-(b). RC4 を継続利用する場合"></a>3-(b). RC4 を継続利用する場合</h3><p>AES への移行が難しいなど、RC4 を継続利用する必要がある場合は、認証先となった「<strong>サービス情報:</strong> 」に記載のサービス アカウントの <code>msds-SupportedEncryptionTypes</code> に、<strong>RC4 を含む値（例：0x1C）を明示的に設定</strong>ください。ID 201 / 202 / 206 / 207 とも共通で、こちらの設定を実施すると監査イベントログの記録が解消可能です。</p><p>■ GUI からの設定方法</p><ol><li>Active Directory ユーザーとコンピューターを開きます。</li><li>上部タブの「表示」を選択後、拡張機能を有効にします。</li><li>該当のサービス アカウントのプロパティを開きます。</li><li>「属性エディター」タブ - msDS-SupportedEncryptionTypes をRC4 を含むように (0x1C など) に編集します。</li></ol><p>■ 有効化方法 (CUI)<br>例としてユーザーアカウントにセットする場合を記載します。</p><ol><li>管理者権限で PowerShell を起動します。</li><li>次のコマンドを実行し、msDS-SupportedEncryptionTypes に RC4 を含むように設定します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ADUser</span> <span class="literal">-Identity</span> <span class="string">&quot;&lt;対象名&gt;&quot;</span> <span class="operator">-Replace</span> <span class="selector-tag">@</span>&#123;<span class="string">&#x27;msDS-SupportedEncryptionTypes&#x27;</span>= <span class="number">0</span>x1C &#125;</span><br></pre></td></tr></table></figure><blockquote><p>※  &lt;対象名&gt; の部分には、設定対象となるユーザー名を入力ください。<br>※ コンピューターアカウントに対して実行する場合は、Set-ADComputer コマンドをご利用ください。</p></blockquote></li></ol><p><code>msds-SupportedEncryptionTypes</code>に設定できる値については、後述の <a href="https://jpwinsup.github.io/blog/2026/02/02/ActiveDirectory/Authentication/kerberos-rc4-for-service-account-ticket-issuance-changes-related-to-cve-2026-20833/#FAQ">FAQ</a> にある「msds-SupportedEncryptionTypes とは何ですか」に記載のリンクをご参照ください。<br> 0x1C という値は 0x4 (RC4-HMAC)、0x8 (AES128-CTS-HMAC-SHA1-96)、0x10 (AES256-CTS-HMAC-SHA1-96) の値の足し算となっており、AES と RC4 を含む値となります。</p><h3 id="4-RC4DefaultDisablementPhase-の設定"><a href="#4-RC4DefaultDisablementPhase-の設定" class="headerlink" title="4. RC4DefaultDisablementPhase の設定"></a>4. RC4DefaultDisablementPhase の設定</h3><p>3-(a) または 3-(b) の対応を行い、「2. 監査イベントを確認し、影響範囲を把握する」で確認した監査イベントログ ID 201 / 202 / 206 / 207 の記録が無くなったことを確認したら、RC4DefaultDisablementPhase = 2 に設定します。設定後は OS の再起動、または KDC サービスの再起動が必要です。</p><p>必要な対応としては以上となります。</p><hr><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>今回の脆弱性対応による変更は、ドメイン コントローラーが既定で RC4 を使わないようにするという変更となりますが、裏を返すと「<strong>RC4 を継続して利用するのであれば、明示的に設定しなければならない</strong>」という変更になります。<br>CVE‑2026‑20833 への対応としては、監査イベントログの記録が無くなり、RC4DefaultDisablementPhase = 2 となれば完了ですので、<br>明示的に RC4 の設定さえすれば、対応完了後も引き続き RC4 による Kerberos 認証の利用は可能です。<br>お客様の選択によって、RC4 の継続利用も一つの対応となっております。</p><p>しかし、RC4 は現在安全でないと見なされており、段階的に廃止されていく動きとなっております。本脆弱性対応によって、RC4 の明示的な有効化を選択された場合、どのアカウントで RC4 を利用されているのかが明確になった状況と存じますので、 RC4 の廃止に向けた対応を継続いただくことをご検討いただけますと幸いです。</p><p>また、本脆弱性対応によって監査イベントログが記録されなくなった後も、以下の公開情報に記載の手順で、RC4 の監視を継続することができます。ご参考になれば幸いです。<br><a href="https://learn.microsoft.com/ja-jp/windows-server/security/kerberos/detect-remediate-rc4-kerberos">Kerberos での RC4 の使用状況を検出して修復する</a></p><hr><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="DefaultDomainSupportedEncTypes-とは何ですか"><a href="#DefaultDomainSupportedEncTypes-とは何ですか" class="headerlink" title="DefaultDomainSupportedEncTypes とは何ですか"></a>DefaultDomainSupportedEncTypes とは何ですか</h3><p>CVE-2022-37966 対応で追加されたレジストリです。CVE-2022-37966 対応では、このレジストリの既定値が 0x27 となることで、既定で Kerberos 認証時におけるセッションキーで利用される暗号化方式が AES となりました。<br>今回の CVE‑2026‑20833 対応ではこの既定値が 0x18 へと変更になり、Kerberos 認証時におけるサービス チケットの暗号化方式も AES となります。アカウントに msds-SupportedEncryptionTypes が設定されていない場合の既定値となります。<br>// ご参考<br><a href="https://support.microsoft.com/ja-jp/topic/kb5021131-cve-2022-37966-%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B-kerberos-%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95-fd837ac3-cdec-4e76-a6ec-86e67501407d">KB5021131: CVE-2022-37966 に関連する Kerberos プロトコルの変更を管理する方法</a><br><a href="https://jpwinsup.github.io/blog/2022/12/29/ActiveDirectory/Authentication/kerberos-protocol-changes-related-to-cve-2022-37966/">CVE-2022-37966 への対応とその影響について</a></p><h3 id="msds-SupportedEncryptionTypes-とは何ですか"><a href="#msds-SupportedEncryptionTypes-とは何ですか" class="headerlink" title="msds-SupportedEncryptionTypes とは何ですか"></a>msds-SupportedEncryptionTypes とは何ですか</h3><p>アカウントがサポートする暗号化の種類を示す、Active Directory 属性です。msds-SETと呼ばれることもあります。サポートされているバージョンの Windows OS では、Active Directory でそのコンピューター アカウントの msds-SupportedEncryptionTypes が自動的に設定されます。<br>ユーザーアカウントや gMSA アカウントなど他のアカウントでは、msds-SupportedEncryptionTypes に明示的な値は自動的には設定されません。設定できる値については以下の公開情報を参照ください。<br><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/6cfc7b50-11ed-4b4d-846d-6f08f0812919">2.2.7 Supported Encryption Types Bit Flags</a></p><p>その他ご参考：<br><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ada2/a75d1c3f-0bb3-470c-99bd-2bb557119483">2.481 Attribute msDS-SupportedEncryptionTypes</a></p><h3 id="2026-年-7-月-適用フェーズ-以降も-RC4-の継続利用は可能ですか"><a href="#2026-年-7-月-適用フェーズ-以降も-RC4-の継続利用は可能ですか" class="headerlink" title="2026 年 7 月 - 適用フェーズ 以降も RC4 の継続利用は可能ですか"></a>2026 年 7 月 - 適用フェーズ 以降も RC4 の継続利用は可能ですか</h3><p>はい、今回の脆弱性対応で、「認証先のサービス アカウントの msds-SupportedEncryptionTypes 属性に明示的に RC4 を含むような値を設定」をし、RC4 の継続利用すること選択された場合は、引き続き RC4 を利用することが可能です。<br>また、DefaultDomainSupportedEncTypes の設定は、2026 年 7 月 - 適用フェーズ 以降もその機能は削除されませんので、明示的に RC4 を含む値に設定された場合もその値の通りに動作します。ただし、DefaultDomainSupportedEncTypes に RC4 などのレガシー暗号を含む場合、ID 205 の監査イベントログが OS 再起動や KDC サービス起動のたびに記録されます。<br>RC4 は現在安全でないと見なされており、段階的に廃止されていく動きとなっております。本脆弱性対応によって、RC4 の明示的な有効化を選択された場合も RC4 の廃止に向けた対応を継続いただくことをご検討ください。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><h3 id="記録される監査イベントログについて"><a href="#記録される監査イベントログについて" class="headerlink" title="記録される監査イベントログについて"></a>記録される監査イベントログについて</h3><p>記録されるイベントログのサンプルを以下に記載します。</p><h4 id="RC4DefaultDisablementPhase-1-の時に記録される監査イベントログ"><a href="#RC4DefaultDisablementPhase-1-の時に記録される監査イベントログ" class="headerlink" title="RC4DefaultDisablementPhase = 1 の時に記録される監査イベントログ"></a>RC4DefaultDisablementPhase = 1 の時に記録される監査イベントログ</h4><p>■ ID 201</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 201</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: 警告</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が定義されておらず、クライアントがセキュリティで保護されていない暗号化の種類のみをサポートしているため、キー配布センター (KDC) は強制フェーズでサポートされない RC4-HMAC-NT の使用状況を検出しました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line"> </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Service Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Service Available Keys&gt;</span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: &lt;DefaultDomainSupportedEncTypes Value&gt;</span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス:　&lt;クライアント アドレス&gt;</span><br><span class="line">クライアント ポート: &lt;クライアント ポート&gt;</span><br><span class="line">変換された Etypes: </span><br><span class="line">RC4-HMAC-NT </span><br></pre></td></tr></table></figure><p>■ ID 202</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 202</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: 警告</span><br><span class="line">説明:</span><br><span class="line">キー配布センター (KDC) は、サービス msds-SupportedEncryptionTypes が定義されておらず、サービス アカウントに安全でないキーしかないため、強制フェーズでサポートされない RC4-HMAC-NT の使用状況を検出しました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Service Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: RC4 </span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: &lt;DefaultDomainSupportedEncTypes Value&gt;</span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">&lt;Advertized Kerberos Encryption Types&gt; </span><br></pre></td></tr></table></figure><p>■ ID 206</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 206</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: 警告</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes は AES-SHA1 のみをサポートするように構成されていますが、クライアントは AES-SHA1 をアドバタイズしないため、キー配布センター (KDC) は強制フェーズでサポートされない RC4-HMAC-NT の使用状況を検出しました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Service Available Keys&gt;</span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">RC4-HMAC-NT </span><br></pre></td></tr></table></figure><p>■ ID 207</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 207</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: 警告</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が AES-SHA1 のみをサポートするように構成されていますが、サービス アカウントに AES-SHA1 キーがないため、強制フェーズでサポートされない RC4-HMAC-NT の使用状況がキー配布センター (KDC) によって検出されました。  </span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: RC4 </span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">&lt;Advertized Kerberos Encryption Types&gt; </span><br></pre></td></tr></table></figure><h4 id="RC4DefaultDisablementPhase-2-の時に記録されるエラーイベントログ"><a href="#RC4DefaultDisablementPhase-2-の時に記録されるエラーイベントログ" class="headerlink" title="RC4DefaultDisablementPhase = 2 の時に記録されるエラーイベントログ"></a>RC4DefaultDisablementPhase = 2 の時に記録されるエラーイベントログ</h4><p>■ ID 203</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 203</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: エラー</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が定義されておらず、クライアントがセキュリティで保護されていない暗号化の種類のみをサポートしているため、キー配布センター (KDC) は暗号の使用をブロックしました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;アカウント名&gt;</span><br><span class="line">リソース領域名: &lt;ドメイン名&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;サポートされている暗号化の種類&gt;&gt;</span><br><span class="line">使用可能なキー: &lt;使用可能なキー&gt;</span><br><span class="line"> </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;サービスアカウント名&gt;</span><br><span class="line">サービス ID: &lt;ドメイン名\サービスアカウント名&gt; </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;サービスでサポートされる暗号化の種類&gt;</span><br><span class="line">使用可能なキー: &lt;サービスの使用可能なキー&gt;</span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: &lt;DefaultDomainSupportedEncTypes Value&gt;</span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス:　&lt;クライアント アドレス&gt;</span><br><span class="line">クライアント ポート: &lt;クライアント ポート&gt;</span><br><span class="line">変換された Etypes: </span><br><span class="line">RC4-HMAC-NT </span><br></pre></td></tr></table></figure><p>■ ID 204</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 204</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: エラー</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が定義されておらず、サービス アカウントに安全でないキーしかないため、キー配布センター (KDC) によって暗号の使用がブロックされました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Service Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: RC4 </span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: &lt;DefaultDomainSupportedEncTypes Value&gt;</span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">&lt;Advertized Kerberos Encryption Types&gt; </span><br></pre></td></tr></table></figure><p>■ ID 208</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 208</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: エラー</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が AES-SHA1 のみをサポートするように構成されていますが、クライアントが AES-SHA1 をアドバタイズしないため、キー配布センター (KDC) は暗号の使用をブロックしました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Service Available Keys&gt;</span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">RC4-HMAC-NT </span><br></pre></td></tr></table></figure><p>■ ID 209</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 209</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: エラー</span><br><span class="line">説明:</span><br><span class="line">サービス msds-SupportedEncryptionTypes が AES-SHA1 のみをサポートするように構成されていますが、サービス アカウントに AES-SHA1 キーがないため、キー配布センター (KDC) は暗号の使用をブロックしました。</span><br><span class="line"></span><br><span class="line">アカウント情報</span><br><span class="line">アカウント名: &lt;Account Name&gt; </span><br><span class="line">リソース領域名: &lt;Supplied Realm Name&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Supported Encryption Types&gt; </span><br><span class="line">使用可能なキー: &lt;Available Keys&gt; </span><br><span class="line">  </span><br><span class="line">サービス情報: </span><br><span class="line">サービス名: &lt;Service Name&gt;</span><br><span class="line">サービス ID: &lt;Service ID&gt;</span><br><span class="line">msds-SupportedEncryptionTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: RC4 </span><br><span class="line"></span><br><span class="line">ドメイン コントローラー情報: </span><br><span class="line">msds-SupportedEncryptionTypes: &lt;Domain Controller Supported Encryption Types&gt; </span><br><span class="line">DefaultDomainSupportedEncTypes: 0x18 (AES128-SHA96, AES256-SHA96) </span><br><span class="line">使用可能なキー: &lt;Domain Controller Available Keys&gt; </span><br><span class="line"></span><br><span class="line">ネットワーク情報: </span><br><span class="line">クライアント アドレス: &lt;Client IP Address&gt; </span><br><span class="line">クライアント ポート: &lt;Client Port&gt; </span><br><span class="line">変換された Etypes: </span><br><span class="line">&lt;Advertized Kerberos Encryption Types&gt; </span><br></pre></td></tr></table></figure><h4 id="DefaultDomainSupportedEncTypes-に明示的な設定がある場合に記録されるイベントログ"><a href="#DefaultDomainSupportedEncTypes-に明示的な設定がある場合に記録されるイベントログ" class="headerlink" title="DefaultDomainSupportedEncTypes に明示的な設定がある場合に記録されるイベントログ"></a>DefaultDomainSupportedEncTypes に明示的な設定がある場合に記録されるイベントログ</h4><p>DefaultDomainSupportedEncTypes に明示的に RC4 を含む脆弱性な暗号方式の値があると、ID 205 の監査イベントログが OS 再起動や KDC サービス起動のたびに記録されます。これは想定される動作であり、DefaultDomainSupportedEncTypes を削除するか、AES のみを含む値に設定する以外に解消策はありません。</p><p>■ ID 205</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ログの名前: System</span><br><span class="line">ソース: Microsoft-Windows-Kerberos-Key-Distribution-Center</span><br><span class="line">イベント ID: 205</span><br><span class="line">タスクのカテゴリ: KDC 拡張監査</span><br><span class="line">レベル: 警告</span><br><span class="line">説明:</span><br><span class="line">キー配布センター (KDC) は、既定のドメインでサポートされている暗号化の種類の既定のポリシー構成で、セキュリティで保護されていない明示的な暗号の有効化を検出しました。</span><br><span class="line"></span><br><span class="line">Cipher: RC4-HMAC-NT</span><br><span class="line">DefaultDomainSupportedEncTypes: 0x4 (RC4)</span><br></pre></td></tr></table></figure><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2026/02/03 記事の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;2026 年 1 月の Windows 更新プログラム以降、Kerber</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Authentication" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Authentication/"/>
    
    
  </entry>
  
  <entry>
    <title>ライブ マイグレーション後の再起動でゲスト OS の時刻がずれる場合がある</title>
    <link href="https://jpwinsup.github.io/blog/2026/01/12/Hyper-V/vmwp-does-not-save-the-RTC-value-of-a-virtual-machine-when-performing-Live-Migration/"/>
    <id>https://jpwinsup.github.io/blog/2026/01/12/Hyper-V/vmwp-does-not-save-the-RTC-value-of-a-virtual-machine-when-performing-Live-Migration/</id>
    <published>2026-01-12T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.391Z</updated>
    
    <content type="html"><![CDATA[<p>本記事は、マイクロソフト社員によって公開されております。  </p><p>こんにちは、Windows サポート チームです。<br>今回は、Hyper-V の Live Migration (ライブ マイグレーション) 実施後に、仮想マシン (VM) の再起動を契機としてゲスト OS の時刻がずれる場合がある事象についてお知らせします。</p><h2 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h2><p>以下の条件に該当する環境が対象です。</p><ul><li>Hyper-V ホスト OS が Windows Server 2016 / 2019 / 2022 / 2025 の環境</li><li>VM設定バージョン : 6.2以降</li><li>ゲスト OS 側で独自の NTP を使用するなどの理由により、Hyper-V の時刻同期 (統合サービス) を無効化している VM</li></ul><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>Live Migration (または Quick Migration) 実施後、対象の VM を再起動すると、ゲスト OS の時刻が過去方向へ戻ったように見える場合があります。<br>なお、一般的にはホスト OS 自体が NTP などにより正しい時刻へ同期していることが多いため、実運用においてゲスト OS の時刻が「大幅に」戻る可能性は高くありません。<br>戻ったとしても差分が限定的となるケースが多いと考えられます (環境や直前の調整量に依存します)。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Live Migration および Quick Migration では、VM の移動に伴って一部の時刻情報 (起動後に調整された時刻の差分に相当する情報) が保存されないまま移動する場合があります。<br>その結果、移動後の再起動時に、VM が起動してから調整された時刻の差分が反映されずに起動し、ゲスト OS の時刻がずれたように見えることがあります。</p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><h3 id="回避策-1-推奨-Hyper-V-の時刻同期-統合サービス-を有効化する"><a href="#回避策-1-推奨-Hyper-V-の時刻同期-統合サービス-を有効化する" class="headerlink" title="回避策 1 (推奨): Hyper-V の時刻同期 (統合サービス) を有効化する"></a>回避策 1 (推奨): Hyper-V の時刻同期 (統合サービス) を有効化する</h3><p>Hyper-V の時刻同期 (統合サービス) を有効化することで、本事象の回避が可能です。<br>ゲスト OS 側で独自の NTP を利用している場合でも、時刻同期方式の設計 (どの時刻ソースを正とするか) を整理したうえで、運用に適した構成をご検討ください。</p><h3 id="回避策-2-代替案-Live-Migration-前に-VM-をシャットダウンして移動する"><a href="#回避策-2-代替案-Live-Migration-前に-VM-をシャットダウンして移動する" class="headerlink" title="回避策 2 (代替案): Live Migration 前に VM をシャットダウンして移動する"></a>回避策 2 (代替案): Live Migration 前に VM をシャットダウンして移動する</h3><p>もし運用上可能であれば、Live Migration の代わりに、VM をシャットダウンしてから移動し、移動先で起動することで回避できる場合があります (ただしダウンタイムが発生します)。</p><h2 id="本問題に対する弊社の対応状況について"><a href="#本問題に対する弊社の対応状況について" class="headerlink" title="本問題に対する弊社の対応状況について"></a>本問題に対する弊社の対応状況について</h2><p>本事象については、2025 年 7 月時点で次期 OS の修正課題として開発部門へエスカレーション済みです。<br>現行の OS につきましては、上記の回避策にて対応が可能であるため、回避策の実施をご検討ください。<br>今後、修正に関する具体的な情報が更新され次第、本記事でお知らせいたします。</p><p>本情報の内容 (添付文書、リンク先などを含む) は作成日時点のものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポート チームです。&lt;br&gt;今回は、Hyper-V の Live Migration (ライブ マイグレーション) 実施後に、仮想マシン (VM) の再起動を契機として</summary>
      
    
    
    
    <category term="Hyper-V" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/"/>
    
    <category term="Configuration and Management" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/Configuration-and-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>ISO メディア経由かつ動的更新無効な状態で Windows 11 バージョン 24H2 または 25H2 へのアップグレードが失敗 (0x8007042B 0x2000D) する事象と対策について</title>
    <link href="https://jpwinsup.github.io/blog/2026/01/07/WindowsUpdate/FU/fublog-txt/"/>
    <id>https://jpwinsup.github.io/blog/2026/01/07/WindowsUpdate/FU/fublog-txt/</id>
    <published>2026-01-07T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.994Z</updated>
    
    <content type="html"><![CDATA[<p>※ 本記事はマイクロソフト社員によって公開されております。</p><h2 id="事象の内容"><a href="#事象の内容" class="headerlink" title="事象の内容"></a>事象の内容</h2><p> ISO メディアを用いて Windows 11 バージョン 24H2 または 25H2 へアップグレードを実行する際に、動的更新 (Dynamic Update) が無効または実行されない環境では、セットアップ処理中に 0x8007042B - 0x2000D のエラーでアップグレードに失敗する場合があります。</p><p>本ブログでは、この事象の特徴と対処方法についてご説明します。</p><h3 id="事象発生の確認方法"><a href="#事象発生の確認方法" class="headerlink" title="事象発生の確認方法"></a>事象発生の確認方法</h3><p>C:$WINDOWS.~BT\Sources\Panther\setupact.log にて以下のようなログが出力されている場合、該当している可能性があります。</p><pre>2025-01-01 00:00:00, Info                  MIG            V2VArbitrate: Source migration unit <System>\<B><ファイル名称></B> (CCSIAgent) is not supported on the destination machine and it will not be restored2025-01-01 00:00:00, Error                 MIG            V2VArbitrate: Source migration unit is critical, arbitration will fail[gle=0x000000cb]2025-01-01 00:00:00, Error                                V2V Arbitration failed. Last error: 0x00000032[gle=0x00000032]</pre><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>アップグレード処理の過程で、アップグレード前の起動中の環境と ISO メディアに含まれる &lt;ファイル名称&gt; のマニフェストの整合性を確認します。</p><p>この際に、ISO メディアに含まれる &lt;ファイル名称&gt; のマニュフェストの方が古い場合、マニュフェスト バージョンの不整合として事象が発生します。</p><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>対処方法には以下の 2 種類があります。</p><p>(a) インターネットに接続可能な環境で、動的更新 (Dynamic Update) を有効にした状態でアップグレードします</p><p>　　&gt;setup /auto upgrade /dynamicupdate Enable</p><p>(b) 最新の品質更新プログラムを組みこんだ ISO メディアでアップグレードします</p><h2 id="過去の同事象のご紹介"><a href="#過去の同事象のご紹介" class="headerlink" title="過去の同事象のご紹介"></a>過去の同事象のご紹介</h2><h3 id="1-Microsoft-Windows-Pcrpf-マニフェストの場合"><a href="#1-Microsoft-Windows-Pcrpf-マニフェストの場合" class="headerlink" title="1) Microsoft-Windows-Pcrpf マニフェストの場合"></a>1) Microsoft-Windows-Pcrpf マニフェストの場合</h3><p>2025 年 7 月 D リリース (KB5062660) 以降の更新プログラムで Microsoft-Windows-Pcrpf マニフェストが追加され、<br>Windows 11 24H2 から Windows 11 24H2 へのインプレースアップグレード時に事象が発生します。</p><h4 id="詳細な対処方法"><a href="#詳細な対処方法" class="headerlink" title="詳細な対処方法"></a>詳細な対処方法</h4><p>(a) インターネットに接続可能な環境で、動的更新 (Dynamic Update) を有効にした状態でアップグレードします</p><p>　　&gt;setup /auto upgrade /dynamicupdate Enable</p><p>(b) 2025 年 7 月 D リリース (KB5062660) 以降の更新プログラムを適用した ISO メディアでアップグレードします</p><br><h3 id="2-Microsoft-Windows-TPM-Driver-WMI-マニフェストの場合"><a href="#2-Microsoft-Windows-TPM-Driver-WMI-マニフェストの場合" class="headerlink" title="2) Microsoft-Windows-TPM-Driver-WMI マニフェストの場合"></a>2) Microsoft-Windows-TPM-Driver-WMI マニフェストの場合</h3><p>2025 年 11 月 D リリース (KB5070311) 以降の更新プログラムで Microsoft-Windows-TPM-Driver-WMI マニフェストが更新され、アップグレード時に事象が発生します。</p><h4 id="詳細な対処方法-1"><a href="#詳細な対処方法-1" class="headerlink" title="詳細な対処方法"></a>詳細な対処方法</h4><p>(a) インターネットに接続可能な環境で、動的更新 (Dynamic Update) を有効にした状態でアップグレードします</p><p>　　&gt;setup /auto upgrade /dynamicupdate Enable</p><p>(b) 2025 年 11 月 D リリース (KB5070311) 以降の更新プログラムを適用した ISO メディアでアップグレードします</p><br><p>[特記事項]<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※ 本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;h2 id=&quot;事象の内容&quot;&gt;&lt;a href=&quot;#事象の内容&quot; class=&quot;headerlink&quot; title=&quot;事象の内容&quot;&gt;&lt;/a&gt;事象の内容&lt;/h2&gt;&lt;p&gt; ISO メディアを用いて Windows</summary>
      
    
    
    
    <category term="Windows Update" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/"/>
    
    <category term="Feature Update (FU)" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/Feature-Update-FU/"/>
    
    
  </entry>
  
  <entry>
    <title>予定よりも早い時間で画面がロックされてしまう事象について</title>
    <link href="https://jpwinsup.github.io/blog/2026/01/05/Shell/Explorer/unexpexted-early-screen-lock/"/>
    <id>https://jpwinsup.github.io/blog/2026/01/05/Shell/Explorer/unexpexted-early-screen-lock/</id>
    <published>2026-01-05T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.605Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事はマイクロソフト社員によって公開されております。</p><p>みなさま、こんにちは。Windows Commercial Support チームの丸山です。</p><p>本日は、グループ ポリシーなどで画面がロックされるまでの時間を設定しているが、予定よりも早い時間で画面がロックされてしまう、という事象について、よくある原因と確認すべきチェックポイントをご紹介します。</p><hr><h1 id="【事象の概要】"><a href="#【事象の概要】" class="headerlink" title="【事象の概要】"></a>【事象の概要】</h1><p>Windows には、画面をロックするためのタイムアウト設定が複数存在します。これらの設定は、ユーザー設定、グループポリシー、MDM ポリシーなど、さまざまな方法で構成されます。</p><p><strong>複数のタイムアウト設定が存在する場合、最も短い時間が適用されます。</strong></p><p>そのため、意図した時間よりも早く画面がロックされる場合には、対象のデバイスにより短い時間でタイムアウトする設定が行われている可能性があります。</p><hr><h1 id="【原因について】"><a href="#【原因について】" class="headerlink" title="【原因について】"></a>【原因について】</h1><p>画面ロックに影響を与える設定は以下の 3 つです。</p><ol><li>非アクティブ時間の上限 (InactivityTimeoutSecs / MaxInactivityTimeDeviceLock)</li><li>DelayLockInterval (ディスプレイ電源オフ後のロック) </li><li>ScreenSaveTimeOut スクリーンセーバーが起動する時間</li></ol><p>上記について複数の設定が行われている場合、最も短い設定が有効になります。</p><hr><h1 id="【確認のポイントについて】"><a href="#【確認のポイントについて】" class="headerlink" title="【確認のポイントについて】"></a>【確認のポイントについて】</h1><p>原因に挙げた 3 つのタイムアウトについて、確認のポイントをご紹介します。</p><hr><h2 id="1-非アクティブ時間の上限-InactivityTimeoutSecs-MaxInactivityTimeDeviceLock"><a href="#1-非アクティブ時間の上限-InactivityTimeoutSecs-MaxInactivityTimeDeviceLock" class="headerlink" title="[1] 非アクティブ時間の上限 (InactivityTimeoutSecs / MaxInactivityTimeDeviceLock)"></a>[1] 非アクティブ時間の上限 (InactivityTimeoutSecs / MaxInactivityTimeDeviceLock)</h2><p>セキュリティ ポリシーによる強制的な画面ロック設定です。</p><p><strong>動作:</strong></p><ul><li>ユーザーの操作がない状態が指定された時間続くと、画面がロックされます</li></ul><p>InactivityTimeoutSecs と MaxInactivityTimeDeviceLock がどちらも設定されている場合、より短い時間が有効になります。</p><hr><h3 id="A-ローカル設定-グループ-ポリシーの場合-InactivityTimeoutSecs"><a href="#A-ローカル設定-グループ-ポリシーの場合-InactivityTimeoutSecs" class="headerlink" title="(A) ローカル設定 / グループ ポリシーの場合 (InactivityTimeoutSecs)"></a>(A) ローカル設定 / グループ ポリシーの場合 (InactivityTimeoutSecs)</h3><p><strong>GUI での設定箇所:</strong></p><ul><li>ローカル セキュリティ ポリシー (secpol.msc)</li><li>[ローカル ポリシー] &gt; [セキュリティ オプション] &gt; [対話型ログオン: コンピューターの非アクティブ状態の上限]</li></ul><p><strong>グループ ポリシー エディター (gpedit.msc) での設定箇所:</strong></p><ul><li>[コンピューターの構成] &gt; [Windows の設定] &gt; [セキュリティの設定] &gt; [ローカル ポリシー] &gt; [セキュリティ オプション] &gt; [対話型ログオン: コンピューターの非アクティブ状態の上限]</li></ul><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</span><br><span class="line">値の名前: InactivityTimeoutSecs</span><br><span class="line">値の種類: REG_DWORD</span><br><span class="line">値のデータ: 秒数 (例: 900 = 15 分、0 = 無効) </span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># レジストリから直接確認</span></span><br><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System&quot;</span> /v InactivityTimeoutSecs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 適用されているポリシーをレポート出力</span></span><br><span class="line">gpresult /<span class="built_in">h</span> gpresult.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># または、セキュリティ設定をエクスポートして確認</span></span><br><span class="line">secedit /export /cfg secpol.txt</span><br><span class="line">findstr /i <span class="string">&quot;InactivityTimeoutSecs&quot;</span> secpol.txt</span><br></pre></td></tr></table></figure><hr><h3 id="B-MDM-Exchange-ActiveSync-ポリシーの場合-MaxInactivityTimeDeviceLock"><a href="#B-MDM-Exchange-ActiveSync-ポリシーの場合-MaxInactivityTimeDeviceLock" class="headerlink" title="(B) MDM / Exchange ActiveSync ポリシーの場合 (MaxInactivityTimeDeviceLock)"></a>(B) MDM / Exchange ActiveSync ポリシーの場合 (MaxInactivityTimeDeviceLock)</h3><p>Microsoft Intune などの MDM や、Exchange ActiveSync (EAS) 経由でモバイル デバイス ポリシーが適用されている場合、以下の値を確認してください。</p><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device\DeviceLock</span><br><span class="line">値の名前: MaxInactivityTimeDeviceLock</span><br><span class="line"></span><br><span class="line">キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\Providers\&lt;ProviderGUID&gt;\default\Device\DeviceLock</span><br><span class="line">値の名前: MaxInactivityTimeDeviceLock</span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 現在適用されているポリシーを確認</span></span><br><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\DeviceLock&quot;</span> /v MaxInactivityTimeDeviceLock</span><br><span class="line"></span><br><span class="line"><span class="comment"># すべてのプロバイダー (MDM/EAS) の設定を確認</span></span><br><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\PolicyManager\Providers&quot;</span> /s /v MaxInactivityTimeDeviceLock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登録されているプロバイダー一覧を確認</span></span><br><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\PolicyManager\Providers&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 各プロバイダー (MDM/EAS) の詳細を確認</span></span><br><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Enrollments&quot;</span> /s</span><br></pre></td></tr></table></figure><blockquote><p><strong>補足:</strong> Exchange ActiveSync ポリシーは、メール アプリで Exchange アカウントを構成した際に、Exchange サーバー側で設定されたモバイル デバイス ポリシーがデバイスに適用されます。管理者は Exchange 管理センターまたは PowerShell でモバイル デバイス メールボックス ポリシーを確認・変更できます。</p></blockquote><hr><h2 id="2-DelayLockInterval-ディスプレイ電源オフ後のロック"><a href="#2-DelayLockInterval-ディスプレイ電源オフ後のロック" class="headerlink" title="[2] DelayLockInterval (ディスプレイ電源オフ後のロック)"></a>[2] DelayLockInterval (ディスプレイ電源オフ後のロック)</h2><p>ディスプレイの電源をオフにする設定と連動して動作します。</p><p><strong>動作:</strong></p><ul><li>ディスプレイの電源がオフになってから、指定された時間が経過すると画面がロックされます</li><li>ロックまでの時間 = 「ディスプレイの電源をオフにする時間」+「DelayLockInterval の値」</li></ul><blockquote><p><strong>重要:</strong> DelayLockInterval による画面ロックのタイミングを正確に把握するには、「ディスプレイの電源を切る」までの時間も併せて確認する必要があります。</p></blockquote><hr><h3 id="A-手動設定の場合"><a href="#A-手動設定の場合" class="headerlink" title="(A) 手動設定の場合"></a>(A) 手動設定の場合</h3><h4 id="DelayLockInterval-の設定"><a href="#DelayLockInterval-の設定" class="headerlink" title="DelayLockInterval の設定"></a>DelayLockInterval の設定</h4><p><strong>GUI での設定箇所:</strong></p><ul><li>[設定] &gt; [アカウント] &gt; [サインイン オプション] &gt; [しばらく操作しなかった場合に、もう一度 Windows へのサインインを求めるタイミング]</li></ul><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_CURRENT_USER\Control Panel\Desktop</span><br><span class="line">値の名前: DelayLockInterval</span><br><span class="line">値の種類: REG_DWORD</span><br><span class="line">値のデータ: 秒数 (例: 0 = 即座にロック) </span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKCU\Control Panel\Desktop&quot;</span> /v DelayLockInterval</span><br></pre></td></tr></table></figure><h4 id="ディスプレイの電源を切る時間の設定"><a href="#ディスプレイの電源を切る時間の設定" class="headerlink" title="ディスプレイの電源を切る時間の設定"></a>ディスプレイの電源を切る時間の設定</h4><p><strong>GUI での設定箇所:</strong></p><ul><li>[設定] &gt; [システム] &gt; [電源とバッテリー] &gt; [画面とスリープ] &gt; [電源接続時に、次の時間が経過した後に画面の電源を切る]</li></ul><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 現在の電源プランの設定を確認</span></span><br><span class="line">powercfg /query SCHEME_CURRENT SUB_VIDEO VIDEOIDLE</span><br></pre></td></tr></table></figure><hr><h3 id="B-グループ-ポリシーの場合"><a href="#B-グループ-ポリシーの場合" class="headerlink" title="(B) グループ ポリシーの場合"></a>(B) グループ ポリシーの場合</h3><h4 id="DelayLockInterval-の設定-1"><a href="#DelayLockInterval-の設定-1" class="headerlink" title="DelayLockInterval の設定"></a>DelayLockInterval の設定</h4><p>DelayLockInterval はグループ ポリシーでは直接制御されません。</p><h4 id="ディスプレイの電源を切る時間の設定-1"><a href="#ディスプレイの電源を切る時間の設定-1" class="headerlink" title="ディスプレイの電源を切る時間の設定"></a>ディスプレイの電源を切る時間の設定</h4><p><strong>グループ ポリシー エディター (gpedit.msc) での設定箇所:</strong></p><ul><li>[コンピューターの構成] &gt; [管理用テンプレート] &gt; [システム] &gt; [電源の管理] &gt; [ビデオとディスプレイの設定]<ul><li>[ディスプレイの電源を切る (電源に接続時)]</li><li>[ディスプレイの電源を切る (バッテリ使用時)]</li></ul></li></ul><p><strong>確認コマンド:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 適用されているポリシーをレポート出力</span></span><br><span class="line">gpresult /<span class="built_in">h</span> gpresult.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 現在の電源プランの設定を確認</span></span><br><span class="line">powercfg /query SCHEME_CURRENT SUB_VIDEO VIDEOIDLE</span><br></pre></td></tr></table></figure><hr><h3 id="C-MDM-ポリシーの場合"><a href="#C-MDM-ポリシーの場合" class="headerlink" title="(C) MDM ポリシーの場合"></a>(C) MDM ポリシーの場合</h3><h4 id="DelayLockInterval-の設定-2"><a href="#DelayLockInterval-の設定-2" class="headerlink" title="DelayLockInterval の設定"></a>DelayLockInterval の設定</h4><p>Intune などの MDM で管理されている場合、以下を確認します。</p><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device\DeviceLock</span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\DeviceLock&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ディスプレイの電源を切る時間の設定-2"><a href="#ディスプレイの電源を切る時間の設定-2" class="headerlink" title="ディスプレイの電源を切る時間の設定"></a>ディスプレイの電源を切る時間の設定</h4><p>MDM では、Power CSP を使用してディスプレイの電源設定を構成できます。</p><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\current\device\Power</span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\PolicyManager\current\device\Power&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 現在の電源プランの設定を確認</span></span><br><span class="line">powercfg /query SCHEME_CURRENT SUB_VIDEO VIDEOIDLE</span><br></pre></td></tr></table></figure><hr><h2 id="3-ScreenSaveTimeOut-スクリーンセーバーが起動する時間"><a href="#3-ScreenSaveTimeOut-スクリーンセーバーが起動する時間" class="headerlink" title="[3] ScreenSaveTimeOut スクリーンセーバーが起動する時間"></a>[3] ScreenSaveTimeOut スクリーンセーバーが起動する時間</h2><p>画面ロックは、スクリーンセーバーの設定と連動して動作します。</p><p><strong>動作:</strong></p><ul><li>スクリーンセーバーが起動する時間で画面がロックされます</li><li>ただし、以下の両方の条件を満たす場合のみ有効です:<ul><li>スクリーンセーバーが有効 (ScreenSaveActive = 1) </li><li>[再開時にログオン画面に戻る] が有効 (ScreenSaverIsSecure = 1) </li></ul></li></ul><hr><h3 id="A-ローカル設定-グループ-ポリシーの場合"><a href="#A-ローカル設定-グループ-ポリシーの場合" class="headerlink" title="(A) ローカル設定 / グループ ポリシーの場合"></a>(A) ローカル設定 / グループ ポリシーの場合</h3><h4 id="手動設定-GUI"><a href="#手動設定-GUI" class="headerlink" title="手動設定 (GUI)"></a>手動設定 (GUI)</h4><p><strong>GUI での設定箇所:</strong></p><ul><li>[設定] &gt; [個人用設定] &gt; [ロック画面] &gt; [スクリーン セーバー]</li><li>または、コントロール パネル &gt; [個人設定] &gt; [スクリーン セーバーの変更]</li></ul><p><strong>レジストリでの確認:</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_CURRENT_USER\Control Panel\Desktop</span><br><span class="line">値の名前: ScreenSaveActive (スクリーンセーバー有効: 1、無効: 0) </span><br><span class="line">値の名前: ScreenSaverIsSecure (再開時にログオン画面に戻る: 1、戻らない: 0) </span><br><span class="line">値の名前: ScreenSaveTimeOut (タイムアウト秒数) </span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKCU\Control Panel\Desktop&quot;</span> /v ScreenSaveActive</span><br><span class="line">reg query <span class="string">&quot;HKCU\Control Panel\Desktop&quot;</span> /v ScreenSaverIsSecure</span><br><span class="line">reg query <span class="string">&quot;HKCU\Control Panel\Desktop&quot;</span> /v ScreenSaveTimeOut</span><br></pre></td></tr></table></figure><h4 id="グループ-ポリシー"><a href="#グループ-ポリシー" class="headerlink" title="グループ ポリシー"></a>グループ ポリシー</h4><p><strong>グループ ポリシー エディター (gpedit.msc) での設定箇所:</strong></p><ul><li>[ユーザーの構成] &gt; [管理用テンプレート] &gt; [コントロール パネル] &gt; [個人設定]<ul><li>[スクリーン セーバーを有効にする]</li><li>[パスワードでスクリーン セーバーを保護する]</li><li>[スクリーン セーバーのタイムアウト]</li></ul></li></ul><p><strong>レジストリでの確認 (ポリシー適用時):</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Control Panel\Desktop</span><br><span class="line">値の名前: ScreenSaveActive</span><br><span class="line">値の名前: ScreenSaverIsSecure</span><br><span class="line">値の名前: ScreenSaveTimeOut</span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ポリシーによる設定</span></span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaveActive</span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaverIsSecure</span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaveTimeOut</span><br><span class="line"></span><br><span class="line"><span class="comment"># 適用されているポリシーをレポート出力</span></span><br><span class="line">gpresult /<span class="built_in">h</span> gpresult.html</span><br></pre></td></tr></table></figure><hr><h3 id="B-MDM-ポリシーの場合"><a href="#B-MDM-ポリシーの場合" class="headerlink" title="(B) MDM ポリシーの場合"></a>(B) MDM ポリシーの場合</h3><p>スクリーンセーバー設定には専用の CSP が存在しないため、MDM (Intune など) でスクリーンセーバーを制御する場合は、ADMX ポリシーを使用してグループ ポリシーと同等の設定を配布します。</p><p><strong>レジストリでの確認:</strong></p><p>ADMX ポリシーで配布された場合、以下のレジストリに設定が反映されます。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー: HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Control Panel\Desktop</span><br><span class="line">値の名前: ScreenSaveActive</span><br><span class="line">値の名前: ScreenSaverIsSecure</span><br><span class="line">値の名前: ScreenSaveTimeOut</span><br></pre></td></tr></table></figure><p><strong>コマンドでの確認:</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ポリシーによる設定を確認</span></span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaveActive</span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaverIsSecure</span><br><span class="line">reg query <span class="string">&quot;HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop&quot;</span> /v ScreenSaveTimeOut</span><br></pre></td></tr></table></figure><blockquote><p><strong>補足:</strong> MDM 経由で ADMX ポリシーを使用してスクリーンセーバー設定を配布している場合、グループ ポリシーと同じレジストリ キーに設定が書き込まれます。そのため、確認方法は (A) のグループ ポリシーの場合と同様です。</p></blockquote><hr><h1 id="【対策】"><a href="#【対策】" class="headerlink" title="【対策】"></a>【対策】</h1><p>意図した時間で画面がロックされるようにするには、以下の手順を実施してください。</p><ol><li><strong>すべての設定を棚卸しする</strong>: 上記の内容を参照いただき、すべての画面ロック関連の設定を確認します</li><li><strong>最も短い時間を特定する</strong>: 複数の設定がある場合、最も短い時間が適用されるため、意図しない設定がないか確認します</li><li><strong>不要な設定を無効化または調整する</strong>: 意図しない設定がある場合は、その設定を無効化するか、適切な値に変更します</li></ol><hr><h1 id="【まとめ】"><a href="#【まとめ】" class="headerlink" title="【まとめ】"></a>【まとめ】</h1><p>Windows には、画面をロックするための複数のタイムアウト設定が存在します。これらの設定は、ユーザー設定、グループポリシー、MDM ポリシーなど、さまざまな方法で構成できます。</p><ol><li>非アクティブ時間の上限 (InactivityTimeoutSecs / MaxInactivityTimeDeviceLock)</li><li>DelayLockInterval (ディスプレイ電源オフ後のロック) </li><li>ScreenSaveTimeOut スクリーンセーバーが起動する時間</li></ol><p><strong>複数の設定が存在する場合、最も短い時間が適用されます。</strong> 予期せず画面がロックされる場合は、すべての設定を確認し、意図しない設定がないかご確認ください。</p><hr><h1 id="【更新履歴】"><a href="#【更新履歴】" class="headerlink" title="【更新履歴】"></a>【更新履歴】</h1><ul><li>2026/01/07 初版公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Windows Commercial Support チームの丸山です。&lt;/p&gt;
&lt;p&gt;本日は、グループ ポリシーなどで画面がロックされるまでの時間を設定しているが、予定よりも早い</summary>
      
    
    
    
    <category term="Shell" scheme="https://jpwinsup.github.io/blog/categories/Shell/"/>
    
    
  </entry>
  
  <entry>
    <title>Microsoft Connected Cache の展開時における注意点とベストプラクティス</title>
    <link href="https://jpwinsup.github.io/blog/2025/12/28/MicrosoftConnectedCache/microsoft-connected-cache-best-practices/"/>
    <id>https://jpwinsup.github.io/blog/2025/12/28/MicrosoftConnectedCache/microsoft-connected-cache-best-practices/</id>
    <published>2025-12-28T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.391Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事はマイクロソフト社員によって公開されております。 </p><p>みなさま、こんにちは。Windows Commercial Support: Performance チームの鈴木です。最近、Microsoft Connected Cache for Enterprise and Education (以下 MCC) に関するお問い合わせを頂戴する機会が増えてきております。</p><p>MCC は、更新プログラムの取得に要する WAN 帯域をローカル キャッシュにより軽減するソリューションです。「キャッシュ ノード」と呼ばれるサーバーをネットワーク内に構築いただくことにより、クライアントが取得した更新プログラムのパッケージを保持し組織内でのダウンロードに再利用することが可能です。</p><p>Microsoft Store アプリを業務利用されるユースケースの増加や、WSUS の開発が終了したことなどを背景として MCC をご検討いただいておりますが、2025 年夏に一般提供を迎えた比較的新しいサービスという点もあり情報が少ないとお感じのお客様も多いかと存じます。これまでのお問い合わせ事例等より “勘所” をご紹介いたしますので、お役立ていただけましたら幸いです。</p><h2 id="クライアントとキャッシュ-ノードそれぞれにインターネット接続が必要です"><a href="#クライアントとキャッシュ-ノードそれぞれにインターネット接続が必要です" class="headerlink" title="クライアントとキャッシュ ノードそれぞれにインターネット接続が必要です"></a>クライアントとキャッシュ ノードそれぞれにインターネット接続が必要です</h2><p>最も誤解されやすい点ですが、MCC のキャッシュ ノードおよび MCC から更新プログラムをダウンロードするクライアントには双方インターネット接続が必要です。いわゆる完全な閉域網でご利用いただくことはできません。</p><p>クライアントが更新プログラムを取得する際の最初のアクセス先はキャッシュ ノードではなく、当社クラウド サービス (Delivery Optimization) となります。更新プログラムを構成するパッケージ本体はキャッシュ ノードから取得するため WAN 帯域の大幅な削減が達成されますが、インターネットへの接続を全く行わないよう構成することはできません。</p><p>完全に閉域の環境では、クライアントのみではなく WSUS も多段構成とする手法が取られておりましたが、キャッシュ ノードの多段構成は構築いただけません。直接のインターネット接続が必要である点にご留意ください。</p><h2 id="中央集権的に大規模なキャッシュ-ノードを構築するよりも、拠点やネットワーク-セグメントごとに分散した展開をお勧めします"><a href="#中央集権的に大規模なキャッシュ-ノードを構築するよりも、拠点やネットワーク-セグメントごとに分散した展開をお勧めします" class="headerlink" title="中央集権的に大規模なキャッシュ ノードを構築するよりも、拠点やネットワーク セグメントごとに分散した展開をお勧めします"></a>中央集権的に大規模なキャッシュ ノードを構築するよりも、拠点やネットワーク セグメントごとに分散した展開をお勧めします</h2><p>可能な限り、キャッシュ ノードはクライアントと同じネットワーク セグメントに配置することを推奨しております。サブネットを超える構成ももちろんサポートされておりますが、ルーター等ネットワーク機器への負荷や、キャッシュのヒット率といった観点からベスト プラクティスではございません。</p><p>大規模な WSUS を問題なく運用されていた環境においても、WSUS ではキャッシュできなかった Microsoft 365 Apps や Microsoft Store アプリの更新が不定期に取得されることで WSUS よりも圧倒的に多くのトラフィックが転送され、ネットワークが過負荷となる事例が報告されております。なお、WSUS では使用可能であった BranchCache によるトラフィック削減手法も MCC ではご利用いただけません。</p><p>Windows Server のライセンスが必要であった WSUS と異なり、MCC のキャッシュ ノードはWindows クライアントや Ubuntu への展開も可能です。キャッシュ ノードの作成にライセンス コストは不要ですので、拠点やネットワーク セグメントごとに分散した配置をご検討ください。</p><p>なお、ネットワーク的に最も近いキャッシュ ノードから更新プログラムをダウンロードするため、キャッシュ ノードを分散配置した際は DHCP オプション 235 を使用してキャッシュ ノードのホスト名 / IP アドレスをクライアントに伝えることをお勧めします。グループ ポリシーによる指定よりも機動的に運用いただくことが可能かと存じます。</p><h2 id="大規模展開の場合は特に、Linux-への展開をご検討ください"><a href="#大規模展開の場合は特に、Linux-への展開をご検討ください" class="headerlink" title="大規模展開の場合は特に、Linux への展開をご検討ください"></a>大規模展開の場合は特に、Linux への展開をご検討ください</h2><p>Windows クライアントおよび Windows Server を MCC のキャッシュ ノードとして構築することは可能ですが、キャッシュ ノードを実現するソフトウェア群は Linux コンテナーとして実装されております。Windows ネイティブのソフトウェア スタックのご用意はございません。</p><p>Windows に構築いただく場合はまず WSL 2 (Windows Subsystem for Linux) 上に Ubuntu がインストールされ、その上で Docker (Azure IoT Edge) コンテナーとしてキャッシュ ノード ソフトウェアが実行されております。 </p><p>このような背景から、主にストレージやネットワークの部分で Windows 版のほうが複雑な構成となっております。</p><p>特に、多数のクライアントを収容する大規模展開の場合はキャッシュを保持するストレージも大きな領域を割り当てる必要が生じますが、Linux 版では Linux ファイル システムを直接利用し、複数のパス (ディスク) を指定できる一方、Windows 版は “/var/mcc” としてマウントされる容量固定かつ単一の VHD (仮想ハードディスク) 以外に変更することができません。</p><p>また、若干ではございますが WSL 2 のオーバーヘッドも存在するため、構成の柔軟性やシンプルさ、性能面で Linux への展開にアドバンテージがある一方でデメリットはございません。特に大規模なキャッシュ ノードの構築においては、Linux を強く推奨いたします。</p><h2 id="インストールに用いるアカウントと、キャッシュ-ノード-ソフトウェアの実行に用いるアカウントは必ず別にしていただく必要があります-Windows-のみ"><a href="#インストールに用いるアカウントと、キャッシュ-ノード-ソフトウェアの実行に用いるアカウントは必ず別にしていただく必要があります-Windows-のみ" class="headerlink" title="インストールに用いるアカウントと、キャッシュ ノード ソフトウェアの実行に用いるアカウントは必ず別にしていただく必要があります (Windows のみ)"></a>インストールに用いるアカウントと、キャッシュ ノード ソフトウェアの実行に用いるアカウントは必ず別にしていただく必要があります (Windows のみ)</h2><p>キャッシュ ノードを Windows 上に展開される場合、セットアップに使用するアカウントと、キャッシュ ノードとしての機能を実行するアカウント (ランタイム アカウント) は必ず別なアカウントを指定する必要がございます。</p><p>同一のアカウントを指定した場合、一連のセットアップ プロセスの最後で WSL 2 上に作成されたキャッシュ ノードのコンテナーが削除されてしまい、以降正しく動作しなくなることを確認しております。公開技術情報に記載の手順にも別のアカウントを指定するよう注記がございますので、ご確認ください。</p><p>Microsoft Connected Cache ソフトウェアを Windows ホスト コンピューターに展開する | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-deploy-to-windows?tabs=portal#steps-to-deploy-connected-cache-node-to-windows">https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-deploy-to-windows?tabs=portal#steps-to-deploy-connected-cache-node-to-windows</a></p><p>なお、デプロイ スクリプトを実行してセットアップを行うアカウントは管理者権限を有している必要がありますが、ランタイム アカウントには管理者権限は不要です。セキュリティの観点から、必要最小限の権限を持たせることをお勧めしております。可能であれば、gMSA (グループ管理サービス アカウント) をランタイム アカウントとして使用することをお勧めいたします。</p><h2 id="MCC-からキャッシュの提供を受けるクライアントには、Windows-Enterprise-サブスクリプション-ライセンスが必要です"><a href="#MCC-からキャッシュの提供を受けるクライアントには、Windows-Enterprise-サブスクリプション-ライセンスが必要です" class="headerlink" title="MCC からキャッシュの提供を受けるクライアントには、Windows Enterprise サブスクリプション ライセンスが必要です"></a>MCC からキャッシュの提供を受けるクライアントには、Windows Enterprise サブスクリプション ライセンスが必要です</h2><p>前述の通り、キャッシュ ノードの構築は Windows クライアントや Ubuntu に対しても可能であり、WSUS と異なり Windows Server をご用意いただく必要はありません。サーバー側にライセンスは不要ですが、MCC を利用するクライアント側には下記ライセンスの要件が存在します。</p><ul><li>Windows Enterprise E3</li><li>Windows Enterprise E5</li><li>Windows Education E3</li><li>Windows Education E5</li></ul><p>また、Windows Server 2019 以降も MCC のキャッシュ ノード経由で品質更新プログラムを受け取ることが可能です。上記のサブスクリプション ライセンスは Microsoft Entra ID に対し付与する必要があり Windows Server ではご使用いただくことができませんが、正しくライセンスされたクライアントをお持ちであれば Windows Server をキャッシュ ノードに接続いただいて問題ございません。 </p><p>ライセンスを含む各種要件について記載されている公開技術情報も下記にご用意がございますので併せてご参照ください。</p><p>Microsoft Connected Cache for Enterprise and Education の前提条件 | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-prerequisites#licensing-requirements">https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-prerequisites#licensing-requirements</a></p><p>なお、キャッシュ ノードの展開には Azure のサブスクリプションが必要ですが、MCC に関連するリソースでの課金は発生いたしませんのでご安心ください。</p><h2 id="Teams-の更新を-MCC-経由にするには、クライアントとキャッシュ-ノード間の接続を-TLS-にする必要があります"><a href="#Teams-の更新を-MCC-経由にするには、クライアントとキャッシュ-ノード間の接続を-TLS-にする必要があります" class="headerlink" title="Teams の更新を MCC 経由にするには、クライアントとキャッシュ ノード間の接続を TLS にする必要があります"></a>Teams の更新を MCC 経由にするには、クライアントとキャッシュ ノード間の接続を TLS にする必要があります</h2><p>MCC は、Microsoft Teams の更新に係るトラフィックにお悩みのお客様にも積極的にご検討いただいております。Teams は Windows 等と比較しても更新間隔が短い一方、WSUS 等を用いた帯域削減の手段が提供されてこなかった経緯があります。MCC であれば Teams の更新をキャッシュすることが可能であり、各クライアントからのトラフィックを削減することが可能です。MCC がキャッシュできる更新プログラムの種類は、下記の公開技術情報もご確認ください。</p><p>配信の最適化とは | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/do/waas-delivery-optimization#types-of-download-content-supported-by-delivery-optimization">https://learn.microsoft.com/ja-jp/windows/deployment/do/waas-delivery-optimization#types-of-download-content-supported-by-delivery-optimization</a></p><p>ただし、Teams の更新を MCC 経由で取得する要件として、クライアントとキャッシュ ノード間の接続を TLS (HTTPS) に対応させる必要があります。Windows や Microsoft 365 Apps の更新をキャッシュする場合は TLS 対応は必要ありませんが、Teams の更新コンテンツの配信においては TLS 接続が必須です。証明書の用意など、通常の MCC の構築に加え追加の手順が存在いたします点にご留意ください。</p><p>Microsoft 接続キャッシュの HTTPS サポートの概要 | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-https-overview?tabs=portal">https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-https-overview?tabs=portal</a></p><p>また、今後 Intune の Win32 アプリ (.intunewin パッケージ) のキャッシュにおいても TLS が必須化される予定となっております。Windows Autopilot でサイズの大きなアプリを展開する場合の高速化等を目的として MCC をご使用のお客様におかれましては、お持ちのキャッシュ ノードの段階的な TLS 対応をご検討ください。 </p><h2 id="キャッシュ-ノードは静的プロキシのみをサポートしており、PAC-や-WPAD、クラウド-プロキシのような動的構成はご利用いただけません"><a href="#キャッシュ-ノードは静的プロキシのみをサポートしており、PAC-や-WPAD、クラウド-プロキシのような動的構成はご利用いただけません" class="headerlink" title="キャッシュ ノードは静的プロキシのみをサポートしており、PAC や WPAD、クラウド プロキシのような動的構成はご利用いただけません"></a>キャッシュ ノードは静的プロキシのみをサポートしており、PAC や WPAD、クラウド プロキシのような動的構成はご利用いただけません</h2><p>キャッシュ ノードはなるべくサブネットを超えない範囲に配置することをお勧めしており、またライセンス要件も WSUS や Configuration Manager と比較し緩和されていることから、通常の業務用クライアントを利用してキャッシュ ノードを構築されるお客様のお話も多く伺っております。このような場合に問題となりがちなのが、キャッシュ ノードから Windows Update サイトおよび Delivery Optimization クラウド サービスへの接続経路です。</p><p>下記公開技術情報にも記載の通り、キャッシュ ノードから当社 Windows Update  関連のエンドポイントまでは直接接続をご用意いただく必要がございます。</p><p>Microsoft Connected Cache ソフトウェアを Windows ホスト コンピューターに展開する | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-deploy-to-windows">https://learn.microsoft.com/ja-jp/windows/deployment/do/mcc-ent-deploy-to-windows</a></p><p>接続キャッシュのデプロイを成功させるには、接続キャッシュ ホスト マシンからの配信最適化サービスへの直接呼び出しを許可する必要があります。</p><p>プロキシの使用自体はサポートされておりますが、実績としてあまり成功例は多くありません。キャッシュ ノードの正常な動作においては、オリジナルの URL や HTTP ヘッダが維持される必要があり、プロキシを介すことでこれらが書き換えられてしまうことが主な失敗の要因です。</p><p>また、前述の通り、キャッシュ ノード自体はホストから独立した Linux コンテナー内で動作しております。そのため、ホスト OS に設定されているプロキシ設定を利用することができません。やむを得ずプロキシを使用する際は、キャッシュ ノードのセットアップ時に実行するスクリプトにて “-proxyurl” を指定します。ここではプロキシ サーバーの URL を静的に指定することのみがサポートされており、PAC や WPAD を経由してキャッシュ ノードがインターネットにアクセスする構成はサポートされておりません。</p><p>同様に、クライアント ソフトウェアを使用するクラウド プロキシ等もコンテナー内に当該ソフトウェアをインストールすることができないため、ご利用いただけません。</p><p>お手数をおかけいたしますが、キャッシュ ノードを構成するコンピューターに対してはプロキシのバイパス等をご検討ください。キャッシュ ノードに接続するクライアントも Windows Update および Delivery Optimization 関連のエンドポイントへの接続が必要ですので、これまで WSUS をご利用であった環境等で URL のフィルタリングを行っている場合などはクライアント側のインターネット接続についても見直しが必要です。</p><p>本情報が少しでも皆様のお役に立てば幸いです。</p><p>※本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025-12-29 初版公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事はマイクロソフト社員によって公開されております。 &lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Windows Commercial Support: Performance チームの鈴木です。最近、Microsoft Connected Cache for Enterpr</summary>
      
    
    
    
    <category term="Microsoft Connected Cache" scheme="https://jpwinsup.github.io/blog/categories/Microsoft-Connected-Cache/"/>
    
    
  </entry>
  
  <entry>
    <title>ファイルサーバーの共有フォルダーからファイルをコピーすると MOTW のタグが付与される</title>
    <link href="https://jpwinsup.github.io/blog/2025/12/18/UserInterfaceAndApps/motw-on-network-share/"/>
    <id>https://jpwinsup.github.io/blog/2025/12/18/UserInterfaceAndApps/motw-on-network-share/</id>
    <published>2025-12-18T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.955Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは、Windows サポートの丸山です。</p><p>2024 年 6 月のセキュリティ更新プログラムを適用後、共有ファイル サーバーから取得したファイルを実行しようとすると、[セキュリティの警告] が表示され、ブロックされる事象が報告されています。本記事では、この動作の背景と回避策について解説します。</p><h1 id="■-Symptom"><a href="#■-Symptom" class="headerlink" title="■ Symptom"></a>■ Symptom</h1><p>ネットワーク内に設置された共有ファイル サーバーから、実行ファイルやスクリプトなどをダブルクリックして実行する場合や、ローカルにコピーして実行しようとすると、[セキュリティの警告] が表示され、実行できないことがある。</p><p><img src="./security-warning.png" alt="図：セキュリティの警告の例"></p><h1 id="■-Cause"><a href="#■-Cause" class="headerlink" title="■ Cause"></a>■ Cause</h1><p>この動作は、2024 年 6 月 15 日に公開されたセキュリティ更新プログラム適用後の環境における想定動作です。</p><p>2024 年 6 月 15 日 — KB5039239 (OS ビルド 26100.863)<br><a href="https://support.microsoft.com/ja-jp/topic/863c855f-b154-4991-b0dd-f2fc0b7bfe0b">https://support.microsoft.com/ja-jp/topic/863c855f-b154-4991-b0dd-f2fc0b7bfe0b</a></p><blockquote><blockquote><blockquote></blockquote><p>更新内容の抜粋 :<br>この更新プログラム以降、エクスプローラーは Web のマーク (MoTW) タグを、信頼されていない場所から取得したファイルとフォルダーに追加します。 MapUrlToZone がファイルを “インターネット” として分類すると、そのファイルもこのタグを取得します。 この変更により、”LastWriteTime” タイム スタンプが更新されます。 これは、ファイル コピー操作に依存する一部のシナリオに影響する可能性があります。</p><blockquote></blockquote></blockquote></blockquote><p>上記動作により、ファイル サーバーの共有フォルダーが 「ローカル イントラネット」 ゾーンに該当しないと判断された場合、コピーされたファイルに MoTW が付与され、実行時に [セキュリティの警告] が表示されるようになります。</p><h1 id="■-Resolution"><a href="#■-Resolution" class="headerlink" title="■ Resolution"></a>■ Resolution</h1><p>この動作を回避するには、以下のいずれかの方法をご検討ください。</p><h2 id="方法-1-ファイルサーバーをイントラネットゾーンに分類する-推奨"><a href="#方法-1-ファイルサーバーをイントラネットゾーンに分類する-推奨" class="headerlink" title="方法 1: ファイルサーバーをイントラネットゾーンに分類する (推奨)"></a>方法 1: ファイルサーバーをイントラネットゾーンに分類する (推奨)</h2><p>ファイルサーバーの共有フォルダーが [ローカル イントラネット] ゾーンとして認識されるよう、インターネット オプションにてゾーンの構成を行ってください。</p><p>参考情報 : IE のセキュリティ ゾーンについて<br><a href="https://microsoft.github.io/jpbrowsers/internet-explorer-microsoft-edge/IE-SecurityZones/">https://microsoft.github.io/jpbrowsers/internet-explorer-microsoft-edge/IE-SecurityZones/</a></p><h2 id="方法-2-グループポリシーの設定"><a href="#方法-2-グループポリシーの設定" class="headerlink" title="方法 2: グループポリシーの設定"></a>方法 2: グループポリシーの設定</h2><p>グループ ポリシーを利用している環境では、以下のポリシーを有効にすることで、信頼されていない場所からコピーされたファイルに MoTW を付与しないようにできます。</p><blockquote><blockquote><blockquote></blockquote><p>ポリシーの場所 :<br>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [エクスプローラー] - [Do not apply the Mark of the Web tag to files copied from insecure sources]</p><blockquote></blockquote></blockquote></blockquote><p>⚠️ 注意: 本ポリシーを設定すると、信頼されていない場所にあるファイルに MoTW が付与されませんので、Windows のセキュリティ機能の一部が無効化されます。</p><h2 id="方法-3-MDM-ポリシーの利用"><a href="#方法-3-MDM-ポリシーの利用" class="headerlink" title="方法 3: MDM ポリシーの利用"></a>方法 3: MDM ポリシーの利用</h2><p>MDM を利用している環境では、グループ ポリシーの代わりに Policy CSP 経由にて、下記 ADMX_WindowsExplorer 配下にある DisableMotWOnInsecurePathCopy のポリシーを配布することで、信頼されていない場所からコピーされたファイルに MoTW を付与しないようにできます。</p><p>ADMX_WindowsExplorer ポリシー CSP | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-admx-windowsexplorer">https://learn.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-admx-windowsexplorer</a></p><p>⚠️ 注意: 本ポリシーを設定すると、信頼されていない場所にあるファイルに MoTW が付与されませんので、Windows のセキュリティ機能の一部が無効化されます。</p><h1 id="■-Related-Information"><a href="#■-Related-Information" class="headerlink" title="■ Related Information"></a>■ Related Information</h1><p>インターネット ショートカットのアイコンが白抜きになる事象について<br><a href="https://jpwinsup.github.io/blog/2023/11/09/UserInterfaceAndApps/does-not-load-when-icon-is-on-a-network-shared-folder/">https://jpwinsup.github.io/blog/2023/11/09/UserInterfaceAndApps/does-not-load-when-icon-is-on-a-network-shared-folder/</a></p><p>ショートカット ファイルのアイコンが白抜きになる事象について<br><a href="https://jpwinsup.github.io/blog/2024/08/15/UserInterfaceAndApps/does-not-load-when-icon-is-on-a-network-shared-folder-lnk/">https://jpwinsup.github.io/blog/2024/08/15/UserInterfaceAndApps/does-not-load-when-icon-is-on-a-network-shared-folder-lnk/</a></p><p>ネットワークドライブ使用時に「セキュリティの警告」が表示される現象<br><a href="https://jpwinsup.github.io/blog/2024/11/26/Shell/Explorer/Security_Warning/">https://jpwinsup.github.io/blog/2024/11/26/Shell/Explorer/Security_Warning/</a></p><h1 id="■-更新履歴"><a href="#■-更新履歴" class="headerlink" title="■ 更新履歴"></a>■ 更新履歴</h1><ul><li>2025 年 12 月 19 日：本記事を新規公開しました。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポートの丸山です。&lt;/p&gt;
&lt;p&gt;2024 年 6 月のセキュリティ更新プログラムを適用後、共有ファイル サーバーから取得したファイルを実行しようとすると、[セキュリティの警</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows Server 2022 の日本語化</title>
    <link href="https://jpwinsup.github.io/blog/2025/12/14/Performance/LangPack/WindowsServerJapanize/"/>
    <id>https://jpwinsup.github.io/blog/2025/12/14/Performance/LangPack/WindowsServerJapanize/</id>
    <published>2025-12-14T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.445Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。</p></blockquote><p>こんにちは、Windows Commercial Support Performance チームです。</p><p>本 Blog では Azure VM の Windows Server 2022 の日本語化を行う際のベストプラクティスとして、オンラインおよびオフラインでのインストール方法をご紹介します。</p><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Azure では、Windows の日本語イメージを提供しておらず、Windows Server 2022 以前では、WSUS 経由での言語パックインストールをサポートしていません。<br>そのため、日本語化にはインターネット上の Windows Update への通信が必要となります。<br>インターネットへの接続が得られずオフラインで言語パックをインストールする場合は、ボリューム ライセンスなどのチャネルを通じて言語パックの ISO メディアを入手することが必要となります。</p><p>日本語対応の Windows 仮想マシンをデプロイする計画がある場合は、日本語化を完了した仮想マシンのイメージを保存しておくことをお勧めします。</p><h2 id="対象-OS-バージョン"><a href="#対象-OS-バージョン" class="headerlink" title="対象 OS バージョン"></a>対象 OS バージョン</h2><p>本記事で対象とする OS バージョンは以下の通りとなります。</p><ul><li>Windows Server 2022 以前<!-- * Windows 10 Enterprise LTSC 2021, LTSC 2019, LTSB 2016 --></li></ul><p>Windows Server 2025 および Windows 11 Version 22H2 以降のバージョンについては、 Install-Language コマンドを使用した手順に関する以下の記事をご覧ください。<br>本 Blog で紹介するバージョンについても、言語パックのインストール後の流れは同様となります。<br><a href="https://jpwinsup.github.io/blog/2025/06/30/UserInterfaceAndApps/LanguageSupport_IME/japanese_localization_of_azure_vm/">Azure VM の日本語化</a></p><h2 id="日本語化の流れ"><a href="#日本語化の流れ" class="headerlink" title="日本語化の流れ"></a>日本語化の流れ</h2><p>組織のポリシー設定やセキュリティ製品、ネットワーク構成などに由来して日本語化に必要なリソースの取得に失敗する場合がありますので、そのような構成を行う前の、デプロイ直後のタイミングで、以下の流れにて日本語化を行います。</p><p>いずれの場合にも、インストール後には更新プログラムを適用してください。特にオフラインでのインストール時には、下記 Blog で述べられている不具合が起こる可能性が高くなるため、速やかに適用するようお願いします。</p><p>(参考) <a href="https://jpwinsup.github.io/blog/2022/06/22/UserInterfaceAndApps/LanguageSupport_IME/lp-consideration/">言語パックインストール時のご留意点</a></p><h3 id="オンラインでインストールが可能な場合"><a href="#オンラインでインストールが可能な場合" class="headerlink" title="オンラインでインストールが可能な場合"></a>オンラインでインストールが可能な場合</h3><ol><li>Settings &gt; Time &amp; language &gt; Language &amp; region に移動し、 [Add a language] をクリックします。<!-- Windows 10 Enterprise LTSB 2016 の場合は [Region & language] となります。--></li></ol><p><img src="Add-a-language.png"></p><ol start="2"><li>Choose a language to install 画面では、日本語を選択して [Next] をクリックします。</li></ol><p><img src="select.png"></p><ol start="3"><li>Install language features では、　[Language pack] にチェックを入れ、[Install] をクリックします。</li></ol><p><img src="InstallLanguageFeatures.png"></p><ol start="4"><li>インストールの完了を待ちます。</li></ol><p><img src="downloading.png"></p><ol start="5"><li>[Japanese] の [Options] から、インストール状況が確認できます。</li></ol><p><img src="options.png"></p><p>　[Install language features] の画面で選択できなかった機能がこちらから選択できる場合がありますので、確認してみてください。</p><ol start="6"><li>インストールが完了したら、前述の通り更新プログラムを適用しサインアウトすると、[Preferred languages] から日本語表示が可能となります。</li></ol><p><img src="SelectLanguage.png"></p><h3 id="オンラインでインストールできない場合"><a href="#オンラインでインストールできない場合" class="headerlink" title="オンラインでインストールできない場合"></a>オンラインでインストールできない場合</h3><p>Windows Update への通信ができない場合、オフラインでのインストールとなります。<br>オフライン インストール用のパッケージが収録されたメディアをダウンロードする必要があります。ご利用にはボリューム ライセンスなどの言語パックの ISO メディアにアクセスできる契約が必要です。<br>お客様のライセンス管理担当者にお問い合わせください。</p><ol><li><p>下記リンクを参考に、ご契約に基づきメディアをダウンロードしてください。<br>Windows Server 2022 向けには、 ”Languages and Optional Features for Windows Server 2022” が必要となります。</p><p><a href="https://learn.microsoft.com/ja-jp/microsoft-365/commerce/licenses/download-vl-products?view=o365-worldwide&viewFallbackFrom=o365-wo%25E2%2580%25A6">ボリューム ライセンス製品をダウンロードする</a></p></li></ol><ol start="2"><li><p>ダウンロードした iso ファイルを対象の仮想マシンにマウントします。</p></li><li><p>スタート メニューを右クリックし、[Run] を選択します。続いて “lpksetup.exe” と入力します。</p></li></ol><p><img src="lpksetup.png"></p><ol start="4"><li>[Install display languages] をクリックし、続く画面で [Browse] から、手順 2. でマウントして作成されたドライブを選択します。</li></ol><p><img src="lpksetupInstall.png"></p><p><img src="BrowseLangPack.png"></p><ol start="5"><li>[Microsoft-Windows-Server-Language-Pack_x64_ja-jp] を選択し、[OK] をクリックします。</li></ol><p><img src="LangPack.png"></p><ol start="6"><li>さらに [Japanese (日本語)] が選択されていることを確認し、[Next] をクリックします。</li></ol><p><img src="SelectDisplayLang.png"></p><ol start="7"><li>ライセンス条項を読み、同意できれば [I accept the license terms.] にチェックを入れ [Next] をクリックします。インストールが始まります。</li></ol><p><img src="terms.png"></p><p><img src="installing.png"></p><ol start="7"><li>[Completed] と表示されたら [Close] をクリックし閉じます。</li></ol><p><img src="completed.png"></p><ol start="8"><li>オフラインでの言語パックインストール後は<strong>速やかに更新プログラムの適用を実施します。</strong></li></ol><h3 id="WSUS-環境下でのオンライン言語パック取得"><a href="#WSUS-環境下でのオンライン言語パック取得" class="headerlink" title="WSUS 環境下でのオンライン言語パック取得"></a>WSUS 環境下でのオンライン言語パック取得</h3><p>Windows Server 2022 以前では、WSUS 経由での言語パックインストールをサポートしていません。<br>そのため、日本語化を完了したい場合には、インターネット上の Windows Update への通信を許可するか、オフラインでインストールすることが必要となります。</p><p>インターネット上の Windows Update への通信を許可する場合、下記 Blog の「WSUS / MECM の利用時に、言語追加を可能とするグループ ポリシー」の項を参考に、関連 GPO を構成・適用したうえで本 Blog の「オンラインでインストールできない場合」の節をお試しください。</p><p><a href="https://jpwinsup.github.io/blog/2022/05/10/UserInterfaceAndApps/LanguageSupport_IME/FU-LanguagePack/">機能アップデート時の多言語対応について</a></p><p>いかがでしたでしょうか。本記事の情報が少しでも皆様のお役に立てば幸いです。</p><p>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p><hr><p>更新履歴<br>2025/12/15  本 Blog の公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows Commercial Support Performance チームです。&lt;/p&gt;
&lt;p&gt;本 Blog では Azure </summary>
      
    
    
    
    <category term="User Interface and Apps - Language support" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps-Language-support/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows ライセンス認証における電話認証手順の変更について</title>
    <link href="https://jpwinsup.github.io/blog/2025/12/11/Activation/PhoneActivation-changed/"/>
    <id>https://jpwinsup.github.io/blog/2025/12/11/Activation/PhoneActivation-changed/</id>
    <published>2025-12-11T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.302Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事はマイクロソフト社員によって公開されております。</p><p>みなさま、こんにちは。Windows Commercial Support Device and Deployment チームの岩岡です。<br>先日、ライセンス認証における電話認証の手順に変更があり、スマートフォンなどインターネット接続のあるデバイス経由で、ライセンス認証に必要な確認 ID を取得する方式となりました。</p><p>今回の変更については、弊社の公開情報としても下記の通りリリースされておりますので、併せてご確認いただけますと幸いです。</p><p>原文: <a href="https://support.microsoft.com/en-us/windows/activate-microsoft-perpetual-products-using-the-product-activation-portal-64fdc7f5-ce38-42a9-aea8-393020149983">Activate Microsoft perpetual products using the Product Activation portal</a><br><a href="https://support.microsoft.com/ja-jp/windows/%E8%A3%BD%E5%93%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E8%AA%8D%E8%A8%BC%E3%83%9D%E3%83%BC%E3%82%BF%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6-microsoft-%E6%B0%B8%E4%B9%85%E8%A3%BD%E5%93%81%E3%82%92%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E5%8C%96%E3%81%99%E3%82%8B-64fdc7f5-ce38-42a9-aea8-393020149983">(自動翻訳サイト)</a></p><p>新しい認証手順について多くのお問い合わせをいただいておりますので、本ブログでは、電話認証に代わる新しいライセンス認証手順と、よくいただくご質問事例をいくつかご紹介いたします。</p><p>なお、認証手順については今後さらに変更される可能性がございますため、本記事の内容は公開日時点の情報となる点にご留意ください。<br>また、手順が変更された際には、本ブログの情報が更新または削除される場合がございますので、何卒ご了承ください。</p><p>-補足<br>ご利用の環境がインターネットに接続している場合は、本記事で言及している電話認証の手順変更による影響はございません。<br>電話認証は、インターネット接続できない環境において製品をライセンス認証させるための手段としてご用意しておりました。</p><h1 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h1><h2 id="認証手順について"><a href="#認証手順について" class="headerlink" title="認証手順について"></a>認証手順について</h2><p>-<a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">事前準備</a><br>-<a href="#%E8%AA%8D%E8%A8%BC%E6%89%8B%E9%A0%86">認証手順</a></p><h2 id="よくある質問について"><a href="#よくある質問について" class="headerlink" title="よくある質問について"></a>よくある質問について</h2><p>-<a href="#%E5%BE%93%E6%9D%A5%E3%81%AE%E9%9B%BB%E8%A9%B1%E8%AA%8D%E8%A8%BC%E6%89%8B%E9%A0%86%E3%81%A8%E5%90%8C%E6%A7%98%E3%81%AB%E8%87%AA%E5%8B%95%E9%9F%B3%E5%A3%B0%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6%E8%AA%8D%E8%A8%BC%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">従来の電話認証手順と同様に自動音声を利用して認証することができますか？</a><br>-<a href="#Microsoft-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%82%E3%81%97%E3%81%8F%E3%81%AF-Microsoft-Entra-ID-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%A7%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%AF%E5%BF%85%E9%A0%88%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">Microsoft アカウントもしくは Microsoft Entra ID アカウントでのサインインは必須ですか？</a><br>-<a href="#%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%97%E3%81%9F%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E6%83%85%E5%A0%B1%E3%81%AF%E7%B4%90%E3%81%A5%E3%81%91%E3%82%89%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">サインインしたアカウントに対してライセンス情報は紐づけられますか？</a></p><hr><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><ol><li><p>認証対象の端末にてコマンド プロンプトを管理者として実行します。</p></li><li><p>以下のコマンドを実行して、プロダクト キーをインストールします。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk &lt;プロダクト キー&gt;</span><br><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure><ol start="3"><li>続けて以下のコマンドを実行して OS のインストール ID を確認します。確認したインストール ID はこの後の項番 12 で利用いたします。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;dti</span><br></pre></td></tr></table></figure><h2 id="認証手順"><a href="#認証手順" class="headerlink" title="認証手順"></a>認証手順</h2><ol start="4"><li><p>インターネットに接続可能な任意の環境 (スマートフォンでも可能) にてライセンス認証用サイト(<a href="https://aka.ms/aoh">https://aka.ms/aoh</a>) にアクセスします。</p></li><li><p>Microsoft 製品 ライセンス認証ポータルへようこそ！画面が表示されましたら [さぁ、始めましょう] のボタンをクリックして進みます。<br><img src="./Items1.png"></p></li><li><p>セキュリティの検証画面が表示されますので [スタート] をクリックします。<br><img src="./Items2.png"></p></li></ol><ol start="7"><li>画面の指示に従い、右側画面の矢印キーで列車を指定のアイコンまで移動させて [送信] をクリックします。<br><img src="./Items3.png"></li></ol><ol start="8"><li><p>サインイン画面が表示されますので、任意の MSA アカウントや Microsoft Entra ID アカウントでサインインください。<br>※ライセンスとアカウントの紐づけは行われません。セキュリティ観点でサインインが必須となっておりますが、任意のアカウントをご使用いただければ問題ございません。<br><img src="./Items4.png"></p></li><li><p>サインイン完了後 [Microsoft 製品ライセンス認証] 画面が表示されますので、[Microsoft 製品のライセンス認証を行う] を選択します。<br><img src="./Items5.png"></p></li><li><p>[どの製品をライセンス認証しようとしていますか？] の画面で対象の製品 ([Windows] もしくは [Windows Server]) を選択します。<br><img src="./Items6.png"></p></li></ol><ol start="11"><li>次の画面で OS バージョンを選択します (下記画像は [Windows] を選択した際の例)。<br><img src="./Items7.png"></li></ol><ol start="12"><li>インストール ID 入力画面が表示されましたら、”事前準備” の項番 3 で確認したインストール ID を入力し [送信] を押します。<br><img src="./Items8.png"></li></ol><ol start="13"><li><p>確認 ID が表示されますので、ID をメモします。<br><img src="./Items16.png"></p></li><li><p>入手した確認 ID を利用して認証対象の端末で以下のコマンドを実施し確認 ID を端末に登録します。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;atp &lt;確認 ID&gt;</span><br><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;atp xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p>上記コマンドが正しく実行されると、確認 ID が正常に登録された旨のメッセージが表示されます。</p><ol start="15"><li>念のため、以下のコマンドを実行してライセンス認証の状態が “ライセンスされています” と表示されていることをご確認ください。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;dlv</span><br></pre></td></tr></table></figure><hr><h2 id="従来の電話認証手順と同様に自動音声を利用して認証することができますか？"><a href="#従来の電話認証手順と同様に自動音声を利用して認証することができますか？" class="headerlink" title="従来の電話認証手順と同様に自動音声を利用して認証することができますか？"></a>従来の電話認証手順と同様に自動音声を利用して認証することができますか？</h2><p>いいえ、これまでご提供しておりました従来の電話認証 (音声でのインストール ID の入力および確認 ID の取得) はご利用いただけなくなりました。<br>なお、これまで通り、認証対象の環境自体はインターネットにアクセスする必要はないため、別途インターネットに接続可能なスマートフォン等のデバイスをご用意いただき作業を行ってください。</p><h2 id="Microsoft-アカウントもしくは-Microsoft-Entra-ID-アカウントでのサインインは必須ですか？"><a href="#Microsoft-アカウントもしくは-Microsoft-Entra-ID-アカウントでのサインインは必須ですか？" class="headerlink" title="Microsoft アカウントもしくは Microsoft Entra ID アカウントでのサインインは必須ですか？"></a>Microsoft アカウントもしくは Microsoft Entra ID アカウントでのサインインは必須ですか？</h2><p>はい、変更後の手順においてはセキュリティの観点から Microsoft アカウントもしくは Microsoft Entra ID アカウントでのサインインが必須となっております。</p><h2 id="サインインしたアカウントに対してライセンス情報は紐づけられますか？"><a href="#サインインしたアカウントに対してライセンス情報は紐づけられますか？" class="headerlink" title="サインインしたアカウントに対してライセンス情報は紐づけられますか？"></a>サインインしたアカウントに対してライセンス情報は紐づけられますか？</h2><p>いいえ、サインインはセキュリティ対策として必須化しておりますが、サインインしたアカウントとライセンス情報の紐づけは行われません。<br>この点については、手順内で確認できる下記画面でも同様に確認いただくことが可能です。<br><img src="./Items17.png"></p><h2 id="特記事項"><a href="#特記事項" class="headerlink" title="特記事項"></a>特記事項</h2><p>本情報の内容 (添付文書、リンク先などを含む) は作成日時点のものであり、予告なく変更される場合がございます。</p><hr><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/12/25 : 公開情報の追記<br>2025/12/17 : 補足事項の追記<br>2025/12/12 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Windows Commercial Support Device and Deployment チームの岩岡です。&lt;br&gt;先日、ライセンス認証における電話認証の手順に変更があり、</summary>
      
    
    
    
    <category term="Activation" scheme="https://jpwinsup.github.io/blog/categories/Activation/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 11 version 24H2 以降では宛先 IP アドレスでの SMBv1 (TCP 139 番ポート) アクセスができない</title>
    <link href="https://jpwinsup.github.io/blog/2025/12/05/FileServices/SMB/smbv1-tcp-139-access-by-destination-ip-address-unavailable-on-windows-11-24h2-and-later/"/>
    <id>https://jpwinsup.github.io/blog/2025/12/05/FileServices/SMB/smbv1-tcp-139-access-by-destination-ip-address-unavailable-on-windows-11-24h2-and-later/</id>
    <published>2025-12-05T04:30:00.000Z</published>
    <updated>2026-02-19T02:53:58.373Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Windows プラットフォーム サポートです。<br>今回は Windows 11 version 24H2 以降では、宛先 IP アドレスを指定して SMBv1 (TCP 139 番ポート) アクセスができなくなっている事象についてご説明します。</p><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>Windows 11 version 24H2 以降で TCP 139 番ポートの SMBv1 を利用する環境の場合、 <code>\\宛先IPアドレス\共有名</code> のように宛先を指定すると共有フォルダにアクセスできません。</p><h2 id="対象-OS"><a href="#対象-OS" class="headerlink" title="対象 OS"></a>対象 OS</h2><ul><li>Windows 11 version 24H2  </li><li>Windows 11 version 25H2  </li><li>Windows Server 2025</li></ul><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Windows 11 version 24H2 以降の 動作変更により、<code>\\宛先IPアドレス\共有名</code> でアクセスする場合には、TCP 139 番ポートでの SMBv1 アクセスを試行しなくなっています。</p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><p><code>\\宛先コンピューター名\共有名</code> を指定してアクセスする場合、TCP 139 番ポートでの SMBv1 アクセスが可能です。</p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>SMBv1 は非推奨のプロトコルですので、TCP 445 番ポートでの SMBv2 以降の利用を推奨します。<br><a href="https://techcommunity.microsoft.com/t5/storage-at-microsoft/stop-using-smb1/ba-p/425858">Stop using SMB1 | Microsoft Community Hub</a></p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025/12/05 : 本 Blog の公開</li></ul><h2 id="特記事項"><a href="#特記事項" class="headerlink" title="特記事項"></a>特記事項</h2><p>本情報の内容（添付文書、リンク先などを含む）は作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Windows プラットフォーム サポートです。&lt;br&gt;今回は Windows 11 version 24H2 以降では、宛先 IP アドレスを指定して SMBv1 (TCP 139 番ポート) アクセスができなくなっている事象についてご説明します。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="FileServices" scheme="https://jpwinsup.github.io/blog/categories/FileServices/"/>
    
    <category term="SMB" scheme="https://jpwinsup.github.io/blog/categories/FileServices/SMB/"/>
    
    
  </entry>
  
  <entry>
    <title>RDS CAL の概要と動作について</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/19/RemoteDesktopService/RDS/RDS-CAL-Types/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/19/RemoteDesktopService/RDS/RDS-CAL-Types/</id>
    <published>2025-11-19T03:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.580Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事は、マイクロソフト社員によって公開されております。  </p></blockquote><p>こんにちは、Windows サポートチームの岩永です。<br>今回は、リモート デスクトップ サービスで利用される CAL (Client Access License) の概要および動作についてご説明いたします。</p><p>Windows Server に多数のセッションを同時に接続させるためには、リモート デスクトップ サービス環境を構築する必要がありますが、ご利用いただくためには、各クライアントに対して、リモート デスクトップ サービス クライアント アクセス ライセンス (RDS CAL) を発行します。</p><p>本記事では CAL の動作原理や有効期限について、よくいただくご質問をまとめました。ぜひご参考ください。</p><p>なお、本記事中で CAL と記載しておりますが、すべて RDS CAL についての言及となります。</p><p>公開情報：<br>クライアント アクセス ライセンス (CAL) を使用してリモート デスクトップ サービスをライセンスする | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/rds-client-access-license">https://learn.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/rds-client-access-license</a></p><h2 id="1-CAL-の概要"><a href="#1-CAL-の概要" class="headerlink" title="1. CAL の概要"></a>1. CAL の概要</h2><p>CAL は大きく以下の 2 種類に分類されます。</p><ul><li>デバイス CAL</li><li>ユーザー CAL</li></ul><p>この 2 種類は、お客様のリモート デスクトップ サービス環境に応じて、使い分けていただく必要があります。</p><p>簡単に説明すると、デバイス CAL は接続元デバイス (クライアント) ごとに発行され、ユーザー CAL は接続ユーザーごとに発行されます。<br>例えば、1 台のデバイスを複数人でご利用いただく環境の場合はデバイス CAL、1 人のユーザーが複数のデバイスをご利用いただく環境の場合はユーザー CAL を選択する事で、購入 (インストール) いただく CAL の数量を効率よく管理できます。</p><p>重要なポイントとして、1 台のセッション ホスト サーバーに対しては、デバイス CAL を使って接続させるか、ユーザー CAL を使って接続させるかに応じて、いずれかのライセンス モードを選択する必要があります。<br>セッション ホスト サーバーが両方の CAL に応じる事はできません。<br>なお、1 台のライセンス サーバーに、デバイス CAL、ユーザー CAL の両方をインストールする事は可能です。</p><p>デバイス CAL、ユーザー CAL はそれぞれ発行動作が異なります。<br>次項でそれぞれの動作概要をご説明します。</p><h2 id="2-デバイス-CAL-について"><a href="#2-デバイス-CAL-について" class="headerlink" title="2. デバイス CAL について"></a>2. デバイス CAL について</h2><p>デバイス CAL は、クライアント コンピューター (デバイス) に対してセッション ホスト サーバーへアクセスする権限を与えます。</p><p>デバイス CAL が一度発行されると、その情報がクライアント コンピューターの以下のレジストリに格納されます。</p><p><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSLicensing\Store\LICENSE00x</code></p><p><img src="DeviceCALReg.png" alt="図 1 : デバイス CAL 情報 レジストリ"></p><p>デバイス CAL は、初回接続時に発行される一時 CAL と、2 回目の接続時に発行される恒久 CAL の 2 種類が存在します。</p><h3 id="一時-CAL"><a href="#一時-CAL" class="headerlink" title="一時 CAL"></a>一時 CAL</h3><p>クライアント コンピューターからセッション ホスト サーバーに初めて接続した時に発行されるライセンスです。</p><p>一時 CAL の有効期限は、一律で 90 日間となり、恒久 CAL の余剰数がない場合は、2 回目以降の接続時も一時 CAL のまま接続します。<br>一時 CAL の発行数に制限はありません。</p><p><img src="TempCAL.png" alt="図 2 : 一時 CAL 発行例"></p><h3 id="恒久-CAL"><a href="#恒久-CAL" class="headerlink" title="恒久 CAL"></a>恒久 CAL</h3><p>一時 CAL を持っているクライアント コンピューターが 2 回目に接続した時に発行されるライセンスです。</p><p>恒久 CAL の有効期限は、52 日間から 89 日間のランダムな期間が設定されます。<br>この有効期限を任意の期間にすることはできません。<br>ライセンス サーバーにインストールした数量を上限として発行されます。</p><p><img src="PermCAL.png" alt="図 3 : 恒久 CAL 発行例"></p><hr><p>上記のとおり、デバイス CAL は一時 CAL、恒久 CAL ともに有効期限があります。<br>有効期限を過ぎた場合には、接続ができなくなります。<br>そのため、セッション ホスト サーバーに接続するクライアント コンピューター数を適切に管理する必要があります。</p><h3 id="恒久-CAL-の更新について"><a href="#恒久-CAL-の更新について" class="headerlink" title="恒久 CAL の更新について"></a>恒久 CAL の更新について</h3><p>恒久 CAL の有効期限は、52 日間から 89 日間のランダムな期間が設定されますが、その有効期限日の 1 週間前から CAL の更新期間となります。<br>更新期間中にセッション ホスト サーバーに接続することで、新たに 52 日間から 89 日間のランダムな期間が設定されます。</p><h3 id="ライセンスの失効について"><a href="#ライセンスの失効について" class="headerlink" title="ライセンスの失効について"></a>ライセンスの失効について</h3><p>ライセンス マネージャー上から、失効処理を行うことができます。<br>接続することがなくなったクライアントや、誤って接続して発行させてしまったクライアントに対して、発行された CAL を失効させ、別のクライアントのために発行の余剰を作ることができます。</p><p><img src="Lapse.png" alt="図 4 : 失効"></p><p>失効できる数はインストールしている CAL 総数の 20 % までとなります。<br>また、失効された CAL につきましても、発行先のクライアントが保持する CAL の情報は変わりませんので、有効期限内は接続できます。<br>失効処理は、あくまでライセンス サーバーでの管理上の情報となります。</p><p>極端な例となりますが、100 CAL が存在し、全ての CAL が発行済みであるとします。<br>その状態で上限となる 20 % の CAL を失効させ、さらに新規で 20 台のクライントが接続し、恒久 CAL が発行された場合、一時的には 120 台のクライアントが恒久 CAL を持つ状態となります。</p><h3 id="クライアント-の識別について"><a href="#クライアント-の識別について" class="headerlink" title="クライアント の識別について"></a>クライアント の識別について</h3><p>セッション ホスト サーバーは、接続元のクライアントをコンピューター名ではなく、各クライアントが一意で持つ Hardware ID で識別します。<br>仮に同じコンピューター名を持つクライアントから接続を受け付けた場合においても、別のクライアントとして管理されます。<br>Hardware ID は、クライアント コンピューターの以下のレジストリにあります。</p><p><code>HKLM\Software\Microsoft\MSLicensing\HardwareID\ClientHWID</code></p><p><img src="DeviceCALReg2.png" alt="図 5 : Hardware ID"></p><p>ただし、ライセンス マネージャー上では、コンピューター名のみで表示されますので、同じコンピューター名を持つクライアントが存在する環境や、コンピューター名の変更が発生する場合には注意が必要です。<br>また、ライセンス マネージャー上は、初回 CAL 発行時のコンピューター名で表示されますので、CAL を持つクライアントのコンピューター名を変更した場合においても、旧コンピューター名のまま表示されます。</p><h2 id="3-ユーザー-CAL-について"><a href="#3-ユーザー-CAL-について" class="headerlink" title="3. ユーザー CAL について"></a>3. ユーザー CAL について</h2><p>ユーザー CAL には、デバイス CAL のような、一時 CAL や恒久 CAL といった概念はありません。<br>また、デバイス CAL のように、接続元クライアントのレジストリに情報が記録される動作もありません。</p><p>CAL の発行情報は、ドメイン コントローラー上の各ユーザー コンテナに格納されます。</p><p>ライセンス サーバーがドメイン環境の場合は、ライセンス マネージャー上でユーザー CAL の発行状況を確認できます。</p><p><img src="user-cal.png" alt="図 6 : ユーザー CAL 発行例"></p><p>なお、ユーザー CAL の有効期限は一律で 60 日間となっておりますが、その有効期限は、あくまでその時点で発行されているユーザー CAL の情報管理のために使われるものとなります。有効期限を超過した場合も、超過直後の接続時に新たな有効期限が付与されますので、長期間アクセスが無い場合においても、接続不可となることは発生いたしません。</p><p>ユーザー CAL (ユーザー数ライセンス モード) では、1 人のユーザーに対して、無制限の数のクライアントからセッション ホスト サーバーにアクセスする権限が与えられます。</p><p>ユーザー数ライセンス モードはライセンスによって強制されることはありません。<br>そのため、ライセンス サーバーにインストールされている CAL の数に関係なく、クライアント接続を行うことができます。<br>ただしこれによって、各ユーザーに有効な CAL を持たせなければならないという、マイクロソフト ソフトウェア ライセンス条項の要件から管理者が免除されるわけではありません。<br>ユーザー数ライセンス モードを使用している場合に、各ユーザーに有効な CAL を持たせることができなければ、ライセンス条項違反となります。</p><h2 id="4-必要なライセンス数について"><a href="#4-必要なライセンス数について" class="headerlink" title="4. 必要なライセンス数について"></a>4. 必要なライセンス数について</h2><p>上記のとおり、RDS CAL には有効期限があり、一定の期間にわたって有効です。接続時だけ一時的に付与されるものではありません。<br>そのため、必要なライセンス数は、同時に接続する数ではなく、接続する可能性があるユーザー数やデバイス数に基づいて決まります。</p><p>例えば、ユーザー CAL を使用する際、同じ期間内に RDS 接続するユーザーが 10 人いる場合は、同時接続が 5 人であっても 10 CAL が必要です。</p><h2 id="5-デバイス-CAL-運用において、クライアントが接続できなくなった際の暫定対策について"><a href="#5-デバイス-CAL-運用において、クライアントが接続できなくなった際の暫定対策について" class="headerlink" title="5. デバイス CAL 運用において、クライアントが接続できなくなった際の暫定対策について"></a>5. デバイス CAL 運用において、クライアントが接続できなくなった際の暫定対策について</h2><p>ライセンス マネージャー上で、対象クライアントに対してライセンスが正常に発行されているにも関わらず、クライアントがセッション ホスト サーバーに接続できなくなった場合や、恒久 CAL の余剰数がない状態で有効期限が超過したクライアントをどうしても接続させる必要がある場合の暫定対策を説明いたします。</p><h3 id="暫定対策-クライアントのレジストリ削除"><a href="#暫定対策-クライアントのレジストリ削除" class="headerlink" title="暫定対策 : クライアントのレジストリ削除"></a>暫定対策 : クライアントのレジストリ削除</h3><p>クライアントで保持しているライセンス情報、および HardwareID のレジストリを削除することで、セッション ホスト サーバー側で、新規接続のクライアントと判断され、ライセンス サーバーから一時 CAL が発行されます。<br>そのため、一時 CAL にて、90 日間はリモート デスクトップ接続が可能となります。<br>恒久 CAL に使用可能な数が残っている場合には、2 回目の接続時に一時 CAL から恒久 CAL に変わります。</p><p>削除する必要のあるレジストリは以下となります。</p><ul><li><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSLicensing\HardwareID\ClientHWID</code></li><li><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSLicensing\Store\LICENSE00x</code></li></ul><p>(LICENSE00x は x に数字が入ります。いくつか存在する場合がありますので、すべて削除します)</p><p>公開情報：<br>リモート デスクトップ プロトコル (RDP) クライアントからターミナル サーバー ライセンスを削除する - Windows Server | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/windows-server/remote/remove-terminal-server-licenses-from-rdp">https://learn.microsoft.com/ja-jp/troubleshoot/windows-server/remote/remove-terminal-server-licenses-from-rdp</a></p><p>なお、上記レジストリの削除につきましては、クライアント PC の administrator 権限があるユーザーにて実行する必要があります。<br>また、初回接続時に、新たに HardwareID レジストリが作成されますので、初回接続時につきましても、administrator 権限のあるユーザーにて実施する必要があります。</p><h2 id="補足情報-多段-RDP-接続について"><a href="#補足情報-多段-RDP-接続について" class="headerlink" title="補足情報 : 多段 RDP 接続について"></a>補足情報 : 多段 RDP 接続について</h2><p>条件つきとはなりますが、2 段 RDP 接続はサポートされております。<br>詳細は以下の公開情報を参照ください。</p><p>公開情報：<br>リモート デスクトップ接続セッションを実行する - Windows Server | Microsoft Learn<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/windows-server/remote/run-remote-desktop-connection-session">https://learn.microsoft.com/ja-jp/troubleshoot/windows-server/remote/run-remote-desktop-connection-session</a></p><p>例 : Windows 11 — RDP —&gt; Windows Server 2025 (1) — RDP —&gt; Windows Server 2025 (2)</p><p>なお、CAL については、[Windows Server 2025 (1)] に接続するために、[Windows 11] に必要となり、[Windows Server 2025 (2)] に接続するために、中継となる [Windows Server 2025 (1)] に発行される必要がございますので、数量の管理にはご留意願います。</p><h2 id="修正履歴"><a href="#修正履歴" class="headerlink" title="修正履歴"></a>修正履歴</h2><ul><li>2025.11.1X 旧 Blog より移行</li></ul><blockquote><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポートチームの岩永です。&lt;br&gt;今回は、リモート デスクトップ サービスで利用される CAL (Client Ac</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Remote Desktop Service (RDS)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Remote-Desktop-Service-RDS/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows Defender Firewall サービスが「パラメーターが間違っています」のエラーで繰り返し終了する</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/18/Networking/Firewall/firewall-service-parameter-incorrect-error-repeated-termination/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/18/Networking/Firewall/firewall-service-parameter-incorrect-error-repeated-termination/</id>
    <published>2025-11-18T01:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.397Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Windows プラットフォーム サポートです。<br>今回は Windows Defender Firewall サービスが「パラメーターが間違っています」のエラーで繰り返し終了する事象についてご説明します。</p><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>システム イベントログに Service Control Manager のエラー イベント ID 7024 で「パラメーターが間違っています」というメッセージが記録され、Windows Defender Firewall サービスが繰り返し終了します。</p><h3 id="本事象発生時に記録されるイベント"><a href="#本事象発生時に記録されるイベント" class="headerlink" title="本事象発生時に記録されるイベント"></a>本事象発生時に記録されるイベント</h3><pre><code>Log Name:      SystemSource:        Service Control ManagerEvent ID:      7024Level:         ErrorDescription:Windows Defender Firewall サービスは、次のサービス固有エラーで終了しました:パラメーターが間違っています。</code></pre><h2 id="対象-OS"><a href="#対象-OS" class="headerlink" title="対象 OS"></a>対象 OS</h2><ul><li>Windows Server 2022</li><li>Windows 11</li></ul><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>以下のレジストリ値が肥大化していることで、Windows Defender Firewall サービスが起動時にレジストリの読み込みに失敗し、サービスが終了します。</p><pre><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs\DebugedLoopbackApps</code></pre><p><code>DebugedLoopbackApps</code> のレジストリ値が肥大化している場合、レジストリ エディターでキーは確認できますが、値をダブルクリックしてもデータが表示されません。</p><p>・本事象発生時のレジストリ エディターの表示例<br><img src="image1_regedit.png" alt="本事象発生時のレジストリ エディターの表示例"></p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>以下の手順で肥大化した <code>DebugedLoopbackApps</code> のレジストリ値を削除することで、Windows Defender Firewall サービスが起動できるようになります。<br>その後、<code>DebugedLoopbackApps</code> のレジストリ値は再作成されます。</p><h3 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h3><ol><li><p>以下のサイトからから <strong>PSTools.zip</strong> をダウンロードします。<br><a href="https://learn.microsoft.com/sysinternals/downloads/psexec">PsExec - Sysinternals | Microsoft Learn</a></p></li><li><p>ダウンロードした PSTools.zip を解凍し、任意のフォルダー（例: <code>C:\temp\PSTools</code>）に配置します。</p></li><li><p>ChangeOwnerAppCs.txt と RevertOwnerAppCs.txt を取得し、それぞれ拡張子を .ps1 に変更して C:\temp フォルダーに配置します。</p></li></ol><ul><li><a href="ChangeOwnerAppCs.txt" download="ChangeOwnerAppCs.txt">ChangeOwnerAppCs.txt</a></li><li><a href="RevertOwnerAppCs.txt" download="RevertOwnerAppCs.txt">RevertOwnerAppCs.txt</a></li></ul><ol start="4"><li>PowerShell を管理者権限で起動し、PSTools フォルダーに移動します。 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\temp\PSTools</span><br></pre></td></tr></table></figure></li><li>以下のコマンドを実行して powershell.exe をシステム権限で起動します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\psexec.exe <span class="literal">-s</span> <span class="literal">-i</span> powershell.exe</span><br></pre></td></tr></table></figure></li><li>以下のコマンドを実行して AppCs レジストリ キーの所有者を変更します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> bypass <span class="literal">-Scope</span> <span class="keyword">Process</span> <span class="literal">-Force</span></span><br><span class="line">C:\temp\ChangeOwnerAppCs.ps1</span><br></pre></td></tr></table></figure></li><li>以下のコマンドを実行して AppCs レジストリ キーのバックアップを取ります。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg export <span class="string">&quot;HKLM\System\CurrentControlSet\Services\mpssvc\Parameters\AppCs&quot;</span> fw.reg</span><br></pre></td></tr></table></figure></li><li>以下のコマンドを実行して <code>DebugedLoopbackApps</code> のレジストリ値を削除します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg delete <span class="string">&quot;HKLM\System\CurrentControlSet\Services\mpssvc\Parameters\AppCs&quot;</span> /v DebugedLoopbackApps /f</span><br></pre></td></tr></table></figure></li><li>以下のコマンドを実行して AppCs レジストリ キーの所有者をデフォルトに戻します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\temp\RevertOwnerAppCs.ps1</span><br></pre></td></tr></table></figure></li><li>OS を再起動し、Windows Defender Firewall サービスが正常に起動することを確認します。</li></ol><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>Windows 11 では <code>DebugedLoopbackApps</code> のレジストリ値が肥大化していく事象はすでに改善されているため、Windows Defender Firewall サービスが繰り返し終了する問題が発生して <code>DebugedLoopbackApps</code> を一度削除した後は本問題が再発することはありません。<br>Windows Server 2022 では <code>DebugedLoopbackApps</code> のレジストリ値を一度削除した後に、本問題が再発した場合は同じ手順で再度削除ください。</p><h2 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h2><p>本サンプルコードは、あくまでもサンプルとして提供されるものです。本サンプルコードおよびそれに関連するあらゆる情報は、「現状のまま」で提供されるものであり、商品性や特定の目的への適合性に関する黙示の保証も含め、明示・黙示を問わずいかなる保証も付されるものではありません。</p><p>マイクロソフトは、お客様に対し、本サンプルコードを使用および改変するための非排他的かつ無償の権利ならびに本サンプルコードをオブジェクトコードの形式で複製および頒布するための非排他的かつ無償の権利を許諾します。</p><p>但し、お客様は (1) 本サンプルコードが組み込まれたお客様のソフトウェア製品のマーケティングのためにマイクロソフトの会社名、ロゴまたは商標を用いないこと (2) 本サンプルコードが組み込まれたお客様のソフトウェア製品に有効な著作権表示をすること、および（３）本サンプルコードの使用または頒布から生じるあらゆる損害（弁護士費用を含む）に関する請求または訴訟について、マイクロソフトおよびマイクロソフトの取引業者に対し補償し、損害を与えないことに同意するものとします。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><ul><li>2025/11/18 : 本 Blog の公開</li></ul><h2 id="特記事項"><a href="#特記事項" class="headerlink" title="特記事項"></a>特記事項</h2><p>本情報の内容（添付文書、リンク先などを含む）は作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Windows プラットフォーム サポートです。&lt;br&gt;今回は Windows Defender Firewall サービスが「パラメーターが間違っています」のエラーで繰り返し終了する事象についてご説明します。&lt;/p&gt;
&lt;h2 id=&quot;事象&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="Networking" scheme="https://jpwinsup.github.io/blog/categories/Networking/"/>
    
    <category term="Firewall" scheme="https://jpwinsup.github.io/blog/categories/Networking/Firewall/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 11 でアプリケーションの自動起動のタイミングが遅くなる事象について</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/13/Performance/SlowResponse/AutoRunDelayOnWin11/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/13/Performance/SlowResponse/AutoRunDelayOnWin11/</id>
    <published>2025-11-13T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.468Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは、Windows サポート チームの八木です。</p><p>最近、Windows 11 へアップグレード後にアプリケーションの自動起動タイミングが遅くなった、というお問合せを頂くことが増えましたので、本記事ではその事象についての説明と回避策をご紹介させて頂きます。</p><h2 id="対象-OS"><a href="#対象-OS" class="headerlink" title="対象 OS"></a>対象 OS</h2><ul><li>Windows 11 version 22H2 以降</li></ul><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Windows にサインインすると、予め自動起動が設定された Teams などのアプリケーションがエクスプローラーによって順番に起動されますが、Windows 11 version 22H2 以降では、自動起動が設定されたアプリケーションの起動されるタイミングが遅くなる場合があります。</p><p>一例として、Windows 10 のときは数十秒で起動していたアプリケーションが、Windows 11 では 3 分から 5 分ほどかかることが報告されています。</p><p>なお、ここで説明する自動起動遅延の事象は、 Run レジストリキーに登録されたものと、スタートアップフォルダーに登録されたものを含みます。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>エクスプローラーがアプリケーションの自動起動を行う際に、システムの負荷が高い場合に自動起動のタイミングを遅延させる動作が影響しています。</p><p>この遅延させる理由には、サインイン直後に多くのプロセスが集中して起動することによってユーザーの操作性が損なわれることを緩和する目的があります。 </p><p>Windows 10 の場合も同様の遅延処理はありましたが、Windows 10 の場合は起動するアプリケーション自体の負荷を考慮していたのに対して、Windows 11 からはシステム全体の負荷（CPU 使用率とディスク使用率）を考慮するように仕様が変更されました。</p><p>この仕様変更の影響により、特にシステムのコア数が少ない環境やシステム起動時に動作するウィルス対策スキャンが動作する場合など、システム全体の負荷が下がらず、この影響でアプリケーションの自動起動のタイミングが遅れることになります。</p><h2 id="対策"><a href="#対策" class="headerlink" title="対策"></a>対策</h2><p>サインイン直後にアプリケーションを利用したい場合は、直接そのアプリケーションのアイコンをクリックすることで遅延の影響は受けずに起動することができますので、そのような形の対処をご検討ください。</p><p>もし、システムの動作を Windows 10 の動作と同等に戻されたい場合には、以下のレジストリをセットして頂くことで実現が可能です。</p><p>但し、弊社として直接レジストリを編集することは推奨しておらず、今後の製品リリースでレジストリが変更される可能性もありますので、予めご理解頂きお客様ご自身で十分に検証の上でご利用をお願いいたします。</p><pre><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Serialize　・WaitForIdleState (DWORD値：0)</code></pre><p>コマンドプロンプトやバッチファイルで実行する場合は、以下のコマンドをご利用頂けます。</p><pre><code>REG ADD HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Serialize /v WaitForIdleState /t REG_DWORD /d 0 /f</code></pre><p>なお、この設定を行うためのグループポリシーはございませんので、必要に応じて上記レジストリをスクリプトで配布頂くなどをご検討下さい。</p><h2 id="変更履歴"><a href="#変更履歴" class="headerlink" title="変更履歴"></a>変更履歴</h2><ul><li>2025/11/14 : 本 Blog の公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポート チームの八木です。&lt;/p&gt;
&lt;p&gt;最近、Windows 11 へアップグレード後にアプリケーションの自動起動タイミングが遅くなった、というお問合せを頂くことが増えまし</summary>
      
    
    
    
    <category term="Performance" scheme="https://jpwinsup.github.io/blog/categories/Performance/"/>
    
    <category term="Slow Response" scheme="https://jpwinsup.github.io/blog/categories/Performance/Slow-Response/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows Update 後に Windows Hello や 保存された資格情報が利用できなくなる事象</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/12/ActiveDirectory/WindowsHello/cannot-validate-VSM-when-multiple-PCRs-changed/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/12/ActiveDirectory/WindowsHello/cannot-validate-VSM-when-multiple-PCRs-changed/</id>
    <published>2025-11-12T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.339Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows Commercial Support Directory Services チームです。</p><p>今回は、Windows Update をインストールした後の OS 再起動後に Windows Hello によるサインインができなくなるという事象について紹介します。</p><h1 id="発生する事象について"><a href="#発生する事象について" class="headerlink" title="発生する事象について"></a>発生する事象について</h1><p>Windows Update をインストール後、OS を再起動した後から、「問題が発生したため、PIN を使用できません。クリックして暗証番号 (PIN) をもう一度設定してください。」と表示され、Microsoft アカウントが Windows Hello (PIN や 生体認証) によるサインインができなくなる事象が報告されています。本事象が発生すると、最悪の場合は Microsoft アカウントによるサインインができなくなり、OS の再インストールが必要となる場合がございます。</p><p>OS の再インストールが必要となる条件については、<strong>OS の再インストールが必要となるケース</strong> にてご説明いたします。</p><h1 id="発生原因"><a href="#発生原因" class="headerlink" title="発生原因"></a>発生原因</h1><p>今回の問題は、Windows Update 時に、Secure Boot DBX のアップデートと BIOS/UEFI Firmware のアップデートが同時に行われた場合に発生する可能性があります。Secure Boot DBX とは、Secure Boot の信頼を取り消された署名や証明書のリスト (Disallowed Signature Database) です。</p><p>一方で、Windows 11 の Copilot+ PC などでは、ESS (Enhanced Sign-in Security) と呼ばれる機能が有効化されていますが、この ESS が有効となっている環境では、Windows Hello に関する情報は、VSM (Virtual Secure Mode) で保護されています。この VSM で保護されている情報を取得する際、TPM 内に存在する特別なレジスター情報 (PCR) を用いて、整合性のチェックを行います。</p><p>Secure Boot DBX のアップデートと BIOS/UEFI Firmware のアップデートが同時に行われた場合、複数の PCR 値が同時に更新されてしまうことがあります。その結果、VSM で保護された情報の取り出し時の整合性チェックに失敗し、それに伴い情報の取り出しもできなくなり、本事象が発生します。</p><p>なお、Windows Update は既定で自動更新が有効となっているため Secure Boot DBX と BIOS/UEFI Firmware のアップデートが自動的に更新される場合がございますのでご留意ください。</p><h1 id="OS-の再インストールが必要となるケース"><a href="#OS-の再インストールが必要となるケース" class="headerlink" title="OS の再インストールが必要となるケース"></a>OS の再インストールが必要となるケース</h1><p>以下の条件を満たす場合、Microsoft アカウントでデバイスにサインインができなくなり、OS の再インストールが必要となる場合がございます。</p><p>条件 1) <strong>[セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)]</strong> が有効になっている ( 既定で有効 )<br>本設定が有効になっていることで Windows Hello 以外のサインイン手段 ( パスワード ) が無効になります。これにより、Windows Hello が利用できなくなった場合サインインする手段が失われます。</p><p>条件 2) システム ドライブが BitLocker で暗号化 / 保護されており、かつ、BitLocker の回復パスワードを保管していない<br>サインインできない状況から回復するためには、Windows RE (Windows 回復環境) や OS インストール メディアを用いて起動を行い、<strong>条件1) [セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)]</strong> を無効化する必要がありますが、BitLocker の保護が有効な環境の場合、BitLocker の回復パスワードが必要になります。BitLocker の回復パスワードが分からない場合、復旧が困難となり、OS の再インストールが必要となります。</p><p>なお、Bitlocker は特定の環境下で自動で有効化される場合がございます。対象端末が自動有効化の条件に合致しているかを確認する方法、および具体的な条件については、<strong>Bitlocker が自動で有効化されるケース</strong> にてご説明いたします。</p><h1 id="OS-再インストールの予防策"><a href="#OS-再インストールの予防策" class="headerlink" title="OS 再インストールの予防策"></a>OS 再インストールの予防策</h1><p>Windows 11 Home, Pro Edition では、Microsoft アカウントを用いて初期セットアップを行うと、初期セットアップ中に Windows Hello の登録を求められます。また、Windows Hello を登録した場合、既定で [設定] アプリ - [アカウント] - [サインイン オプション] 内にある [セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)] が有効化されます。この設定が有効化されている場合、Windows Hello を用いてのみ対象端末にサインイン可能となり、パスワードでのサインインは使用できなくなります。</p><p>[セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)] を無効にしていただくことでパスワードでサインインが可能となり、一切サインインが出来なくなるというシナリオを予防することができます。また、本事象が発生してしまった後に、引き続き Windows Hello を利用する場合は、Windows Hello の再設定をお願いいたします。 [設定] アプリ - [アカウント] - [サインイン オプション] 内から PIN や生体情報の登録が可能となります。</p><p>残念ながら、現状 Windows OS として Secure Boot DBX と BIOS/UEFI Firmware の更新が確実に同時に行われないようにする実装はありません。マイクロソフトではこのようなシナリオにも対応できるよう、サポート チームから開発部門へのフィードバックは実施しているため、今後改善される可能性はあります。</p><p>しかしながら、現時点では Windows Update による自動更新が有効になっている (既定で有効) 場合、Secure Boot DBX と BIOS/UEFI Firmware のアップデートが自動的に更新される可能性があるため、前述の予防策は必須となります。</p><h1 id="サインインできなくなった場合の対処策"><a href="#サインインできなくなった場合の対処策" class="headerlink" title="サインインできなくなった場合の対処策"></a>サインインできなくなった場合の対処策</h1><p>Microsoft アカウントでのサインインができなくなった場合、この状況から回復するためには、Windows RE (Windows 回復環境) や OS インストール メディアを用いて起動を行い、**[セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)]** を以下のレジストリから無効化する必要があります。<br>(対象 Microsoft アカウント以外にサインインできる管理者ユーザーがいる場合は、管理者ユーザーでサインインして [レジストリ エディター] より以下のレジストリを書き換えてください。)</p><blockquote><p>キー: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PasswordLess\Device<br>値の名前: DevicepasswordLessBuildVersion<br>値の種類: REG_DWORD<br>値のデータ: 0  (<strong>[セキュリティ向上のため、このデバイスでは Microsoft アカウント用に Windows Hello サインインのみを許可する (推奨)]</strong> を無効化します)<br>            ※ 有効時は 2 になります。</p></blockquote><p>なお、BitLocker が有効化されている場合、先述の Windows RE や OS インストール メディアなどを用いてのレジストリ編集時に、BitLocker 回復パスワードの入力が求められます。この時に BitLocker 回復パスワードが確認できない場合、復旧が困難となることが想定されるため、万が一に備えて通常時から BitLocker 回復パスワードが参照できる状況を確保しておいてください。( 回復パスワードが不明な場合、OS の再インストールが必要となります )</p><p>BitLocker 回復パスワードは、<a href="https://account.microsoft.com/devices/recoverykey">Microsoft account | BitLocker 回復キー</a> に対象の Microsoft アカウントを用いてサインインすることで確認できます。また、OS が起動している状態であれば、以下のコマンドを用いて、新たに BitLocker 回復パスワードを追加することもできます。(追加した/表示された回復パスワード (数字パスワード) 情報は、安全な場所に保管してください。)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; BitLocker が有効化どうかを確認するコマンド (&quot;保護の状態&quot; が &quot;保護はオンです&quot; となっているか確認します。)</span><br><span class="line">manage-bde -status C:</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 追加コマンド</span><br><span class="line">manage-bde -protectors -add C: -RecoveryPassword</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 確認コマンド</span><br><span class="line">manage-bde -protectors -get C:</span><br></pre></td></tr></table></figure><p>※ 管理者権限が必要です</p><blockquote><p>参考情報<br><a href="https://learn.microsoft.com/ja-jp/windows-hardware/design/device-experiences/oem-bitlocker">OEM 向け Windows 11 での BitLocker ドライブ暗号化</a><br><a href="https://learn.microsoft.com/ja-jp/windows/security/operating-system-security/data-protection/bitlocker/recovery-overview#bitlocker-recovery-password">BitLocker 回復の概要</a><br><a href="https://learn.microsoft.com/ja-jp/windows/security/operating-system-security/data-protection/bitlocker/recovery-process">BitLocker 回復プロセス</a></p></blockquote><h1 id="Bitlocker-が自動で有効化されるケース"><a href="#Bitlocker-が自動で有効化されるケース" class="headerlink" title="Bitlocker が自動で有効化されるケース"></a>Bitlocker が自動で有効化されるケース</h1><p>Bitlocker は特定の環境下で自動で有効化される場合がございます。具体的な条件 および お使いのデバイスが自動有効化の条件に合致しているかを確認する方法は以下の通りとなります。</p><h3 id="Bitlocker-が自動で有効化される条件"><a href="#Bitlocker-が自動で有効化される条件" class="headerlink" title="Bitlocker が自動で有効化される条件"></a>Bitlocker が自動で有効化される条件</h3><blockquote><ol><li>Windows 10 以降、エディションは Home 以上。 (※1)</li><li>新規インストール時 ( なお、既存の OS に対し、 [リセット] 機能 (選択肢: “すべて削除する”) を使用し初期化した場合を含みます。)</li><li>Bitlocker の自動暗号化要件<br>・ デバイスに TPM 1.2 もしくは TPM 2.0 が搭載されていること<br>・ UEFI Secure Boot が有効であること<br>・ Platform Secure Boot が有効であること<br>・ モダンスタンバイ もしくは HSTI に準拠していること ( ただし、Windows 11 24H2 以降では IoT Enterprise Edition を除いて要件より削除 )<br>・ 許可されていないダイレクト メモリ アクセス (DMA) インターフェイス が存在しないこと ( ただし、Windows 11 24H2 以降では IoT Enterprise Edition を除いて要件より削除 )</li></ol><p>かつ、以下の条件を満たし BitLocker による保護が開始されている状態。 (※2)<br>4. Microsoft アカウントによる OS ログオン もしくは Entra ID 参加</p><p>※1 [BitLocker] は Pro エディション以上で利用可能な機能ですが、 Home エディションにおいても [デバイスの暗号化] 機能として OS ドライブの自動暗号化が行われます。 そのため、 Microsoft アカウントによるログオンに切り替えられ、保護が開始されると WinRE や OS インストール メディアから OS ディスクにアクセスする際には回復キーによるロック解除が必要となります。<br>※2 [BitLocker] には暗号化と保護の 2 フェーズがございます。暗号化の段階では回復キーは作成されておらず、 OS ドライブは保護されていないため、 WinRE や OS のインストール メディアから回復キー不要でアクセスすることが可能です。</p></blockquote><h3 id="条件に合致したデバイスであるかを確認する方法"><a href="#条件に合致したデバイスであるかを確認する方法" class="headerlink" title="条件に合致したデバイスであるかを確認する方法"></a>条件に合致したデバイスであるかを確認する方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. コマンド プロンプトまたは Powershell を [管理者として実行] で起動します。</span><br><span class="line">2. 以下のコマンドを実行します。</span><br><span class="line">msinfo32</span><br><span class="line"></span><br><span class="line">3. [システムの要約] - [自動デバイスの暗号化サポート] が &quot;前提条件を満たしています&quot; になっている場合、</span><br><span class="line">そのデバイスは自動暗号化の条件を満たしていると判断できます。</span><br></pre></td></tr></table></figure><h1 id="その他の関連事例"><a href="#その他の関連事例" class="headerlink" title="その他の関連事例"></a>その他の関連事例</h1><p>Windows Hello 以外の関連事例についてご紹介いたします。</p><h2 id="資格情報マネージャーに保存した資格情報が削除され、タスクスケジューラーが実行されなくなった"><a href="#資格情報マネージャーに保存した資格情報が削除され、タスクスケジューラーが実行されなくなった" class="headerlink" title="資格情報マネージャーに保存した資格情報が削除され、タスクスケジューラーが実行されなくなった"></a>資格情報マネージャーに保存した資格情報が削除され、タスクスケジューラーが実行されなくなった</h2><p>Credential Guard が有効な環境において、タスク スケジューラ タスクにて、[ユーザーがログオンしているかどうかにかかわらず実行する] にチェックを入れているタスクが実行できなくなる事象が報告されております。この時、Microsoft-Windows-TaskScheduler/Operatinoal イベント ログを確認すると、以下のログオン失敗のイベント ログが記録されていることが確認できます。</p><blockquote><p>ログの名前:         Microsoft-Windows-TaskScheduler/Operational<br>ソース:           Microsoft-Windows-TaskScheduler<br>日付:            yyyy/MM/dd HH:mm:ss<br>イベント ID:       104<br>タスクのカテゴリ:      ログオン失敗<br>レベル:           エラー<br>説明:<br>タスク スケジューラは、”&lt;YOUR_TASK_NAME&gt;” にログオンできませんでした。”LogonUserExEx” でエラーが発生しました。<br>ユーザー操作: タスクの資格情報が正確に指定されていることを確認します。<br>追加データ: エラー値: 2147943726。</p></blockquote><p>タスク スケジューラ タスクの実行アカウントの資格情報については、SYSTEM アカウントの資格情報マネージャー内に保存されます。Credential Guard が有効な環境では、資格情報マネージャーに保存された資格情報が VSM (Virtual Secure Mode) で保護されています。そのため、<strong>発生原因</strong> に記載の問題が発生すると VSM で保護された情報が取り出せなくなり、実行アカウントの資格情報を利用することができなくなります。これに伴ってタスク実行のためのユーザー ログオンに失敗し、その結果タスクの実行に失敗します。</p><p>この事象が発生した場合は、改めて対象タスクを保存し直し、実行アカウントの資格情報を再入力する必要があります。</p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/10/07 : 本ブログの公開<br>2025/10/10 : 一部文言の修正およびシナリオを追加<br>2025/11/13 : 章立て および 内容を全体的に修正</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;/p&gt;
&lt;p&gt;今回は、Windows Update をインストールした後の OS 再起</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Windows Hello" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Windows-Hello/"/>
    
    
  </entry>
  
  <entry>
    <title>PowerShell に関するお問い合わせ時の留意事項</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/06/UserInterfaceAndApps/PowerShell/PowerShell-SupportGuidlines/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/06/UserInterfaceAndApps/PowerShell/PowerShell-SupportGuidlines/</id>
    <published>2025-11-06T05:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.847Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事は、マイクロソフト社員によって公開されております。  </p></blockquote><p>こんにちは、Windows サポートチームの岩永です。<br>今回は PowerShell に関するお問い合わせの留意事項をご説明いたします。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>弊社の有償サポート サービスへ、Windows PowerShell ならびに、オープンソース プロジェクトより提供する PowerShell に関するお問い合わせいただく際、留意点について事前にご確認いただくことでよりスムーズなサポートが可能となります。</p><h2 id="独自スクリプトと標準コマンドレットのお問い合わせ"><a href="#独自スクリプトと標準コマンドレットのお問い合わせ" class="headerlink" title="独自スクリプトと標準コマンドレットのお問い合わせ"></a>独自スクリプトと標準コマンドレットのお問い合わせ</h2><p>弊社の有償サポート サービスでは、Windows が標準で提供しているスクリプトやコマンドレットに関するお問い合わせは承っております。</p><p>一方で、お客様が独自に作成されたスクリプトにつきましては、お問い合わせを承ることができません。また、スクリプトの機能要件や問題などをご提示いただいたとしてもスクリプトの作成や改修なども対応が出来かねますのでご了承ください。<br>そのため、お客様が作成されたスクリプトに関するトラブルシューティングは、お客様ご自身での対応をお願いしております。</p><p>ただし、トラブルシューティングの結果、特定のコマンドレットに問題が絞り込まれた場合には、そのコマンドレットに関するお問い合わせを承っております。<br>その際は、以下のような情報をご提供ください。</p><ul><li>対象コマンドレット</li><li>コマンドレットの引数</li><li>実行結果やエラーの詳細</li><li>想定されている動作・結果</li></ul><p>なお、Windows OS に既定で含まれないコマンドレットについては、提供元にお問い合わせいただくようお願いしております。<br>また、以下のようなスクリプトについても、提供元へのお問い合わせをご案内しております。</p><ul><li>他社様が提供されたスクリプト</li><li>PowerShell Gallery に掲載されているスクリプト</li><li>Microsoft Community やその他のサイトに投稿されたスクリプト</li></ul><h2 id="Web-リクエストを伴うコマンドレットに関するお問合せ"><a href="#Web-リクエストを伴うコマンドレットに関するお問合せ" class="headerlink" title="Web リクエストを伴うコマンドレットに関するお問合せ"></a>Web リクエストを伴うコマンドレットに関するお問合せ</h2><p>Invoke-RestMethod や Invoke-WebRequest などの Web リクエストを伴うコマンドレットに対し、各パラメーターに関する利用用途などのお問い合わせは承っております。</p><p>ただし、これらのコマンドレットの実行結果は、通信環境や送信先 (エンドポイント) の動作に大きく依存します。そのため、コマンドレットが適切に処理を行っても、Web サーバー側の応答によっては期待通りに動作しない場合があり、コマンドレットの調査では原因追及ができません。<br>このような理由から、Web リクエストを伴うコマンドレットの実行結果に関しては、コマンドレット観点でのサポートは対応が難しいことご了承ください。</p><p>なお、Invoke-RestMethod や Invoke-WebRequest などの引数の内容がコマンドレットの仕様に沿っているかどうかのご支援は可能ですが、通信環境や送信先については以下を参考にご対応をお願いしておりますので、ご参考にください。</p><ul><li>通信環境：お客様によるトラブルシューティング</li><li>送信先（エンドポイント）：送信先の管理者または提供元へのお問い合わせ</li></ul><h2 id="Windows-非標準のコマンドレットに関するお問い合わせ"><a href="#Windows-非標準のコマンドレットに関するお問い合わせ" class="headerlink" title="Windows 非標準のコマンドレットに関するお問い合わせ"></a>Windows 非標準のコマンドレットに関するお問い合わせ</h2><p>PowerShell は、コマンドレットを拡張することができ、Windows 以外の Microsoft 製品でもコマンドレットの拡張 (追加) を行っている製品がございます。<br>あくまでも一例でございますが、 Exchange Online や Azure 上のリソースを操作するモジュールなどは、コマンドレットの拡張 (追加) を行っております。</p><p>これらの製品が提供するコマンドレットについて、PowerShell に対するお問い合わせとして頂戴すると、迅速な対応が難しくなる場合がございます。<br>そのため、PowerShell ではなく、該当するコマンドレットを提供している製品をご指定のうえ、お問い合わせいただきますようお願いいたします。</p><p>また、Microsoft 製品として公開されているものの、オープンソース プロジェクト (OSS) にて提供されているものもございます。<br>OSS 提供のソフトウェアにつきましては、対象 OSS の開発リポジトリや、コミュニティ サイトへのご相談をお願いしております。</p><h2 id="PowerShell-上の-NET-Framework-および-Win32-API-の動作に関するお問い合わせ"><a href="#PowerShell-上の-NET-Framework-および-Win32-API-の動作に関するお問い合わせ" class="headerlink" title="PowerShell 上の .NET Framework および Win32 API の動作に関するお問い合わせ"></a>PowerShell 上の .NET Framework および Win32 API の動作に関するお問い合わせ</h2><p>PowerShell は柔軟性が高く、.NET Framework や Win32 API を PowerShell からご利用いただけます。<br>基本的な利用方法では問題なく動作することが多いですが、PowerShell はいかなる条件下においても .NET Framework や Win32 API が完全に動作することを保証しているわけではございません。<br>複雑な利用方法では、条件や組み合わせにより、期待通りに動作しないことも考えられます。</p><p>このため、PowerShell 上での .NET Framework や Win32 API の動作に関しては、PowerShell のお問い合わせとしては承っておりませんのでご了承ください。</p><p>なお、 .NET Framework や Win32 API は、C#/VB#/C++/C といったプログラム言語からのご利用を目的として提供している機能になり、動作確認もこれらの言語で行っていただくことをお願いしております。<br>また、これらの言語で正常に動作しながらも、PowerShell 上で期待通りの動作とならない場合は、プログラミング言語のご利用をお願いしておりますことをご留意ください。</p><h2 id="修正履歴"><a href="#修正履歴" class="headerlink" title="修正履歴"></a>修正履歴</h2><ul><li>2025.11.06 本ブログを公開</li></ul><blockquote><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポートチームの岩永です。&lt;br&gt;今回は PowerShell に関するお問い合わせの留意事項をご説明いたします。&lt;</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="PowerShell" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/PowerShell/"/>
    
    
  </entry>
  
  <entry>
    <title>Hyper-V マネージャーを使用して信頼関係を結んだ他ドメインに所属するHype-V ホストへ Hyper-V レプリカを構築時エラーコード 0x80090303 にて失敗する事象について</title>
    <link href="https://jpwinsup.github.io/blog/2025/11/04/Hyper-V/ConfigurationAndManagement/Fail-hyperv-replica-cross-domain-setup/"/>
    <id>https://jpwinsup.github.io/blog/2025/11/04/Hyper-V/ConfigurationAndManagement/Fail-hyperv-replica-cross-domain-setup/</id>
    <published>2025-11-04T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.375Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。  </p><p>こんにちは。Windows サポートチームです。<br>今回は Hyper-V マネージャーを使用して、信頼関係を結んだ他ドメインに所属するHype-V ホストへ Hyper-V レプリカを構築する際に、エラーコード 0x80090303 にて失敗する事象についてお伝えさせていただきます。</p><h2 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h2><p>Hyper-V マネージャーを使用して、信頼関係を結んだ他ドメインに所属するHype-V ホストへ Hyper-V レプリカを構築する場合、以下エラーが発生します。</p><blockquote><p>“Error” “2025/xx/xx xx:xx:xx” “Microsoft-Windows-Hyper-V-VMMS” “32000” “None” “Hyper-V failed to enable replication for virtual machine ‘xxxx’: %%2148074243 (0x80090303). (Virtual machine ID xxxx-xxxx-xxxx-xxxx-xxxx)”</p><p>“Error” “2025/xx/xx xx:xx:xx” “Microsoft-Windows-Hyper-V-VMMS” “29210” “None” “Hyper-V failed to authenticate the Replica server ‘xxxx’ using Kerberos authentication. Error: %%2148074243 (0x80090303)”</p></blockquote><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Hyepr-V マネージャー上で Hyper-V レプリカの設定を行う場合、内部では WinRM による接続が行われます。WinRM 観点での権限設定が不足している場合、エラーコード 0x80090303 が発生し、Hyper-V レプリカの構築に失敗します。</p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><p>PowerShell コマンドレットにて Hyper-V レプリカを構築いただく場合には、WinRM での接続処理が発生いたしませんため、事象の回避が可能となります。信頼関係を結んだ異なるドメイン間での Hyper-V レプリカ構築をご検討いただく場合には、PowerShell コマンドレットでの構築をご検討いただけますと幸いでございます。</p><p>コマンド例 ) </p><blockquote><p> Enable-VMReplication -VMName 仮想マシン名 -ReplicaServerName レプリカサーバーFQDN -ReplicaServerPort 80 -AuthenticationType Kerberos</p></blockquote><p>// 参考情報<br>Enable-VMReplication<br><br><a href="https://learn.microsoft.com/en-us/powershell/module/hyper-v/enable-vmreplication?view=windowsserver2025-ps">https://learn.microsoft.com/en-us/powershell/module/hyper-v/enable-vmreplication?view=windowsserver2025-ps</a></p><p>// 参考情報<br>Hyper-V レプリカを設定する<br><br><a href="https://learn.microsoft.com/ja-jp/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica">https://learn.microsoft.com/ja-jp/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica</a></p><h2 id="その他対処策-WinRM-観点"><a href="#その他対処策-WinRM-観点" class="headerlink" title="その他対処策 (WinRM 観点)"></a>その他対処策 (WinRM 観点)</h2><p>WinRM での操作には、”WinRMRemoteWMIUsers_” （旧名称であり、Windows Server 2016 以降 Remote Management Users になります）の権限が必要となります。<br>Hyper-V マネージャー上での構築操作をご希望の場合には、お手数おかけしますが、下記設定の追加をご検討ください。</p><h3 id="追加設定"><a href="#追加設定" class="headerlink" title="追加設定"></a>追加設定</h3><p>WinRM 接続先 のマシンで lusrmgr.msc を起動し、グループ内の Remote Management Users グループを開き、WinRM 接続元側（Hyper-V のレプリケーションを操作しているマシン）で Hyper-V レプリカの設定操作を行っているユーザーを追加してください。</p><h3 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h3><p>同ドメイン内であれば、Domain Admins は既定で対象マシンの Administrators グループに所属しているため、Remote Management Users に WinRM 接続時のユーザーを追加する、という操作は不要でございます。</p><p>— 公開情報より抜粋 —<br><br>WinRM は、ローカル管理グループまたは WinRMRemoteWMIUsers__ グループのメンバーではないすべてのユーザーにリモート アクセスを制限します。<br><br>— 公開情報より抜粋 —</p><p>// 参考情報<br>リモート接続の認証<br><br><a href="https://learn.microsoft.com/ja-jp/windows/win32/winrm/authentication-for-remote-connections">https://learn.microsoft.com/ja-jp/windows/win32/winrm/authentication-for-remote-connections</a></p><br><p>いかがでしたでしょうか。本投稿が少しでも皆様のお役に立てば幸いです。<br>本情報の内容（添付文書、リンク先などを含む）は、作成日時でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは。Windows サポートチームです。&lt;br&gt;今回は Hyper-V マネージャーを使用して、信頼関係を結んだ他ドメインに所属するHype-V ホストへ Hyper-V レプリカを構築する際</summary>
      
    
    
    
    <category term="Hyper-V" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/"/>
    
    <category term="Configuration and Management" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/Configuration-and-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>TPM-WMI イベント ID: 1801 について</title>
    <link href="https://jpwinsup.github.io/blog/2025/10/28/UEFI/Secure%20Boot/about-tpm-wmi-1801/"/>
    <id>https://jpwinsup.github.io/blog/2025/10/28/UEFI/Secure%20Boot/about-tpm-wmi-1801/</id>
    <published>2025-10-28T03:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.670Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事はマイクロソフト社員によって公開されております。  </p></blockquote><p>こんにちは、Windows サポートの丸山です。<br>本記事では、2025 年 10 月以降のセキュリティ更新プログラム適用後に記録される TPM-WMI ID: 1801 のイベントについてご案内いたします。</p><h2 id="■-概要"><a href="#■-概要" class="headerlink" title="■ 概要"></a>■ 概要</h2><p>2025 年 10 月のセキュリティ更新プログラム適用後、一部の Windows デバイスにおいて、起動時に TPM-WMI ID: 1801 のイベントが記録される事象が報告されています。本イベントは、Secure Boot 証明書の更新について、今後のセキュリティ更新を正常に受け取るために必要な対応を促すイベントであり、想定された動作です。</p><h2 id="■-事象"><a href="#■-事象" class="headerlink" title="■ 事象"></a>■ 事象</h2><p>以下の環境において、OS 起動時に次のイベントが記録される事象が報告されています。</p><h3 id="対象-OS"><a href="#対象-OS" class="headerlink" title="対象 OS"></a>対象 OS</h3><ul><li>Windows 10 version 22H2</li><li>Windows 11 version 22H2, 23H2, 24H2, 25H2</li><li>Windows 10 Enterprise LTSC 2021</li><li>Windows 11 Enterprise LTSC 2024</li><li>Windows Server 2022</li><li>Windows Server 2025</li></ul><p>また 2025 年 11 月のセキュリティ更新プログラム適用後には以下の OS バージョンにおいてもイベントが記録されます。</p><ul><li>Windows 10 Enterprise 2016 LTSB</li><li>Windows 10 Enterprise LTSC 2019</li><li>Windows Server 2016</li><li>Windows Server 2019</li></ul><h3 id="イベントの例"><a href="#イベントの例" class="headerlink" title="イベントの例"></a>イベントの例</h3><p>※ 2026-02-18 追記 : 2026 年 1 月度のセキュリティ更新プログラムに相当する更新が適用されているかどうかにより、メッセージが変わりますのでご注意ください。<br>※ 2025-12-18 追記 : 2025 年 11 月度のプレビュー更新プログラムに相当する更新が適用されているかどうかにより、メッセージが変わりますのでご注意ください。</p><h4 id="2026-年-1-月のセキュリティ更新プログラム以降のメッセージ"><a href="#2026-年-1-月のセキュリティ更新プログラム以降のメッセージ" class="headerlink" title="2026 年 1 月のセキュリティ更新プログラム以降のメッセージ"></a>2026 年 1 月のセキュリティ更新プログラム以降のメッセージ</h4><blockquote><blockquote><blockquote></blockquote><p>ログの名前: System<br>ソース: Microsoft-Windows-TPM-WMI<br>イベント ID: 1801<br>レベル: エラー<br>説明: 更新されたセキュア ブート証明書は、このデバイスで使用できますが、ファームウェアにはまだ適用されていません。公開されているガイダンスを確認し、更新を完了し、完全な保護を維持してください。このデバイス署名情報は次に含まれています。</p><blockquote></blockquote></blockquote></blockquote><p><img src="tpm-wmi-1801-2026-01-b.png" alt="図: TPM-WMI ID: 1801 イベントの例 (2026 年 1 月以降)"></p><h4 id="2025-年-11-月のプレビュー更新プログラム以降、2026-年-1-月のセキュリティ更新プログラム以前のメッセージ"><a href="#2025-年-11-月のプレビュー更新プログラム以降、2026-年-1-月のセキュリティ更新プログラム以前のメッセージ" class="headerlink" title="2025 年 11 月のプレビュー更新プログラム以降、2026 年 1 月のセキュリティ更新プログラム以前のメッセージ"></a>2025 年 11 月のプレビュー更新プログラム以降、2026 年 1 月のセキュリティ更新プログラム以前のメッセージ</h4><blockquote><blockquote><blockquote></blockquote><p>ログの名前: System<br>ソース: Microsoft-Windows-TPM-WMI<br>イベント ID: 1801<br>レベル: エラー<br>説明: セキュア ブート証明書は更新されましたが、デバイスのファームウェアにまだ適用されていません。公開されているガイダンスを確認して更新を完了し、完全な保護を確保します。このデバイス署名情報はここに含まれています。</p><blockquote></blockquote></blockquote></blockquote><p><img src="tpm-wmi-1801-11d.png" alt="図: TPM-WMI ID: 1801 イベントの例 (2025 年 11 月以降)"></p><h4 id="2025-年-11-月のプレビュー更新プログラム以前のメッセージ"><a href="#2025-年-11-月のプレビュー更新プログラム以前のメッセージ" class="headerlink" title="2025 年 11 月のプレビュー更新プログラム以前のメッセージ"></a>2025 年 11 月のプレビュー更新プログラム以前のメッセージ</h4><blockquote><blockquote><blockquote></blockquote><p>ログの名前: System<br>ソース: Microsoft-Windows-TPM-WMI<br>イベント ID: 1801<br>レベル: エラー<br>説明: セキュア ブート CA/キーを更新する必要があります。このデバイス署名情報はここに含まれています。</p><blockquote></blockquote></blockquote></blockquote><p><img src="tpm-wmi-1801.png" alt="図: TPM-WMI ID: 1801 イベントの例 (旧)"></p><h2 id="■-対処策について"><a href="#■-対処策について" class="headerlink" title="■ 対処策について"></a>■ 対処策について</h2><p>本イベントは Secure Boot 証明書の更新が未完了であることを通知する目的で記録されております。<br>本イベントへの対応方法について、ご案内させていただきます。</p><h3 id="1-手動で-Secure-Boot-証明書の更新を適用する"><a href="#1-手動で-Secure-Boot-証明書の更新を適用する" class="headerlink" title="1. 手動で Secure Boot 証明書の更新を適用する"></a>1. 手動で Secure Boot 証明書の更新を適用する</h3><p>以下のレジストリ値を設定することで、管理者は Secure Boot 証明書の手動更新を開始できます。</p><p>キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecureBoot<br>名前 : AvailableUpdates<br>種類 : REG_DWORD<br>値 : 0x5944</p><blockquote><blockquote><blockquote></blockquote><p>⚠️ 注意: Secure Boot の更新は、Windows OS だけではなく、デバイスの UEFI ファームウェア上にある証明書データベースの更新を行う必要がございます。この影響により、一部の環境では更新後、OS が起動しなくなる事象が報告されております。手動更新を実施いただく場合には、可能な限り事前に検証環境をご用意いただき、動作のご確認をお願いいたします。</p><blockquote></blockquote></blockquote></blockquote><h3 id="2-Microsoft-による自動更新の適用を待つ"><a href="#2-Microsoft-による自動更新の適用を待つ" class="headerlink" title="2. Microsoft による自動更新の適用を待つ"></a>2. Microsoft による自動更新の適用を待つ</h3><p>前述の手順にて Secure Boot 証明書の手動更新を行わない場合におきましても、Secure Boot 証明書の更新処理が安全に適用でき、”高信頼” であることが確認できたデバイスにおきましては、今後適切なタイミングで自動的な更新処理が開始される見込みでございます。</p><p>しかしながら、お使いのデバイスによりましては十分な信頼性が確認できず、手動での更新が必要となる可能性がございますので、ご注意ください。</p><h3 id="3-デバイスの提供元にご相談いただく"><a href="#3-デバイスの提供元にご相談いただく" class="headerlink" title="3. デバイスの提供元にご相談いただく"></a>3. デバイスの提供元にご相談いただく</h3><p>AvailableUpdates 値を設定し、手動更新を開始しましても、引き続き TPM-WMI ID: 1801 イベントが記録され続ける場合には、事前にファームウェア アップデートなどの対応が必要になることがございますので、デバイスの提供元様にご相談いただくことをご検討ください。</p><h2 id="■-関連情報"><a href="#■-関連情報" class="headerlink" title="■ 関連情報"></a>■ 関連情報</h2><p>Windows セキュア ブート証明書の有効期限と CA 更新プログラム<br><a href="https://support.microsoft.com/ja-jp/topic/7ff40d33-95dc-4c3c-8725-a9b95457578e">https://support.microsoft.com/ja-jp/topic/7ff40d33-95dc-4c3c-8725-a9b95457578e</a></p><p>KB5036210: セキュア ブート許可署名データベース (DB) への Windows UEFI CA 2023 証明書の展開 - Microsoft サポート<br><a href="https://support.microsoft.com/ja-jp/topic/a68a3eae-292b-4224-9490-299e303b450b">https://support.microsoft.com/ja-jp/topic/a68a3eae-292b-4224-9490-299e303b450b</a></p><p>Updating Microsoft Secure Boot keys | Windows IT Pro blog<br><a href="https://techcommunity.microsoft.com/blog/windows-itpro-blog/updating-microsoft-secure-boot-keys/4055324">https://techcommunity.microsoft.com/blog/windows-itpro-blog/updating-microsoft-secure-boot-keys/4055324</a></p><h2 id="■-更新履歴"><a href="#■-更新履歴" class="headerlink" title="■ 更新履歴"></a>■ 更新履歴</h2><ul><li>2025-10-28 本記事を新規公開しました。</li><li>2025-11-17 対象 OS を追加しました。</li><li>2025-11-18 対処策の記載内容を更新しました。</li><li>2025-12-18 2025 年 11 月度のプレビュー更新プログラム適用後のメッセージの改善について追記しました。</li><li>2026-02-18 2026 年 1 月度のセキュリティ更新プログラム適用後のメッセージの改善について追記しました。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事はマイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;こんにちは、Windows サポートの丸山です。&lt;br&gt;本記事では、2025 年 10 月以降のセキュリティ更新プログラム適用後に記録される TP</summary>
      
    
    
    
    <category term="UEFI" scheme="https://jpwinsup.github.io/blog/categories/UEFI/"/>
    
    <category term="Secure Boot" scheme="https://jpwinsup.github.io/blog/categories/UEFI/Secure-Boot/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 10 ESU に関するよくあるお問い合わせ</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/29/Activation/Windows10-ESU-QA/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/29/Activation/Windows10-ESU-QA/</id>
    <published>2025-09-29T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.305Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事はマイクロソフト社員によって公開されております。</p><p>みなさま、こんにちは。Windows サポート チームです。<br>Windows 10 のサポートは、2025 年 10 月 14 日に終了します。サポート終了後は、基本的にセキュリティ更新および技術サポートが提供されなくなりますが、ESU を適用することで、最大 3 年間セキュリティ更新を受けることができます。<br>本記事では、オンプレミス環境における Windows 10 ESU の認証に関するよくあるお問い合わせをご紹介いたします。</p><ul><li>本内容はすべて本記事記載時点の情報に基づいたものとなりますのでご留意ください。</li></ul><p>初めに、ESU 適用する必要なケースと必要でないケースについて、以下の表をご覧ください。</p><table><thead><tr><th>環境構成</th><th>ESU 適用要否</th><th>ESU キー入手要否</th><th>ESU キー提供形態</th></tr></thead><tbody><tr><td>Windows 365 <br> Azure Virtual Desktop <br> Azure 仮想マシン <br> Azure Dedicated Host <br> Azure Local (Azure Local は Azure Stack HCI の新名称) <br> Azure Stack Hub <br> Azure Stack Edge</td><td>不要</td><td>不要</td><td>N/A</td></tr><tr><td>その他の仮想化プラットフォーム (<a href="https://learn.microsoft.com/en-us/windows/whats-new/enable-extended-security-updates#cloud-and-virtualization-scenario-considerations">参考ページ</a>)</td><td>(プラットフォームによっては必要)</td><td>(プラットフォームによっては必要)</td><td>5×5 MAK キー</td></tr><tr><td>オンプレ Windows 10</td><td>必要</td><td>必要</td><td>5×5 MAK キー</td></tr><tr><td>Intune で管理された Windows 10</td><td>必要</td><td>必要</td><td>5×5 MAK キー( 配布方法は <a href="#Intune-%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%80%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%AD%E3%83%BC%E3%82%92%E9%85%8D%E5%B8%83%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">「Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？」</a> を参照)</td></tr></tbody></table><p>上記のオンプレ Windows 10 環境を利用する場合、5x5 MAK キーによる適用が必要となるため、MAK キーによる適用に関連する Q&amp;A を以下に記載します。</p><h1 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h1><h2 id="セクション1-ESU-の導入とライセンス認証方法"><a href="#セクション1-ESU-の導入とライセンス認証方法" class="headerlink" title="セクション1: ESU の導入とライセンス認証方法"></a>セクション1: ESU の導入とライセンス認証方法</h2><p>-<a href="#MAK-%E3%82%AD%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B-Windows-10-ESU-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%81%84%E3%81%A7%E3%81%99%E3%81%8C%E3%80%81%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%82%88%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？</a></p><p>-<a href="#KMS-%E7%92%B0%E5%A2%83%E3%81%A7%E9%81%8B%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8C%E3%80%81ESU-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E4%BD%95%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">KMS 環境で運用していますが、ESU を適用するには何が必要ですか</a></p><p>-<a href="#Windows-10-ESU-%E3%82%92%E4%B8%80%E6%8B%AC%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">Windows 10 ESU を一括適用することができますか？</a></p><p>-<a href="#Sysprep-%E5%AE%9F%E8%A1%8C%E5%BE%8C%E3%81%AE%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E5%86%8D%E8%AA%8D%E8%A8%BC%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">Sysprep 実行後のライセンス再認証は必要ですか？</a></p><p>-<a href="#%E9%81%A9%E7%94%A8%E6%B8%88%E3%81%BF%E3%81%AE-ESU-%E3%82%92%E5%A4%B1%E5%8A%B9%E3%81%95%E3%81%9B%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E5%87%BA%E6%9D%A5%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">適用済みの ESU を失効させることが出来ますか？</a></p><p>-<a href="#VAMT-%E3%81%A7-Windows-10-ESU-%E3%82%AD%E3%83%BC%E3%82%92%E5%B1%95%E9%96%8B%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">VAMT で Windows 10 ESU キーを展開できますか？</a></p><p>-<a href="#Intune-%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E7%AB%AF%E6%9C%AB%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%80%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%AD%E3%83%BC%E3%82%92%E9%85%8D%E5%B8%83%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">Intune で複数の端末に対して、ライセンスキーを配布可能ですか？</a></p><h2 id="セクション2-運用環境への影響・周辺設定"><a href="#セクション2-運用環境への影響・周辺設定" class="headerlink" title="セクション2: 運用環境への影響・周辺設定"></a>セクション2: 運用環境への影響・周辺設定</h2><p>-<a href="#WSUS-%E3%82%84-SCCM-%E3%81%AB%E4%BD%95%E3%81%8B%E6%89%8B%E3%82%92%E5%8A%A0%E3%81%88%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">WSUS や SCCM に何か手を加える必要がありますか？</a></p><p>-<a href="#ESU-%E3%81%AE%E9%81%A9%E7%94%A8%E5%BE%8C%E3%80%81%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E9%85%8D%E4%BF%A1%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？</a></p><h2 id="セクション3-年次更新とエディション対応"><a href="#セクション3-年次更新とエディション対応" class="headerlink" title="セクション3: 年次更新とエディション対応"></a>セクション3: 年次更新とエディション対応</h2><p>-<a href="#ESU-%E7%94%A8%E3%81%AE-MAK-%E3%82%AD%E3%83%BC%E3%81%AF%E6%AF%8E%E5%B9%B4%E6%9B%B4%E6%96%B0%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU 用の MAK キーは毎年更新されますか？</a></p><p>-<a href="#ESU-%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%A8%E3%83%87%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE-Windows-10-%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">ESU はどのエディションの Windows 10 に適用できますか？</a></p><p>-<a href="#ESU-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AE%E9%96%8B%E5%A7%8B%E6%97%A5%E3%81%AF%E3%81%84%E3%81%A4%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU サポートの開始日はいつですか？</a></p><h2 id="セクション4-認証要件・接続条件"><a href="#セクション4-認証要件・接続条件" class="headerlink" title="セクション4: 認証要件・接続条件"></a>セクション4: 認証要件・接続条件</h2><p>-<a href="#ESU-%E8%AA%8D%E8%A8%BC%E7%94%A8%E3%81%AE-URLxxx-%E3%81%AE%E3%81%BF%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%97%E3%81%A6%E3%82%82%E5%A4%A7%E4%B8%88%E5%A4%AB%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU 認証用の URL の一部だけブロックしても大丈夫ですか？</a></p><p>-<a href="#ESU-%E3%81%AE-MAK-%E3%82%AD%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E8%AA%8D%E8%A8%BC%E3%81%AB-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-%E3%81%AF%E5%BF%85%E8%A6%81%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？</a></p><p>-<a href="#KMS-%E3%83%9B%E3%82%B9%E3%83%88%E3%81%A7-ESU-%E3%82%92%E8%AA%8D%E8%A8%BC%E5%8F%AF%E8%83%BD%E3%81%A7%E3%81%99%E3%81%8B%EF%BC%9F">KMS ホストで ESU を認証可能ですか？</a></p><hr><h2 id="MAK-キーによる-Windows-10-ESU-を適用したいですが、どうすればよいですか？"><a href="#MAK-キーによる-Windows-10-ESU-を適用したいですが、どうすればよいですか？" class="headerlink" title="MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？"></a>MAK キーによる Windows 10 ESU を適用したいですが、どうすればよいですか？</h2><p>Windows 10 ESU 対応手順は、以下の公開情報にまとまっております。<br>下記に公開情報の手順を詳細に記載しておりますのでご参照ください。</p><p>Title:拡張セキュリティ更新プログラム (ESU) を有効にする<br>URL:<a href="https://learn.microsoft.com/en-us/windows/whats-new/enable-extended-security-updates">https://learn.microsoft.com/en-us/windows/whats-new/enable-extended-security-updates</a></p><p>■ 前提条件</p><ol><li><p>Windows 10 バージョン 22H2  がインストールされており、かつ、2025 年 10 月 14 日 KB5066791 が適用されていること。</p></li><li><p>KB5066791 以降を適用後に、拡張セキュリティ Updates (ESU) ライセンス準備パッケージ KB5072653 をインストールしていること。</p></li><li><p>以下のエンドポイントに接続できること。<br>　<a href="https://go.microsoft.com/">https://go.microsoft.com/</a><br>　<a href="https://login.live.com/">https://login.live.com</a><br>　<a href="https://activation.sls.microsoft.com/">https://activation.sls.microsoft.com/</a><br>　<a href="http://crl.microsoft.com/">http://crl.microsoft.com/</a><br>　<a href="https://validation.sls.microsoft.com/">https://validation.sls.microsoft.com/</a><br>　<a href="https://activation-v2.sls.microsoft.com/">https://activation-v2.sls.microsoft.com/</a><br>　<a href="https://validation-v2.sls.microsoft.com/">https://validation-v2.sls.microsoft.com/</a><br>　<a href="https://displaycatalog.mp.microsoft.com/">https://displaycatalog.mp.microsoft.com/</a><br>　<a href="https://licensing.mp.microsoft.com/">https://licensing.mp.microsoft.com/</a><br>　<a href="https://purchase.mp.microsoft.com/">https://purchase.mp.microsoft.com/</a><br>　<a href="https://displaycatalog.md.mp.microsoft.com/">https://displaycatalog.md.mp.microsoft.com/</a><br>　<a href="https://licensing.md.mp.microsoft.com/">https://licensing.md.mp.microsoft.com/</a><br>　<a href="https://purchase.md.mp.microsoft.com/">https://purchase.md.mp.microsoft.com/</a><br>※1. <a href="http://crl.microsoft.com/pki">http://crl.microsoft.com/pki</a><br>※2. <a href="http://www.microsoft.com/pkiops">http://www.microsoft.com/pkiops</a><br>※端末によって中間証明書の取得が必要となるため、※1,2 に接続できる必要がある。  </p></li></ol><ol start="4"><li>ESU プロダクトキーを入手していること。  </li></ol><p>　ESU のプロダクトキーの入手方法:<br>　(1) Microsoft 365 管理センターにアクセスします。<br>　<a href="https://admin.microsoft.com/Adminportal/Home#/homepage">https://admin.microsoft.com/Adminportal/Home#/homepage</a>  </p><p>　※ Microsoft 365 管理センターへのサインインについては以下の公開情報もご参照ください。<br>　　Title:Microsoft 365 管理センター (ボリューム ライセンス) にサインインします<br>　　URL:<a href="https://learn.microsoft.com/en-us/microsoft-365/commerce/licenses/vl-sign-in?view=o365-worldwide">https://learn.microsoft.com/en-us/microsoft-365/commerce/licenses/vl-sign-in?view=o365-worldwide</a><br>　<br>　(2) 管理センターで [課金] -&gt; [製品] ページに移動し、[ボリューム ライセンス] を選択します。<br>　(3) [契約] セクションで [契約の表示] を選択します。<br>　(4) [契約] ページで ESU ライセンスのライセンス認証 ID を探し、選択し [プロダクト キーの表示] を選択します。<br>　　※[プロダクト キーの詳細] ページには、契約の詳細とその契約のすべてのキーが表示されます。</p><p>■ ESU ライセンス認証手順 (インターネット経由):</p><ol><li><p>コマンド プロンプトを管理者として実行します。</p></li><li><p>以下のコマンドを実行して、ESU プロダクト キーをインストールします。<br> ESU プロダクトキーは Microsoft 365 管理センターで入手したプロダト キーです。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk ＜ESU プロダクト キー＞</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure><p> プロダクト キーのインストールに成功すると、プロダクト キーが正常にインストールされた旨のメッセージが表示されます。</p></li><li><p>次の表から今回 ESU ライセンス認証を実行する ESU Activation ID を確認します。<br>　<br>ESU Program    Activation ID<br>Win10 ESU Year1    f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2    1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3    83d49986-add3-41d7-ba33-87c7bfb5c0fb<br>※ Activation ID は、対象となるすべての Windows ESU エディションと、そのプログラムに登録されているすべてのデバイスで同じです。</p></li><li><p>以下のコマンドを実行して、ライセンス認証を行います。<br>　Activation ID は上記 Activation ID の一覧から確認したものに置き換えます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ato &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(例) 1 年目の認証を行う場合</span><br><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;ato f520e45e-7413-4a34-a497-d2765967d094</span><br></pre></td></tr></table></figure><p>　ライセンス認証に成功すると、コマンドの実行結果に正常にライセンス認証された旨のメッセージが表示されます。</p></li></ol><ol start="5"><li>念のため、以下のコマンドを実行して、現在のライセンス認証の状態を確認します。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dlv</span><br></pre></td></tr></table></figure>　出力結果に対応する ESU プログラムの名前とその ESU の “ライセンスの状態” が “ライセンスされています” と表示されていれば問題ございません。<br>(英語表記の場合は “LICENSE STATUS” に “LICENSED”。)</li></ol><p>■ ESU ライセンス認証手順 (電話経由):</p><ol><li><p>コマンド プロンプトを管理者として実行します。</p></li><li><p>以下のコマンドを実行して、ESU プロダクト キーをインストールします。<br> ESU プロダクト キーは Microsoft 365 管理センターで入手したプロダクト キーです。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk ＜ESU プロダクト キー＞</span><br><span class="line">(例) cscript %WinDir%\system32\slmgr.vbs &#x2F;ipk XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span><br></pre></td></tr></table></figure><p> プロダクト キーのインストールに成功すると、プロダクト キーが正常にインストールされた旨のメッセージが表示されます。</p></li></ol><ol start="3"><li><p>次の表から今回 ESU ライセンス認証を実行する ESU Activation ID を確認します。<br>　<br>ESU Program    Activation ID<br>Win10 ESU Year1    f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2    1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3    83d49986-add3-41d7-ba33-87c7bfb5c0fb<br>※ Activation ID は、対象となるすべての Windows ESU エディションと、そのプログラムに登録されているすべてのデバイスで同じです。</p></li><li><p>以下のコマンドを実行し、インストール ID を確認します。<br>Activation ID は上記 Activation ID の一覧から確認したものに置き換えます。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dti &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><p>※ この後の手順でインストール ID を使用します。<br>メモ帳などのテキスト エディターにコピーし、以下のように 6 桁毎もしくは 7 桁毎に区切っておいていただくことをお勧めいたします。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　  (例)    xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx-xxxxxx</span><br></pre></td></tr></table></figure><ol start="5"><li><p>以下のブログに記載されている [認証手順] 4.- 13. を実施し、確認 ID を取得します。</p><p> <a href="https://jpwinsup.github.io/blog/2025/12/11/Activation/PhoneActivation-changed/#%E8%AA%8D%E8%A8%BC%E6%89%8B%E9%A0%86">認証手順</a>  </p></li><li><p>認証対象の PC 上で以下のコマンドで、確認 ID を入力しライセンス認証を行います。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;atp &lt;確認 ID&gt; &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><p>(例) 1 年目の認証を行う場合</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript %WinDir%\system32\slmgr.vbs &#x2F;atp xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx f520e45e-7413-4a34-a497-d2765967d094</span><br></pre></td></tr></table></figure><p>   上記コマンドが正しく実行されると、確認 ID が正常に登録された旨のメッセージが表示されます。</p><ol start="7"><li>念のため、以下のコマンドを実行して、現在のライセンス認証の状態を確認します。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　cscript %WinDir%\system32\slmgr.vbs &#x2F;dlv</span><br></pre></td></tr></table></figure>出力結果に対応する ESU プログラムの名前とその ESU の “ライセンスの状態” が “ライセンスされています” と表示されていれば問題ございません。<br>(英語表記の場合は “LICENSE STATUS” に “LICENSED”。)</li></ol><hr><h2 id="WSUS-や-SCCM-に何か手を加える必要がありますか？"><a href="#WSUS-や-SCCM-に何か手を加える必要がありますか？" class="headerlink" title="WSUS や SCCM に何か手を加える必要がありますか？"></a>WSUS や SCCM に何か手を加える必要がありますか？</h2><p>ESU の更新プログラムはすべて従来の更新プログラムと同様なチャンネルで配信しております。<br>そのため、通常通り WSUS、Windows Update および Microsoft カタログ サイトから取得可能となり、<br>これまでに WSUS サーバーに参照して、WSUS から更新プログラムを取得しているクライアントに関しては、<br>ESU 開始後にも WSUS サーバーから取得できるようになります。<br>(通常通り個々の更新プログラムに対して WSUS 側での承認作業が必要となります。)</p><p>WSUS に関しては追加作業や設定変更はございませんが、<br>WSUS から取得した ESU の更新プログラムを各端末に適用可能にするには、<br>各クライアント端末にて、ESU 専用の MAK キーのインストールおよび認証作業を実施していただく必要がございます。<br>この ESU 専用の MAK キーのインストールおよび認証作業を実施しても、<br>WSUS 関連の設定や既存の OS のライセンス認証に影響を与えることは一切ありません。</p><hr><h2 id="ESU-用の-MAK-キーは毎年更新されますか？"><a href="#ESU-用の-MAK-キーは毎年更新されますか？" class="headerlink" title="ESU 用の MAK キーは毎年更新されますか？"></a>ESU 用の MAK キーは毎年更新されますか？</h2><p>はい、ESU は年間の契約となり、お客様の契約内容によって認証可能なデバイス数なども異なるため、毎年異なる MAK キーが発行されます。そのため、契約ごとに発行された MAK キーのインストールおよびライセンス認証は必ず必要となります。</p><hr><h2 id="KMS-環境で運用していますが、ESU-を適用するには何が必要ですか？"><a href="#KMS-環境で運用していますが、ESU-を適用するには何が必要ですか？" class="headerlink" title="KMS 環境で運用していますが、ESU を適用するには何が必要ですか？"></a>KMS 環境で運用していますが、ESU を適用するには何が必要ですか？</h2><p>ESU 有効化のために MAK 認証は既存の OS のライセンス認証を置き換えるものではなく、既存の OS ライセンス認証をこのまま維持したうえで、追加で ESU 有効化用の MAK キーをインストールし、認証していただく形となります。</p><p>既存の環境に対して、 ESU 専用の MAK のインストールおよび (電話もしくはインターネットによる) MAK キーのライセンス認証を行っていただくことで、ESU のセキュリティ更新の適用が可能となります。(ESU 専用の MAK キーのインストールおよび認証作業を実施しない限り、ESU のセキュリティ更新を入手しても OS に適用することはできません。)</p><p>また、今回のシナリオにおいて、上記作業はすべてエンドユーザー側にて各 OS に対して実施していただく必要があり、KCPS IaaS の基盤側における変更や操作は一切必要ございません。(このまま KCPS IaaS 上の KMS サーバーに参照するような設定で運用していただいて問題ございません)</p><hr><h2 id="ESU-認証用の-URLxxx-のみブロックしても大丈夫ですか？"><a href="#ESU-認証用の-URLxxx-のみブロックしても大丈夫ですか？" class="headerlink" title="ESU 認証用の URLｘｘｘ のみブロックしても大丈夫ですか？"></a>ESU 認証用の URLｘｘｘ のみブロックしても大丈夫ですか？</h2><p>以下の公開情報に記載されている URL は ESU 認証を行うための前提条件となっております。<br>そのため、原則すべて許可していただく必要がございます。</p><p>タイトル：前提条件<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/whats-new/enable-extended-security-updates#prerequisites">https://learn.microsoft.com/ja-jp/windows/whats-new/enable-extended-security-updates#prerequisites</a>  </p><blockquote><p>ESU for Windows 10を有効にするには、次の前提条件を満たす必要があります。<br>Windows 10、バージョン 22H2 とKB5046613、またはそれ以降の更新プログラムがインストールされている<br>デバイスの管理特権<br>クライアントのアクティブ化のエンドポイント:<br><a href="https://go.microsoft.com/">https://go.microsoft.com/</a><br><a href="https://login.live.com/">https://login.live.com</a><br><a href="https://activation.sls.microsoft.com/">https://activation.sls.microsoft.com/</a><br><a href="http://crl.microsoft.com/">http://crl.microsoft.com/</a><br><a href="https://validation.sls.microsoft.com/">https://validation.sls.microsoft.com/</a><br><a href="https://activation-v2.sls.microsoft.com/">https://activation-v2.sls.microsoft.com/</a><br><a href="https://validation-v2.sls.microsoft.com/">https://validation-v2.sls.microsoft.com/</a><br><a href="https://displaycatalog.mp.microsoft.com/">https://displaycatalog.mp.microsoft.com/</a><br><a href="https://licensing.mp.microsoft.com/">https://licensing.mp.microsoft.com/</a><br><a href="https://purchase.mp.microsoft.com/">https://purchase.mp.microsoft.com/</a><br><a href="https://displaycatalog.md.mp.microsoft.com/">https://displaycatalog.md.mp.microsoft.com/</a><br><a href="https://licensing.md.mp.microsoft.com/">https://licensing.md.mp.microsoft.com/</a><br><a href="https://purchase.md.mp.microsoft.com/">https://purchase.md.mp.microsoft.com/</a>  </p></blockquote><h2 id="Windows-10-ESU-を一括適用することができますか？"><a href="#Windows-10-ESU-を一括適用することができますか？" class="headerlink" title="Windows 10 ESU を一括適用することができますか？"></a>Windows 10 ESU を一括適用することができますか？</h2><p>インターネット接続できる環境であれば、「ESU ライセンス認証手順 (インターネット経由)」に記載されているコマンドを何等かの方法でクライアント端末で実行させれば、ESU を認証することが可能です。</p><p>インターネット接続なし、かつ複数台で電話認証が現実的に実施できない場合には、VAMT というツールが用意されており、クライアント OS の代わりに、本ツールでライセンス認証を実施することが可能です。<br>なお、VAMT については、無料で提供されているものであるため、技術サポートはベスト エフォートでの対応となり、製品側の不具合がある場合は修正を受け付けできないこと、ご了承ください。  </p><p>また、ご利用にあたり、VAMTの構築が必要になりますので、必要に応じて下記の公開情報をご参考ください。<br>タイトル：ボリューム ライセンス認証管理ツール (VAMT) テクニカル リファレンス<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/volume-activation-management-tool">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/volume-activation-management-tool</a></p><hr><h2 id="Sysprep-実行後のライセンス再認証は必要ですか？"><a href="#Sysprep-実行後のライセンス再認証は必要ですか？" class="headerlink" title="Sysprep 実行後のライセンス再認証は必要ですか？"></a>Sysprep 実行後のライセンス再認証は必要ですか？</h2><p>はい。Sysprep 実行後は端末の固有情報が初期化されるため、ESU ライセンスの再認証が必要になります。再認証には同じキーを使用できますが、認証回数が減る点に注意が必要です 。  </p><hr><h2 id="適用済みの-ESU-を失効させることが出来ますか？"><a href="#適用済みの-ESU-を失効させることが出来ますか？" class="headerlink" title="適用済みの ESU を失効させることが出来ますか？"></a>適用済みの ESU を失効させることが出来ますか？</h2><p>以下のコマンドを実行することで、該当端末で ESU キーをアンインストールすることが可能です。<br>ただし、アンインストールしても、ESU キーの残数が +1 に戻ることがありませんので、ご留意ください。  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slmgr.vbs &#x2F;upk &lt;Activation ID&gt;</span><br></pre></td></tr></table></figure><p>■ご参考: 各 Activation ID<br>Win10 ESU Year1: f520e45e-7413-4a34-a497-d2765967d094<br>Win10 ESU Year2: 1043add5-23b1-4afb-9a0f-64343c8f3f8d<br>Win10 ESU Year3: 83d49986-add3-41d7-ba33-87c7bfb5c0fb  </p><hr><h2 id="ESU-はどのエディションの-Windows-10-に適用できますか？"><a href="#ESU-はどのエディションの-Windows-10-に適用できますか？" class="headerlink" title="ESU はどのエディションの Windows 10 に適用できますか？"></a>ESU はどのエディションの Windows 10 に適用できますか？</h2><p>Windows 10 の ESU 対象エディションには、Home, Education、Pro,Pro for Workstations, Pro Education および  Enterprise が含まれます。  </p><hr><h2 id="ESU-の-MAK-キーを使った認証に-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-は必要ですか？"><a href="#ESU-の-MAK-キーを使った認証に-Microsoft-Entra-joined-Microsoft-Entra-hybrid-joined-は必要ですか？" class="headerlink" title="ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？"></a>ESU の MAK キーを使った認証に Microsoft Entra joined / Microsoft Entra hybrid joined は必要ですか？</h2><p>いいえ、通常の 5x5 MAK Microsoft Entra joined 参加 や Microsoft Entra hybrid joined 参加 は不要です。Microsoft Entra joined / Microsoft Entra hybrid joined が必要なのは、クラウドベースの ESU サブスクリプション方式に限られます 。</p><hr><h2 id="ESU-の適用後、セキュリティ更新プログラムはどのように配信されますか？"><a href="#ESU-の適用後、セキュリティ更新プログラムはどのように配信されますか？" class="headerlink" title="ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？"></a>ESU の適用後、セキュリティ更新プログラムはどのように配信されますか？</h2><p>ESU 適用後は、Windows Update、WSUS、Intune などの既存の配信チャネルを通じてセキュリティ更新プログラムが配信されます。</p><hr><h2 id="VAMT-で-Windows-10-ESU-キーを展開できますか？"><a href="#VAMT-で-Windows-10-ESU-キーを展開できますか？" class="headerlink" title="VAMT で Windows 10 ESU キーを展開できますか？"></a>VAMT で Windows 10 ESU キーを展開できますか？</h2><p>VAMT を構築済みで、かつ以下の前提条件を満たした場合、VAMT で Windows 10 ESU キーを展開できます。</p><p>■ 前提条件1<br>クライアント側で、本記事 A1 で記載した Windows 10 ESU 公開情報にある前提条件を満たした。</p><p>■ 前提条件2<br>各クライアント端末側で以下の設定を行っている。</p><p>＜事前設定 1＞<br>各クライアント端末において、Windows ファイアウォールより設定する場合は、以下の操作を行います。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1) [コントロール パネル] - [Windows ファイアウォール] を開きます。</span><br><span class="line"> </span><br><span class="line">2) [Windows ファイアウォールを介したアプリまたは機能を許可] をクリックします。</span><br><span class="line"> </span><br><span class="line">3) 表示された一覧がグレー アウトしている場合は、[設定の変更] ボタンをクリックします。</span><br><span class="line"> </span><br><span class="line">4) [Windows Management Instrumentation (WMI)] のチェックをオンにします。</span><br><span class="line"> </span><br><span class="line">5) [OK] ボタンをクリックします。</span><br></pre></td></tr></table></figure><br> 警告 既定では、Windows ファイアウォールの例外は、ローカルサブネットで送信されたトラフィックにのみ適用されます。<br> 複数のサブネットに適用する例外を展開するには、以下で説明するように、セキュリティが強化された Windows ファイアウォールの<br>例外設定を変更する必要があります。 </p><p>＜コマンドで実行する場合＞<br>以下の内容をバッチ実行する。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall set rule group&#x3D;&quot;windows management instrumentation (wmi)&quot; new enable&#x3D;yes</span><br></pre></td></tr></table></figure><ul><li>参考情報<br><a href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista">https://docs.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista</a><br>※上記の設定は、Sysprep 後も保持されます。</li></ul><p>＜事前設定 2＞<br>ワークグループ環境の場合、各クライアント端末において、以下のレジストリの設定も行っていただく必要がございます。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">キー : HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</span><br><span class="line">種類 : REG_DWORD</span><br><span class="line">名前 : LocalAccountTokenFilterPolicy</span><br><span class="line">データ : 1</span><br></pre></td></tr></table></figure><br>※上記のレジストリ設定は、Sysprep 後も保持されます。</p><ul><li>参考情報<br>クライアント端末での設定につきましては、以下の公開情報にも掲載しておりますので、あわせてご参照ください。</li></ul><p>※ 複数のサブネットにわたる VAMT アクセスを許可する場合の設定などについても掲載しております。</p><p>Configure client computers<br><a href="https://learn.microsoft.com/en-us/windows/deployment/volume-activation/configure-client-computers-vamt">https://learn.microsoft.com/en-us/windows/deployment/volume-activation/configure-client-computers-vamt</a><br><a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/configure-client-computers-vamt">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/configure-client-computers-vamt</a> (機械翻訳)  </p><p>■ VAMT を使った Windows 10 ESU キーの展開手順</p><p>1.下記サイトより VAMT-ESU 構成ファイルをダウンロードします。</p><p>タイトル: VAMT- ESU Configuration March 2025<br>アドレス:  <a href="https://www.microsoft.com/en-us/download/details.aspx?id=106364">https://www.microsoft.com/en-us/download/details.aspx?id=106364</a>  </p><ol start="2"><li><p>ダウンロードした構成ファイル (pkconfig_win10_esu.xrm-ms) を以下のパスに配置します。<br>  C:\Program Files (x86)\Windows Kits\10\Assessment and Deployment Kit\VAMT3\pkconfig</p></li><li><p>VAMT を起動し、左ペインにある [Product Keys] を選択し右クリックメニューから [Add Product Keys] を押下します。</p></li><li><p>表示されたウインドウに入手した ESU キーを入力し [Add Key(s)] 押下で追加します。<br><img src="./step4.png"></p></li></ol><ol start="5"><li>次に左ペインにある [Products] &gt; [Windows] を選択し、右クリックメニューから [Discover products…] を押下します。<br><img src="./step5.png"></li></ol><ol start="6"><li>表示されたウインドウにてプルダウンメニューから ESU キーのインストールを行うクライアントの検索方法を選択し、検索句を入力後、 [Search] を押下して検索を行います。</li></ol><p>例1) ドメインに参加しているコンピューターを検索する場合<br>(ドメイン名: testDomain.com / コンピューター名: 対象のコンピューターが例えば “WIN10” から始まる場合 “WIN10*” で検索対象をフィルターすることが出来ます。)<br><img src="./step6.png"></p><p>例2) 個々のコンピューター名や IP アドレスで検索する場合<br>(画像では “WIN10PC” という名称のコンピューターを追加したい場合の入力例)<br> <img src="./step6-2.png"></p><p>利用可能な検索方法などにつきましては下記弊社公開情報もご参照ください。</p><ul><li>参考情報<br>タイトル: コンピューターの追加と削除<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/add-remove-computers-vamt">https://learn.microsoft.com/ja-jp/windows/deployment/volume-activation/add-remove-computers-vamt</a>  </li></ul><ol start="7"><li>検索に成功した場合、以下のようなダイアログが表示されます。<br><img src="./step7.png"></li></ol><ol start="8"><li>コンピューターが追加されましたら、クライアントの情報を収集するために追加されたコンピューターを選択し、右クリックメニューから [Update license status] &gt; [Current credential] もしくは [Alternate credential…] を押下します。<br><img src="./step8.png"></li></ol><p>※ [Current credential] と [Alternate credential…] について</p><ul><li><p>VAMT を使用している端末にログオンしているユーザーが、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーである場合は、[Current credential] をクリックします。</p></li><li><p>VAMT を使用している端末にログオンしているユーザーが、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーではない場合は、[Alternate credential] をクリックすると、ユーザー名とパスワードの入力画面が表示されますので、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p></li></ul><p>(ユーザー名 / パスワードの入力画面サンプル)<br><img src="./step8-2.png"></p><ol start="9"><li>以下の画像のように情報収集が完了しましたら [Close] を押下し、ウインドウを閉じます。<br><img src="./step9.png"></li></ol><ol start="10"><li>ESU キーをインストールしたい端末を選択し、右クリックメニューから [Install product key…] を押下します。 (CtrlキーまたはShiftキーを用いて一度に複数選択も可能です。)<br><img src="./step10.png"></li></ol><ol start="11"><li>表示されたウインドウにてインストールを行う ESU キーを選択し、 [Install Key] を押下します。<br><img src="./step11.png"></li></ol><p>※「8.」 にて [Alternate credential…] を選択した場合は本画面においても左下の [Use Alternate Credentials] にチェックを入れ、 [Install Key] 押下後に表示されるユーザー名とパスワードの入力画面にて、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p><ol start="12"><li>以下の画像のようにキーのインストールが完了しましたら [Close] を押下し、ウインドウを閉じます。<br><img src="./step12.png"></li></ol><ol start="13"><li>キーのインストールが完了しましたら、次に認証を行います。認証するクライアントと ESU キーの組み合わせを選択し、右クリックメニューから [Activate] &gt; [Online activate] もしくは [Proxy activate…] を押下します。<br><img src="./step13.png"></li></ol><p>※ [Online activate] と [Proxy activate…] について</p><ul><li><p>該当のクライアントが直接インターネットに接続可能な場合は [Online activate] より [Current credential] もしくは [Alternate credential…] を押下し認証します。</p></li><li><p>該当のクライアントがインターネットに接続できない場合は代わりに VAMT にて代理 (Proxy) で認証を行うために [Proxy activate…] を押下します。</p></li></ul><ol start="14"><li>([Proxy activate…] を押下した場合のみ) 表示されたウインドウにて [Acquire confirmation ID, apply to selected machine(s) and activate] のラジオボタンを選択し、 [OK] を押下します。<br><img src="./step14.png"></li></ol><p>※「8.」 にて [Alternate credential…] を選択した場合は本画面においても [Use Alternate Credentials when applying confirmation ID] にチェックを入れ、 [OK] 押下後に表示されるユーザー名とパスワードの入力画面にて、クライアント端末の Administrators グループ (ローカル管理者権限) のユーザーのユーザー名およびパスワードを入力します。</p><ol start="15"><li>[Online activate] の場合はウインドウが 1 回、 [Proxy activate…] の場合は 2 回ウインドウが表示されますので、それぞれ処理が完了しましたら [Close] を押下します。</li></ol><p>[Online activate] の場合)<br><img src="./step15.png"></p><p> [Proxy activate…] の場合)<br>●1 回目 (Confirmation ID の 取得)<br><img src="./step15-2.png"></p><p>●2 回目 (取得した Confirmation ID のクライアントへの適用)<br><img src="./step15-3.png"></p><p>※ [Automatically close when done] にチェックを入れることでウインドウを自動で閉じることも可能です。</p><ol start="16"><li>認証が完了し、インストールした ESU キーについて [License Status] 列が “Licensed” となっていることを確認します。<br><img src="./step16.png"></li></ol><p>これにて ESU の適用が完了となります。</p><hr><p>▼参考<br>手順完了後の端末の状態 (slmgr /dlv の結果)<br>端末側でも ESU Year1 のキーが “ライセンスされています” になっていることが確認できる。<br><img src="./step16-2.png"></p><hr><h2 id="Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？"><a href="#Intune-で複数の端末に対して、ライセンスキーを配布可能ですか？" class="headerlink" title="Intune で複数の端末に対して、ライセンスキーを配布可能ですか？"></a>Intune で複数の端末に対して、ライセンスキーを配布可能ですか？</h2><p>はい、Intune Win32 アプリもしくは PowerShell スクリプトの修復にて ESU ライセンスキーを配布することが可能です。<br>具体的なやり方については、以下の情報をご参考ください。</p><ul><li>Enabling Extended Security Updates (ESU) for Windows 10 with Intune<br><a href="https://techcommunity.microsoft.com/blog/coreinfrastructureandsecurityblog/enabling-extended-security-updates-esu-for-windows-10-with-intune/4420182">https://techcommunity.microsoft.com/blog/coreinfrastructureandsecurityblog/enabling-extended-security-updates-esu-for-windows-10-with-intune/4420182</a></li></ul><hr><h2 id="KMS-ホストで-ESU-を認証可能ですか？"><a href="#KMS-ホストで-ESU-を認証可能ですか？" class="headerlink" title="KMS ホストで ESU を認証可能ですか？"></a>KMS ホストで ESU を認証可能ですか？</h2><p>ESU は MAK キーによる認証方式となっているため、KMS ホストでは認証できません。</p><hr><h2 id="ESU-サポートの開始日はいつですか？"><a href="#ESU-サポートの開始日はいつですか？" class="headerlink" title="ESU サポートの開始日はいつですか？"></a>ESU サポートの開始日はいつですか？</h2><p>ESU サポートの開始日は 2025 年 10 月 14 日です。（Windows 10 のサポート終了日と同じ日です。）<br><a href="https://learn.microsoft.com/en-us/lifecycle/faq/extended-security-updates#esu-availability-and-end-dates">https://learn.microsoft.com/en-us/lifecycle/faq/extended-security-updates#esu-availability-and-end-dates</a></p><hr><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/09/30 : 本ブログの公開<br>2025/10/06 : Azure VMware Solution (Nutanix など) に ESU の適用が必要であることを明記<br>2025/11/14 : Azure VMware Solution (Nutanix など) 、プラットフォームによって ESU の適用が必要であることに変更<br>2025/12/11 : 新しい電話認証手順を引用。ESU 認証に必要なエンドポイントを追加。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Windows サポート チームです。&lt;br&gt;Windows 10 のサポートは、2025 年 10 月 14 日に終了します。サポート終了後は、基本的にセキュリティ更新および技術</summary>
      
    
    
    
    <category term="Activation" scheme="https://jpwinsup.github.io/blog/categories/Activation/"/>
    
    <category term="ESU" scheme="https://jpwinsup.github.io/blog/categories/Activation/ESU/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 11 へアップグレードしましょう！</title>
    <link href="https://jpwinsup.github.io/blog/2025/09/29/Setup/FU/FU_Win10EOS/"/>
    <id>https://jpwinsup.github.io/blog/2025/09/29/Setup/FU/FU_Win10EOS/</id>
    <published>2025-09-29T15:00:00.000Z</published>
    <updated>2026-02-19T02:53:58.603Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Windows Commercial Support Device and Deployment チームの堀之内です。  </p><p>この記事では<br>・Windows 11 へのアップグレードをスムーズに進めるための準備<br>・よくあるトラブルと、解決方法の紹介<br>についてご紹介いたします。  </p><p>まずは、今この記事を公開する理由から説明させていただきます。</p><h2 id="アップグレードが必要になる背景"><a href="#アップグレードが必要になる背景" class="headerlink" title="アップグレードが必要になる背景"></a>アップグレードが必要になる背景</h2><p>皆様に長くご利用いただいている Windows 10 ですが、実は発売されたのが 2015 年 7 月 29 日でした。<br>つまり、発売からほぼ 10 年経過したことになりますが、10 年目となる今年 (2025 年) の 10 月 14 日をもちまして、いよいよWindows 10 のサポートが終了いたします。  </p><p><a href="https://support.microsoft.com/ja-jp/windows/2ca8b313-1946-43d3-b55c-2b95b107f281">https://support.microsoft.com/ja-jp/windows/2ca8b313-1946-43d3-b55c-2b95b107f281</a>  </p><p>OS がサポート終了日を迎えると、その OS に対するセキュリティ更新や技術サポートは提供されなくなります。<br>つまり、サポートが切れた OS を利用を続ける = 重大なセキュリティリスクを抱えたままになる、ということになります。<br>安全な環境を維持するためにも、現時点で Windows 10 をご利用になられている方は、Windows 11 への移行を是非ご検討ください。  </p><p>本記事は、ご利用中の Windows 10 を Windows 11 にアップグレードしようとした時に発生しがちなトラブルに対する対処方法を、サポートの観点から対処しやすい順にまとめました。<br>また、全て実施した上でも解決できない場合、弊社有償サポートをご契約いただいているお客様は、文末の情報と合わせてお問い合わせをいただく事で、切り分けや情報取得に時間をかけることなく、迅速にサポートの提供が可能となります。  </p><h1 id="Windows-11-アップグレード：お試しいただきたい手順まとめ"><a href="#Windows-11-アップグレード：お試しいただきたい手順まとめ" class="headerlink" title="Windows 11 アップグレード：お試しいただきたい手順まとめ"></a>Windows 11 アップグレード：お試しいただきたい手順まとめ</h1><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><p>-<a href="#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB%EF%BC%88%E6%BA%96%E5%82%99%E3%81%AE%E3%81%8A%E9%A1%98%E3%81%84%EF%BC%89">0- はじめに (準備のお願い)</a><br>-<a href="#1-%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E8%A6%81%E4%BB%B6%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF">1-アップグレード要件のチェック</a><br>-<a href="#2-%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%8C%E5%A4%B1%E6%95%97%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%80%81%E6%9C%80%E5%88%9D%E3%81%AB%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%9F%E3%81%84%E7%AE%87%E6%89%80">2-アップグレードが失敗したとき、最初確認したい箇所</a><br>-<a href="#3-%E9%A0%85%E7%95%AA-2-%E3%81%AB%E6%9B%B8%E3%81%8B%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E6%89%8B%E9%A0%86%E3%82%92%E5%AE%9F%E6%96%BD%E3%81%97%E3%81%A6%E3%82%82%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E5%A0%B4%E5%90%88">3-項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合</a><br>    - <a href="#EFI-%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%A9%BA%E3%81%8D%E4%B8%8D%E8%B6%B3%E3%82%92%E8%A7%A3%E6%B6%88">efi パーティションの空き不足を解消</a><br>    - <a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E9%87%8D%E8%A4%87%E3%82%92%E8%A7%A3%E6%B6%88">ユーザープロファイルの重複を解消</a><br>    - <a href="#%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%BB%E3%82%A8%E3%83%87%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%B8%80%E8%87%B4%E3%81%95%E3%81%9B%E3%82%8B">メディアの言語エディションを一致させる</a><br>-<a href="#4-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%94%E8%B3%AA%E5%95%8F%EF%BC%88%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E6%99%82%EF%BC%89">4-よくあるご質問アップグレード時</a><br>  -<a href="#Windows-old-%E3%82%92%E4%BD%9C%E3%82%89%E3%81%AA%E3%81%84%E6%96%B9%E6%B3%95">windows.old-を作らない方法</a><br>  -<a href="#%E5%85%83%E3%81%AE-OS-%E3%81%AB%E6%88%BB%E3%81%99%E6%96%B9%E6%B3%95%EF%BC%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%EF%BC%89">元の OS に戻す方法（ロールバック）</a><br>  -<a href="#%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E5%AE%B9%E9%87%8F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99%E6%96%B9%E6%B3%95">ディスク容量を増やす方法</a><br>-<a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B">5-お問い合わせ</a></p><hr><blockquote><p>本セクションでは、Windows 11 へのアップグレードする前に[まずご確認いただきたい操作]をまとめています。<br>詳細な原因の説明は省き、実際に役立つ手順だけを簡単な補足とともにご紹介します。</p></blockquote><h2 id="0-はじめに（準備のお願い）"><a href="#0-はじめに（準備のお願い）" class="headerlink" title="0) はじめに（準備のお願い）"></a>0) はじめに（準備のお願い）</h2><p>アップグレードに失敗するシナリオのうち、いくつかは事前準備の段階で予防が可能です。<br>スムーズにアップグレードを進めるためにも、以下の準備をご実施ください。  </p><ul><li><p><strong>最新のメディアを使用する</strong><br>意図しない互換性の問題の発生を防ぐためにも、アップグレードに最新版のメディアをご利用いただくことを強くお勧めいたします。<br>アップグレードに ISO メディアをご利用の場合は、インターネットに接続可能な環境にて、セットアップ画面の [セットアップでの更新プログラムのダウンロード方法の変更] より [更新プログラム、ドライバー、オプション機能をダウンロードする (推奨)] にチェックのうえ、アップグレードをご実施ください。<br>WSUS や MECM をご利用の場合、毎月リリースされる最新の累積更新プログラムを含む機能更新プログラムのパッケージをご利用ください。</p></li><li><p><strong>バックアップを取る</strong><br>大切なデータを守るため、事前にバックアップをお願いします。  </p></li><li><p><strong>BitLocker を一時停止</strong><br>既定ではアップグレード中に BitLocker の保護の中断を自動的に行う動作ですが、環境固有の何等かの理由により、BitLocker が中断されないことあるため、BitLocker 暗号化を一時的に止めることで、アップグレード中のエラーを防ぎます。<br>[BitLocker の管理] をスタートメニューから開き、[オペレーティング システム ドライブ] の [保護の中断] を実施してください。<br>※[保護の中断] を実施しても、次回再起動時またはアップグレード完了時に自動的に再開するので、ご安心ください。  </p></li><li><p><strong>周辺機器を外す</strong><br>接続されているハードウェアによってアップデートが失敗する場合があります。<br>可能な限り不要なデバイスを一時的に外し、必要最小限（キーボード、マウス、LAN）の構成にしてください。  </p></li><li><p><strong>管理者権限の確認</strong><br>コマンド実行や設定変更に必要です。<br>以降でご紹介する手順にはいくつかコマンドの実行がありますが、いずれも基本的には管理者権限を必要とします。<br>アップグレード時には出来るだけ管理者権限を利用できる状態で臨んでください。  </p></li><li><p><strong>ディスク容量を増やす</strong><br>一般的なガイダンスとして最低で 6GB - 11GB の空き領域が必要となっていますが、10GB 以上が必要となるケースがほとんどです。<br>さらに言えば、一時的に利用される領域等も加味した、弊社サポートとしての推奨値としては 20GB - 30GB の空き領域を確保していただきたいです。<br>以下の公開情報を参考に、十分な空き領域の確保をご実施ください。</p><p>Title : Windows でドライブの空き領域を増やす<br>URL   : <a href="https://support.microsoft.com/ja-jp/windows/85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/85529ccb-c365-490d-b548-831022bc9b32</a></p></li></ul><hr><h2 id="1-アップグレード要件のチェック"><a href="#1-アップグレード要件のチェック" class="headerlink" title="1) アップグレード要件のチェック"></a>1) アップグレード要件のチェック</h2><p>Windows 11 をご利用いただくに際しては、いくつかの必須要件があります。<br>アップグレードの実施前に、利用中の環境が条件を満たしているかご確認ください。  </p><ul><li><p><strong>TPM 2.0 の確認</strong><br>ハードウェアで提供されるセキュリティ機能ですが、Windows 11 では本機能の搭載が必須です。<br><code>Win</code> + <code>R</code> → <code>tpm.msc</code> を入力し、**[仕様バージョン: 2.0]** と表示されているか確認してください。<br>また、ここでバージョンが指定されたものではない、あるいは表示されないなどがあれば、UEFI の設定で無効化されているだけの場合もあります。<br>TPM の利用可否も含め、本項目で不明点がある場合は PC の提供元へご相談ください。</p></li><li><p><strong>UEFI とセキュアブート</strong><br>起動方式が UEFI で、セキュアブートが有効になっているか確認します。<br><code>Win</code> + <code>R</code> → <code>msinfo32</code> を入力し、以下を確認してください：  </p><ul><li><strong>BIOS モード: UEFI</strong>  </li><li><strong>セキュアブートの状態: 有効</strong></li></ul></li><li><p><strong>ハードウェア要件</strong><br>CPU 1GHz/2コア以上（対応CPU）、RAM 4GB以上、ストレージ64GB以上、DirectX 12対応GPU/WDDM 2.0。</p></li></ul><p>など、主な項目と確認方法を挙げましたが、詳細については以下の公開情報に纏められていますので、合わせてご確認ください。</p><p>  Title : Windows 11 の仕様、機能、コンピューターの要件を確認する<br>  URL   : <a href="https://www.microsoft.com/ja-jp/windows/windows-11-specifications">https://www.microsoft.com/ja-jp/windows/windows-11-specifications</a>  </p><p>また、これらの要件を満たしているかどうかは、以下の [PC 正常性チェック] アプリで一括確認することもできます。<br>※ 本ツールは WSUS や MECM に管理されている端末では利用できません。</p><ul><li><p><strong>PC 正常性チェック</strong>  </p><p>Title : PC 正常性チェック アプリの使用方法<br>URL   : <a href="https://support.microsoft.com/ja-jp/windows/9c8abd9b-03ba-4e67-81ef-36f37caa7844">https://support.microsoft.com/ja-jp/windows/9c8abd9b-03ba-4e67-81ef-36f37caa7844</a>    </p></li></ul><hr><blockquote><p>ここまでが準備編になります。<br>これ以降は、実際にアップグレードに臨んだものの、エラーになってしまった場合などの対処方法になります。</p></blockquote><hr><h2 id="2-アップグレードが失敗したとき、最初に確認したい箇所"><a href="#2-アップグレードが失敗したとき、最初に確認したい箇所" class="headerlink" title="2) アップグレードが失敗したとき、最初に確認したい箇所"></a>2) アップグレードが失敗したとき、最初に確認したい箇所</h2><p>アップグレードが失敗した場合、多くのシナリオで以下の項目を解決する事により改善が確認されております。<br>また、これらの要因でアップグレードが失敗する場合、特定のエラーが返されるわけではないため、エラーの内容等から対処方法を一意に特定することが非常に困難な内容となります。<br>特に優先順位はありませんが、いずれも事例として非常に多いものとなりますので、可能な限り全て同時にお試しください。  </p><ol><li><p><strong>サードパーティ製セキュリティソフトを一時的に停止またはアンインストールする</strong><br>他社製のウイルス対策や暗号化ソフトが原因になることがあります。<br>また、これらのソフトウェアは多くの場合、ドライバーとして機能の一部をインストールしています。<br>その場合、ソフトウェア上から [停止] [無効] などを実行しても、実は稼働したまま、という事が多くあります。<br>停止後もアップグレードが失敗する場合は、併せて [アンインストール] をご検討ください。</p></li><li><p><strong>ドライバーを最新にする</strong><br>特にストレージやネットワーク関連は重要です。<br>Windows Update の [オプションの更新] や、各ベンダーから提供されているツールで更新してください。  </p></li><li><p><strong>BIOS/UEFI を更新</strong><br>古いファームウェアはアップグレードを妨げる場合があります。<br>BIOS/UEFI に関しては更新の方法も様々ですので、PC の提供元へ確認の上でご実施ください。  </p></li><li><p><strong>システム整合性の修復</strong><br>以下のコマンドでシステムを修復します。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Cleanup-Image /RestoreHealth</span><br><span class="line">sfc /scannow</span><br></pre></td></tr></table></figure><p>これにより、Windows コンポーネントに破損が生じている場合も、可能な範囲で修復が行われます。  </p></li></ol><hr><blockquote><p>ここから先は、ファイルの削除を含む手順が含まれますので、必ず重要なファイルはバックアップを取得してから臨んでください。</p></blockquote><hr><h2 id="3-項番-2-に書かれている手順を実施してもアップグレードに失敗してしまう場合"><a href="#3-項番-2-に書かれている手順を実施してもアップグレードに失敗してしまう場合" class="headerlink" title="3) 項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合"></a>3) 項番 2 に書かれている手順を実施してもアップグレードに失敗してしまう場合</h2><h3 id="EFI-パーティションの空き不足を解消"><a href="#EFI-パーティションの空き不足を解消" class="headerlink" title="EFI パーティションの空き不足を解消"></a>EFI パーティションの空き不足を解消</h3><p>EFI パーティションに空きがないとアップグレードに失敗します。<br>このシナリオに合致すると、多くの場合 [システム予約パーティションを更新できませんでした] という旨のエラーでアップグレードが失敗します。<br>以下のコマンドで EFI パーティションのフォルダ構成が確認できますので、それ以外のフォルダが存在しないか確認してみてください。  </p><p>Microsoft や Boot 以外のフォルダが存在する場合、サードパーティー製のアプリケーションや端末の提供元などによって作成・利用されている可能性がございます。これらフォルダ・ファイルが削除可能であるか提供元にご確認ください。</p><p>例) EFI フォルダ以下に、Microsoft や Boot 以外のフォルダが存在する　等<br>    この場合、PC やアプリケーションの提供元によって作成されている可能性がありますので、提供元へ相談しましょう。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\&gt;<span class="title">mountvol</span> <span class="title">y</span>: /<span class="title">s</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\&gt;<span class="title">y</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Y</span>:\&gt;<span class="title">tree</span></span></span><br><span class="line"><span class="function">フォルダー パスの一覧</span></span><br><span class="line"><span class="function">ボリューム シリアル番号は 36<span class="title">D4</span>-<span class="title">C9BB</span> です</span></span><br><span class="line"><span class="function"><span class="title">Y</span>:.</span></span><br><span class="line"><span class="function">└─<span class="title">EFI</span></span></span><br><span class="line"><span class="function">    ├─<span class="title">Microsoft</span></span></span><br><span class="line"><span class="function">    │  ├─<span class="title">Boot</span></span></span><br><span class="line"><span class="function">    |  | ～ <span class="title">Boot</span> フォルダ以下には多くのファイル/フォルダがあるため、省略しています ～</span></span><br><span class="line"><span class="function">    │  └─<span class="title">Recovery</span></span></span><br><span class="line"><span class="function">    └─<span class="title">Boot</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Y</span>:\&gt;</span></span><br></pre></td></tr></table></figure><p>また、同エラーに関して公開情報もありますので、こちらも確認してみてください。  </p><p>Title : Windows 10のインストール中に “システム予約パーティションを更新できませんでした” というエラーが表示される<br>URL   : <a href="https://support.microsoft.com/ja-jp/topic/46865f3f-37bb-4c51-c69f-07271b6672ac">https://support.microsoft.com/ja-jp/topic/46865f3f-37bb-4c51-c69f-07271b6672ac</a>  </p><hr><h3 id="ユーザープロファイルの重複を解消"><a href="#ユーザープロファイルの重複を解消" class="headerlink" title="ユーザープロファイルの重複を解消"></a>ユーザープロファイルの重複を解消</h3><p>Windows は複数のユーザーを作成することができ、それらのユーザーを使いわけて利用者ごとにデスクトップやドキュメント類を分けて管理することができます。<br>通常、これらは C:\Users フォルダ以下にユーザー毎のフォルダが作成されて管理されますが、この管理情報に誤りがある場合、アップグレードを妨げる事があります。<br>例) UserA と UserB のいずれも、<strong>C:\Users¥UserA</strong> を利用する事になってしまっている。  </p><p>上の例はわかりやすく書きましたが、こんな極端なシナリオは生じませんのでご安心ください。<br>ただ、[昔一時的に作成したけど削除したユーザーが、今メインで利用しているユーザーと同じフォルダを利用する事になっている。]<br>こういうシナリオは発生する可能性があります。<br>通常の Windows 利用時には全く問題となりませんが、アップグレード時には <strong>現時点で存在している全ユーザー情報</strong>の移行が必要ですので、これが問題になります。</p><p>各ユーザーには、SID と呼ばれる一意の ID が割り振られており、この ID 毎にユーザーのフォルダを管理しています。<br>次のコマンドを実行すると、各 SID (ユーザーに対して一意に割り当てられた ID) に対して設定された、プロファイルのパスを示す ProfileImagePath 値を纏めて表示できます。 </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList&quot; /v ProfileImagePath /s</span><br></pre></td></tr></table></figure><p>ここで、ProfileImagePath の指すパスが重複している SID がいないか確認してみてください。<br>もし複数の SID でパスが重複している場合、アップグレードの失敗に繋がります。<br>この場合は、次の手順で [利用されていない] SID のレジストリを削除してください。  </p><p>手順</p><ol><li>上のコマンドを実行し、フォルダ名が重複しているユーザーの SID (S- で始まるもの) を全て控えます。  </li><li>そのフォルダを利用しているユーザーで OS にサインインします。  </li><li>コマンド プロンプトから [whoami /user] を実行し、現時点でユーザーに紐づいている SID を確認します。  </li><li>レジストリ エディタを起動し、以下のキーまで移動します。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</li><li>[手順 3. で確認したほうではない] SID を右クリックし、エクスポート (.reg 形式) します。</li><li>[手順 3. で確認したほうではない] SID を右クリックし、削除します。</li></ol><p>※普段、自分が利用しているユーザーのフォルダがわからない場合、コマンド プロンプトを起動した際に表示される C:\Users のパスを確認してみてください。</p><p>コマンドプロンプト表示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Windows [Version 10.0.26100.6508]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line">C:\Users\admin&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="メディアの言語・エディションを一致させる"><a href="#メディアの言語・エディションを一致させる" class="headerlink" title="メディアの言語・エディションを一致させる"></a>メディアの言語・エディションを一致させる</h3><p>以下のコマンドで、今使っている Windows 10 のエディションと言語を確認してください。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Get-CurrentEdition</span><br><span class="line">DISM /Online /Get-TargetEditions</span><br><span class="line">DISM /Online /Get-Intl</span><br></pre></td></tr></table></figure><p><strong>現在のエディション</strong> がインストールに利用しているメディアに含まれているか確認してみてください。<br>その後、ここで確認した <strong>既定のシステム UI 言語</strong> と一致するメディアを利用して、OS のアップグレードを実施しましょう。  </p><hr><h2 id="4-よくあるご質問（アップグレード時）"><a href="#4-よくあるご質問（アップグレード時）" class="headerlink" title="4) よくあるご質問（アップグレード時）"></a>4) よくあるご質問（アップグレード時）</h2><h3 id="Windows-old-を作らない方法"><a href="#Windows-old-を作らない方法" class="headerlink" title="Windows.old を作らない方法"></a>Windows.old を作らない方法</h3><p>クリーンインストールのみ対応可能です。インプレースでは必ず作成されます。<br>ただし、Windows 11 へのアップグレード直後に自動削除する設定がありますので、アップグレードする際に、setup.exe に対して下記の /Uninstall Disable というオプションを設定することで利用可能です。</p><hr><h4 id="アップグレード後にすぐ-Windows-old-を自動削除するオプション"><a href="#アップグレード後にすぐ-Windows-old-を自動削除するオプション" class="headerlink" title="アップグレード後にすぐ Windows.old を自動削除するオプション"></a>アップグレード後にすぐ Windows.old を自動削除するオプション</h4><p>タイトル：/Uninstall<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#uninstall">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#uninstall</a>  </p><blockquote><p>/Uninstall<br>ユーザーが前のオペレーティング システムに戻れるようにするためのコントロールを Windows に含めるかどうかを決定します。<br>構文<br>/Uninstall {Enable | Disable}</p></blockquote><hr><p>なお、Windows Update で機能更新プログラムを配信する場合、通常 Setup.exe コマンドではないため、<br>代わりに以下のサイトで紹介されている setupconfig.ini に該当する記載をすることで、機能更新の際に、<br>当該設定を読み取って、設定項目に従って動作することが可能です。（機能更新前に、あらかじめ所定の場所に<br>SetupConfig.ini を配置しておく必要がございます。）</p><p>タイトル：Windows Update の使用<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-automation-overview?view=windows-11#using-windows-update">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-automation-overview?view=windows-11#using-windows-update</a>  </p><blockquote><p>Windows Update によって更新プログラムが配布されると、Windows セットアップは setupconfig ファイルの既定の場所を検索します。<br>setupconfig ファイルを %systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\WSUS\SetupConfig.ini に含めることができます。</p></blockquote><hr><h4 id="アップグレード後に手動で-Windows-old-を削除するオプション"><a href="#アップグレード後に手動で-Windows-old-を削除するオプション" class="headerlink" title="アップグレード後に手動で Windows.old を削除するオプション"></a>アップグレード後に手動で Windows.old を削除するオプション</h4><p>[設定 &gt; システム &gt; 記憶域 &gt; クリーンアップの推奨事項] で [以前の Windows のインストール] を削除してください。</p><hr><h4 id="Windows-old-をすぐに削除するコマンドについて"><a href="#Windows-old-をすぐに削除するコマンドについて" class="headerlink" title="Windows.old をすぐに削除するコマンドについて"></a>Windows.old をすぐに削除するコマンドについて</h4><p>管理者権限にて以下の 2 つのコマンドを実行することで、すぐに Windows.old を削除することが可能です。<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 削除設定</span><br><span class="line">&gt; DISM &#x2F;Online &#x2F;Remove-OSUninstall</span><br><span class="line"> </span><br><span class="line">2. SetupCleanupTask タスクの実行</span><br><span class="line">&gt; schtasks &#x2F;Run &#x2F;TN &quot;\Microsoft\Windows\Setup\SetupCleanupTask&quot; &#x2F;I</span><br></pre></td></tr></table></figure><br>なお、”前の バージョンの Windows に戻せる猶予期間” 以上の日数が経過している場合は、上記の 2 のコマンドのみでも削除可能でございます。</p><hr><h3 id="元の-OS-に戻す方法（ロールバック）"><a href="#元の-OS-に戻す方法（ロールバック）" class="headerlink" title="元の OS に戻す方法（ロールバック）"></a>元の OS に戻す方法（ロールバック）</h3><p>既定では 10 日以内なら [設定 &gt; システム &gt; 回復 &gt; 前のバージョンの Windows に戻す] からアップグレード前の状態に戻せます。<br>コマンドで戻す事も可能です。  </p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DISM /Online /Initiate-OSUninstall</span><br></pre></td></tr></table></figure><hr><h3 id="アップグレードする際にディスク容量を増やす方法"><a href="#アップグレードする際にディスク容量を増やす方法" class="headerlink" title="アップグレードする際にディスク容量を増やす方法"></a>アップグレードする際にディスク容量を増やす方法</h3><p>Windows OS における、ドライブの空き容量を増やすための手法に関する技術情報は、以下の公開情報に記載されています。</p><p>[公開情報]<br>タイトル：Windows でドライブの空き領域を増やす<br>URL：<a href="https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32</a>  </p><p>また、OS アップグレードに際して、必要な空き容量確保のために有効と考えられる主な手法として以下があります。</p><p><strong>A. ドライブ全体を圧縮する</strong></p><p>システム領域のみではなく、C ドライブ全体を圧縮 (C ドライブ内のすべてのフォルダーと、ファイルに圧縮属性を付与) することでも、空き領域を確保することができます。</p><p>※本操作にはドライブの大きさなどに依存して数十分を要する場合がございます。ご採用される場合は事前にテスト環境などで圧縮/圧縮解除にかかるお時間を測定ください。</p><ol><li><p>ファイル エクスプローラーより左パネルから [PC] を選択して C ドライブを右クリップしてプロパティを選択します。</p></li><li><p>[このドライブを圧縮してディスク領域を空ける] にチェックを入れます。</p></li><li><p>[ドライブ C:\ のみに変更を適用する] または [変更をドライブ C:\、サブフォルダ及びファイルに適用する] のいずれかを選択し OK を押下します。</p></li></ol><hr><p><strong>B. 休止状態を無効化し hiberfil.sys を削除する</strong></p><p>休止状態を利用している場合は一時的に無効化しhiberfil.sys を削除します。</p><ol><li><p>コマンド プロンプトを “管理者として実行” にて起動します。</p></li><li><p>以下のコマンドを実行します。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /h off</span><br></pre></td></tr></table></figure></li><li><p>システムの再起動を実行します。</p></li><li><p>再度休止状態を利用する場合は以下のコマンド実行後に再起動します。</p></li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercfg /h on</span><br></pre></td></tr></table></figure><hr><p><strong>C. ページング ファイル (pagefile.sys) を別ドライブに移動する</strong></p><p>Pagefile は大きなファイルのサイズとなりますため、可能であれば、別ドライブに移動します。</p><p>以下手順は C ドライブにある pagefile.sys を削除し D ドライブ等の別ドライブに pagefile.sys を移動する場合の手順です。</p><ol><li>ファイル名を指定して実行に “sysdm.cpl” と入力し OK をクリックします。</li><li>[システムのプロパティ] の [詳細設定] タブの [パフォーマンス] にある [設定(S)] をクリックします。</li><li>[詳細設定] タブの [仮想メモリ] の項目にある [変更(C)] ボタンをクリックします。</li><li>[すべてのドライブのページング ファイルのサイズを自動的に管理する(A)] オプションを外します。</li><li>[各ドライブのページング ファイルのサイズ] 欄よりC: を選択し、[ページング ファイルなし] のラジオボタンをクリックし、[設定]ボタンをクリックします。</li><li>[各ドライブのページング ファイルのサイズ] 欄の C: の項目が [なし] と表示されていることを確認します。</li><li>続けて[各ドライブのページング ファイルのサイズ] 欄の D: を選択します。</li><li>[カスタム サイズ] にチェックを入れて、特定のメモリ サイズ を指定するか、[システム管理サイズ] にチェックを入れて、[設定] をクリックします。  </li><li>[各ドライブのページング ファイルのサイズ] 欄の D: の項目が設定した表示に切り替わったことを確認します。</li><li>[OK] ボタンをクリックし画面を閉じます。</li><li>“変更結果はコンピューターを再起動しなければ有効になりません。” というポップアップが表示されますので、[OK] ボタンをクリックします。</li><li>端末を再起動し、設定を反映させます</li></ol><hr><p><strong>D. 外部ストレージの利用</strong></p><p>外部ストレージを挿入することで一時ファイルを別ドライブに移動することが可能です。</p><p>コマンドで実行する場合は /TempDriveオプションをご使用いただけます。</p><p>[参考情報]<br>タイトル: /TempDrive<br>URL: <a href="https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#tempdrive">https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-setup-command-line-options?view=windows-11#tempdrive</a></p><hr><p><strong>E. 一時ファイルの削除</strong></p><p>端末で保持されている一時ファイルにつきましては、以下公開情報に記載のディスクのクリーンアップにて</p><p>削除が可能となる場合があり、データの削除および空き容量の確保に寄与できる事がございますので、</p><p>併せてご案内させていただきます。</p><p>[公開情報]<br>タイトル：ディスクのクリーンアップ<br>URL：<a href="https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32">https://support.microsoft.com/ja-jp/windows/windows-%E3%81%A7%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E7%A9%BA%E3%81%8D%E9%A0%98%E5%9F%9F%E3%82%92%E5%A2%97%E3%82%84%E3%81%99-85529ccb-c365-490d-b548-831022bc9b32</a>  </p><hr><h2 id="お問い合わせ"><a href="#お問い合わせ" class="headerlink" title="お問い合わせ"></a>お問い合わせ</h2><p>ここまでの項目を全て試しても解決しない場合や、その他の問題に遭遇した場合など、有償の技術サポートが必要な場合は弊社までお問い合わせください。<br>お問い合わせ時には問題発生時のログが必要となりますが、Windows 10 -&gt; Windows 11 へのアップグレードが失敗する場合は、以下の資料で多くの情報が網羅できます。<br>お問い合わせをいただく際には、失敗直後に以下の情報を収集してください。  </p><p><strong>TSS の収集</strong><br>Title : 初期調査にご取得いただくログ情報<br>URL   : <a href="https://jpwinsup.github.io/mslog/deployment/general/initiallog-deployment/">https://jpwinsup.github.io/mslog/deployment/general/initiallog-deployment/</a>  </p><ol><li>上記ページの手順通りに資料取得を進めます。</li></ol><hr><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2025/09/30 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Windows Commercial Support Device and Deployment チームの堀之内です。  &lt;/p&gt;
&lt;p&gt;この記事では&lt;br&gt;・Windows 11 へのアップグレードをスムーズに進めるための準備&lt;br&gt;・よくあるトラブルと、解決</summary>
      
    
    
    
    <category term="Windows Update" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/"/>
    
    <category term="Feature Update (FU)" scheme="https://jpwinsup.github.io/blog/categories/Windows-Update/Feature-Update-FU/"/>
    
    
  </entry>
  
</feed>
